<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Byte REO & Mortgage Liability Management - Process Workflow</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: #111827;
            --bg-card: #1a2234;
            --accent-blue: #3b82f6;
            --accent-teal: #14b8a6;
            --accent-amber: #f59e0b;
            --accent-rose: #f43f5e;
            --accent-green: #22c55e;
            --accent-purple: #8b5cf6;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-subtle: rgba(255,255,255,0.08);
            --sidebar-width: 280px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Breadcrumb */
        .breadcrumb {
            background: linear-gradient(90deg, #0d1525 0%, #1a2234 100%);
            padding: 14px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
            border-bottom: 1px solid var(--border-subtle);
        }

        .breadcrumb a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            transition: all 0.2s;
            border: 1px solid var(--border-subtle);
        }

        .breadcrumb a:hover {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .breadcrumb .separator { color: var(--text-muted); font-size: 1.2rem; }
        .breadcrumb .current { color: var(--accent-amber); font-weight: 600; padding: 8px 16px; }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 54px;
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - 54px);
            background: var(--bg-secondary);
            overflow-y: auto;
            z-index: 1000;
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 25px 20px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-header h2 { color: var(--text-primary); font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
        .sidebar-header p { color: var(--text-muted); font-size: 0.85rem; }

        /* Tab Switch */
        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-tab {
            flex: 1;
            padding: 14px 10px;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            background: none;
            border-left: none;
            border-right: none;
            border-top: none;
        }

        .sidebar-tab:hover { background: rgba(255,255,255,0.03); color: var(--text-secondary); }
        .sidebar-tab.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); background: rgba(59, 130, 246, 0.08); }
        .sidebar-tab.agent-tab.active { color: var(--accent-purple); border-bottom-color: var(--accent-purple); background: rgba(139, 92, 246, 0.08); }

        .sidebar-nav { padding: 15px 0; flex: 1; overflow-y: auto; }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .nav-item:hover { background: rgba(255,255,255,0.03); color: var(--text-primary); }
        .nav-item.active { background: rgba(59, 130, 246, 0.1); border-left-color: var(--accent-blue); color: var(--text-primary); }

        .nav-number {
            background: rgba(255,255,255,0.1);
            color: var(--text-secondary);
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .nav-item.active .nav-number { background: var(--accent-blue); color: white; }
        .nav-label { font-size: 0.95rem; font-weight: 500; }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-subtle);
            background: rgba(0,0,0,0.2);
        }

        .doc-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px 20px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .doc-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3); }

        /* Main Content */
        .main-content { margin-left: var(--sidebar-width); padding: 80px 40px 40px 40px; }

        /* Tab Panels */
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        .header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(20, 184, 166, 0.08) 0%, transparent 50%);
            pointer-events: none;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        .header .meta { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; position: relative; }

        .header .meta-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-subtle);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); }
        .legend-color { width: 18px; height: 18px; border-radius: 4px; }

        /* Sections */
        .section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            margin-bottom: 25px;
            overflow: hidden;
            scroll-margin-top: 75px;
        }

        .section-header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(59, 130, 246, 0.1) 100%);
            border-bottom: 1px solid var(--border-subtle);
            padding: 22px 25px;
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .section-number {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .section-title h2 { font-size: 1.35rem; font-weight: 700; margin-bottom: 4px; color: var(--text-primary); }
        .section-title span { font-size: 0.9rem; color: var(--text-muted); }
        .section-content { padding: 28px; }

        /* Workflow Diagrams */
        .workflow-diagram {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 28px;
            margin-bottom: 22px;
        }

        .flow-row { display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 12px; margin: 15px 0; }

        .flow-node {
            padding: 14px 22px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            min-width: 150px;
            border: 1px solid var(--border-subtle);
        }

        .flow-node.start { background: linear-gradient(135deg, var(--accent-green) 0%, #16a34a 100%); color: white; border-radius: 25px; border: none; }
        .flow-node.action { background: linear-gradient(135deg, var(--accent-blue) 0%, #2563eb 100%); color: white; border: none; }
        .flow-node.decision { background: linear-gradient(135deg, var(--accent-amber) 0%, #d97706 100%); color: var(--bg-primary); border: none; }
        .flow-node.input { background: var(--bg-secondary); border: 2px solid var(--accent-blue); color: var(--text-primary); }
        .flow-node.output { background: linear-gradient(135deg, var(--accent-teal) 0%, #0d9488 100%); color: white; border: none; }
        .flow-node.exception { background: linear-gradient(135deg, var(--accent-rose) 0%, #dc2626 100%); color: white; border: none; }

        .flow-arrow { color: var(--accent-blue); font-size: 1.5rem; }
        .flow-arrow.down { transform: rotate(90deg); }

        .decision-branch { display: flex; gap: 40px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
        .branch { display: flex; flex-direction: column; align-items: center; gap: 10px; }

        .branch-label {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        /* Tables */
        .field-table { width: 100%; border-collapse: collapse; margin: 18px 0; }

        .field-table th {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            padding: 14px 18px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border-subtle);
        }

        .field-table td { padding: 14px 18px; border-bottom: 1px solid var(--border-subtle); color: var(--text-secondary); }
        .field-table tr:hover { background: rgba(255,255,255,0.02); }

        .badge { display: inline-block; padding: 4px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge.required-badge { background: rgba(244, 63, 94, 0.15); color: var(--accent-rose); }
        .badge.optional-badge { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .badge.calculated-badge { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }

        /* Info Boxes */
        .exception-box, .tip-box, .info-box {
            padding: 18px 22px;
            margin: 18px 0;
            border-radius: 0 10px 10px 0;
            border-left-width: 4px;
            border-left-style: solid;
        }

        .exception-box { background: rgba(244, 63, 94, 0.08); border-color: var(--accent-rose); border: 1px solid rgba(244, 63, 94, 0.2); border-left: 4px solid var(--accent-rose); }
        .exception-box h4 { color: var(--accent-rose); margin-bottom: 10px; font-size: 1rem; }
        .exception-box p, .exception-box li { color: var(--text-secondary); }

        .tip-box { background: rgba(34, 197, 94, 0.08); border-color: var(--accent-green); border: 1px solid rgba(34, 197, 94, 0.2); border-left: 4px solid var(--accent-green); }
        .tip-box h4 { color: var(--accent-green); margin-bottom: 10px; font-size: 1rem; }
        .tip-box p, .tip-box li { color: var(--text-secondary); }

        .info-box { background: rgba(59, 130, 246, 0.08); border-color: var(--accent-blue); border: 1px solid rgba(59, 130, 246, 0.2); border-left: 4px solid var(--accent-blue); }
        .info-box h4 { color: var(--accent-blue); margin-bottom: 10px; font-size: 1rem; }
        .info-box p, .info-box li { color: var(--text-secondary); }

        /* Decision Tree */
        .decision-tree {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 22px;
            margin: 22px 0;
        }

        .decision-tree h3 { color: var(--accent-blue); margin-bottom: 18px; padding-bottom: 12px; border-bottom: 1px solid var(--border-subtle); font-size: 1.1rem; }

        .tree-node { margin-left: 20px; padding: 12px; border-left: 2px solid var(--accent-teal); position: relative; color: var(--text-secondary); }
        .tree-node::before { content: ''; position: absolute; left: -2px; top: 22px; width: 15px; height: 2px; background: var(--accent-teal); }
        .tree-node.level-1 { margin-left: 0; border-left: none; }
        .tree-node.level-1::before { display: none; }

        .tree-label { background: var(--accent-amber); color: var(--bg-primary); padding: 6px 14px; border-radius: 6px; font-weight: 700; display: inline-block; margin-bottom: 6px; font-size: 0.9rem; }

        /* Summary Grid */
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 18px; margin: 22px 0; }

        .summary-card { background: rgba(0,0,0,0.3); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 22px; text-align: center; }
        .summary-card h4 { color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9rem; }
        .summary-card .value {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .summary-card .label { font-size: 0.85rem; color: var(--text-muted); margin-top: 8px; }

        /* MI Comparison Cards */
        .mi-comparison { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 22px 0; }

        .mi-card { background: rgba(0,0,0,0.2); border: 1px solid var(--border-subtle); border-radius: 12px; overflow: hidden; }
        .mi-card-header { background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%); color: white; padding: 18px; text-align: center; }
        .mi-card-header h4 { font-size: 1.05rem; }
        .mi-card-body { padding: 22px; }
        .mi-card ul { list-style: none; padding: 0; }
        .mi-card li { padding: 10px 0; border-bottom: 1px solid var(--border-subtle); display: flex; align-items: center; gap: 12px; color: var(--text-secondary); font-size: 0.95rem; }
        .mi-card li:last-child { border-bottom: none; }
        .check-icon { color: var(--accent-green); font-weight: bold; }
        .x-icon { color: var(--accent-rose); font-weight: bold; }

        /* Quick Reference */
        .quick-ref {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
            border: 1px solid var(--border-subtle);
            padding: 28px;
            border-radius: 16px;
            margin-top: 30px;
            font-family: 'JetBrains Mono', monospace;
            scroll-margin-top: 75px;
        }

        .quick-ref h3 { color: var(--accent-amber); margin-bottom: 18px; font-family: 'Plus Jakarta Sans', sans-serif; }
        .quick-ref pre { background: rgba(0,0,0,0.4); border: 1px solid var(--border-subtle); padding: 20px; border-radius: 10px; overflow-x: auto; font-size: 0.85rem; line-height: 1.7; color: var(--text-secondary); }

        /* ====== AGENT OPPORTUNITIES STYLES ====== */
        .agent-header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .agent-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(139, 92, 246, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .agent-header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        /* Heat Map */
        .heat-map-container { margin-bottom: 35px; }
        .heat-map-title { font-size: 1.3rem; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }

        .heat-map-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .heat-item {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .heat-item:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .heat-item:active { transform: scale(0.98); }

        .heat-item::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 4px;
        }

        .heat-item.critical::before { background: linear-gradient(90deg, #ef4444, #f97316); }
        .heat-item.high::before { background: linear-gradient(90deg, #f97316, #eab308); }
        .heat-item.medium::before { background: linear-gradient(90deg, #eab308, #22c55e); }
        .heat-item.low::before { background: linear-gradient(90deg, #22c55e, #14b8a6); }

        .heat-score {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.8rem;
            font-weight: 800;
        }

        .heat-item.critical .heat-score { color: #ef4444; }
        .heat-item.high .heat-score { color: #f97316; }
        .heat-item.medium .heat-score { color: #eab308; }
        .heat-item.low .heat-score { color: #22c55e; }

        .heat-name { font-size: 1rem; font-weight: 700; color: var(--text-primary); margin-bottom: 6px; padding-right: 50px; }
        .heat-desc { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; }

        .heat-metrics { display: flex; gap: 15px; margin-top: 12px; }
        .heat-metric { font-size: 0.75rem; color: var(--text-muted); }
        .heat-metric span { color: var(--text-secondary); font-weight: 600; }

        /* Agent Cards */
        .agent-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 25px; margin-bottom: 35px; }

        .agent-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .agent-card:hover { transform: translateY(-5px); box-shadow: 0 15px 50px rgba(0,0,0,0.3); }

        .agent-card.highlight {
            animation: highlightPulse 2s ease;
            box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.4);
        }

        @keyframes highlightPulse {
            0% { box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.6); }
            50% { box-shadow: 0 0 0 6px rgba(139, 92, 246, 0.5), 0 15px 50px rgba(139, 92, 246, 0.3); }
            100% { box-shadow: 0 0 0 0px transparent, 0 15px 50px rgba(0,0,0,0.3); }
        }

        .agent-card-header {
            padding: 22px;
            display: flex;
            align-items: flex-start;
            gap: 18px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .agent-icon {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            flex-shrink: 0;
        }

        .agent-info { flex: 1; }
        .agent-name { font-size: 1.15rem; font-weight: 700; color: var(--text-primary); margin-bottom: 5px; }
        .agent-type { font-size: 0.8rem; color: var(--accent-purple); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-priority {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .agent-priority.critical { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .agent-priority.high { background: rgba(249, 115, 22, 0.15); color: #f97316; }
        .agent-priority.medium { background: rgba(234, 179, 8, 0.15); color: #eab308; }
        .agent-priority.low { background: rgba(34, 197, 94, 0.15); color: #22c55e; }

        .agent-card-body { padding: 22px; }
        .agent-description { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; }

        .agent-flow {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 20px;
        }

        .agent-flow-title { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-flow-diagram { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; justify-content: center; }

        .agent-step {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .agent-arrow { color: var(--accent-purple); font-size: 1.2rem; }

        .agent-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }

        .agent-stat {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .agent-stat-value {
            font-size: 1.3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-top: 4px; }

        .agent-prompt-btn {
            width: 100%;
            margin-top: 18px;
            padding: 14px 20px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 10px;
            color: var(--accent-purple);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .agent-prompt-btn:hover {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(59, 130, 246, 0.3) 100%);
            border-color: var(--accent-purple);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.25);
        }

        /* Summary Stats */
        .agent-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .agent-summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            padding: 25px;
            text-align: center;
        }

        .agent-summary-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-summary-label { font-size: 0.9rem; color: var(--text-muted); margin-top: 8px; }

        /* Heat Map Legend */
        .heat-legend {
            display: flex;
            gap: 25px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .heat-legend-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; color: var(--text-secondary); }
        .heat-legend-color { width: 24px; height: 24px; border-radius: 6px; }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(10, 15, 26, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.show { display: flex; }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            width: 100%;
            max-width: 950px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 80px rgba(0,0,0,0.5);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            padding: 22px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 16px 16px 0 0;
        }

        .modal-header h3 { font-size: 1.25rem; font-weight: 700; }
        .modal-actions { display: flex; gap: 12px; }

        .modal-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: transform 0.2s;
            font-size: 0.9rem;
        }

        .modal-btn:hover { transform: scale(1.05); }
        .modal-btn.copy { background: white; color: var(--accent-blue); }
        .modal-btn.close { background: rgba(255,255,255,0.2); color: white; }

        .modal-body { padding: 28px; overflow-y: auto; flex: 1; }

        .modal-body pre {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            padding: 22px;
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.7;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--text-secondary);
        }

        .copy-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--accent-green);
            color: white;
            padding: 18px 35px;
            border-radius: 10px;
            font-weight: 700;
            z-index: 3000;
            display: none;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut { 0%, 100% { opacity: 0; } 10%, 90% { opacity: 1; } }

        /* Prompt Modal */
        .prompt-modal .modal { max-width: 800px; }
        .prompt-modal .modal-header { background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%); }

        .prompt-section { margin-bottom: 25px; }
        .prompt-section h4 { color: var(--accent-purple); font-size: 1rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }

        .prompt-box {
            background: rgba(0,0,0,0.4);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.7;
            color: var(--text-secondary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .prompt-tags { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .prompt-tag { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 75px 20px 30px 20px; }
            .agent-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <a href="../../index.html">Portal Home</a>
        <span class="separator">></span>
        <a href="./index.html">Byte</a>
        <span class="separator">></span>
        <span class="current">REO & Mortgage Liability</span>
    </nav>

    <!-- Fixed Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>REO & Liability</h2>
            <p>Interactive Workflow Guide</p>
        </div>

        <!-- Tab Switcher -->
        <div class="sidebar-tabs">
            <button class="sidebar-tab active" onclick="switchTab('workflow')">Workflow</button>
            <button class="sidebar-tab agent-tab" onclick="switchTab('agents')">AI Agents</button>
        </div>

        <!-- Workflow Navigation -->
        <nav class="sidebar-nav" id="workflow-nav">
            <a href="#section-1" class="nav-item active">
                <span class="nav-number">1</span>
                <span class="nav-label">Basics</span>
            </a>
            <a href="#section-2" class="nav-item">
                <span class="nav-number">2</span>
                <span class="nav-label">Occupancy Types</span>
            </a>
            <a href="#section-3" class="nav-item">
                <span class="nav-number">3</span>
                <span class="nav-label">Property Status</span>
            </a>
            <a href="#section-4" class="nav-item">
                <span class="nav-number">4</span>
                <span class="nav-label">REO Entry</span>
            </a>
            <a href="#section-5" class="nav-item">
                <span class="nav-number">5</span>
                <span class="nav-label">Mortgage Linking</span>
            </a>
            <a href="#section-6" class="nav-item">
                <span class="nav-number">6</span>
                <span class="nav-label">Rental Income</span>
            </a>
            <a href="#section-7" class="nav-item">
                <span class="nav-number">7</span>
                <span class="nav-label">FHA Specifics</span>
            </a>
            <a href="#section-8" class="nav-item">
                <span class="nav-number">8</span>
                <span class="nav-label">VA Specifics</span>
            </a>
            <a href="#quick-ref" class="nav-item">
                <span class="nav-number">*</span>
                <span class="nav-label">Quick Reference</span>
            </a>
        </nav>

        <!-- Agent Navigation -->
        <nav class="sidebar-nav" id="agents-nav" style="display: none;">
            <a href="#agent-summary" class="nav-item active">
                <span class="nav-number">S</span>
                <span class="nav-label">Summary</span>
            </a>
            <a href="#agent-heatmap" class="nav-item">
                <span class="nav-number">H</span>
                <span class="nav-label">Heat Map</span>
            </a>
            <a href="#agent-details" class="nav-item">
                <span class="nav-number">A</span>
                <span class="nav-label">Agent Details</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="doc-btn" onclick="openDocModal()">
                View Source Documentation
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

        <!-- ==================== WORKFLOW TAB ==================== -->
        <div id="workflow-panel" class="tab-panel active">
            <!-- Header -->
            <div class="header">
                <h1>Byte REO & Mortgage Liability Management</h1>
                <p class="subtitle">Complete Guide to Real Estate Owned Entry and Liability Handling</p>
                <div class="meta">
                    <span class="meta-item">System: Byte LOS</span>
                    <span class="meta-item">Role: Loan Processor / Underwriter</span>
                    <span class="meta-item">Updated: Feb 28, 2024</span>
                    <span class="meta-item">Complexity: Intermediate</span>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #22c55e, #16a34a);"></div><span>Start/End</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></div><span>Action Step</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></div><span>Decision Point</span></div>
                <div class="legend-item"><div class="legend-color" style="background: #111827; border: 2px solid #3b82f6;"></div><span>User Input</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f43f5e, #dc2626);"></div><span>Exception</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #14b8a6, #0d9488);"></div><span>Output</span></div>
            </div>

            <!-- Section 1: Basics -->
            <section id="section-1" class="section">
                <div class="section-header">
                    <div class="section-number">1</div>
                    <div class="section-title"><h2>Liability Basics</h2><span>Understanding Not Counted vs Omitted</span></div>
                </div>
                <div class="section-content">
                    <div class="info-box">
                        <h4>Key Concept</h4>
                        <p>This guide covers how to properly handle liabilities in Byte, with special focus on the critical differences between marking debts as "Not Counted" versus "Omitted".</p>
                    </div>

                    <div class="mi-comparison">
                        <div class="mi-card">
                            <div class="mi-card-header"><h4>Not Counted</h4></div>
                            <div class="mi-card-body">
                                <ul>
                                    <li><span class="check-icon">*</span> ONLY omits debt in Byte calculations</li>
                                    <li><span class="x-icon">!</span> Does NOT omit from AUS</li>
                                    <li><span class="check-icon">*</span> Payment still sent to DU/LP</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mi-card">
                            <div class="mi-card-header"><h4>Omitted</h4></div>
                            <div class="mi-card-body">
                                <ul>
                                    <li><span class="check-icon">*</span> Omits debt from AUS findings</li>
                                    <li><span class="check-icon">*</span> Removes from DU/LP submission</li>
                                    <li><span class="x-icon">!</span> Use carefully - affects findings</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="exception-box">
                        <h4>Critical Rule for Mortgage Debts</h4>
                        <p>Mortgage debts are <strong>automatically marked Not Counted</strong> in the Mortgage section because payments are picked up through the Real Estate Owned (REO) Screen. This prevents double-counting.</p>
                    </div>

                    <div class="tip-box">
                        <h4>REO-Mortgage Relationship</h4>
                        <p>Anytime there is a Mortgage listed, there <strong>MUST</strong> be an REO tied to it. However, there CAN be an REO listed without a mortgage (e.g., property owned free and clear).</p>
                    </div>
                </div>
            </section>

            <!-- Section 2: Occupancy Types -->
            <section id="section-2" class="section">
                <div class="section-header">
                    <div class="section-number">2</div>
                    <div class="section-title"><h2>Occupancy / Usage Types</h2><span>Current and Intended Occupancy selection</span></div>
                </div>
                <div class="section-content">
                    <table class="field-table">
                        <thead>
                            <tr><th>Occupancy Type</th><th>When to Use</th><th>Impact on DTI</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Primary Residence</strong></td>
                                <td>
                                    <ul style="margin-left: 20px; color: var(--text-secondary);">
                                        <li>It is the subject property, OR</li>
                                        <li>Property will be sold at or prior to closing</li>
                                    </ul>
                                </td>
                                <td>Payment may be excluded if being sold</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Second Home</strong></td>
                                <td>Only if truly a second/vacation home</td>
                                <td>PITI included in DTI</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Investment Property</strong></td>
                                <td>
                                    <ul style="margin-left: 20px; color: var(--text-secondary);">
                                        <li>Properties with rental income</li>
                                        <li>Borrower keeping current residence and renting it out</li>
                                        <li>Current residence not yet sold and may not sell before closing</li>
                                    </ul>
                                </td>
                                <td>Payment used in qualifying ratios; rental income may offset</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="decision-tree">
                        <h3>Occupancy Decision Logic</h3>
                        <div class="tree-node level-1"><span class="tree-label">Is this the subject property?</span></div>
                        <div class="tree-node"><span class="tree-label" style="background: var(--accent-green); color: white;">YES</span> --> Primary Residence (for owner-occupied)</div>
                        <div class="tree-node"><span class="tree-label" style="background: var(--text-muted); color: white;">NO</span> --> Continue below...</div>
                        <div class="tree-node level-1" style="margin-top: 15px;"><span class="tree-label">Will property be sold at/before closing?</span></div>
                        <div class="tree-node"><span class="tree-label" style="background: var(--accent-green); color: white;">YES</span> --> Primary Residence (pending sale)</div>
                        <div class="tree-node"><span class="tree-label" style="background: var(--text-muted); color: white;">NO</span> --> Investment Property (payment counts in DTI)</div>
                    </div>
                </div>
            </section>

            <!-- Section 3: Property Status -->
            <section id="section-3" class="section">
                <div class="section-header">
                    <div class="section-number">3</div>
                    <div class="section-title"><h2>Property Status Options</h2><span>How status affects qualifying ratios</span></div>
                </div>
                <div class="section-content">
                    <div class="summary-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                        <div class="summary-card" style="background: rgba(34, 197, 94, 0.1);">
                            <h4 style="color: var(--accent-green);">Sold</h4>
                            <div class="label">Property is sold and will close during loan process. UW can approve CD from Sale for Cash-to-Close.</div>
                        </div>
                        <div class="summary-card" style="background: rgba(59, 130, 246, 0.1);">
                            <h4 style="color: var(--accent-blue);">Pending Sale</h4>
                            <div class="label">Property will be sold at/before closing. CD becomes a closing condition.</div>
                        </div>
                        <div class="summary-card" style="background: rgba(139, 92, 246, 0.1);">
                            <h4 style="color: var(--accent-purple);">Retained - Rental</h4>
                            <div class="label">Property generates rental income. Intended Usage = Investment. Also for primary converting to investment.</div>
                        </div>
                        <div class="summary-card" style="background: rgba(245, 158, 11, 0.1);">
                            <h4 style="color: var(--accent-amber);">Retained - Non-Rental</h4>
                            <div class="label">Property held as primary or secondary residence without rental income.</div>
                        </div>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr><th>Intended Usage</th><th>When to Select</th><th>Notes</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Leave Blank</strong></td>
                                <td>Property will be Sold at or before Closing</td>
                                <td>Do not make a choice</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Primary Residence</strong></td>
                                <td>Refinance where borrower continues to owner-occupy</td>
                                <td>Only for refinances</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Second Home</strong></td>
                                <td>Property is a second home OR a Lot</td>
                                <td>Also use for retained property with explanation in Conversation Log</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Investment Property</strong></td>
                                <td>Properties with rental income, OR current primary being rented out, OR current primary not yet sold</td>
                                <td>Ensures payment is used in qualifying ratios</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Section 4: REO Entry -->
            <section id="section-4" class="section">
                <div class="section-header">
                    <div class="section-number">4</div>
                    <div class="section-title"><h2>Byte REO Entry Process</h2><span>Step-by-step REO screen completion</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Start</div>
                            <span class="flow-arrow">--></span>
                            <div class="flow-node action">URLA Borrower Info</div>
                            <span class="flow-arrow">--></span>
                            <div class="flow-node action">REO Tab/Section</div>
                            <span class="flow-arrow">--></span>
                            <div class="flow-node input">Click + to Add Property</div>
                        </div>
                    </div>

                    <h3 style="color: var(--accent-blue); margin: 25px 0 15px;">Edit REO Screen Fields</h3>

                    <table class="field-table">
                        <thead>
                            <tr><th>Step</th><th>Field</th><th>Action</th><th>Critical Notes</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="badge calculated-badge">1</span></td>
                                <td><strong style="color: var(--text-primary);">Borrower</strong></td>
                                <td>Select borrower from dropdown</td>
                                <td><span class="badge required-badge">Must Match</span> Liability borrower</td>
                            </tr>
                            <tr>
                                <td><span class="badge calculated-badge">2</span></td>
                                <td><strong style="color: var(--text-primary);">Held</strong></td>
                                <td>Select Jointly, Individual, etc.</td>
                                <td><span class="badge required-badge">Must Match</span> Liability - or DU error</td>
                            </tr>
                            <tr>
                                <td><span class="badge calculated-badge">3</span></td>
                                <td><strong style="color: var(--text-primary);">This is the subject property</strong></td>
                                <td>Check if doing a Refinance</td>
                                <td>Leave unchecked for purchases</td>
                            </tr>
                            <tr>
                                <td><span class="badge calculated-badge">4</span></td>
                                <td><strong style="color: var(--text-primary);">Current Usage</strong></td>
                                <td>Select appropriate type</td>
                                <td>If Primary, address chosen from cardex</td>
                            </tr>
                            <tr>
                                <td><span class="badge calculated-badge">5</span></td>
                                <td><strong style="color: var(--text-primary);">Intended Usage</strong></td>
                                <td>Select post-closing usage</td>
                                <td>If retained, choose Second Home + add Conversation Log note</td>
                            </tr>
                            <tr>
                                <td><span class="badge calculated-badge">6</span></td>
                                <td><strong style="color: var(--text-primary);">Status</strong></td>
                                <td>Sold / Pending Sale / Retained</td>
                                <td>Affects qualifying ratios</td>
                            </tr>
                            <tr>
                                <td><span class="badge calculated-badge">7</span></td>
                                <td><strong style="color: var(--text-primary);">Type</strong></td>
                                <td>Single Family, Condo, etc.</td>
                                <td>Must match property type</td>
                            </tr>
                            <tr>
                                <td><span class="badge calculated-badge">8</span></td>
                                <td><strong style="color: var(--text-primary);">Present Market Value</strong></td>
                                <td>Enter current value</td>
                                <td>Required field</td>
                            </tr>
                            <tr>
                                <td><span class="badge calculated-badge">9</span></td>
                                <td><strong style="color: var(--text-primary);">No Units</strong></td>
                                <td>Enter unit count</td>
                                <td>Usually 1 for SFR</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="exception-box">
                        <h4>Do NOT Manually Add Mortgage</h4>
                        <p>Do not click the + button to attach a mortgage that is already on credit. The manual add feature is ONLY used if a mortgage is NOT listed on credit report.</p>
                    </div>

                    <div class="tip-box">
                        <h4>Sorting Liabilities</h4>
                        <p>To match credit report order: Go to URLA Borrower Info --> Liabilities --> Click "Show All Liabilities" --> Click Balance column --> Select "Sort by Balance Descending"</p>
                    </div>
                </div>
            </section>

            <!-- Section 5: Mortgage Linking -->
            <section id="section-5" class="section">
                <div class="section-header">
                    <div class="section-number">5</div>
                    <div class="section-title"><h2>Linking Mortgages to REO</h2><span>Edit Liability screen configuration</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Double-click Mortgage in list</div>
                            <span class="flow-arrow">--></span>
                            <div class="flow-node input">Edit Liability opens</div>
                            <span class="flow-arrow">--></span>
                            <div class="flow-node decision">Verify Borrower & Held match REO</div>
                        </div>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr><th>Field</th><th>Setting</th><th>Explanation</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Not Counted</strong></td>
                                <td>Automatically checked for mortgages</td>
                                <td>Ratios calculated from REO section, not Mortgage section</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">To Be Paid Off</strong></td>
                                <td>Check if mortgage being paid at closing</td>
                                <td>Marks for payoff processing</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Property</strong></td>
                                <td>Select from dropdown OR click Edit Property</td>
                                <td>Links mortgage to correct REO</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Lien Position</strong></td>
                                <td>Enter 1, 2, etc.</td>
                                <td>First mortgage = 1</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3 style="color: var(--accent-blue); margin: 25px 0 15px;">PITIA Calculation Section</h3>

                    <div class="mi-comparison">
                        <div class="mi-card">
                            <div class="mi-card-header"><h4>T&I/HOD Included in Mtg</h4></div>
                            <div class="mi-card-body">
                                <ul>
                                    <li><span class="check-icon">*</span> Check this box if taxes and insurance are escrowed</li>
                                    <li><span class="check-icon">*</span> PITIA will equal mortgage payment</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mi-card">
                            <div class="mi-card-header"><h4>T&I NOT Included</h4></div>
                            <div class="mi-card-body">
                                <ul>
                                    <li><span class="check-icon">*</span> Leave box unchecked</li>
                                    <li><span class="check-icon">*</span> Enter amount in Taxes, Insurance, HOD field</li>
                                    <li><span class="check-icon">*</span> PITIA = Mortgage + T&I/HOD</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 6: Rental Income -->
            <section id="section-6" class="section">
                <div class="section-header">
                    <div class="section-number">6</div>
                    <div class="section-title"><h2>Rental / Investment Income Entry</h2><span>Net Rental Income calculation in REO</span></div>
                </div>
                <div class="section-content">
                    <div class="info-box">
                        <h4>When Investment is Intended Occupancy</h4>
                        <p>When Investment is chosen as Intended Occupancy, the Gross Rental Income section becomes enabled in the Edit REO screen.</p>
                    </div>

                    <div class="mi-comparison">
                        <div class="mi-card">
                            <div class="mi-card-header"><h4>NOT on Tax Return</h4></div>
                            <div class="mi-card-body">
                                <ul>
                                    <li><span class="check-icon">*</span> Property purchased current year</li>
                                    <li><span class="check-icon">*</span> Enter monthly rent in Gross Rental Income</li>
                                    <li><span class="check-icon">*</span> Vacancy defaults to 25%</li>
                                    <li><span class="check-icon">*</span> Can override if loan type allows different factor</li>
                                    <li><span class="check-icon">*</span> Need copies of Lease</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mi-card">
                            <div class="mi-card-header"><h4>Listed on Tax Return</h4></div>
                            <div class="mi-card-body">
                                <ul>
                                    <li><span class="check-icon">*</span> Schedule E calculation done via Loanbeam</li>
                                    <li><span class="check-icon">*</span> Enter Loanbeam result in Gross Rental Income</li>
                                    <li><span class="check-icon">*</span> Override Vacancy to 0%</li>
                                    <li><span class="x-icon">!</span> Do NOT override Net Rental Income</li>
                                    <li><span class="check-icon">*</span> Need copies of Lease</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <h3 style="color: var(--accent-blue); margin: 25px 0 15px;">Net Rental Income Calculation</h3>

                    <table class="field-table">
                        <thead>
                            <tr><th>Field</th><th>Source</th><th>Calculation</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Gross Rental Income</strong></td>
                                <td>Monthly rent or Loanbeam</td>
                                <td>User entered</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Vacancy Factor</strong></td>
                                <td>Default 25% or Override</td>
                                <td>Set to 0% for Schedule E properties</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Income Less Vacancy</strong></td>
                                <td>Calculated</td>
                                <td>Gross x (1 - Vacancy%)</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Mortgage Payments</strong></td>
                                <td>From linked mortgage</td>
                                <td>Monthly P&I</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Taxes, Insurance, HOD</strong></td>
                                <td>User entered if not escrowed</td>
                                <td>Monthly T&I amount</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--accent-teal);">Net Rental Income</strong></td>
                                <td>Calculated</td>
                                <td>Income Less Vacancy - PITIA</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="tip-box">
                        <h4>Program Requirements Vary</h4>
                        <p>Rules on the use of Rental Income vary by loan program. Always check the Guidelines for specific requirements.</p>
                    </div>
                </div>
            </section>

            <!-- Section 7: FHA Specifics -->
            <section id="section-7" class="section">
                <div class="section-header">
                    <div class="section-number">7</div>
                    <div class="section-title"><h2>FHA Loan Specifics</h2><span>Paid at Close vs Omitted for FHA</span></div>
                </div>
                <div class="section-content">
                    <div class="exception-box">
                        <h4>Critical FHA Rule</h4>
                        <p>If a debt is to be paid at close, INCLUDING REVOLVING, you only mark it as <strong>Paid at Close</strong> (and Not Counted so Byte excludes). <strong>Do NOT mark the omit button.</strong></p>
                    </div>

                    <div class="workflow-diagram">
                        <h3 style="text-align: center; margin-bottom: 22px; color: var(--accent-blue);">FHA Debt Handling Flow</h3>
                        <div class="flow-row">
                            <div class="flow-node decision">Debt to be paid at closing?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">YES</span>
                                <span class="flow-arrow" style="transform: rotate(90deg);">--></span>
                                <div class="flow-node action">Mark: To Be Paid Off + Not Counted</div>
                                <span class="flow-arrow" style="transform: rotate(90deg);">--></span>
                                <div class="flow-node output">AUS shows debt paid off, Funds to Close INCLUDES payoff</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">WRONG: Omitted</span>
                                <span class="flow-arrow" style="transform: rotate(90deg);">--></span>
                                <div class="flow-node exception">AUS thinks paid outside closing, Funds to Close WRONG</div>
                            </div>
                        </div>
                    </div>

                    <div class="info-box">
                        <h4>Why This Matters</h4>
                        <p>If you mark debts as Omitted instead of just Paid at Close + Not Counted, your AUS will think debts are being paid outside of closing, and your funds to close figure will be inaccurate. This applies to both installment AND revolving debts.</p>
                    </div>

                    <div class="tip-box">
                        <h4>Correct FHA Configuration</h4>
                        <p>For debts paid at closing on FHA loans:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>Check: <strong>To Be Paid Off</strong></li>
                            <li>Check: <strong>Not Counted</strong></li>
                            <li>Leave Unchecked: <strong>Omitted</strong></li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 8: VA Specifics -->
            <section id="section-8" class="section">
                <div class="section-header">
                    <div class="section-number">8</div>
                    <div class="section-title"><h2>VA Loan Specifics</h2><span>Known glitch and workaround for VA Loan Analysis</span></div>
                </div>
                <div class="section-content">
                    <div class="exception-box">
                        <h4>Known Byte Glitch for VA Loans</h4>
                        <p>On VA new purchase loans where borrower owns a home and will sell it prior to closing: Even though you mark it Pending Sale (ratios correct) and Omitted (AUS correct), the <strong>Residual Income and DTI on the VA Loan Analysis screen will be WRONG</strong>.</p>
                    </div>

                    <div class="workflow-diagram">
                        <h3 style="text-align: center; margin-bottom: 22px; color: var(--accent-blue);">VA Workaround Process</h3>
                        <div class="flow-row">
                            <div class="flow-node start">VA Purchase + Selling Current Home</div>
                            <span class="flow-arrow">--></span>
                            <div class="flow-node decision">Residual Income Wrong?</div>
                        </div>
                        <div class="flow-row">
                            <span class="flow-arrow" style="transform: rotate(90deg);">--></span>
                        </div>
                        <div class="flow-row">
                            <div class="flow-node action">Zero Out the Payment (ONLY for mortgage being paid off through sale)</div>
                        </div>
                        <div class="flow-row">
                            <span class="flow-arrow" style="transform: rotate(90deg);">--></span>
                        </div>
                        <div class="flow-row">
                            <div class="flow-node output">Corrected Residual & DTI on VA Loan Analysis</div>
                        </div>
                    </div>

                    <div class="info-box">
                        <h4>When to Use This Workaround</h4>
                        <p>This is particularly helpful when you're close to residual requirements and not meeting the minimum (when you should be). The issue occurs because Byte's VA Loan Analysis screen doesn't properly account for pending sale properties.</p>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr><th>Scenario</th><th>Problem</th><th>Solution</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Mortgage on property being sold</strong></td>
                                <td>Payment still showing in VA Loan Analysis DTI</td>
                                <td>Zero out the payment amount</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Residual Income too low</strong></td>
                                <td>Not meeting minimums when you should qualify</td>
                                <td>Zero out payment to correct calculation</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="tip-box">
                        <h4>Important Note</h4>
                        <p>Only zero out the payment for the specific mortgage being paid off through the sale. Do not modify other debts or liabilities.</p>
                    </div>
                </div>
            </section>

            <!-- Quick Reference -->
            <section id="quick-ref" class="quick-ref">
                <h3>Quick Reference Card</h3>
                <pre>
NAVIGATION: URLA Borrower Info --> Liabilities or REO Tab

KEY RULES:
* Not Counted = Omits from Byte only, NOT from AUS
* Omitted = Removes from AUS findings entirely
* Mortgage debts auto-marked Not Counted (picked up via REO)
* Every Mortgage MUST have an REO tied to it

OCCUPANCY SELECTION:
* Primary Residence: Subject property OR being sold
* Second Home: True second home only
* Investment: Rental income OR current home not selling

PROPERTY STATUS:
* Sold: Closed during loan process
* Pending Sale: Will sell at/before closing (CD condition)
* Retained - Rental: Investment with rental income
* Retained - Non-Rental: Kept as primary/secondary

RENTAL INCOME:
* Not on Tax Return: Enter rent, 25% vacancy default
* On Tax Return: Enter Loanbeam result, Override vacancy to 0%

FHA SPECIFICS:
* Paid at Close: Mark "To Be Paid Off" + "Not Counted"
* NEVER mark "Omitted" for debts paid at closing

VA SPECIFICS:
* Known glitch: Residual/DTI wrong for pending sale properties
* Workaround: Zero out payment for mortgage being sold
                </pre>
            </section>
        </div>

        <!-- ==================== AGENT OPPORTUNITIES TAB ==================== -->
        <div id="agents-panel" class="tab-panel">
            <!-- Header -->
            <div class="agent-header">
                <h1>AI Agent Opportunities</h1>
                <p class="subtitle">Automation Analysis for REO & Liability Management Workflow</p>
                <div class="meta">
                    <span class="meta-item">8 Process Steps Analyzed</span>
                    <span class="meta-item">4 Agent Candidates Identified</span>
                    <span class="meta-item">Est. 45% Time Savings</span>
                </div>
            </div>

            <!-- Summary Stats -->
            <div class="agent-summary" id="agent-summary">
                <div class="agent-summary-card">
                    <div class="agent-summary-value">4</div>
                    <div class="agent-summary-label">Agent Candidates</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">2</div>
                    <div class="agent-summary-label">High Priority</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">45%</div>
                    <div class="agent-summary-label">Time Savings</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">90%</div>
                    <div class="agent-summary-label">Error Reduction</div>
                </div>
            </div>

            <!-- Heat Map Legend -->
            <div class="heat-legend" id="agent-heatmap">
                <div class="heat-legend-item"><div class="heat-legend-color" style="background: linear-gradient(135deg, #ef4444, #f97316);"></div><span><strong>Critical (90-100)</strong> - Immediate ROI</span></div>
                <div class="heat-legend-item"><div class="heat-legend-color" style="background: linear-gradient(135deg, #f97316, #eab308);"></div><span><strong>High (70-89)</strong> - Strong candidate</span></div>
                <div class="heat-legend-item"><div class="heat-legend-color" style="background: linear-gradient(135deg, #eab308, #22c55e);"></div><span><strong>Medium (50-69)</strong> - Consider</span></div>
                <div class="heat-legend-item"><div class="heat-legend-color" style="background: linear-gradient(135deg, #22c55e, #14b8a6);"></div><span><strong>Low (0-49)</strong> - Future phase</span></div>
            </div>

            <!-- Heat Map Grid -->
            <div class="heat-map-container">
                <div class="heat-map-title">Automation Priority Heat Map <span style="font-size: 0.8rem; font-weight: 400; color: var(--text-muted);">(Click to jump to agent)</span></div>
                <div class="heat-map-grid">
                    <div class="heat-item critical" onclick="scrollToAgent('agent-reo-validator')" title="Click to view agent details">
                        <div class="heat-score">94</div>
                        <div class="heat-name">REO-Mortgage Validator</div>
                        <div class="heat-desc">Auto-validate Borrower/Held match between REO and Liabilities</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Effort: <span>Low</span></div>
                            <div class="heat-metric">Impact: <span>High</span></div>
                            <div class="heat-metric">Step: <span>4-5</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-occupancy')" title="Click to view agent details">
                        <div class="heat-score">85</div>
                        <div class="heat-name">Occupancy Recommender</div>
                        <div class="heat-desc">Suggest correct occupancy type based on loan scenario</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Effort: <span>Medium</span></div>
                            <div class="heat-metric">Impact: <span>High</span></div>
                            <div class="heat-metric">Step: <span>2-3</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-rental')" title="Click to view agent details">
                        <div class="heat-score">78</div>
                        <div class="heat-name">Rental Income Calculator</div>
                        <div class="heat-desc">Auto-calculate net rental income with correct vacancy factors</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Effort: <span>Medium</span></div>
                            <div class="heat-metric">Impact: <span>High</span></div>
                            <div class="heat-metric">Step: <span>6</span></div>
                        </div>
                    </div>
                    <div class="heat-item medium" onclick="scrollToAgent('agent-va-fix')" title="Click to view agent details">
                        <div class="heat-score">62</div>
                        <div class="heat-name">VA Residual Corrector</div>
                        <div class="heat-desc">Detect and fix VA Loan Analysis glitch automatically</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Effort: <span>Low</span></div>
                            <div class="heat-metric">Impact: <span>Medium</span></div>
                            <div class="heat-metric">Step: <span>8</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agent Details -->
            <h2 style="font-size: 1.4rem; margin: 35px 0 22px; color: var(--text-primary);" id="agent-details">Agent Specifications</h2>

            <div class="agent-grid">
                <!-- Agent 1: REO-Mortgage Validator -->
                <div class="agent-card" id="agent-reo-validator">
                    <div class="agent-card-header">
                        <div class="agent-icon">V</div>
                        <div class="agent-info">
                            <div class="agent-name">REO-Mortgage Validator Agent</div>
                            <div class="agent-type">Data Validation Agent</div>
                        </div>
                        <span class="agent-priority critical">Critical</span>
                    </div>
                    <div class="agent-card-body">
                        <p class="agent-description">Automatically validates that Borrower and Held fields match between REO entries and associated Mortgage liabilities. Prevents DU errors before submission by flagging mismatches in real-time.</p>
                        <div class="agent-flow">
                            <div class="agent-flow-title">Agent Flow</div>
                            <div class="agent-flow-diagram">
                                <div class="agent-step">Scan REO</div>
                                <span class="agent-arrow">--></span>
                                <div class="agent-step">Match Mortgage</div>
                                <span class="agent-arrow">--></span>
                                <div class="agent-step">Compare Fields</div>
                                <span class="agent-arrow">--></span>
                                <div class="agent-step">Flag/Auto-Fix</div>
                            </div>
                        </div>
                        <div class="agent-stats">
                            <div class="agent-stat"><div class="agent-stat-value">5min</div><div class="agent-stat-label">Time Saved</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">95%</div><div class="agent-stat-label">Error Prevent</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">Low</div><div class="agent-stat-label">Complexity</div></div>
                        </div>
                        <button class="agent-prompt-btn" onclick="showAgentPrompt('reovalidator')">
                            View AI Prompt to Build This Agent
                        </button>
                    </div>
                </div>

                <!-- Agent 2: Occupancy Recommender -->
                <div class="agent-card" id="agent-occupancy">
                    <div class="agent-card-header">
                        <div class="agent-icon">O</div>
                        <div class="agent-info">
                            <div class="agent-name">Occupancy Recommender Agent</div>
                            <div class="agent-type">Decision Support Agent</div>
                        </div>
                        <span class="agent-priority high">High</span>
                    </div>
                    <div class="agent-card-body">
                        <p class="agent-description">Analyzes loan scenario details and recommends the correct Current Usage, Intended Usage, and Property Status selections. Explains reasoning and impact on qualifying ratios.</p>
                        <div class="agent-flow">
                            <div class="agent-flow-title">Agent Flow</div>
                            <div class="agent-flow-diagram">
                                <div class="agent-step">Read Scenario</div>
                                <span class="agent-arrow">--></span>
                                <div class="agent-step">Apply Rules</div>
                                <span class="agent-arrow">--></span>
                                <div class="agent-step">Recommend</div>
                                <span class="agent-arrow">--></span>
                                <div class="agent-step">Explain Why</div>
                            </div>
                        </div>
                        <div class="agent-stats">
                            <div class="agent-stat"><div class="agent-stat-value">3min</div><div class="agent-stat-label">Time Saved</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">90%</div><div class="agent-stat-label">Accuracy</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">Med</div><div class="agent-stat-label">Complexity</div></div>
                        </div>
                        <button class="agent-prompt-btn" onclick="showAgentPrompt('occupancy')">
                            View AI Prompt to Build This Agent
                        </button>
                    </div>
                </div>

                <!-- Agent 3: Rental Income Calculator -->
                <div class="agent-card" id="agent-rental">
                    <div class="agent-card-header">
                        <div class="agent-icon">R</div>
                        <div class="agent-info">
                            <div class="agent-name">Rental Income Calculator Agent</div>
                            <div class="agent-type">Calculation Agent</div>
                        </div>
                        <span class="agent-priority high">High</span>
                    </div>
                    <div class="agent-card-body">
                        <p class="agent-description">Determines correct vacancy factor based on whether property is on tax returns or not. Auto-populates rental income fields and calculates Net Rental Income per program guidelines.</p>
                        <div class="agent-flow">
                            <div class="agent-flow-title">Agent Flow</div>
                            <div class="agent-flow-diagram">
                                <div class="agent-step">Check Tax Status</div>
                                <span class="agent-arrow">--></span>
                                <div class="agent-step">Set Vacancy %</div>
                                <span class="agent-arrow">--></span>
                                <div class="agent-step">Pull Loanbeam</div>
                                <span class="agent-arrow">--></span>
                                <div class="agent-step">Calculate Net</div>
                            </div>
                        </div>
                        <div class="agent-stats">
                            <div class="agent-stat"><div class="agent-stat-value">4min</div><div class="agent-stat-label">Time Saved</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">99%</div><div class="agent-stat-label">Accuracy</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">Med</div><div class="agent-stat-label">Complexity</div></div>
                        </div>
                        <button class="agent-prompt-btn" onclick="showAgentPrompt('rental')">
                            View AI Prompt to Build This Agent
                        </button>
                    </div>
                </div>

                <!-- Agent 4: VA Residual Corrector -->
                <div class="agent-card" id="agent-va-fix">
                    <div class="agent-card-header">
                        <div class="agent-icon">V</div>
                        <div class="agent-info">
                            <div class="agent-name">VA Residual Corrector Agent</div>
                            <div class="agent-type">Bug Workaround Agent</div>
                        </div>
                        <span class="agent-priority medium">Medium</span>
                    </div>
                    <div class="agent-card-body">
                        <p class="agent-description">Detects VA loans with pending sale properties where residual income is incorrectly calculated. Automatically applies the zero-payment workaround and alerts user to the fix.</p>
                        <div class="agent-flow">
                            <div class="agent-flow-title">Agent Flow</div>
                            <div class="agent-flow-diagram">
                                <div class="agent-step">Detect VA Loan</div>
                                <span class="agent-arrow">--></span>
                                <div class="agent-step">Find Pending Sale</div>
                                <span class="agent-arrow">--></span>
                                <div class="agent-step">Zero Payment</div>
                                <span class="agent-arrow">--></span>
                                <div class="agent-step">Alert User</div>
                            </div>
                        </div>
                        <div class="agent-stats">
                            <div class="agent-stat"><div class="agent-stat-value">2min</div><div class="agent-stat-label">Time Saved</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">100%</div><div class="agent-stat-label">Fix Rate</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">Low</div><div class="agent-stat-label">Complexity</div></div>
                        </div>
                        <button class="agent-prompt-btn" onclick="showAgentPrompt('vafix')">
                            View AI Prompt to Build This Agent
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Documentation Modal -->
    <div class="modal-overlay" id="docModal">
        <div class="modal">
            <div class="modal-header">
                <h3>REO & Mortgage Liability - Source Documentation</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyToClipboard()">Copy</button>
                    <button class="modal-btn close" onclick="closeDocModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <pre id="docContent">Source: Real-Estate-Owned-and-Mortgage-Lien-Liability-Entry-in-Byte.pdf
Updated: 2/28/2024

This workflow covers:
- Difference between Not Counted and Omitted
- Occupancy/Usage selection for Current and Intended
- Property Status options and their impact
- Step-by-step REO entry in Byte
- Linking mortgages to REO properties
- Rental/Investment income calculation
- FHA-specific debt handling rules
- VA loan analysis workarounds</pre>
            </div>
        </div>
    </div>

    <div class="copy-success" id="copySuccess">Copied to clipboard!</div>

    <!-- AI Prompt Modal -->
    <div class="modal-overlay prompt-modal" id="promptModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="promptModalTitle">AI Agent Build Prompt</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyPromptToClipboard()">Copy Prompt</button>
                    <button class="modal-btn close" onclick="closePromptModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="prompt-tags" id="promptTags"></div>
                <div class="prompt-section">
                    <h4>Agent Purpose</h4>
                    <div class="prompt-box" id="promptPurpose"></div>
                </div>
                <div class="prompt-section">
                    <h4>Full Build Prompt</h4>
                    <div class="prompt-box" id="promptContent"></div>
                </div>
                <div class="prompt-section">
                    <h4>Integration Points</h4>
                    <div class="prompt-box" id="promptIntegration"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));

            if (tab === 'workflow') {
                document.querySelector('.sidebar-tab:not(.agent-tab)').classList.add('active');
                document.getElementById('workflow-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'block';
                document.getElementById('agents-nav').style.display = 'none';
            } else {
                document.querySelector('.sidebar-tab.agent-tab').classList.add('active');
                document.getElementById('agents-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'none';
                document.getElementById('agents-nav').style.display = 'block';
            }

            window.scrollTo(0, 0);
        }

        // Scroll spy with isScrolling flag and timeout
        const sections = document.querySelectorAll('.section, .quick-ref');
        const navItems = document.querySelectorAll('#workflow-nav .nav-item');
        let isScrolling = false;
        let scrollTimeout;

        function updateActiveNav() {
            if (isScrolling) return;

            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                if (window.scrollY >= sectionTop) current = section.getAttribute('id');
            });
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + current) item.classList.add('active');
            });
        }

        // Handle nav clicks with scroll flag
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                isScrolling = true;
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    isScrolling = false;
                    updateActiveNav();
                }, 1000);
            });
        });

        window.addEventListener('scroll', updateActiveNav);

        // Modal functions
        function openDocModal() {
            document.getElementById('docModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeDocModal() {
            document.getElementById('docModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyToClipboard() {
            try {
                await navigator.clipboard.writeText(document.getElementById('docContent').textContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeDocModal(); closePromptModal(); } });
        document.getElementById('docModal').addEventListener('click', (e) => { if (e.target.id === 'docModal') closeDocModal(); });

        document.addEventListener('DOMContentLoaded', () => { updateActiveNav(); });

        // Agent Prompt System
        const agentPrompts = {
            reovalidator: {
                name: 'REO-Mortgage Validator Agent',
                tags: ['Data Validation', 'Error Prevention', 'Low Complexity', 'Critical Priority'],
                purpose: 'This agent automatically validates that Borrower and Held fields match between REO entries and their associated Mortgage liabilities, preventing DU errors before AUS submission.',
                prompt: `You are building a Data Validation Agent for Byte LOS REO and Liability management.

AGENT NAME: REO-Mortgage Validator Agent
TYPE: Real-time Data Validation

OBJECTIVE:
Create an agent that monitors REO and Mortgage Liability entries and validates that the Borrower and Held fields match exactly between linked records.

VALIDATION RULES:
1. For each REO entry with a linked mortgage:
   - REO.Borrower MUST equal Liability.Borrower
   - REO.Held MUST equal Liability.Held
   - If mismatch detected, flag immediately

2. Error Types:
   - CRITICAL: Borrower mismatch (will cause DU error)
   - CRITICAL: Held mismatch (will cause DU error)
   - WARNING: REO exists without linked mortgage (may be valid)

OUTPUT FORMAT:
{
  "validationStatus": "PASS" | "FAIL",
  "errors": [
    {
      "reoAddress": "123 Main St",
      "field": "Borrower",
      "reoValue": "John Smith",
      "liabilityValue": "Jane Smith",
      "severity": "CRITICAL",
      "autoFixAvailable": true
    }
  ],
  "warnings": [],
  "recommendation": "Update REO Borrower to match Liability"
}

AUTO-FIX CAPABILITY:
- If user approves, agent can update REO to match Liability
- Always show preview of changes before applying
- Log all auto-fixes for audit trail`,
                integration: `INTEGRATION POINTS:
1. Byte LOS API
   - Hook into REO save event
   - Hook into Liability save event
   - Real-time validation on field change

2. User Interface
   - Add validation indicator next to REO entries
   - Red highlight for mismatches
   - One-click fix button

3. Pre-AUS Check
   - Run full validation before DU submission
   - Block submission if CRITICAL errors exist
   - Show summary of all issues`
            },
            occupancy: {
                name: 'Occupancy Recommender Agent',
                tags: ['Decision Support', 'Rules Engine', 'Medium Complexity', 'High Priority'],
                purpose: 'This agent analyzes loan scenario details and recommends the correct Current Usage, Intended Usage, and Property Status selections based on CMG guidelines.',
                prompt: `You are building a Decision Support Agent for Byte LOS occupancy selection.

AGENT NAME: Occupancy Recommender Agent
TYPE: Rules-Based Decision Support

OBJECTIVE:
Analyze loan scenario and recommend correct occupancy settings with explanation of impact on qualifying ratios.

INPUT DATA:
- Loan Purpose (Purchase, Refinance, Cash-Out)
- Subject Property Address
- REO Property Address
- Is property being sold?
- Will property be rented?
- Sale pending or closed?

DECISION TREE:

IF property = subject property AND loan purpose = Refinance:
  -> Current Usage: Primary Residence (if owner-occupied)
  -> Intended Usage: Primary Residence
  -> Check "This is the subject property"

IF property will be SOLD at/before closing:
  -> Current Usage: Primary Residence
  -> Intended Usage: Leave Blank
  -> Status: Pending Sale OR Sold

IF property being RETAINED and will be RENTED:
  -> Current Usage: (current actual use)
  -> Intended Usage: Investment
  -> Status: Retained - Rental
  -> NOTE: Payment will be used in DTI, rental income may offset

IF property being RETAINED, NOT rented:
  -> Intended Usage: Second Home
  -> Status: Retained - Non-Rental
  -> NOTE: Add explanation to Conversation Log

OUTPUT:
{
  "recommendation": {
    "currentUsage": "Primary Residence",
    "intendedUsage": "Investment",
    "status": "Retained - Rental"
  },
  "reasoning": "Borrower is keeping current home and renting it out. Investment ensures PITI counts in DTI.",
  "dtiImpact": "PITI of $2,100 will be added to monthly obligations. Rental income of $1,800 may offset.",
  "requiredActions": ["Add explanation to Conversation Log"]
}`,
                integration: `INTEGRATION POINTS:
1. REO Entry Screen
   - Add "Get Recommendation" button
   - Display recommendation with reasoning
   - One-click apply to all fields

2. Loan Scenario Data
   - Pull from loan header (purpose, property)
   - Read existing REO entries
   - Check for pending sale indicators

3. Conversation Log
   - Auto-generate explanation text
   - Prompt user to add if needed`
            },
            rental: {
                name: 'Rental Income Calculator Agent',
                tags: ['Calculation', 'Loanbeam Integration', 'Medium Complexity', 'High Priority'],
                purpose: 'This agent determines correct vacancy factor based on tax return status and auto-calculates Net Rental Income per program guidelines.',
                prompt: `You are building a Calculation Agent for Byte LOS rental income.

AGENT NAME: Rental Income Calculator Agent
TYPE: Automated Calculation with Integration

OBJECTIVE:
Determine if rental property is on Schedule E, set correct vacancy factor, and calculate Net Rental Income.

LOGIC:

IF property NOT on Tax Return (new rental):
  - Vacancy Factor = 25% (default)
  - Can override if loan type allows different factor
  - Need: Copy of Lease Agreement
  - Gross Rental Income = Monthly Rent from Lease

  Calculation:
  Income Less Vacancy = Gross * (1 - 0.25)
  Net Rental Income = Income Less Vacancy - PITIA

IF property ON Tax Return (existing rental):
  - Pull calculation from Loanbeam Schedule E analysis
  - Vacancy Factor = 0% (override required)
  - Gross Rental Income = Loanbeam result
  - DO NOT override Net Rental Income
  - Need: Copy of Lease Agreement

  Calculation:
  Income Less Vacancy = Gross (no vacancy applied)
  Net Rental Income = Income Less Vacancy - PITIA

VALIDATION:
- Check loan type for vacancy factor restrictions
- Verify Loanbeam data available for Schedule E properties
- Ensure Lease document is in file

OUTPUT:
{
  "taxReturnStatus": "On Schedule E" | "Not on Tax Return",
  "recommendedVacancy": 0 | 25,
  "grossRentalIncome": 2500.00,
  "incomeLessVacancy": 2500.00,
  "pitia": 2100.00,
  "netRentalIncome": 400.00,
  "missingDocs": ["Lease Agreement"],
  "warnings": ["Verify Loanbeam calculation matches"]
}`,
                integration: `INTEGRATION POINTS:
1. Loanbeam API
   - Pull Schedule E calculation results
   - Match property by address
   - Display Loanbeam vs manual comparison

2. REO Rental Income Section
   - Auto-populate fields
   - Highlight overridden values
   - Show calculation breakdown

3. Document Checklist
   - Flag if Lease not in file
   - Link to upload screen`
            },
            vafix: {
                name: 'VA Residual Corrector Agent',
                tags: ['Bug Workaround', 'VA Loans', 'Low Complexity', 'Medium Priority'],
                purpose: 'This agent detects the known Byte glitch on VA loans with pending sale properties and automatically applies the zero-payment workaround.',
                prompt: `You are building a Bug Workaround Agent for Byte LOS VA loan analysis.

AGENT NAME: VA Residual Corrector Agent
TYPE: Automated Bug Detection and Fix

OBJECTIVE:
Detect VA loans where borrower is selling current home and the VA Loan Analysis screen shows incorrect Residual Income due to known Byte glitch.

DETECTION CRITERIA:
1. Loan Type = VA
2. Loan Purpose = Purchase
3. REO exists with Status = "Pending Sale"
4. Mortgage linked to that REO has payment > $0
5. VA Loan Analysis Residual appears incorrect

GLITCH EXPLANATION:
Even though the property is marked Pending Sale (correct for ratios) and the mortgage may be marked Omitted (correct for AUS), the VA Loan Analysis screen still includes the payment in Residual Income calculation incorrectly.

FIX:
Zero out the payment amount ONLY for the mortgage being paid off through the pending sale.

WORKFLOW:
1. Scan for VA Purchase loans
2. Check for pending sale REO
3. Compare expected vs actual Residual Income
4. If discrepancy detected:
   - Alert user to known glitch
   - Show before/after impact
   - Offer one-click fix (zero payment)
   - Log fix for audit

OUTPUT:
{
  "glitchDetected": true,
  "affectedMortgage": "PENNYMAC LOAN SER",
  "currentPayment": 2327.00,
  "residualBefore": 4901.05,
  "residualAfter": 7228.05,
  "dtiImpactBefore": 52.26,
  "dtiImpactAfter": 35.92,
  "recommendation": "Zero out payment to correct VA Loan Analysis",
  "userApprovalRequired": true
}`,
                integration: `INTEGRATION POINTS:
1. VA Loan Analysis Screen
   - Add "Check for Known Issues" button
   - Display correction recommendation
   - Show before/after comparison

2. Liability Screen
   - Apply zero payment on approval
   - Add note explaining workaround
   - Revert capability if needed

3. Audit Trail
   - Log all corrections
   - Document original values
   - Note reason for change`
            }
        };

        // Scroll to agent card and highlight
        function scrollToAgent(agentId) {
            const agentCard = document.getElementById(agentId);
            if (agentCard) {
                document.querySelectorAll('.agent-card.highlight').forEach(card => {
                    card.classList.remove('highlight');
                });

                agentCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

                setTimeout(() => {
                    agentCard.classList.add('highlight');
                }, 300);

                setTimeout(() => {
                    agentCard.classList.remove('highlight');
                }, 2500);
            }
        }

        // Show agent prompt modal
        let currentPromptContent = '';

        function showAgentPrompt(agentKey) {
            const agent = agentPrompts[agentKey];
            if (!agent) return;

            document.getElementById('promptModalTitle').textContent = agent.name + ' - Build Prompt';

            const tagsHtml = agent.tags.map(tag => '<span class="prompt-tag">' + tag + '</span>').join('');
            document.getElementById('promptTags').innerHTML = tagsHtml;

            document.getElementById('promptPurpose').textContent = agent.purpose;
            document.getElementById('promptContent').textContent = agent.prompt;
            document.getElementById('promptIntegration').textContent = agent.integration;

            currentPromptContent = '# ' + agent.name + '\n\n## Purpose\n' + agent.purpose + '\n\n## Build Prompt\n' + agent.prompt + '\n\n## Integration Points\n' + agent.integration;

            document.getElementById('promptModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closePromptModal() {
            document.getElementById('promptModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyPromptToClipboard() {
            try {
                await navigator.clipboard.writeText(currentPromptContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) {
                alert('Failed to copy prompt.');
            }
        }

        document.getElementById('promptModal').addEventListener('click', (e) => {
            if (e.target.id === 'promptModal') closePromptModal();
        });
    </script>
</body>
</html>
