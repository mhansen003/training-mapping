<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HMDA Geocoding - Process Workflow</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: #111827;
            --bg-card: #1a2234;
            --accent-blue: #3b82f6;
            --accent-teal: #14b8a6;
            --accent-amber: #f59e0b;
            --accent-rose: #f43f5e;
            --accent-green: #22c55e;
            --accent-purple: #8b5cf6;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-subtle: rgba(255,255,255,0.08);
            --sidebar-width: 280px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Breadcrumb */
        .breadcrumb {
            background: linear-gradient(90deg, #0d1525 0%, #1a2234 100%);
            padding: 14px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
            border-bottom: 1px solid var(--border-subtle);
        }

        .breadcrumb a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            transition: all 0.2s;
            border: 1px solid var(--border-subtle);
        }

        .breadcrumb a:hover {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .breadcrumb .separator { color: var(--text-muted); font-size: 1.2rem; }
        .breadcrumb .current { color: var(--accent-amber); font-weight: 600; padding: 8px 16px; }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 54px;
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - 54px);
            background: var(--bg-secondary);
            overflow-y: auto;
            z-index: 1000;
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 25px 20px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-header h2 { color: var(--text-primary); font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
        .sidebar-header p { color: var(--text-muted); font-size: 0.85rem; }

        /* Tab Switch */
        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-tab {
            flex: 1;
            padding: 14px 10px;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            background: none;
            border-left: none;
            border-right: none;
            border-top: none;
        }

        .sidebar-tab:hover { background: rgba(255,255,255,0.03); color: var(--text-secondary); }
        .sidebar-tab.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); background: rgba(59, 130, 246, 0.08); }
        .sidebar-tab.agent-tab.active { color: var(--accent-purple); border-bottom-color: var(--accent-purple); background: rgba(139, 92, 246, 0.08); }

        .sidebar-nav { padding: 15px 0; flex: 1; overflow-y: auto; }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .nav-item:hover { background: rgba(255,255,255,0.03); color: var(--text-primary); }
        .nav-item.active { background: rgba(59, 130, 246, 0.1); border-left-color: var(--accent-blue); color: var(--text-primary); }

        .nav-number {
            background: rgba(255,255,255,0.1);
            color: var(--text-secondary);
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .nav-item.active .nav-number { background: var(--accent-blue); color: white; }
        .nav-label { font-size: 0.95rem; font-weight: 500; }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-subtle);
            background: rgba(0,0,0,0.2);
        }

        .doc-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px 20px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .doc-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3); }

        /* Main Content */
        .main-content { margin-left: var(--sidebar-width); padding: 80px 40px 40px 40px; }

        /* Tab Panels */
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        .header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(20, 184, 166, 0.08) 0%, transparent 50%);
            pointer-events: none;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        .header .meta { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; position: relative; }

        .header .meta-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-subtle);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); }
        .legend-color { width: 18px; height: 18px; border-radius: 4px; }

        /* Sections */
        .section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            margin-bottom: 25px;
            overflow: hidden;
            scroll-margin-top: 75px;
        }

        .section-header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(59, 130, 246, 0.1) 100%);
            border-bottom: 1px solid var(--border-subtle);
            padding: 22px 25px;
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .section-number {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .section-title h2 { font-size: 1.35rem; font-weight: 700; margin-bottom: 4px; color: var(--text-primary); }
        .section-title span { font-size: 0.9rem; color: var(--text-muted); }
        .section-content { padding: 28px; }

        /* Workflow Diagrams */
        .workflow-diagram {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 28px;
            margin-bottom: 22px;
        }

        .flow-row { display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 12px; margin: 15px 0; }

        .flow-node {
            padding: 14px 22px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            min-width: 150px;
            border: 1px solid var(--border-subtle);
        }

        .flow-node.start { background: linear-gradient(135deg, var(--accent-green) 0%, #16a34a 100%); color: white; border-radius: 25px; border: none; }
        .flow-node.action { background: linear-gradient(135deg, var(--accent-blue) 0%, #2563eb 100%); color: white; border: none; }
        .flow-node.decision { background: linear-gradient(135deg, var(--accent-amber) 0%, #d97706 100%); color: var(--bg-primary); border: none; }
        .flow-node.input { background: var(--bg-secondary); border: 2px solid var(--accent-blue); color: var(--text-primary); }
        .flow-node.output { background: linear-gradient(135deg, var(--accent-teal) 0%, #0d9488 100%); color: white; border: none; }
        .flow-node.exception { background: linear-gradient(135deg, var(--accent-rose) 0%, #dc2626 100%); color: white; border: none; }

        .flow-arrow { color: var(--accent-blue); font-size: 1.5rem; }
        .flow-arrow.down { transform: rotate(90deg); }

        .decision-branch { display: flex; gap: 40px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
        .branch { display: flex; flex-direction: column; align-items: center; gap: 10px; }

        .branch-label {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        /* Tables */
        .field-table { width: 100%; border-collapse: collapse; margin: 18px 0; }

        .field-table th {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            padding: 14px 18px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border-subtle);
        }

        .field-table td { padding: 14px 18px; border-bottom: 1px solid var(--border-subtle); color: var(--text-secondary); }
        .field-table tr:hover { background: rgba(255,255,255,0.02); }

        .badge { display: inline-block; padding: 4px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge.required-badge { background: rgba(244, 63, 94, 0.15); color: var(--accent-rose); }
        .badge.optional-badge { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .badge.calculated-badge { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }

        /* Info Boxes */
        .exception-box, .tip-box, .info-box {
            padding: 18px 22px;
            margin: 18px 0;
            border-radius: 0 10px 10px 0;
            border-left-width: 4px;
            border-left-style: solid;
        }

        .exception-box { background: rgba(244, 63, 94, 0.08); border-color: var(--accent-rose); border: 1px solid rgba(244, 63, 94, 0.2); border-left: 4px solid var(--accent-rose); }
        .exception-box h4 { color: var(--accent-rose); margin-bottom: 10px; font-size: 1rem; }
        .exception-box p, .exception-box li { color: var(--text-secondary); }

        .tip-box { background: rgba(34, 197, 94, 0.08); border-color: var(--accent-green); border: 1px solid rgba(34, 197, 94, 0.2); border-left: 4px solid var(--accent-green); }
        .tip-box h4 { color: var(--accent-green); margin-bottom: 10px; font-size: 1rem; }
        .tip-box p, .tip-box li { color: var(--text-secondary); }

        .info-box { background: rgba(59, 130, 246, 0.08); border-color: var(--accent-blue); border: 1px solid rgba(59, 130, 246, 0.2); border-left: 4px solid var(--accent-blue); }
        .info-box h4 { color: var(--accent-blue); margin-bottom: 10px; font-size: 1rem; }
        .info-box p, .info-box li { color: var(--text-secondary); }

        /* Decision Tree */
        .decision-tree {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 22px;
            margin: 22px 0;
        }

        .decision-tree h3 { color: var(--accent-blue); margin-bottom: 18px; padding-bottom: 12px; border-bottom: 1px solid var(--border-subtle); font-size: 1.1rem; }

        .tree-node { margin-left: 20px; padding: 12px; border-left: 2px solid var(--accent-teal); position: relative; color: var(--text-secondary); }
        .tree-node::before { content: ''; position: absolute; left: -2px; top: 22px; width: 15px; height: 2px; background: var(--accent-teal); }
        .tree-node.level-1 { margin-left: 0; border-left: none; }
        .tree-node.level-1::before { display: none; }

        .tree-label { background: var(--accent-amber); color: var(--bg-primary); padding: 6px 14px; border-radius: 6px; font-weight: 700; display: inline-block; margin-bottom: 6px; font-size: 0.9rem; }

        /* Summary Grid */
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 18px; margin: 22px 0; }

        .summary-card { background: rgba(0,0,0,0.3); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 22px; text-align: center; }
        .summary-card h4 { color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9rem; }
        .summary-card .value {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .summary-card .label { font-size: 0.85rem; color: var(--text-muted); margin-top: 8px; }

        /* Code Format Cards */
        .code-format { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 18px; margin: 22px 0; }

        .code-card { background: rgba(0,0,0,0.2); border: 1px solid var(--border-subtle); border-radius: 12px; overflow: hidden; }
        .code-card-header { background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%); color: white; padding: 14px 18px; text-align: center; }
        .code-card-header h4 { font-size: 0.95rem; }
        .code-card-body { padding: 18px; }
        .code-card .code-value { font-family: 'JetBrains Mono', monospace; font-size: 1.5rem; font-weight: 700; color: var(--accent-blue); text-align: center; margin-bottom: 8px; }
        .code-card .code-desc { font-size: 0.85rem; color: var(--text-muted); text-align: center; }

        /* Quick Reference */
        .quick-ref {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
            border: 1px solid var(--border-subtle);
            padding: 28px;
            border-radius: 16px;
            margin-top: 30px;
            font-family: 'JetBrains Mono', monospace;
        }

        .quick-ref h3 { color: var(--accent-amber); margin-bottom: 18px; font-family: 'Plus Jakarta Sans', sans-serif; }
        .quick-ref pre { background: rgba(0,0,0,0.4); border: 1px solid var(--border-subtle); padding: 20px; border-radius: 10px; overflow-x: auto; font-size: 0.85rem; line-height: 1.7; color: var(--text-secondary); }

        /* ====== AGENT OPPORTUNITIES STYLES ====== */
        .agent-header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .agent-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(139, 92, 246, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .agent-header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        /* Heat Map */
        .heat-map-container { margin-bottom: 35px; }
        .heat-map-title { font-size: 1.3rem; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }

        .heat-map-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .heat-item {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .heat-item:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .heat-item:active { transform: scale(0.98); }

        .heat-item::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 4px;
        }

        .heat-item.critical::before { background: linear-gradient(90deg, #ef4444, #f97316); }
        .heat-item.high::before { background: linear-gradient(90deg, #f97316, #eab308); }
        .heat-item.medium::before { background: linear-gradient(90deg, #eab308, #22c55e); }
        .heat-item.low::before { background: linear-gradient(90deg, #22c55e, #14b8a6); }

        .heat-score {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.8rem;
            font-weight: 800;
        }

        .heat-item.critical .heat-score { color: #ef4444; }
        .heat-item.high .heat-score { color: #f97316; }
        .heat-item.medium .heat-score { color: #eab308; }
        .heat-item.low .heat-score { color: #22c55e; }

        .heat-name { font-size: 1rem; font-weight: 700; color: var(--text-primary); margin-bottom: 6px; padding-right: 50px; }
        .heat-desc { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; }

        .heat-metrics { display: flex; gap: 15px; margin-top: 12px; }
        .heat-metric { font-size: 0.75rem; color: var(--text-muted); }
        .heat-metric span { color: var(--text-secondary); font-weight: 600; }

        /* Agent Cards */
        .agent-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 25px; margin-bottom: 35px; }

        .agent-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .agent-card:hover { transform: translateY(-5px); box-shadow: 0 15px 50px rgba(0,0,0,0.3); }

        .agent-card.highlight {
            animation: highlightPulse 2s ease;
            box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.4);
        }

        @keyframes highlightPulse {
            0% { box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.6); }
            50% { box-shadow: 0 0 0 6px rgba(139, 92, 246, 0.5), 0 15px 50px rgba(139, 92, 246, 0.3); }
            100% { box-shadow: 0 0 0 0px transparent, 0 15px 50px rgba(0,0,0,0.3); }
        }

        .agent-card-header {
            padding: 22px;
            display: flex;
            align-items: flex-start;
            gap: 18px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .agent-icon {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            flex-shrink: 0;
        }

        .agent-info { flex: 1; }
        .agent-name { font-size: 1.15rem; font-weight: 700; color: var(--text-primary); margin-bottom: 5px; }
        .agent-type { font-size: 0.8rem; color: var(--accent-purple); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-priority {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .agent-priority.critical { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .agent-priority.high { background: rgba(249, 115, 22, 0.15); color: #f97316; }
        .agent-priority.medium { background: rgba(234, 179, 8, 0.15); color: #eab308; }
        .agent-priority.low { background: rgba(34, 197, 94, 0.15); color: #22c55e; }

        .agent-card-body { padding: 22px; }
        .agent-description { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; }

        .agent-flow {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 20px;
        }

        .agent-flow-title { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-flow-diagram { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; justify-content: center; }

        .agent-step {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .agent-arrow { color: var(--accent-purple); font-size: 1.2rem; }

        .agent-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }

        .agent-stat {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .agent-stat-value {
            font-size: 1.3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-top: 4px; }

        /* View Prompt Button */
        .agent-prompt-btn {
            width: 100%;
            margin-top: 18px;
            padding: 14px 20px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 10px;
            color: var(--accent-purple);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .agent-prompt-btn:hover {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(59, 130, 246, 0.3) 100%);
            border-color: var(--accent-purple);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.25);
        }

        /* Summary Stats */
        .agent-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .agent-summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            padding: 25px;
            text-align: center;
        }

        .agent-summary-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-summary-label { font-size: 0.9rem; color: var(--text-muted); margin-top: 8px; }

        /* Heat Map Legend */
        .heat-legend {
            display: flex;
            gap: 25px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .heat-legend-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; color: var(--text-secondary); }
        .heat-legend-color { width: 24px; height: 24px; border-radius: 6px; }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(10, 15, 26, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.show { display: flex; }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            width: 100%;
            max-width: 950px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 80px rgba(0,0,0,0.5);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            padding: 22px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 16px 16px 0 0;
        }

        .modal-header h3 { font-size: 1.25rem; font-weight: 700; }
        .modal-actions { display: flex; gap: 12px; }

        .modal-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: transform 0.2s;
            font-size: 0.9rem;
        }

        .modal-btn:hover { transform: scale(1.05); }
        .modal-btn.copy { background: white; color: var(--accent-blue); }
        .modal-btn.close { background: rgba(255,255,255,0.2); color: white; }

        .modal-body { padding: 28px; overflow-y: auto; flex: 1; }

        .modal-body pre {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            padding: 22px;
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.7;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--text-secondary);
        }

        .copy-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--accent-green);
            color: white;
            padding: 18px 35px;
            border-radius: 10px;
            font-weight: 700;
            z-index: 3000;
            display: none;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut { 0%, 100% { opacity: 0; } 10%, 90% { opacity: 1; } }

        /* Prompt Modal */
        .prompt-modal .modal { max-width: 800px; }
        .prompt-modal .modal-header { background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%); }

        .prompt-section { margin-bottom: 25px; }
        .prompt-section h4 { color: var(--accent-purple); font-size: 1rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }

        .prompt-box {
            background: rgba(0,0,0,0.4);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.7;
            color: var(--text-secondary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .prompt-tags { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .prompt-tag { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 75px 20px 30px 20px; }
            .agent-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <a href="../../index.html">Portal Home</a>
        <span class="separator">></span>
        <a href="./index.html">Byte</a>
        <span class="separator">></span>
        <span class="current">HMDA Geocoding</span>
    </nav>

    <!-- Fixed Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>HMDA Geocoding</h2>
            <p>Interactive Workflow Guide</p>
        </div>

        <!-- Tab Switcher -->
        <div class="sidebar-tabs">
            <button class="sidebar-tab active" onclick="switchTab('workflow')">Workflow</button>
            <button class="sidebar-tab agent-tab" onclick="switchTab('agents')">AI Agents</button>
        </div>

        <!-- Workflow Navigation -->
        <nav class="sidebar-nav" id="workflow-nav">
            <a href="#section-1" class="nav-item active">
                <span class="nav-number">1</span>
                <span class="nav-label">Condition Alert</span>
            </a>
            <a href="#section-2" class="nav-item">
                <span class="nav-number">2</span>
                <span class="nav-label">HMDA Screen</span>
            </a>
            <a href="#section-3" class="nav-item">
                <span class="nav-number">3</span>
                <span class="nav-label">FFIEC Lookup</span>
            </a>
            <a href="#section-4" class="nav-item">
                <span class="nav-number">4</span>
                <span class="nav-label">Appraisal Review</span>
            </a>
            <a href="#section-5" class="nav-item">
                <span class="nav-number">5</span>
                <span class="nav-label">Map Research</span>
            </a>
            <a href="#section-6" class="nav-item">
                <span class="nav-number">6</span>
                <span class="nav-label">Enter Codes</span>
            </a>
            <a href="#section-7" class="nav-item">
                <span class="nav-number">7</span>
                <span class="nav-label">Document & Clear</span>
            </a>
            <a href="#quick-ref" class="nav-item">
                <span class="nav-number">*</span>
                <span class="nav-label">Quick Reference</span>
            </a>
        </nav>

        <!-- Agent Navigation -->
        <nav class="sidebar-nav" id="agents-nav" style="display: none;">
            <a href="#agent-summary" class="nav-item active">
                <span class="nav-number">S</span>
                <span class="nav-label">Summary</span>
            </a>
            <a href="#agent-heatmap" class="nav-item">
                <span class="nav-number">H</span>
                <span class="nav-label">Heat Map</span>
            </a>
            <a href="#agent-details" class="nav-item">
                <span class="nav-number">A</span>
                <span class="nav-label">Agent Details</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="doc-btn" onclick="openDocModal()">
                View Workflow Markdown
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

        <!-- ==================== WORKFLOW TAB ==================== -->
        <div id="workflow-panel" class="tab-panel active">
            <!-- Header -->
            <div class="header">
                <h1>HMDA Geocoding</h1>
                <p class="subtitle">Property Location Data Entry for HMDA Compliance</p>
                <div class="meta">
                    <span class="meta-item">System: Byte</span>
                    <span class="meta-item">Role: Loan Processor / Disclosures Coordinator</span>
                    <span class="meta-item">Updated: Jan 27, 2026</span>
                    <span class="meta-item">Duration: 5-15 min</span>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #22c55e, #16a34a);"></div><span>Start/End</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></div><span>Action Step</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></div><span>Decision Point</span></div>
                <div class="legend-item"><div class="legend-color" style="background: #111827; border: 2px solid #3b82f6;"></div><span>User Input</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f43f5e, #dc2626);"></div><span>Exception</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #14b8a6, #0d9488);"></div><span>Output</span></div>
            </div>

            <!-- Section 1: Condition Alert -->
            <section id="section-1" class="section">
                <div class="section-header">
                    <div class="section-number">1</div>
                    <div class="section-title"><h2>Identify Missing Geocoding</h2><span>Condition auto-populates when data is missing</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Start</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Geocoding Missing?</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node exception">Condition Auto-Populates</div>
                        </div>
                    </div>
                    <div class="info-box">
                        <h4>What is HMDA Geocoding?</h4>
                        <p>Geocoding information consists of the <strong>MSA/MD</strong> (Metropolitan Statistical Area/Metropolitan Division), <strong>State Code</strong>, <strong>County Code</strong>, and <strong>Census Tract</strong> combination that must be provided for each reported loan.</p>
                    </div>
                    <div class="exception-box">
                        <h4>Critical Compliance Requirement</h4>
                        <p>We <strong>cannot file</strong> the company's HMDA report without BOTH the County Code AND Census Tract completed and accurate on every loan. This step is typically completed by Disclosures Coordinators but may need to be done by Loan Processors for new construction loans.</p>
                    </div>
                </div>
            </section>

            <!-- Section 2: HMDA Screen -->
            <section id="section-2" class="section">
                <div class="section-header">
                    <div class="section-number">2</div>
                    <div class="section-title"><h2>Open HMDA Screen in Byte</h2><span>Navigate to Property Information Section</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Open HMDA Screen</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Scroll to Property Information</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Click FFIEC Geocoding System Link</div>
                        </div>
                    </div>
                    <table class="field-table">
                        <thead><tr><th>Field</th><th>Format</th><th>Source</th><th>Notes</th></tr></thead>
                        <tbody>
                            <tr><td><strong style="color: var(--text-primary);">MSA No</strong></td><td><span class="badge required-badge">5 Digits</span></td><td>FFIEC / Appraisal</td><td>Metropolitan Statistical Area code</td></tr>
                            <tr><td><strong style="color: var(--text-primary);">State Code</strong></td><td><span class="badge required-badge">2 Digits</span></td><td>FFIEC</td><td>Auto-populates from address</td></tr>
                            <tr><td><strong style="color: var(--text-primary);">County Code</strong></td><td><span class="badge required-badge">3 Digits</span></td><td>FFIEC / Appraisal</td><td>Must be validated</td></tr>
                            <tr><td><strong style="color: var(--text-primary);">Census Tract</strong></td><td><span class="badge required-badge">6 Digits</span></td><td>FFIEC / Appraisal</td><td>Format: XXXX.XX</td></tr>
                        </tbody>
                    </table>
                    <div class="tip-box">
                        <h4>Pro Tip</h4>
                        <p>The FFIEC Geocoding System link in Byte opens directly to the federal lookup tool in a new browser tab.</p>
                    </div>
                </div>
            </section>

            <!-- Section 3: FFIEC Lookup -->
            <section id="section-3" class="section">
                <div class="section-header">
                    <div class="section-number">3</div>
                    <div class="section-title"><h2>Search FFIEC Geocoding Website</h2><span>Enter property address and zip code</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node input">Enter Street Address + Zip</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Click Search</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Address Found?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">YES - Found</span>
                                <span class="flow-arrow down">|</span>
                                <div class="flow-node output">Copy Geocoding Data</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">NO - Not Found</span>
                                <span class="flow-arrow down">|</span>
                                <div class="flow-node exception">Requires Additional Research</div>
                            </div>
                        </div>
                    </div>
                    <div class="exception-box">
                        <h4>Address Not Found</h4>
                        <p>If FFIEC returns "Address Not Found", proceed to Step 4 to review the appraisal for geocoding data, or Step 5 for map-based research for new construction properties.</p>
                    </div>
                </div>
            </section>

            <!-- Section 4: Appraisal Review -->
            <section id="section-4" class="section">
                <div class="section-header">
                    <div class="section-number">4</div>
                    <div class="section-title"><h2>Review Appraisal for Geocoding Data</h2><span>All appraisals contain County Code and Census Tract</span></div>
                </div>
                <div class="section-content">
                    <div class="info-box">
                        <h4>Appraisal Data Location</h4>
                        <p>All appraisals list the <strong>County Code</strong> and <strong>Census Tract</strong>. Some also list the <strong>MSA as the Map Reference</strong>. If the MSA is listed as a 5-digit number, you have all the information required to complete the HMDA Screen.</p>
                    </div>
                    <div class="code-format">
                        <div class="code-card">
                            <div class="code-card-header"><h4>MSA / Map Reference</h4></div>
                            <div class="code-card-body">
                                <div class="code-value">16700</div>
                                <div class="code-desc">5-digit code from appraisal</div>
                            </div>
                        </div>
                        <div class="code-card">
                            <div class="code-card-header"><h4>County Code</h4></div>
                            <div class="code-card-body">
                                <div class="code-value">015</div>
                                <div class="code-desc">3-digit code from appraisal</div>
                            </div>
                        </div>
                        <div class="code-card">
                            <div class="code-card-header"><h4>Census Tract</h4></div>
                            <div class="code-card-body">
                                <div class="code-value">0208.12</div>
                                <div class="code-desc">6-digit format: XXXX.XX</div>
                            </div>
                        </div>
                    </div>
                    <div class="decision-tree">
                        <h3>Appraisal Data Decision</h3>
                        <div class="tree-node level-1"><span class="tree-label">MSA Listed in Appraisal?</span></div>
                        <div class="tree-node"><span class="tree-label" style="background: var(--accent-green); color: white;">YES (5-digit)</span> -> Enter all codes directly into Byte HMDA Screen</div>
                        <div class="tree-node"><span class="tree-label" style="background: var(--accent-rose); color: white;">NO</span> -> Must determine MSA from FFIEC Geocoding website (proceed to Step 5)</div>
                    </div>
                </div>
            </section>

            <!-- Section 5: Map Research -->
            <section id="section-5" class="section">
                <div class="section-header">
                    <div class="section-number">5</div>
                    <div class="section-title"><h2>Map-Based Research</h2><span>For new construction or missing addresses</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Open Google Maps</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Locate Subject Property</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Identify Nearby Intersections</div>
                        </div>
                        <div class="flow-row"><span class="flow-arrow down">|</span></div>
                        <div class="flow-row">
                            <div class="flow-node action">Open FFIEC Map View</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Navigate to Same Area</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Click on Tract Area</div>
                        </div>
                    </div>
                    <div class="tip-box">
                        <h4>Navigation Tips</h4>
                        <ul style="margin-top: 10px; padding-left: 20px;">
                            <li style="margin-bottom: 8px;">Look for major roads and intersections visible on both Google Maps and FFIEC</li>
                            <li style="margin-bottom: 8px;">Note landmarks like shopping centers, schools, or major highways</li>
                            <li style="margin-bottom: 8px;">The FFIEC map displays Census Tract boundaries - click within the correct tract</li>
                        </ul>
                    </div>
                    <div class="info-box">
                        <h4>Select Tract Display</h4>
                        <p>Once you click on the FFIEC map in the correct area, the tract details display in the <strong>Select Tract</strong> panel on the bottom left of the browser, showing MSA, State Code, County Code, and Tract Code.</p>
                    </div>
                </div>
            </section>

            <!-- Section 6: Enter Codes -->
            <section id="section-6" class="section">
                <div class="section-header">
                    <div class="section-number">6</div>
                    <div class="section-title"><h2>Enter Geocoding Data in Byte</h2><span>Input the required codes into HMDA Screen</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node input">Enter 5-digit MSA No</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">Enter 3-digit County Code</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">Enter 6-digit Census Tract</div>
                        </div>
                    </div>
                    <table class="field-table">
                        <thead><tr><th>Code Type</th><th>Digits</th><th>Example</th><th>Entry Notes</th></tr></thead>
                        <tbody>
                            <tr><td><strong style="color: var(--text-primary);">MSA No</strong></td><td>5</td><td>16700</td><td>Enter exactly as shown in FFIEC/Appraisal</td></tr>
                            <tr><td><strong style="color: var(--text-primary);">County Code</strong></td><td>3</td><td>015</td><td>Include leading zeros</td></tr>
                            <tr><td><strong style="color: var(--text-primary);">Census Tract</strong></td><td>6</td><td>0208.12</td><td>Format: XXXX.XX (include decimal)</td></tr>
                        </tbody>
                    </table>
                    <div class="exception-box">
                        <h4>Common Address Issues - Troubleshooting Tips</h4>
                        <ul style="margin-top: 10px; padding-left: 20px;">
                            <li style="margin-bottom: 10px;"><strong>Direction in Address:</strong> FFIEC may have the direction (N, S, E, W, NE, SW, etc.) in a different position. Example: Byte shows "123 W Main St" but FFIEC has "123 Main St W". Try interchanging the direction position.</li>
                            <li style="margin-bottom: 10px;"><strong>Incorrect Zip Code:</strong> Byte could have the wrong zip code. Verify using the appraisal and/or Google.</li>
                            <li style="margin-bottom: 10px;"><strong>New Construction:</strong> Properties may not appear in FFIEC yet. The appraisal may not list a corresponding Census Tract. Check realtor websites for turn-by-turn directions that include major roads to help locate the property on the FFIEC map.</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 7: Document & Clear -->
            <section id="section-7" class="section">
                <div class="section-header">
                    <div class="section-number">7</div>
                    <div class="section-title"><h2>Document and Clear Condition</h2><span>Save evidence and mark condition received</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Print FFIEC Page to Byte</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Save as "USPS GeoCoder"</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Mark Reviewed</div>
                        </div>
                        <div class="flow-row"><span class="flow-arrow down">|</span></div>
                        <div class="flow-row">
                            <div class="flow-node action">Attach to Condition</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Mark Received</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node start">Complete</div>
                        </div>
                    </div>
                    <div class="summary-grid">
                        <div class="summary-card">
                            <h4>Document Name</h4>
                            <div class="value" style="font-size: 1.2rem;">USPS GeoCoder</div>
                            <div class="label">Standard naming convention</div>
                        </div>
                        <div class="summary-card">
                            <h4>Status</h4>
                            <div class="value" style="font-size: 1.2rem;">Reviewed</div>
                            <div class="label">Mark after printing</div>
                        </div>
                        <div class="summary-card">
                            <h4>Condition</h4>
                            <div class="value" style="font-size: 1.2rem;">Received</div>
                            <div class="label">Clears the condition</div>
                        </div>
                    </div>
                    <div class="tip-box">
                        <h4>Validation Confirmation</h4>
                        <p>The condition text reads: "Processor to validate the HMDA GEO Codes are filled in correctly and upload confirmation to the condition." Attaching the FFIEC printout and marking received satisfies this requirement.</p>
                    </div>
                </div>
            </section>

            <!-- Quick Reference -->
            <section id="quick-ref" class="quick-ref">
                <h3>Quick Reference Card</h3>
                <pre>
HMDA GEOCODING - BYTE WORKFLOW
================================

REQUIRED DATA:
  * MSA No         - 5 digits  (e.g., 16700)
  * State Code     - 2 digits  (e.g., 45)
  * County Code    - 3 digits  (e.g., 015)
  * Census Tract   - 6 digits  (e.g., 0208.12)

PROCESS FLOW:
  1. Condition alerts you to missing geocoding
  2. Open HMDA Screen -> Property Information Section
  3. Click FFIEC Geocoding System link
  4. Search by property street address + zip code
  5. If not found: Check appraisal OR use map research
  6. Enter codes in Byte: MSA, County Code, Census Tract
  7. Print FFIEC page as "USPS GeoCoder" + attach to condition

DATA SOURCES:
  * Primary: FFIEC Geocoding System (ffiec.cfpb.gov)
  * Backup:  Appraisal (Map Reference, County, Census Tract)

TROUBLESHOOTING:
  * Address not found? Try moving direction (N/S/E/W) position
  * Wrong zip code? Verify against appraisal
  * New construction? Use Google Maps + FFIEC map overlay

COMPLIANCE NOTE:
  HMDA filing requires BOTH County Code AND Census Tract
  on EVERY loan - no exceptions!
                </pre>
            </section>
        </div>

        <!-- ==================== AGENT OPPORTUNITIES TAB ==================== -->
        <div id="agents-panel" class="tab-panel">
            <!-- Header -->
            <div class="agent-header">
                <h1>AI Agent Opportunities</h1>
                <p class="subtitle">Automation Analysis for HMDA Geocoding Workflow</p>
                <div class="meta">
                    <span class="meta-item">7 Process Steps Analyzed</span>
                    <span class="meta-item">4 Agent Candidates Identified</span>
                    <span class="meta-item">Est. 70% Time Savings</span>
                </div>
            </div>

            <!-- Summary Stats -->
            <div class="agent-summary" id="agent-summary">
                <div class="agent-summary-card">
                    <div class="agent-summary-value">4</div>
                    <div class="agent-summary-label">Agent Candidates</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">2</div>
                    <div class="agent-summary-label">High Priority</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">70%</div>
                    <div class="agent-summary-label">Time Savings</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">95%</div>
                    <div class="agent-summary-label">Automation Potential</div>
                </div>
            </div>

            <!-- Heat Map Legend -->
            <div class="heat-legend" id="agent-heatmap">
                <div class="heat-legend-item"><div class="heat-legend-color" style="background: linear-gradient(135deg, #ef4444, #f97316);"></div><span><strong>Critical (90-100)</strong> - Immediate ROI</span></div>
                <div class="heat-legend-item"><div class="heat-legend-color" style="background: linear-gradient(135deg, #f97316, #eab308);"></div><span><strong>High (70-89)</strong> - Strong candidate</span></div>
                <div class="heat-legend-item"><div class="heat-legend-color" style="background: linear-gradient(135deg, #eab308, #22c55e);"></div><span><strong>Medium (50-69)</strong> - Consider</span></div>
                <div class="heat-legend-item"><div class="heat-legend-color" style="background: linear-gradient(135deg, #22c55e, #14b8a6);"></div><span><strong>Low (0-49)</strong> - Future phase</span></div>
            </div>

            <!-- Heat Map Grid -->
            <div class="heat-map-container">
                <div class="heat-map-title">Automation Priority Heat Map <span style="font-size: 0.8rem; font-weight: 400; color: var(--text-muted);">(Click to jump to agent)</span></div>
                <div class="heat-map-grid">
                    <div class="heat-item critical" onclick="scrollToAgent('agent-autolookup')" title="Click to view agent details">
                        <div class="heat-score">98</div>
                        <div class="heat-name">Auto-Geocode Lookup</div>
                        <div class="heat-desc">Automatically query FFIEC and populate codes</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Effort: <span>Low</span></div>
                            <div class="heat-metric">Impact: <span>Critical</span></div>
                            <div class="heat-metric">Step: <span>2-6</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-appraisal')" title="Click to view agent details">
                        <div class="heat-score">85</div>
                        <div class="heat-name">Appraisal Data Extractor</div>
                        <div class="heat-desc">OCR extract geocodes from appraisal PDF</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Effort: <span>Medium</span></div>
                            <div class="heat-metric">Impact: <span>High</span></div>
                            <div class="heat-metric">Step: <span>4</span></div>
                        </div>
                    </div>
                    <div class="heat-item medium" onclick="scrollToAgent('agent-validation')" title="Click to view agent details">
                        <div class="heat-score">72</div>
                        <div class="heat-name">Geocode Validator</div>
                        <div class="heat-desc">Cross-check codes against multiple sources</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Effort: <span>Low</span></div>
                            <div class="heat-metric">Impact: <span>Medium</span></div>
                            <div class="heat-metric">Step: <span>6</span></div>
                        </div>
                    </div>
                    <div class="heat-item medium" onclick="scrollToAgent('agent-newconstruction')" title="Click to view agent details">
                        <div class="heat-score">65</div>
                        <div class="heat-name">New Construction Locator</div>
                        <div class="heat-desc">AI-powered map matching for missing addresses</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Effort: <span>High</span></div>
                            <div class="heat-metric">Impact: <span>Medium</span></div>
                            <div class="heat-metric">Step: <span>5</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agent Details -->
            <h2 style="font-size: 1.4rem; margin: 35px 0 22px; color: var(--text-primary);" id="agent-details">Agent Specifications</h2>

            <div class="agent-grid">
                <!-- Agent 1: Auto-Geocode Lookup -->
                <div class="agent-card" id="agent-autolookup">
                    <div class="agent-card-header">
                        <div class="agent-icon">G</div>
                        <div class="agent-info">
                            <div class="agent-name">Auto-Geocode Lookup Agent</div>
                            <div class="agent-type">Data Integration Agent</div>
                        </div>
                        <span class="agent-priority critical">Critical</span>
                    </div>
                    <div class="agent-card-body">
                        <p class="agent-description">Automatically queries the FFIEC Geocoding System API when a loan is flagged for missing geocoding data. Populates MSA, State Code, County Code, and Census Tract directly into Byte without manual lookup. Handles 95%+ of standard addresses automatically.</p>
                        <div class="agent-flow">
                            <div class="agent-flow-title">Agent Flow</div>
                            <div class="agent-flow-diagram">
                                <div class="agent-step">Condition Trigger</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Extract Address</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Query FFIEC</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Auto-Fill Byte</div>
                            </div>
                        </div>
                        <div class="agent-stats">
                            <div class="agent-stat"><div class="agent-stat-value">10min</div><div class="agent-stat-label">Time Saved</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">95%</div><div class="agent-stat-label">Success Rate</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">Low</div><div class="agent-stat-label">Complexity</div></div>
                        </div>
                        <button class="agent-prompt-btn" onclick="showAgentPrompt('autolookup')">
                            View AI Prompt to Build This Agent
                        </button>
                    </div>
                </div>

                <!-- Agent 2: Appraisal Data Extractor -->
                <div class="agent-card" id="agent-appraisal">
                    <div class="agent-card-header">
                        <div class="agent-icon">A</div>
                        <div class="agent-info">
                            <div class="agent-name">Appraisal Data Extractor</div>
                            <div class="agent-type">Document Processing Agent</div>
                        </div>
                        <span class="agent-priority high">High</span>
                    </div>
                    <div class="agent-card-body">
                        <p class="agent-description">Uses OCR and intelligent document parsing to extract geocoding data (Map Reference/MSA, County Code, Census Tract) directly from appraisal PDFs. Serves as fallback when FFIEC lookup fails and provides instant data extraction.</p>
                        <div class="agent-flow">
                            <div class="agent-flow-title">Agent Flow</div>
                            <div class="agent-flow-diagram">
                                <div class="agent-step">Appraisal PDF</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">OCR Scan</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Extract Fields</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Validate & Fill</div>
                            </div>
                        </div>
                        <div class="agent-stats">
                            <div class="agent-stat"><div class="agent-stat-value">5min</div><div class="agent-stat-label">Time Saved</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">90%</div><div class="agent-stat-label">Accuracy</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">Med</div><div class="agent-stat-label">Complexity</div></div>
                        </div>
                        <button class="agent-prompt-btn" onclick="showAgentPrompt('appraisal')">
                            View AI Prompt to Build This Agent
                        </button>
                    </div>
                </div>

                <!-- Agent 3: Geocode Validator -->
                <div class="agent-card" id="agent-validation">
                    <div class="agent-card-header">
                        <div class="agent-icon">V</div>
                        <div class="agent-info">
                            <div class="agent-name">Geocode Validator Agent</div>
                            <div class="agent-type">Quality Assurance Agent</div>
                        </div>
                        <span class="agent-priority medium">Medium</span>
                    </div>
                    <div class="agent-card-body">
                        <p class="agent-description">Cross-validates geocoding data against multiple sources (FFIEC, appraisal, USPS) to ensure accuracy before HMDA filing. Flags discrepancies and suggests corrections. Prevents compliance issues from incorrect data entry.</p>
                        <div class="agent-flow">
                            <div class="agent-flow-title">Agent Flow</div>
                            <div class="agent-flow-diagram">
                                <div class="agent-step">Current Codes</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Multi-Source Check</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Compare Results</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Flag/Approve</div>
                            </div>
                        </div>
                        <div class="agent-stats">
                            <div class="agent-stat"><div class="agent-stat-value">99%</div><div class="agent-stat-label">Accuracy</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">Audit</div><div class="agent-stat-label">Protection</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">Low</div><div class="agent-stat-label">Complexity</div></div>
                        </div>
                        <button class="agent-prompt-btn" onclick="showAgentPrompt('validation')">
                            View AI Prompt to Build This Agent
                        </button>
                    </div>
                </div>

                <!-- Agent 4: New Construction Locator -->
                <div class="agent-card" id="agent-newconstruction">
                    <div class="agent-card-header">
                        <div class="agent-icon">N</div>
                        <div class="agent-info">
                            <div class="agent-name">New Construction Locator</div>
                            <div class="agent-type">Geospatial AI Agent</div>
                        </div>
                        <span class="agent-priority medium">Medium</span>
                    </div>
                    <div class="agent-card-body">
                        <p class="agent-description">Uses AI-powered geospatial analysis to locate new construction properties that don't appear in standard address databases. Combines Google Maps coordinates, nearby landmarks, and FFIEC tract boundaries to determine correct geocoding for addresses not yet in USPS system.</p>
                        <div class="agent-flow">
                            <div class="agent-flow-title">Agent Flow</div>
                            <div class="agent-flow-diagram">
                                <div class="agent-step">Property Info</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Geocode Coords</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Match to Tract</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Return Codes</div>
                            </div>
                        </div>
                        <div class="agent-stats">
                            <div class="agent-stat"><div class="agent-stat-value">15min</div><div class="agent-stat-label">Time Saved</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">85%</div><div class="agent-stat-label">Success Rate</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">High</div><div class="agent-stat-label">Complexity</div></div>
                        </div>
                        <button class="agent-prompt-btn" onclick="showAgentPrompt('newconstruction')">
                            View AI Prompt to Build This Agent
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Documentation Modal -->
    <div class="modal-overlay" id="docModal">
        <div class="modal">
            <div class="modal-header">
                <h3>HMDA Geocoding - Workflow Markdown</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyToClipboard()">Copy</button>
                    <button class="modal-btn close" onclick="closeDocModal()">X Close</button>
                </div>
            </div>
            <div class="modal-body">
                <pre id="docContent"># HMDA Geocoding - Byte Workflow

## Overview
Geocoding information consists of MSA/MD, State, County, and Census Tract data required for HMDA reporting.

## Required Data
- **MSA No**: 5 digits (e.g., 16700)
- **State Code**: 2 digits (e.g., 45)
- **County Code**: 3 digits (e.g., 015)
- **Census Tract**: 6 digits, format XXXX.XX (e.g., 0208.12)

## Process Steps

### Step 1: Identify Missing Geocoding
- Condition auto-populates when geocoding data is missing
- Alert: "Processor to validate the HMDA GEO Codes are filled in correctly"

### Step 2: Open HMDA Screen
- Navigate to HMDA Screen in Byte
- Scroll to Property Information Section
- Click the FFIEC Geocoding System link

### Step 3: FFIEC Lookup
- Enter property street address and zip code
- Click Search
- If found: Copy geocoding data
- If not found: Proceed to appraisal review or map research

### Step 4: Appraisal Review
- All appraisals contain County Code and Census Tract
- Some include MSA as "Map Reference"
- If MSA is 5-digit number: You have all required data

### Step 5: Map Research (New Construction)
- Open Google Maps to locate property
- Find nearby intersections and landmarks
- Navigate to same area in FFIEC map
- Click on tract area to get codes

### Step 6: Enter Codes in Byte
- MSA No: 5 digits
- County Code: 3 digits (include leading zeros)
- Census Tract: 6 digits (format XXXX.XX)

### Step 7: Document and Clear Condition
- Print FFIEC page to Byte as "USPS GeoCoder"
- Mark Reviewed
- Attach to condition
- Mark Received

## Troubleshooting Tips
- **Direction Issues**: Try moving N/S/E/W position in address
- **Wrong Zip Code**: Verify against appraisal
- **New Construction**: Use Google Maps + FFIEC map overlay

## Compliance Note
HMDA filing requires BOTH County Code AND Census Tract on EVERY loan.</pre>
            </div>
        </div>
    </div>

    <div class="copy-success" id="copySuccess">Copied to clipboard!</div>

    <!-- AI Prompt Modal -->
    <div class="modal-overlay prompt-modal" id="promptModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="promptModalTitle">AI Agent Build Prompt</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyPromptToClipboard()">Copy Prompt</button>
                    <button class="modal-btn close" onclick="closePromptModal()">X Close</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="prompt-tags" id="promptTags"></div>
                <div class="prompt-section">
                    <h4>Agent Purpose</h4>
                    <div class="prompt-box" id="promptPurpose"></div>
                </div>
                <div class="prompt-section">
                    <h4>Full Build Prompt</h4>
                    <div class="prompt-box" id="promptContent"></div>
                </div>
                <div class="prompt-section">
                    <h4>Integration Points</h4>
                    <div class="prompt-box" id="promptIntegration"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));

            if (tab === 'workflow') {
                document.querySelector('.sidebar-tab:not(.agent-tab)').classList.add('active');
                document.getElementById('workflow-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'block';
                document.getElementById('agents-nav').style.display = 'none';
            } else {
                document.querySelector('.sidebar-tab.agent-tab').classList.add('active');
                document.getElementById('agents-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'none';
                document.getElementById('agents-nav').style.display = 'block';
            }

            window.scrollTo(0, 0);
        }

        // Scroll spy with isScrolling flag and 1000ms timeout
        const sections = document.querySelectorAll('.section, .quick-ref');
        const navItems = document.querySelectorAll('#workflow-nav .nav-item');
        let isScrolling = false;
        let scrollTimeout = null;

        function updateActiveNav() {
            if (isScrolling) return;

            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                if (window.scrollY >= sectionTop) current = section.getAttribute('id');
            });
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + current) item.classList.add('active');
            });
        }

        // Handle nav item clicks with scroll flag
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                isScrolling = true;

                // Clear any existing timeout
                if (scrollTimeout) clearTimeout(scrollTimeout);

                // Update active state immediately
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');

                // Scroll to section
                const targetId = this.getAttribute('href').substring(1);
                const targetSection = document.getElementById(targetId);
                if (targetSection) {
                    targetSection.scrollIntoView({ behavior: 'smooth' });
                }

                // Reset isScrolling flag after 1000ms
                scrollTimeout = setTimeout(() => {
                    isScrolling = false;
                }, 1000);
            });
        });

        window.addEventListener('scroll', updateActiveNav);

        // Modal
        function openDocModal() {
            document.getElementById('docModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeDocModal() {
            document.getElementById('docModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyToClipboard() {
            try {
                await navigator.clipboard.writeText(document.getElementById('docContent').textContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeDocModal(); closePromptModal(); } });
        document.getElementById('docModal').addEventListener('click', (e) => { if (e.target.id === 'docModal') closeDocModal(); });

        document.addEventListener('DOMContentLoaded', () => { updateActiveNav(); });

        // ====== AGENT PROMPT SYSTEM ======
        const agentPrompts = {
            autolookup: {
                name: 'Auto-Geocode Lookup Agent',
                tags: ['Data Integration', 'FFIEC API', 'Low Complexity', 'Critical Priority'],
                purpose: `This agent automatically queries the FFIEC Geocoding System when a loan condition flags missing geocoding data. It extracts the property address from Byte, performs the FFIEC lookup, and populates MSA, State Code, County Code, and Census Tract directly without manual intervention.`,
                prompt: `You are building a Data Integration Agent for CMG Financial's Byte LOS system.

AGENT NAME: Auto-Geocode Lookup Agent
TYPE: Data Integration / API Automation

OBJECTIVE:
Create an agent that monitors for HMDA geocoding conditions and automatically populates geocoding data by querying the FFIEC Geocoding System API.

TRIGGER CONDITIONS:
1. New loan with missing geocoding fields
2. Condition "Processor to validate HMDA GEO Codes" is created
3. Manual request from processor

INPUT DATA (from Byte):
- Property Street Address
- Property City
- Property State
- Property Zip Code

FFIEC API INTEGRATION:
Endpoint: https://geomap.ffiec.gov/FFIECGeocMap/GeocodeMap1.aspx
Parameters: address, city, state, zip

EXPECTED OUTPUT:
{
  "success": true,
  "msaCode": "16700",
  "stateCode": "45",
  "countyCode": "015",
  "censusTract": "0208.12",
  "matchedAddress": "2996 EVENING TIDE DR, HANAHAN, SC 29410",
  "confidence": 0.98
}

BYTE FIELD MAPPING:
- msaCode -> HMDA.MSA_No
- countyCode -> HMDA.County_Code
- censusTract -> HMDA.Census_Tract

ERROR HANDLING:
- Address Not Found: Flag for manual research, suggest appraisal review
- Multiple Matches: Present options to processor for selection
- API Timeout: Retry 3 times, then flag for manual lookup

VALIDATION RULES:
- MSA must be exactly 5 digits
- County Code must be exactly 3 digits
- Census Tract must match format XXXX.XX
- All fields required for HMDA compliance`,
                integration: `INTEGRATION POINTS:

1. Byte LOS Integration
   - Monitor condition creation events
   - Read property address from loan record
   - Write geocoding data to HMDA screen fields
   - Attach FFIEC response as documentation

2. FFIEC Geocoding API
   - RESTful API calls with address parameters
   - Parse JSON response for geocoding data
   - Handle rate limiting (max 100 requests/minute)

3. Document Management
   - Generate PDF confirmation of lookup
   - Auto-attach to condition as "USPS GeoCoder"
   - Mark condition as Received upon successful population

4. Notification System
   - Alert processor when auto-fill completes
   - Escalate to manual queue if lookup fails

DEPLOYMENT:
- Run as background service monitoring Byte events
- Or: Trigger via API call from Byte workflow
- Logging: Track all lookups for audit trail`
            },
            appraisal: {
                name: 'Appraisal Data Extractor',
                tags: ['Document Processing', 'OCR', 'Medium Complexity', 'High Priority'],
                purpose: `This agent uses OCR and intelligent document parsing to extract geocoding data directly from appraisal PDFs when FFIEC lookup fails. It identifies the Map Reference (MSA), County Code, and Census Tract fields from standard appraisal form layouts.`,
                prompt: `You are building a Document Processing Agent for CMG Financial's Byte LOS system.

AGENT NAME: Appraisal Data Extractor
TYPE: OCR / Document Intelligence

OBJECTIVE:
Create an agent that extracts HMDA geocoding data from appraisal PDF documents as a fallback when FFIEC lookup fails or for validation purposes.

APPRAISAL FIELDS TO EXTRACT:
1. Map Reference (often contains MSA code) - Look for 5-digit number
2. County - May be text (e.g., "Berkeley") or code (e.g., "015")
3. Census Tract - Look for format XXXX.XX or XXXX (6 digits)

DOCUMENT LOCATIONS (Standard 1004 Form):
- Map Reference: Subject section, line near "Tax Year"
- County: Subject section, "County" field
- Census Tract: Subject section, may be labeled or near neighborhood section

OCR EXTRACTION RULES:
1. Identify appraisal form type (1004, 1073, 2055, etc.)
2. Locate Subject Property section
3. Extract using field labels and positional analysis
4. Cross-reference with known form templates

OUTPUT FORMAT:
{
  "success": true,
  "source": "Appraisal PDF - Page 1",
  "extractedData": {
    "msaCode": "16700",
    "countyName": "Berkeley",
    "countyCode": "015",
    "censusTract": "0208.12"
  },
  "confidence": {
    "msaCode": 0.95,
    "countyCode": 0.88,
    "censusTract": 0.92
  },
  "needsValidation": ["countyCode"]
}

COUNTY NAME TO CODE MAPPING:
- Maintain lookup table of county names to FIPS codes
- Example: "Berkeley" (SC) -> "015"
- Flag if county name not in database

ERROR HANDLING:
- Low confidence extraction: Flag for human review
- Missing field: Return partial data with missing indicator
- Multiple values found: Present all options`,
                integration: `INTEGRATION POINTS:

1. Document Storage
   - Monitor for new appraisal uploads in Byte
   - Access PDF from document management system
   - Support multiple appraisal form types

2. OCR Engine
   - Azure Form Recognizer or AWS Textract
   - Custom trained model for appraisal forms
   - Handle scanned vs. digital PDFs

3. Byte Integration
   - Populate HMDA fields with extracted data
   - Create task if validation needed
   - Log extraction results for audit

4. Validation Service
   - Cross-check extracted codes against FFIEC
   - Convert county names to FIPS codes
   - Verify census tract format

ACCURACY REQUIREMENTS:
- Target 90%+ extraction accuracy
- 100% flagging of uncertain extractions
- No false positives (wrong data entered without flag)`
            },
            validation: {
                name: 'Geocode Validator Agent',
                tags: ['Quality Assurance', 'Compliance', 'Low Complexity', 'Medium Priority'],
                purpose: `This agent cross-validates HMDA geocoding data against multiple authoritative sources before filing. It compares codes from FFIEC, appraisal, and USPS databases to catch discrepancies and prevent compliance issues.`,
                prompt: `You are building a Quality Assurance Agent for CMG Financial's Byte LOS system.

AGENT NAME: Geocode Validator Agent
TYPE: Compliance / Data Validation

OBJECTIVE:
Create an agent that validates HMDA geocoding data by cross-referencing multiple authoritative sources and flagging discrepancies before HMDA filing.

VALIDATION SOURCES:
1. FFIEC Geocoding System (primary authority)
2. Appraisal document
3. USPS Address Validation
4. County assessor records (if available)

VALIDATION CHECKS:
1. FORMAT VALIDATION
   - MSA: Exactly 5 digits, valid MSA code
   - County: Exactly 3 digits, valid FIPS code
   - Census Tract: Format XXXX.XX, valid tract for county

2. CROSS-SOURCE VALIDATION
   - Compare Byte values against FFIEC lookup
   - Compare against appraisal extracted values
   - Flag any discrepancies > 0 (exact match required)

3. LOGICAL VALIDATION
   - Census tract must exist within stated county
   - MSA must be valid for state/county combination
   - Property address must be within census tract boundaries

OUTPUT FORMAT:
{
  "validationResult": "PASS" | "FAIL" | "WARNING",
  "fieldResults": {
    "msaCode": {
      "status": "PASS",
      "byteValue": "16700",
      "ffiecValue": "16700",
      "appraisalValue": "16700"
    },
    "countyCode": {
      "status": "WARNING",
      "byteValue": "015",
      "ffiecValue": "015",
      "appraisalValue": "15",
      "note": "Appraisal missing leading zero - values match"
    },
    "censusTract": {
      "status": "PASS",
      "byteValue": "0208.12",
      "ffiecValue": "0208.12",
      "appraisalValue": "0208.12"
    }
  },
  "recommendation": "Proceed with filing"
}

FAILURE ACTIONS:
- FAIL: Block HMDA submission, create task for correction
- WARNING: Allow submission with documented exception
- Maintain audit trail of all validations`,
                integration: `INTEGRATION POINTS:

1. Pre-Filing Hook
   - Trigger validation before HMDA batch submission
   - Run on-demand for individual loans
   - Scheduled validation of pending submissions

2. Multiple Data Sources
   - FFIEC API for authoritative lookup
   - Appraisal extractor for document values
   - USPS API for address standardization

3. Byte Workflow
   - Block submission on FAIL status
   - Create conditions for required corrections
   - Log validation results in loan history

4. Reporting
   - Dashboard of validation results
   - Exception report for warnings
   - Audit trail for compliance

COMPLIANCE REQUIREMENTS:
- 100% validation coverage before filing
- Zero tolerance for mismatched critical fields
- Complete audit trail for regulatory review`
            },
            newconstruction: {
                name: 'New Construction Locator',
                tags: ['Geospatial AI', 'Map Matching', 'High Complexity', 'Medium Priority'],
                purpose: `This agent handles the challenging case of new construction properties that don't appear in standard address databases. It uses geospatial analysis to match property coordinates to census tract boundaries, enabling geocoding for addresses not yet in USPS or FFIEC systems.`,
                prompt: `You are building a Geospatial AI Agent for CMG Financial's Byte LOS system.

AGENT NAME: New Construction Locator
TYPE: Geospatial Analysis / AI Matching

OBJECTIVE:
Create an agent that determines HMDA geocoding for new construction properties that don't appear in standard address lookup systems by using coordinate-based tract matching.

INPUT DATA:
1. Property address (may be partial/lot number only)
2. Subdivision/development name
3. Nearby cross streets
4. Coordinates (if available from builder/realtor)
5. Appraisal location map

GEOSPATIAL PROCESS:
1. COORDINATE ACQUISITION
   - Use Google Geocoding API with address hints
   - Extract from appraisal location map if available
   - Use nearby known addresses as reference points

2. TRACT BOUNDARY MATCHING
   - Load TIGER/Line census tract boundaries
   - Perform point-in-polygon analysis
   - Identify containing census tract

3. CODE LOOKUP
   - Get MSA from tract's parent geography
   - Get county FIPS from tract ID
   - Format census tract code

FALLBACK STRATEGIES:
1. Address not geocodable:
   - Use subdivision plat map
   - Reference nearby completed homes
   - Use builder's provided coordinates

2. Multiple possible tracts:
   - Present map visualization to processor
   - Allow manual selection with justification

3. Boundary edge cases:
   - Flag for manual verification
   - Document uncertainty in notes

OUTPUT FORMAT:
{
  "success": true,
  "method": "coordinate_matching",
  "coordinates": {
    "latitude": 32.9876,
    "longitude": -79.9876
  },
  "geocoding": {
    "msaCode": "16700",
    "stateCode": "45",
    "countyCode": "015",
    "censusTract": "0208.12"
  },
  "confidence": 0.85,
  "mapImageUrl": "https://...",
  "notes": "Property located via subdivision plat reference"
}`,
                integration: `INTEGRATION POINTS:

1. Mapping APIs
   - Google Maps Geocoding API
   - Google Maps Static API for visualization
   - Census Bureau TIGER/Line shapefiles

2. Geospatial Processing
   - PostGIS or similar for spatial queries
   - Turf.js for client-side calculations
   - Census tract boundary datasets

3. Byte Integration
   - Trigger when standard lookup fails
   - Present map confirmation to processor
   - Store coordinates and methodology

4. Documentation
   - Generate map image showing property location
   - Document tract boundary and property position
   - Attach to loan file for audit purposes

ACCURACY SAFEGUARDS:
- Human confirmation required for < 90% confidence
- Map visualization mandatory for all matches
- Document methodology for regulatory defense

EXTERNAL DATA SOURCES:
- Census Bureau TIGER/Line (tract boundaries)
- Google Maps (geocoding, visualization)
- County GIS portals (parcel data)
- Builder/realtor coordinate data`
            }
        };

        // Scroll to agent card and highlight
        function scrollToAgent(agentId) {
            const agentCard = document.getElementById(agentId);
            if (agentCard) {
                document.querySelectorAll('.agent-card.highlight').forEach(card => {
                    card.classList.remove('highlight');
                });

                agentCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

                setTimeout(() => {
                    agentCard.classList.add('highlight');
                }, 300);

                setTimeout(() => {
                    agentCard.classList.remove('highlight');
                }, 2500);
            }
        }

        // Show agent prompt modal
        let currentPromptContent = '';

        function showAgentPrompt(agentKey) {
            const agent = agentPrompts[agentKey];
            if (!agent) return;

            document.getElementById('promptModalTitle').textContent = `${agent.name} - Build Prompt`;

            const tagsHtml = agent.tags.map(tag => `<span class="prompt-tag">${tag}</span>`).join('');
            document.getElementById('promptTags').innerHTML = tagsHtml;

            document.getElementById('promptPurpose').textContent = agent.purpose;
            document.getElementById('promptContent').textContent = agent.prompt;
            document.getElementById('promptIntegration').textContent = agent.integration;

            currentPromptContent = `# ${agent.name}\n\n## Purpose\n${agent.purpose}\n\n## Build Prompt\n${agent.prompt}\n\n## Integration Points\n${agent.integration}`;

            document.getElementById('promptModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closePromptModal() {
            document.getElementById('promptModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyPromptToClipboard() {
            try {
                await navigator.clipboard.writeText(currentPromptContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) {
                alert('Failed to copy prompt.');
            }
        }

        document.getElementById('promptModal').addEventListener('click', (e) => {
            if (e.target.id === 'promptModal') closePromptModal();
        });
    </script>
</body>
</html>
