<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Byte Aggregate Escrow - Process Workflow</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: #111827;
            --bg-card: #1a2234;
            --accent-blue: #3b82f6;
            --accent-teal: #14b8a6;
            --accent-amber: #f59e0b;
            --accent-rose: #f43f5e;
            --accent-green: #22c55e;
            --accent-purple: #8b5cf6;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-subtle: rgba(255,255,255,0.08);
            --sidebar-width: 280px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Breadcrumb */
        .breadcrumb {
            background: linear-gradient(90deg, #0d1525 0%, #1a2234 100%);
            padding: 14px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
            border-bottom: 1px solid var(--border-subtle);
        }

        .breadcrumb a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            transition: all 0.2s;
            border: 1px solid var(--border-subtle);
        }

        .breadcrumb a:hover {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .breadcrumb .separator { color: var(--text-muted); font-size: 1.2rem; }
        .breadcrumb .current { color: var(--accent-amber); font-weight: 600; padding: 8px 16px; }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 54px;
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - 54px);
            background: var(--bg-secondary);
            overflow-y: auto;
            z-index: 1000;
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 25px 20px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-header h2 { color: var(--text-primary); font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
        .sidebar-header p { color: var(--text-muted); font-size: 0.85rem; }

        /* Tab Switch */
        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-tab {
            flex: 1;
            padding: 14px 10px;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            background: none;
            border-left: none;
            border-right: none;
            border-top: none;
        }

        .sidebar-tab:hover { background: rgba(255,255,255,0.03); color: var(--text-secondary); }
        .sidebar-tab.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); background: rgba(59, 130, 246, 0.08); }
        .sidebar-tab.agent-tab.active { color: var(--accent-purple); border-bottom-color: var(--accent-purple); background: rgba(139, 92, 246, 0.08); }

        .sidebar-nav { padding: 15px 0; flex: 1; overflow-y: auto; }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .nav-item:hover { background: rgba(255,255,255,0.03); color: var(--text-primary); }
        .nav-item.active { background: rgba(59, 130, 246, 0.1); border-left-color: var(--accent-blue); color: var(--text-primary); }

        .nav-number {
            background: rgba(255,255,255,0.1);
            color: var(--text-secondary);
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .nav-item.active .nav-number { background: var(--accent-blue); color: white; }
        .nav-label { font-size: 0.95rem; font-weight: 500; }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-subtle);
            background: rgba(0,0,0,0.2);
        }

        .doc-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px 20px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .doc-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3); }

        /* Main Content */
        .main-content { margin-left: var(--sidebar-width); padding: 80px 40px 40px 40px; }

        /* Tab Panels */
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        .header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(20, 184, 166, 0.08) 0%, transparent 50%);
            pointer-events: none;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        .header .meta { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; position: relative; }

        .header .meta-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-subtle);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); }
        .legend-color { width: 18px; height: 18px; border-radius: 4px; }

        /* Sections */
        .section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            margin-bottom: 25px;
            overflow: hidden;
            scroll-margin-top: 75px;
        }

        .section-header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(59, 130, 246, 0.1) 100%);
            border-bottom: 1px solid var(--border-subtle);
            padding: 22px 25px;
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .section-number {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .section-title h2 { font-size: 1.35rem; font-weight: 700; margin-bottom: 4px; color: var(--text-primary); }
        .section-title span { font-size: 0.9rem; color: var(--text-muted); }
        .section-content { padding: 28px; }

        /* Workflow Diagrams */
        .workflow-diagram {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 28px;
            margin-bottom: 22px;
        }

        .flow-row { display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 12px; margin: 15px 0; }

        .flow-node {
            padding: 14px 22px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            min-width: 150px;
            border: 1px solid var(--border-subtle);
        }

        .flow-node.start { background: linear-gradient(135deg, var(--accent-green) 0%, #16a34a 100%); color: white; border-radius: 25px; border: none; }
        .flow-node.action { background: linear-gradient(135deg, var(--accent-blue) 0%, #2563eb 100%); color: white; border: none; }
        .flow-node.decision { background: linear-gradient(135deg, var(--accent-amber) 0%, #d97706 100%); color: var(--bg-primary); border: none; }
        .flow-node.input { background: var(--bg-secondary); border: 2px solid var(--accent-blue); color: var(--text-primary); }
        .flow-node.output { background: linear-gradient(135deg, var(--accent-teal) 0%, #0d9488 100%); color: white; border: none; }
        .flow-node.exception { background: linear-gradient(135deg, var(--accent-rose) 0%, #dc2626 100%); color: white; border: none; }

        .flow-arrow { color: var(--accent-blue); font-size: 1.5rem; }
        .flow-arrow.down { transform: rotate(90deg); }

        .decision-branch { display: flex; gap: 40px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
        .branch { display: flex; flex-direction: column; align-items: center; gap: 10px; }

        .branch-label {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        /* Tables */
        .field-table { width: 100%; border-collapse: collapse; margin: 18px 0; }

        .field-table th {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            padding: 14px 18px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border-subtle);
        }

        .field-table td { padding: 14px 18px; border-bottom: 1px solid var(--border-subtle); color: var(--text-secondary); }
        .field-table tr:hover { background: rgba(255,255,255,0.02); }

        .badge { display: inline-block; padding: 4px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge.required-badge { background: rgba(244, 63, 94, 0.15); color: var(--accent-rose); }
        .badge.optional-badge { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .badge.calculated-badge { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }
        .badge.default-badge { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); }

        /* Info Boxes */
        .exception-box, .tip-box, .info-box, .warning-box {
            padding: 18px 22px;
            margin: 18px 0;
            border-radius: 0 10px 10px 0;
            border-left-width: 4px;
            border-left-style: solid;
        }

        .exception-box { background: rgba(244, 63, 94, 0.08); border-color: var(--accent-rose); border: 1px solid rgba(244, 63, 94, 0.2); border-left: 4px solid var(--accent-rose); }
        .exception-box h4 { color: var(--accent-rose); margin-bottom: 10px; font-size: 1rem; }
        .exception-box p, .exception-box li { color: var(--text-secondary); }

        .tip-box { background: rgba(34, 197, 94, 0.08); border-color: var(--accent-green); border: 1px solid rgba(34, 197, 94, 0.2); border-left: 4px solid var(--accent-green); }
        .tip-box h4 { color: var(--accent-green); margin-bottom: 10px; font-size: 1rem; }
        .tip-box p, .tip-box li { color: var(--text-secondary); }

        .info-box { background: rgba(59, 130, 246, 0.08); border-color: var(--accent-blue); border: 1px solid rgba(59, 130, 246, 0.2); border-left: 4px solid var(--accent-blue); }
        .info-box h4 { color: var(--accent-blue); margin-bottom: 10px; font-size: 1rem; }
        .info-box p, .info-box li { color: var(--text-secondary); }

        .warning-box { background: rgba(245, 158, 11, 0.08); border-color: var(--accent-amber); border: 1px solid rgba(245, 158, 11, 0.2); border-left: 4px solid var(--accent-amber); }
        .warning-box h4 { color: var(--accent-amber); margin-bottom: 10px; font-size: 1rem; }
        .warning-box p, .warning-box li { color: var(--text-secondary); }

        /* Decision Tree */
        .decision-tree {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 22px;
            margin: 22px 0;
        }

        .decision-tree h3 { color: var(--accent-blue); margin-bottom: 18px; padding-bottom: 12px; border-bottom: 1px solid var(--border-subtle); font-size: 1.1rem; }

        .tree-node { margin-left: 20px; padding: 12px; border-left: 2px solid var(--accent-teal); position: relative; color: var(--text-secondary); }
        .tree-node::before { content: ''; position: absolute; left: -2px; top: 22px; width: 15px; height: 2px; background: var(--accent-teal); }
        .tree-node.level-1 { margin-left: 0; border-left: none; }
        .tree-node.level-1::before { display: none; }

        .tree-label { background: var(--accent-amber); color: var(--bg-primary); padding: 6px 14px; border-radius: 6px; font-weight: 700; display: inline-block; margin-bottom: 6px; font-size: 0.9rem; }

        /* Summary Grid */
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 18px; margin: 22px 0; }

        .summary-card { background: rgba(0,0,0,0.3); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 22px; text-align: center; }
        .summary-card h4 { color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9rem; }
        .summary-card .value {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .summary-card .label { font-size: 0.85rem; color: var(--text-muted); margin-top: 8px; }

        /* Comparison Cards */
        .comparison-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 22px 0; }

        .comparison-card { background: rgba(0,0,0,0.2); border: 1px solid var(--border-subtle); border-radius: 12px; overflow: hidden; }
        .comparison-card-header { background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%); color: white; padding: 18px; text-align: center; }
        .comparison-card-header h4 { font-size: 1.05rem; }
        .comparison-card-body { padding: 22px; }
        .comparison-card ul { list-style: none; padding: 0; }
        .comparison-card li { padding: 10px 0; border-bottom: 1px solid var(--border-subtle); display: flex; align-items: center; gap: 12px; color: var(--text-secondary); font-size: 0.95rem; }
        .comparison-card li:last-child { border-bottom: none; }
        .check-icon { color: var(--accent-green); font-weight: bold; }
        .x-icon { color: var(--accent-rose); font-weight: bold; }

        /* Quick Reference */
        .quick-ref {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
            border: 1px solid var(--border-subtle);
            padding: 28px;
            border-radius: 16px;
            margin-top: 30px;
            font-family: 'JetBrains Mono', monospace;
            scroll-margin-top: 75px;
        }

        .quick-ref h3 { color: var(--accent-amber); margin-bottom: 18px; font-family: 'Plus Jakarta Sans', sans-serif; }
        .quick-ref pre { background: rgba(0,0,0,0.4); border: 1px solid var(--border-subtle); padding: 20px; border-radius: 10px; overflow-x: auto; font-size: 0.85rem; line-height: 1.7; color: var(--text-secondary); }

        /* ====== AGENT OPPORTUNITIES STYLES ====== */
        .agent-header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .agent-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(139, 92, 246, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .agent-header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        /* Heat Map */
        .heat-map-container { margin-bottom: 35px; }
        .heat-map-title { font-size: 1.3rem; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }

        .heat-map-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .heat-item {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .heat-item:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .heat-item:active { transform: scale(0.98); }

        .heat-item::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 4px;
        }

        .heat-item.critical::before { background: linear-gradient(90deg, #ef4444, #f97316); }
        .heat-item.high::before { background: linear-gradient(90deg, #f97316, #eab308); }
        .heat-item.medium::before { background: linear-gradient(90deg, #eab308, #22c55e); }
        .heat-item.low::before { background: linear-gradient(90deg, #22c55e, #14b8a6); }

        .heat-score {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.8rem;
            font-weight: 800;
        }

        .heat-item.critical .heat-score { color: #ef4444; }
        .heat-item.high .heat-score { color: #f97316; }
        .heat-item.medium .heat-score { color: #eab308; }
        .heat-item.low .heat-score { color: #22c55e; }

        .heat-name { font-size: 1rem; font-weight: 700; color: var(--text-primary); margin-bottom: 6px; padding-right: 50px; }
        .heat-desc { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; }

        .heat-metrics { display: flex; gap: 15px; margin-top: 12px; }
        .heat-metric { font-size: 0.75rem; color: var(--text-muted); }
        .heat-metric span { color: var(--text-secondary); font-weight: 600; }

        /* Agent Cards */
        .agent-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 25px; margin-bottom: 35px; }

        .agent-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .agent-card:hover { transform: translateY(-5px); box-shadow: 0 15px 50px rgba(0,0,0,0.3); }

        .agent-card.highlight {
            animation: highlightPulse 2s ease;
            box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.4);
        }

        @keyframes highlightPulse {
            0% { box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.6); }
            50% { box-shadow: 0 0 0 6px rgba(139, 92, 246, 0.5), 0 15px 50px rgba(139, 92, 246, 0.3); }
            100% { box-shadow: 0 0 0 0px transparent, 0 15px 50px rgba(0,0,0,0.3); }
        }

        .agent-card-header {
            padding: 22px;
            display: flex;
            align-items: flex-start;
            gap: 18px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .agent-icon {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            flex-shrink: 0;
        }

        .agent-info { flex: 1; }
        .agent-name { font-size: 1.15rem; font-weight: 700; color: var(--text-primary); margin-bottom: 5px; }
        .agent-type { font-size: 0.8rem; color: var(--accent-purple); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-priority {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .agent-priority.critical { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .agent-priority.high { background: rgba(249, 115, 22, 0.15); color: #f97316; }
        .agent-priority.medium { background: rgba(234, 179, 8, 0.15); color: #eab308; }
        .agent-priority.low { background: rgba(34, 197, 94, 0.15); color: #22c55e; }

        .agent-card-body { padding: 22px; }
        .agent-description { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; }

        .agent-flow {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 20px;
        }

        .agent-flow-title { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-flow-diagram { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; justify-content: center; }

        .agent-step {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .agent-arrow { color: var(--accent-purple); font-size: 1.2rem; }

        .agent-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }

        .agent-stat {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .agent-stat-value {
            font-size: 1.3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-top: 4px; }

        .agent-prompt-btn {
            width: 100%;
            margin-top: 18px;
            padding: 14px 20px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 10px;
            color: var(--accent-purple);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .agent-prompt-btn:hover {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(59, 130, 246, 0.3) 100%);
            border-color: var(--accent-purple);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.25);
        }

        /* Summary Stats */
        .agent-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .agent-summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            padding: 25px;
            text-align: center;
        }

        .agent-summary-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-summary-label { font-size: 0.9rem; color: var(--text-muted); margin-top: 8px; }

        /* Heat Map Legend */
        .heat-legend {
            display: flex;
            gap: 25px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .heat-legend-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; color: var(--text-secondary); }
        .heat-legend-color { width: 24px; height: 24px; border-radius: 6px; }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(10, 15, 26, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.show { display: flex; }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            width: 100%;
            max-width: 950px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 80px rgba(0,0,0,0.5);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            padding: 22px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 16px 16px 0 0;
        }

        .modal-header h3 { font-size: 1.25rem; font-weight: 700; }
        .modal-actions { display: flex; gap: 12px; }

        .modal-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: transform 0.2s;
            font-size: 0.9rem;
        }

        .modal-btn:hover { transform: scale(1.05); }
        .modal-btn.copy { background: white; color: var(--accent-blue); }
        .modal-btn.close { background: rgba(255,255,255,0.2); color: white; }

        .modal-body { padding: 28px; overflow-y: auto; flex: 1; }

        .modal-body pre {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            padding: 22px;
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.7;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--text-secondary);
        }

        .copy-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--accent-green);
            color: white;
            padding: 18px 35px;
            border-radius: 10px;
            font-weight: 700;
            z-index: 3000;
            display: none;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut { 0%, 100% { opacity: 0; } 10%, 90% { opacity: 1; } }

        /* Prompt Modal */
        .prompt-modal .modal { max-width: 800px; }
        .prompt-modal .modal-header { background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%); }

        .prompt-section { margin-bottom: 25px; }
        .prompt-section h4 { color: var(--accent-purple); font-size: 1rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }

        .prompt-box {
            background: rgba(0,0,0,0.4);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.7;
            color: var(--text-secondary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .prompt-tags { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .prompt-tag { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 75px 20px 30px 20px; }
            .agent-grid { grid-template-columns: 1fr; }
        }
            .breadcrumb-logo-link { display: flex; align-items: center; padding: 4px 8px; background: rgba(255,255,255,0.08); border-radius: 8px; border: 1px solid rgba(255,255,255,0.12); transition: all 0.2s; }
        .breadcrumb-logo-link:hover { background: rgba(255,255,255,0.15); }
        .breadcrumb-logo { height: 28px; width: auto; }
    </style>
</head>
<body>
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <a href="../../index.html" class="breadcrumb-logo-link"><img src="../../images/clear-ai-logo.png" alt="Clear AI" class="breadcrumb-logo"></a>
        <a href="../../index.html">Portal Home</a>
        <span class="separator">></span>
        <a href="./index.html">Byte</a>
        <span class="separator">></span>
        <span class="current">Aggregate Escrow</span>
    </nav>

    <!-- Fixed Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>Aggregate Escrow</h2>
            <p>Interactive Workflow Guide</p>
        </div>

        <!-- Tab Switcher -->
        <div class="sidebar-tabs">
            <button class="sidebar-tab active" onclick="switchTab('workflow')">Workflow</button>
            <button class="sidebar-tab agent-tab" onclick="switchTab('agents')">AI Agents</button>
        </div>

        <!-- Workflow Navigation -->
        <nav class="sidebar-nav" id="workflow-nav">
            <a href="#section-1" class="nav-item active">
                <span class="nav-number">1</span>
                <span class="nav-label">Overview</span>
            </a>
            <a href="#section-2" class="nav-item">
                <span class="nav-number">2</span>
                <span class="nav-label">Hazard Insurance</span>
            </a>
            <a href="#section-3" class="nav-item">
                <span class="nav-number">3</span>
                <span class="nav-label">Flood Insurance</span>
            </a>
            <a href="#section-4" class="nav-item">
                <span class="nav-number">4</span>
                <span class="nav-label">Property Taxes</span>
            </a>
            <a href="#section-5" class="nav-item">
                <span class="nav-number">5</span>
                <span class="nav-label">Tax Schedules</span>
            </a>
            <a href="#section-6" class="nav-item">
                <span class="nav-number">6</span>
                <span class="nav-label">Aggregate Adjustment</span>
            </a>
            <a href="#quick-ref" class="nav-item">
                <span class="nav-number">*</span>
                <span class="nav-label">Quick Reference</span>
            </a>
        </nav>

        <!-- Agent Navigation -->
        <nav class="sidebar-nav" id="agents-nav" style="display: none;">
            <a href="#agent-summary" class="nav-item active">
                <span class="nav-number">1</span>
                <span class="nav-label">Summary</span>
            </a>
            <a href="#agent-heatmap" class="nav-item">
                <span class="nav-number">2</span>
                <span class="nav-label">Heat Map</span>
            </a>
            <a href="#agent-details" class="nav-item">
                <span class="nav-number">3</span>
                <span class="nav-label">Agent Details</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="doc-btn" onclick="openDocModal()">
                View Workflow Markdown
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

        <!-- ==================== WORKFLOW TAB ==================== -->
        <div id="workflow-panel" class="tab-panel active">
            <!-- Header -->
            <div class="header">
                <h1>Aggregate Escrow in Byte</h1>
                <p class="subtitle">Calculating Initial Escrow Payment at Closing for Accurate Loan Estimates</p>
                <div class="meta">
                    <span class="meta-item">System: Byte LOS</span>
                    <span class="meta-item">Role: Loan Officer / Processor</span>
                    <span class="meta-item">Updated: Dec 6, 2022</span>
                    <span class="meta-item">Duration: 5-10 min</span>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #22c55e, #16a34a);"></div><span>Start/End</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></div><span>Action Step</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></div><span>Decision Point</span></div>
                <div class="legend-item"><div class="legend-color" style="background: #111827; border: 2px solid #3b82f6;"></div><span>User Input</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f43f5e, #dc2626);"></div><span>Exception</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #14b8a6, #0d9488);"></div><span>Output</span></div>
            </div>

            <!-- Section 1: Overview -->
            <section id="section-1" class="section">
                <div class="section-header">
                    <div class="section-number">1</div>
                    <div class="section-title"><h2>Escrow Entry Overview</h2><span>Understanding the Aggregate Escrow screen on LE Page 2</span></div>
                </div>
                <div class="section-content">
                    <div class="info-box">
                        <h4>Purpose</h4>
                        <p>Calculating the Aggregate Escrow screen of the LE Page 2 will allow the Loan Estimate to get as close as possible to the cash needed at closing. Proper escrow entry ensures accurate disclosure of Section G - Initial Escrow Payment at Closing.</p>
                    </div>

                    <div class="summary-grid">
                        <div class="summary-card">
                            <h4>Escrow Types</h4>
                            <div class="value">4</div>
                            <div class="label">Hazard, Flood, Taxes, MI</div>
                        </div>
                        <div class="summary-card">
                            <h4>Key Screen</h4>
                            <div class="value">LE 2</div>
                            <div class="label">Section G - Initial Escrow</div>
                        </div>
                        <div class="summary-card">
                            <h4>Validation</h4>
                            <div class="value">-/0</div>
                            <div class="label">Agg Adj must be negative or zero</div>
                        </div>
                    </div>

                    <div class="workflow-diagram">
                        <h3 style="text-align: center; margin-bottom: 22px; color: var(--accent-blue);">Escrow Entry Workflow Overview</h3>
                        <div class="flow-row">
                            <div class="flow-node start">Start</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Run SmartFees</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Navigate to LE Page 2</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Loan Type?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">Purchase</span>
                                <span class="flow-arrow down">|</span>
                                <div class="flow-node action">Default values apply</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">Refinance</span>
                                <span class="flow-arrow down">|</span>
                                <div class="flow-node input">Enter Month/Year Due</div>
                            </div>
                        </div>
                        <div class="flow-row">
                            <div class="flow-node action">Configure Tax Schedule</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Validate Agg Adj</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Complete</div>
                        </div>
                    </div>

                    <div class="tip-box">
                        <h4>Pro Tip</h4>
                        <p>Always run SmartFees first before configuring escrow. This ensures costs are pulled into LE Page 2 and tax months populate correctly in Section G.</p>
                    </div>
                </div>
            </section>

            <!-- Section 2: Hazard Insurance -->
            <section id="section-2" class="section">
                <div class="section-header">
                    <div class="section-number">2</div>
                    <div class="section-title"><h2>Hazard Insurance Entry</h2><span>Configure hazard insurance escrow for Purchase and Refinance</span></div>
                </div>
                <div class="section-content">
                    <div class="comparison-grid">
                        <div class="comparison-card">
                            <div class="comparison-card-header">
                                <h4>Purchase Transaction</h4>
                            </div>
                            <div class="comparison-card-body">
                                <ul>
                                    <li><span class="check-icon">*</span> Mo's defaults to <strong>3 months</strong> of Escrow at Closing Date</li>
                                    <li><span class="check-icon">*</span> Disburse defaults to <strong>Annually</strong></li>
                                    <li><span class="check-icon">*</span> Starting defaults to <strong>Closing</strong></li>
                                    <li><span class="check-icon">*</span> Minimal manual entry required</li>
                                </ul>
                            </div>
                        </div>
                        <div class="comparison-card">
                            <div class="comparison-card-header">
                                <h4>Refinance Transaction</h4>
                            </div>
                            <div class="comparison-card-body">
                                <ul>
                                    <li><span class="x-icon">!</span> Mo's shows as <strong>0</strong> until Month/Year entered</li>
                                    <li><span class="check-icon">*</span> Enter <strong>Starting Month</strong> and <strong>Year</strong> next due</li>
                                    <li><span class="check-icon">*</span> Click <strong>Update Months in Reserve</strong></li>
                                    <li><span class="check-icon">*</span> System calculates correct months</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Field</th>
                                <th>Purchase Default</th>
                                <th>Refinance Action</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Mo's (Months)</strong></td>
                                <td><span class="badge default-badge">3</span></td>
                                <td><span class="badge required-badge">Enter Data</span></td>
                                <td>Shows 0 until Month/Year entered on refinance</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">$/Mo</strong></td>
                                <td><span class="badge calculated-badge">Calculated</span></td>
                                <td><span class="badge calculated-badge">Calculated</span></td>
                                <td>Monthly premium amount</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Disburse</strong></td>
                                <td><span class="badge default-badge">Annually</span></td>
                                <td><span class="badge default-badge">Annually</span></td>
                                <td>Disbursement frequency</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Starting</strong></td>
                                <td><span class="badge default-badge">Closing</span></td>
                                <td><span class="badge required-badge">Month/Year</span></td>
                                <td>Enter next due date for refinance</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="workflow-diagram">
                        <h3 style="text-align: center; margin-bottom: 22px; color: var(--accent-blue);">Refinance Hazard Insurance Flow</h3>
                        <div class="flow-row">
                            <div class="flow-node input">Enter Month Next Due</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">Enter Year Next Due</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Click Update Months in Reserve</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Mo's Auto-Populates</div>
                        </div>
                    </div>

                    <div class="warning-box">
                        <h4>Important for Refinance</h4>
                        <p>The <strong>Update Months in Reserve</strong> button appears at the bottom of the section only AFTER entering the Month/Year next due. You must click this button to calculate the correct number of months for Hazard Insurance.</p>
                    </div>
                </div>
            </section>

            <!-- Section 3: Flood Insurance -->
            <section id="section-3" class="section">
                <div class="section-header">
                    <div class="section-number">3</div>
                    <div class="section-title"><h2>Flood Insurance Entry</h2><span>Configure flood insurance escrow when applicable</span></div>
                </div>
                <div class="section-content">
                    <div class="info-box">
                        <h4>Flood Insurance Handling</h4>
                        <p>Flood insurance follows the same entry pattern as Hazard Insurance. The defaults and entry requirements are identical based on transaction type (Purchase vs Refinance).</p>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Field</th>
                                <th>Purchase Default</th>
                                <th>Refinance Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Mo's (Months)</strong></td>
                                <td><span class="badge default-badge">3</span></td>
                                <td><span class="badge required-badge">Enter Month/Year</span></td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Disburse</strong></td>
                                <td><span class="badge default-badge">Annually</span></td>
                                <td><span class="badge default-badge">Annually</span></td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Starting</strong></td>
                                <td><span class="badge default-badge">Closing Date</span></td>
                                <td><span class="badge required-badge">Next Due Date</span></td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="tip-box">
                        <h4>Pro Tip</h4>
                        <p>For refinances, always verify flood insurance next due date with the borrower or existing policy documentation before entering.</p>
                    </div>
                </div>
            </section>

            <!-- Section 4: Property Taxes -->
            <section id="section-4" class="section">
                <div class="section-header">
                    <div class="section-number">4</div>
                    <div class="section-title"><h2>Property Taxes Entry</h2><span>Configure property tax escrow based on state requirements</span></div>
                </div>
                <div class="section-content">
                    <div class="info-box">
                        <h4>SmartFees Integration</h4>
                        <p>Once SmartFees are run and the costs are pulled into the LE Page 2, the months that the taxes are due should populate in Section G - Initial Escrow Payment at Closing.</p>
                    </div>

                    <div class="decision-tree">
                        <h3>Property Tax Configuration Decision Tree</h3>
                        <div class="tree-node level-1">
                            <span class="tree-label">Did Tax Months Populate?</span>
                        </div>
                        <div class="tree-node">
                            <span class="tree-label" style="background: var(--accent-green); color: white;">YES</span> -> Enter the <strong style="color: var(--text-primary);">Year Due</strong> for Annual taxes
                        </div>
                        <div class="tree-node">
                            <span class="tree-label" style="background: var(--accent-rose); color: white;">NO</span> -> Click <strong style="color: var(--text-primary);">Jump To Agg Esc</strong> to manually enter Months/Year(s) due
                        </div>
                    </div>

                    <div class="workflow-diagram">
                        <h3 style="text-align: center; margin-bottom: 22px; color: var(--accent-blue);">Property Tax Entry Flow</h3>
                        <div class="flow-row">
                            <div class="flow-node start">Run SmartFees</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Month Populated?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">YES</span>
                                <span class="flow-arrow down">|</span>
                                <div class="flow-node input">Enter Year Due</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">NO</span>
                                <span class="flow-arrow down">|</span>
                                <div class="flow-node action">Click Jump To Agg Esc</div>
                                <span class="flow-arrow down">|</span>
                                <div class="flow-node input">Enter Month(s) & Year(s)</div>
                            </div>
                        </div>
                    </div>

                    <div class="warning-box">
                        <h4>Blank Disburse Date</h4>
                        <p>When the Month does not populate after Smart Fees are pulled in, click <strong>Jump to Agg Esc</strong> to access the Aggregate Escrow screen and manually enter the Months/Year(s) due.</p>
                    </div>
                </div>
            </section>

            <!-- Section 5: Tax Schedules -->
            <section id="section-5" class="section">
                <div class="section-header">
                    <div class="section-number">5</div>
                    <div class="section-title"><h2>Tax Payment Schedules</h2><span>Configure based on state tax payment frequency</span></div>
                </div>
                <div class="section-content">
                    <div class="summary-grid" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));">
                        <div class="summary-card" style="background: rgba(59, 130, 246, 0.1);">
                            <h4 style="color: var(--accent-blue);">Annually</h4>
                            <div class="label">Once per year</div>
                        </div>
                        <div class="summary-card" style="background: rgba(20, 184, 166, 0.1);">
                            <h4 style="color: var(--accent-teal);">Semi-Annually</h4>
                            <div class="label">Every 6 months</div>
                        </div>
                        <div class="summary-card" style="background: rgba(139, 92, 246, 0.1);">
                            <h4 style="color: var(--accent-purple);">Other</h4>
                            <div class="label">Custom schedule</div>
                        </div>
                        <div class="summary-card" style="background: rgba(245, 158, 11, 0.1);">
                            <h4 style="color: var(--accent-amber);">Quarterly</h4>
                            <div class="label">Every 3 months</div>
                        </div>
                    </div>

                    <!-- Annual Taxes -->
                    <div class="decision-tree">
                        <h3>Taxes Paid Annually</h3>
                        <p style="margin-bottom: 15px; color: var(--text-secondary);">Taxes that are due Annually will populate <strong>one month</strong>. The Year Due needs to be entered.</p>
                        <table class="field-table">
                            <thead>
                                <tr><th>Action</th><th>Details</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>Select Disburse</td><td><span class="badge default-badge">Annually</span></td></tr>
                                <tr><td>Enter Year</td><td><span class="badge required-badge">Required</span> - Enter the year taxes are due</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Semi-Annual Taxes -->
                    <div class="decision-tree">
                        <h3>Semi-Annually (Every 6 Months)</h3>
                        <p style="margin-bottom: 15px; color: var(--text-secondary);">For states with semi-annual tax payments:</p>
                        <table class="field-table">
                            <thead>
                                <tr><th>Step</th><th>Action</th><th>Example</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>1</td><td>Select <strong>"Semi Annually"</strong> from dropdown</td><td>-</td></tr>
                                <tr><td>2</td><td>Enter <strong>Starting</strong> month (next due after closing)</td><td>March</td></tr>
                                <tr><td>3</td><td>Enter <strong>Year</strong></td><td>2023</td></tr>
                            </tbody>
                        </table>
                        <div class="info-box" style="margin-top: 15px;">
                            <h4>Example Scenario</h4>
                            <p>If the loan has a closing in <strong>November 2022</strong>, and the next due date is <strong>March 2023</strong>, the Agg Esc Screen will automatically show the next payment <strong>6 months later in September</strong>.</p>
                        </div>
                    </div>

                    <!-- Other Schedule -->
                    <div class="decision-tree">
                        <h3>Other (Twice a Year, Not Every 6 Months)</h3>
                        <p style="margin-bottom: 15px; color: var(--text-secondary);">For states that are due twice a year but not on a regular 6-month interval:</p>
                        <table class="field-table">
                            <thead>
                                <tr><th>Step</th><th>Action</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>1</td><td>Select <strong>"Other"</strong> from the dropdown</td></tr>
                                <tr><td>2</td><td>Click <strong>Edit</strong></td></tr>
                                <tr><td>3</td><td>Enter <strong>6 months for each due date</strong> in the Months Disbursed column</td></tr>
                            </tbody>
                        </table>
                        <div class="tip-box" style="margin-top: 15px;">
                            <h4>Pro Tip</h4>
                            <p>The "Other" option opens a detailed grid where you can specify exactly which months disbursements occur. This is useful for states with irregular tax schedules.</p>
                        </div>
                    </div>

                    <!-- Quarterly Taxes -->
                    <div class="decision-tree">
                        <h3>Quarterly (Every 3 Months)</h3>
                        <p style="margin-bottom: 15px; color: var(--text-secondary);">For states with quarterly tax payments:</p>
                        <table class="field-table">
                            <thead>
                                <tr><th>Step</th><th>Action</th><th>Result</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>1</td><td>Select <strong>"Quarterly"</strong> from dropdown</td><td>-</td></tr>
                                <tr><td>2</td><td>Enter <strong>Starting Month</strong></td><td>e.g., March</td></tr>
                                <tr><td>3</td><td>Enter <strong>Year</strong></td><td>e.g., 2023</td></tr>
                            </tbody>
                        </table>
                        <div class="info-box" style="margin-top: 15px;">
                            <h4>Automatic Calculation</h4>
                            <p>Taxes will automatically show up paid every <strong>3 months</strong> in the Trial Balance section (e.g., March, June, September, December).</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 6: Aggregate Adjustment -->
            <section id="section-6" class="section">
                <div class="section-header">
                    <div class="section-number">6</div>
                    <div class="section-title"><h2>Aggregate Adjustment Validation</h2><span>Verify escrow calculations are correct</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <h3 style="text-align: center; margin-bottom: 22px; color: var(--accent-blue);">Aggregate Adjustment Validation Flow</h3>
                        <div class="flow-row">
                            <div class="flow-node action">Complete Escrow Entries</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Review Agg Adj Value</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Value Check</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">Negative or Zero</span>
                                <span class="flow-arrow down">|</span>
                                <div class="flow-node output">CORRECT - Proceed</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">Positive</span>
                                <span class="flow-arrow down">|</span>
                                <div class="flow-node exception">ERROR - Review Data</div>
                            </div>
                        </div>
                    </div>

                    <div class="exception-box">
                        <h4>CRITICAL: Aggregate Adjustment Rules</h4>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li style="margin-bottom: 8px;">The Aggregate Adjustment <strong>MUST</strong> be a <strong>negative number</strong> or <strong>zero</strong></li>
                            <li>If it is a <strong>positive number</strong>, the information on the Agg Esc Screen is <strong>NOT correct</strong></li>
                        </ul>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr><th>Aggregate Adjustment Value</th><th>Status</th><th>Action Required</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong style="color: var(--accent-green);">Negative (e.g., -$750.00)</strong></td>
                                <td><span class="badge" style="background: rgba(34, 197, 94, 0.15); color: var(--accent-green);">VALID</span></td>
                                <td>Escrow is configured correctly</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--accent-green);">Zero ($0.00)</strong></td>
                                <td><span class="badge" style="background: rgba(34, 197, 94, 0.15); color: var(--accent-green);">VALID</span></td>
                                <td>Escrow is configured correctly</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--accent-rose);">Positive (e.g., +$500.00)</strong></td>
                                <td><span class="badge required-badge">INVALID</span></td>
                                <td>Review and correct Agg Esc Screen data</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="tip-box">
                        <h4>Troubleshooting Positive Aggregate Adjustment</h4>
                        <p>If your Aggregate Adjustment shows a positive number:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li style="margin-bottom: 5px;">Verify all Starting Month/Year entries are correct</li>
                            <li style="margin-bottom: 5px;">Confirm the disbursement frequency matches state requirements</li>
                            <li style="margin-bottom: 5px;">Check that SmartFees was run and data populated correctly</li>
                            <li>Click Jump To Agg Esc to review the full escrow schedule</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Quick Reference -->
            <section id="quick-ref" class="quick-ref">
                <h3>Quick Reference Card</h3>
                <pre>
LOCATION: LE Page 2 > Section G. Initial Escrow Payment at Closing

PURCHASE DEFAULTS:
  - Hazard/Flood Insurance: 3 months, Annually, Starting at Closing
  - Property Taxes: Populate after SmartFees (enter Year Due)

REFINANCE REQUIREMENTS:
  - Enter Starting Month/Year for insurance next due
  - Click "Update Months in Reserve" to calculate

TAX SCHEDULES:
  - Annually:       Select "Annually" + Enter Year
  - Semi-Annually:  Select "Semi Annually" + Starting Month + Year
  - Quarterly:      Select "Quarterly" + Starting Month + Year
  - Other:          Select "Other" + Click Edit + Enter months for each due date

VALIDATION:
  - Aggregate Adjustment MUST be NEGATIVE or ZERO
  - Positive value = ERROR - Review Agg Esc Screen data

QUICK ACTIONS:
  - Jump To Agg Esc: Access detailed escrow schedule
  - Update Months in Reserve: Calculate insurance months (Refinance)
                </pre>
            </section>
        </div>

        <!-- ==================== AGENT OPPORTUNITIES TAB ==================== -->
        <div id="agents-panel" class="tab-panel">
            <!-- Header -->
            <div class="agent-header">
                <h1>AI Agent Opportunities</h1>
                <p class="subtitle">Automation Analysis for Aggregate Escrow Workflow</p>
                <div class="meta">
                    <span class="meta-item">6 Process Steps Analyzed</span>
                    <span class="meta-item">4 Agent Candidates Identified</span>
                    <span class="meta-item">Est. 50% Time Savings</span>
                </div>
            </div>

            <!-- Summary Stats -->
            <div class="agent-summary" id="agent-summary">
                <div class="agent-summary-card">
                    <div class="agent-summary-value">4</div>
                    <div class="agent-summary-label">Agent Candidates</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">2</div>
                    <div class="agent-summary-label">High Priority</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">50%</div>
                    <div class="agent-summary-label">Time Savings</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">90%</div>
                    <div class="agent-summary-label">Automation Potential</div>
                </div>
            </div>

            <!-- Heat Map Legend -->
            <div class="heat-legend" id="agent-heatmap">
                <div class="heat-legend-item"><div class="heat-legend-color" style="background: linear-gradient(135deg, #ef4444, #f97316);"></div><span><strong>Critical (90-100)</strong> - Immediate ROI</span></div>
                <div class="heat-legend-item"><div class="heat-legend-color" style="background: linear-gradient(135deg, #f97316, #eab308);"></div><span><strong>High (70-89)</strong> - Strong candidate</span></div>
                <div class="heat-legend-item"><div class="heat-legend-color" style="background: linear-gradient(135deg, #eab308, #22c55e);"></div><span><strong>Medium (50-69)</strong> - Consider</span></div>
                <div class="heat-legend-item"><div class="heat-legend-color" style="background: linear-gradient(135deg, #22c55e, #14b8a6);"></div><span><strong>Low (0-49)</strong> - Future phase</span></div>
            </div>

            <!-- Heat Map Grid -->
            <div class="heat-map-container">
                <div class="heat-map-title">Automation Priority Heat Map <span style="font-size: 0.8rem; font-weight: 400; color: var(--text-muted);">(Click to jump to agent)</span></div>
                <div class="heat-map-grid">
                    <div class="heat-item critical" onclick="scrollToAgent('agent-taxlookup')" title="Click to view agent details">
                        <div class="heat-score">92</div>
                        <div class="heat-name">Tax Schedule Lookup</div>
                        <div class="heat-desc">Auto-detect state tax payment schedules</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Effort: <span>Low</span></div>
                            <div class="heat-metric">Impact: <span>High</span></div>
                            <div class="heat-metric">Step: <span>5</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-escrowcalc')" title="Click to view agent details">
                        <div class="heat-score">85</div>
                        <div class="heat-name">Escrow Auto-Calculator</div>
                        <div class="heat-desc">Calculate months in reserve automatically</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Effort: <span>Medium</span></div>
                            <div class="heat-metric">Impact: <span>High</span></div>
                            <div class="heat-metric">Step: <span>2,3</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-validation')" title="Click to view agent details">
                        <div class="heat-score">78</div>
                        <div class="heat-name">Agg Adj Validator</div>
                        <div class="heat-desc">Real-time validation with error suggestions</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Effort: <span>Low</span></div>
                            <div class="heat-metric">Impact: <span>High</span></div>
                            <div class="heat-metric">Step: <span>6</span></div>
                        </div>
                    </div>
                    <div class="heat-item medium" onclick="scrollToAgent('agent-policyfetch')" title="Click to view agent details">
                        <div class="heat-score">65</div>
                        <div class="heat-name">Insurance Policy Fetch</div>
                        <div class="heat-desc">Extract due dates from policy documents</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Effort: <span>High</span></div>
                            <div class="heat-metric">Impact: <span>Medium</span></div>
                            <div class="heat-metric">Step: <span>2,3</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agent Details -->
            <h2 style="font-size: 1.4rem; margin: 35px 0 22px; color: var(--text-primary);" id="agent-details">Agent Specifications</h2>

            <div class="agent-grid">
                <!-- Agent 1: Tax Schedule Lookup -->
                <div class="agent-card" id="agent-taxlookup">
                    <div class="agent-card-header">
                        <div class="agent-icon">T</div>
                        <div class="agent-info">
                            <div class="agent-name">Tax Schedule Lookup Agent</div>
                            <div class="agent-type">Data Integration Agent</div>
                        </div>
                        <span class="agent-priority critical">Critical</span>
                    </div>
                    <div class="agent-card-body">
                        <p class="agent-description">Automatically determines the correct property tax payment schedule based on state and county. Pre-selects Annual, Semi-Annual, Quarterly, or Other and populates due months, eliminating manual research.</p>
                        <div class="agent-flow">
                            <div class="agent-flow-title">Agent Flow</div>
                            <div class="agent-flow-diagram">
                                <div class="agent-step">Property Address</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">State/County Lookup</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Tax DB Query</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Auto-Configure</div>
                            </div>
                        </div>
                        <div class="agent-stats">
                            <div class="agent-stat"><div class="agent-stat-value">3min</div><div class="agent-stat-label">Time Saved</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">98%</div><div class="agent-stat-label">Accuracy</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">Low</div><div class="agent-stat-label">Complexity</div></div>
                        </div>
                        <button class="agent-prompt-btn" onclick="showAgentPrompt('taxlookup')">
                            View AI Prompt to Build This Agent
                        </button>
                    </div>
                </div>

                <!-- Agent 2: Escrow Auto-Calculator -->
                <div class="agent-card" id="agent-escrowcalc">
                    <div class="agent-card-header">
                        <div class="agent-icon">$</div>
                        <div class="agent-info">
                            <div class="agent-name">Escrow Auto-Calculator Agent</div>
                            <div class="agent-type">Calculation Agent</div>
                        </div>
                        <span class="agent-priority high">High</span>
                    </div>
                    <div class="agent-card-body">
                        <p class="agent-description">Automatically calculates the correct number of months in reserve based on closing date and next due dates for hazard, flood, and tax escrows. Handles both Purchase and Refinance logic.</p>
                        <div class="agent-flow">
                            <div class="agent-flow-title">Agent Flow</div>
                            <div class="agent-flow-diagram">
                                <div class="agent-step">Closing Date</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Due Date Input</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Calculate Months</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Update Fields</div>
                            </div>
                        </div>
                        <div class="agent-stats">
                            <div class="agent-stat"><div class="agent-stat-value">2min</div><div class="agent-stat-label">Time Saved</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">100%</div><div class="agent-stat-label">Accuracy</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">Med</div><div class="agent-stat-label">Complexity</div></div>
                        </div>
                        <button class="agent-prompt-btn" onclick="showAgentPrompt('escrowcalc')">
                            View AI Prompt to Build This Agent
                        </button>
                    </div>
                </div>

                <!-- Agent 3: Aggregate Adjustment Validator -->
                <div class="agent-card" id="agent-validation">
                    <div class="agent-card-header">
                        <div class="agent-icon">!</div>
                        <div class="agent-info">
                            <div class="agent-name">Agg Adj Validator Agent</div>
                            <div class="agent-type">Validation Agent</div>
                        </div>
                        <span class="agent-priority high">High</span>
                    </div>
                    <div class="agent-card-body">
                        <p class="agent-description">Real-time monitoring of the Aggregate Adjustment value. Alerts immediately if positive and provides specific suggestions for which escrow line items likely have errors based on pattern analysis.</p>
                        <div class="agent-flow">
                            <div class="agent-flow-title">Agent Flow</div>
                            <div class="agent-flow-diagram">
                                <div class="agent-step">Monitor Agg Adj</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Validate Sign</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Analyze Errors</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Suggest Fix</div>
                            </div>
                        </div>
                        <div class="agent-stats">
                            <div class="agent-stat"><div class="agent-stat-value">5min</div><div class="agent-stat-label">Time Saved</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">-80%</div><div class="agent-stat-label">Error Rate</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">Low</div><div class="agent-stat-label">Complexity</div></div>
                        </div>
                        <button class="agent-prompt-btn" onclick="showAgentPrompt('validation')">
                            View AI Prompt to Build This Agent
                        </button>
                    </div>
                </div>

                <!-- Agent 4: Insurance Policy Fetch -->
                <div class="agent-card" id="agent-policyfetch">
                    <div class="agent-card-header">
                        <div class="agent-icon">P</div>
                        <div class="agent-info">
                            <div class="agent-name">Insurance Policy Fetch Agent</div>
                            <div class="agent-type">Document AI Agent</div>
                        </div>
                        <span class="agent-priority medium">Medium</span>
                    </div>
                    <div class="agent-card-body">
                        <p class="agent-description">Uses OCR and document AI to extract premium amounts, policy effective dates, and next due dates from uploaded hazard and flood insurance policy documents for refinance transactions.</p>
                        <div class="agent-flow">
                            <div class="agent-flow-title">Agent Flow</div>
                            <div class="agent-flow-diagram">
                                <div class="agent-step">Upload Policy</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">OCR Extract</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Parse Dates</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Populate Fields</div>
                            </div>
                        </div>
                        <div class="agent-stats">
                            <div class="agent-stat"><div class="agent-stat-value">4min</div><div class="agent-stat-label">Time Saved</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">92%</div><div class="agent-stat-label">Accuracy</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">High</div><div class="agent-stat-label">Complexity</div></div>
                        </div>
                        <button class="agent-prompt-btn" onclick="showAgentPrompt('policyfetch')">
                            View AI Prompt to Build This Agent
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Documentation Modal -->
    <div class="modal-overlay" id="docModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Aggregate Escrow - Workflow Markdown</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyToClipboard()">Copy</button>
                    <button class="modal-btn close" onclick="closeDocModal()">X Close</button>
                </div>
            </div>
            <div class="modal-body">
                <pre id="docContent"># Aggregate Escrow in Byte

## Overview
Calculating the Aggregate Escrow screen of the LE Page 2 allows the Loan Estimate to get as close as possible to the cash needed at closing.

## Hazard Insurance / Flood Insurance

### Purchase
- Mo's defaults to 3 months of Escrow at Closing Date
- Disburse defaults to Annually
- Starting defaults to Closing

### Refinance
- Mo's shows as 0 until Month/Year next due are entered
- Enter the Starting Month and Year next due
- Click "Update Months in Reserve" to calculate correct months

## Property Taxes

### After SmartFees
Once SmartFees are run and costs are pulled into LE Page 2, the months that taxes are due should populate in Section G.

### Tax Payment Schedules

**Annually:**
- Taxes due once per year populate one month
- Enter the Year Due

**Semi-Annually:**
- Select "Semi Annually" from dropdown
- Enter Starting month (next due after closing)
- Enter Year
- System shows payments every 6 months

**Other (Irregular Schedule):**
- Select "Other" from dropdown
- Click Edit
- Enter 6 months for each due date in grid

**Quarterly:**
- Select "Quarterly" from dropdown
- Enter Starting Month and Year
- Taxes show paid every 3 months

## Aggregate Adjustment Validation

CRITICAL RULE:
- Aggregate Adjustment MUST be NEGATIVE or ZERO
- If POSITIVE, the Agg Esc Screen data is NOT correct
- Review and correct escrow entries until validation passes</pre>
            </div>
        </div>
    </div>

    <div class="copy-success" id="copySuccess">Copied to clipboard!</div>

    <!-- AI Prompt Modal -->
    <div class="modal-overlay prompt-modal" id="promptModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="promptModalTitle">AI Agent Build Prompt</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyPromptToClipboard()">Copy Prompt</button>
                    <button class="modal-btn close" onclick="closePromptModal()">X Close</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="prompt-tags" id="promptTags"></div>
                <div class="prompt-section">
                    <h4>Agent Purpose</h4>
                    <div class="prompt-box" id="promptPurpose"></div>
                </div>
                <div class="prompt-section">
                    <h4>Full Build Prompt</h4>
                    <div class="prompt-box" id="promptContent"></div>
                </div>
                <div class="prompt-section">
                    <h4>Integration Points</h4>
                    <div class="prompt-box" id="promptIntegration"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Scroll spy state for click debounce
        let isScrolling = false;
        let scrollTimeout = null;

        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));

            if (tab === 'workflow') {
                document.querySelector('.sidebar-tab:not(.agent-tab)').classList.add('active');
                document.getElementById('workflow-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'block';
                document.getElementById('agents-nav').style.display = 'none';
            } else {
                document.querySelector('.sidebar-tab.agent-tab').classList.add('active');
                document.getElementById('agents-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'none';
                document.getElementById('agents-nav').style.display = 'block';
            }

            window.scrollTo(0, 0);
        }

        // Improved scroll spy with click debounce
        const sections = document.querySelectorAll('.section, .quick-ref');
        const navItems = document.querySelectorAll('#workflow-nav .nav-item');

        function updateActiveNav() {
            // Skip scroll spy updates while processing a click
            if (isScrolling) return;

            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                if (window.scrollY >= sectionTop) current = section.getAttribute('id');
            });
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + current) item.classList.add('active');
            });
        }

        // Add click handlers to nav items with debounce
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                // Set scrolling flag to prevent scroll spy interference
                isScrolling = true;

                // Clear any existing timeout
                if (scrollTimeout) clearTimeout(scrollTimeout);

                // Update active state immediately on click
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');

                // Reset scrolling flag after scroll animation completes
                scrollTimeout = setTimeout(() => {
                    isScrolling = false;
                }, 1000); // 1 second debounce
            });
        });

        window.addEventListener('scroll', updateActiveNav);

        // Modal functions
        function openDocModal() {
            document.getElementById('docModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeDocModal() {
            document.getElementById('docModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyToClipboard() {
            try {
                await navigator.clipboard.writeText(document.getElementById('docContent').textContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeDocModal(); closePromptModal(); } });
        document.getElementById('docModal').addEventListener('click', (e) => { if (e.target.id === 'docModal') closeDocModal(); });

        document.addEventListener('DOMContentLoaded', () => { updateActiveNav(); });

        // Scroll to agent card from heat map
        function scrollToAgent(agentId) {
            const agentCard = document.getElementById(agentId);
            if (agentCard) {
                agentCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                agentCard.classList.add('highlight');
                setTimeout(() => agentCard.classList.remove('highlight'), 2000);
            }
        }

        // Agent Prompt System
        const agentPrompts = {
            taxlookup: {
                name: 'Tax Schedule Lookup Agent',
                tags: ['Data Integration', 'State Rules', 'Low Complexity', 'Critical Priority'],
                purpose: `This agent automatically determines the correct property tax payment schedule based on the property's state and county. It pre-selects Annual, Semi-Annual, Quarterly, or Other and populates the due months, eliminating the need for manual research.`,
                prompt: `You are building a Data Integration Agent for CMG Financial's Byte LOS system.

AGENT NAME: Tax Schedule Lookup Agent
TYPE: Data Integration / Rules Engine

OBJECTIVE:
Create an agent that automatically determines and configures the correct property tax payment schedule based on state and county information from the loan file.

INPUT DATA:
1. Property Address
   - State (2-letter code)
   - County
   - Zip Code

2. Loan Data (from Byte)
   - Scheduled Closing Date
   - Property Type

TAX SCHEDULE DATABASE:
Maintain a lookup table of all US states/counties with:
- Payment Frequency: Annual, Semi-Annual, Quarterly, Other
- Due Months: List of months when payments are due
- Special Rules: Any county-specific variations

EXAMPLE STATE RULES:
- California: Semi-Annual (Dec, Apr)
- Texas: Annual (Jan/Feb typically)
- New York: Quarterly (varies by county)
- Florida: Annual (Nov)

OUTPUT FORMAT:
{
  "state": "CA",
  "county": "Los Angeles",
  "schedule": "Semi Annually",
  "dueMonths": [12, 4],
  "startingMonth": "April",
  "startingYear": 2023,
  "confidence": 0.98,
  "source": "State Tax DB v2.1"
}

AUTO-CONFIGURATION:
1. Select correct Disburse dropdown value
2. Populate Starting Month
3. Populate Year
4. For "Other" schedule, auto-fill the months disbursed grid`,
                integration: `INTEGRATION POINTS:
1. Byte LOS Property Screen
   - Read property address on loan creation
   - Trigger lookup when address is entered/updated

2. Aggregate Escrow Screen
   - Auto-select Disburse dropdown
   - Populate Starting Month/Year fields
   - For "Other" schedules, populate edit grid

3. Data Sources
   - State/County tax authority databases
   - Historical CMG loan data for validation
   - Annual refresh of tax calendar data

DEPLOYMENT:
- Byte API integration (if available)
- Browser extension for UI automation
- Batch processing for existing pipeline loans`
            },
            escrowcalc: {
                name: 'Escrow Auto-Calculator Agent',
                tags: ['Calculation', 'Date Logic', 'Medium Complexity', 'High Priority'],
                purpose: `This agent automatically calculates the correct number of months in reserve based on the closing date and next due dates for hazard insurance, flood insurance, and property taxes. It handles both Purchase and Refinance transaction logic.`,
                prompt: `You are building a Calculation Agent for CMG Financial's Byte LOS system.

AGENT NAME: Escrow Auto-Calculator Agent
TYPE: Calculation / Date Logic

OBJECTIVE:
Create an agent that calculates the correct number of escrow months to collect at closing based on the loan type, closing date, and disbursement schedules.

INPUT PARAMETERS:
1. Loan Information
   - Loan Purpose: Purchase or Refinance
   - Scheduled Closing Date
   - First Payment Date

2. Insurance Data
   - Hazard Insurance: Next Due Date, Premium Amount
   - Flood Insurance: Next Due Date, Premium Amount (if applicable)

3. Tax Data
   - Property Tax: Disbursement Schedule, Due Dates
   - Tax Amount per Period

CALCULATION LOGIC:

FOR PURCHASE:
- Default to 3 months escrow for Hazard/Flood
- Calculate tax escrow based on months until first tax due date

FOR REFINANCE:
- Calculate months from Closing Date to Next Due Date
- Apply cushion rules (typically 2 months)
- Round appropriately based on investor guidelines

FORMULA:
Months in Reserve =
  (Next Due Date - Closing Date) in months + Cushion - Months of payments before due

VALIDATION RULES:
- Minimum: 0 months (no negative)
- Maximum: 12 months per escrow type
- Flag unusual results for review

OUTPUT:
{
  "hazardInsurance": {
    "monthsToCollect": 3,
    "amountPerMonth": 150.00,
    "totalAtClosing": 450.00
  },
  "floodInsurance": {
    "monthsToCollect": 3,
    "amountPerMonth": 75.00,
    "totalAtClosing": 225.00
  },
  "propertyTaxes": {
    "monthsToCollect": 5,
    "amountPerMonth": 350.00,
    "totalAtClosing": 1750.00
  },
  "aggregateAdjustment": -750.00,
  "isValid": true
}`,
                integration: `INTEGRATION POINTS:
1. LE Page 2 - Section G
   - Populate Mo's field for each escrow line
   - Update total Initial Escrow Payment
   - Recalculate on any date change

2. Aggregate Escrow Screen
   - Sync with Trial Balance calculations
   - Update when any input changes

3. Event Triggers
   - Closing Date change
   - Insurance due date entry
   - Tax schedule configuration
   - SmartFees completion

ACCURACY REQUIREMENTS:
- Must match Byte's native calculation exactly
- Support all disbursement frequencies
- Handle edge cases (year-end closings, etc.)`
            },
            validation: {
                name: 'Agg Adj Validator Agent',
                tags: ['Validation', 'Error Detection', 'Low Complexity', 'High Priority'],
                purpose: `This agent provides real-time monitoring of the Aggregate Adjustment value. It alerts immediately if the value becomes positive and provides specific suggestions for which escrow line items likely have errors based on pattern analysis.`,
                prompt: `You are building a Validation Agent for CMG Financial's Byte LOS system.

AGENT NAME: Aggregate Adjustment Validator Agent
TYPE: Validation / Error Detection

OBJECTIVE:
Create an agent that monitors the Aggregate Adjustment value in real-time and provides intelligent error detection and correction suggestions when the value is invalid (positive).

VALIDATION RULE:
- VALID: Aggregate Adjustment <= 0 (negative or zero)
- INVALID: Aggregate Adjustment > 0 (positive)

MONITORING TRIGGERS:
1. Any escrow field change on LE Page 2
2. Closing date modification
3. Insurance/tax amount updates
4. SmartFees completion
5. Manual Agg Esc screen edits

ERROR ANALYSIS LOGIC:
When Agg Adj is positive, analyze:

1. Date Alignment Issues
   - Starting month doesn't match next due date
   - Year is off by 1 (common error)
   - Closing date changed without escrow update

2. Schedule Mismatch
   - Wrong disbursement frequency selected
   - "Other" schedule not properly configured
   - Semi-annual vs Quarterly confusion

3. Amount Issues
   - Missing premium amounts
   - Duplicated entries
   - Incorrect tax amounts

PATTERN RECOGNITION:
Based on historical error data, prioritize suggestions:

HIGH PROBABILITY ERRORS:
- Year Due not entered for annual taxes (90% match)
- Refinance missing "Update Months in Reserve" click (85%)
- Tax schedule doesn't match state rules (75%)

OUTPUT FORMAT:
{
  "aggregateAdjustment": 500.00,
  "isValid": false,
  "severity": "ERROR",
  "suggestions": [
    {
      "probability": 0.90,
      "issue": "Property Taxes - Year Due not entered",
      "field": "Property Taxes > Year",
      "currentValue": null,
      "suggestedValue": "2023",
      "action": "Enter the year taxes are due"
    },
    {
      "probability": 0.75,
      "issue": "Tax schedule may not match state rules",
      "field": "Property Taxes > Disburse",
      "currentValue": "Annually",
      "suggestedValue": "Semi Annually",
      "action": "California typically has semi-annual taxes"
    }
  ],
  "quickFix": "Click 'Jump To Agg Esc' to review full escrow schedule"
}`,
                integration: `INTEGRATION POINTS:
1. LE Page 2 - Aggregate Adjustment Field
   - Add visual indicator (green check / red X)
   - Hover tooltip with suggestions
   - One-click access to fix screen

2. Alert System
   - Toast notification on error
   - Block LE generation if invalid (optional)
   - Log all errors for training data

3. Learning System
   - Track which suggestions were accepted
   - Refine probability weights over time
   - Identify new error patterns

TECHNICAL REQUIREMENTS:
- Sub-second response time
- Non-blocking UI updates
- Offline capability with last-known rules`
            },
            policyfetch: {
                name: 'Insurance Policy Fetch Agent',
                tags: ['Document AI', 'OCR', 'High Complexity', 'Medium Priority'],
                purpose: `This agent uses OCR and document AI to extract premium amounts, policy effective dates, and next due dates from uploaded hazard and flood insurance policy documents, particularly valuable for refinance transactions.`,
                prompt: `You are building a Document AI Agent for CMG Financial's Byte LOS system.

AGENT NAME: Insurance Policy Fetch Agent
TYPE: Document AI / OCR Extraction

OBJECTIVE:
Create an agent that automatically extracts insurance policy information from uploaded documents to populate escrow fields, eliminating manual data entry for refinance transactions.

SUPPORTED DOCUMENT TYPES:
1. Homeowners Insurance Declarations Page
2. Flood Insurance Policy (NFIP or Private)
3. HOA/Condo Master Policy
4. Insurance Binder

TARGET DATA EXTRACTION:
{
  "policyType": "Hazard" | "Flood",
  "carrier": "State Farm",
  "policyNumber": "12-AB-C345-6",
  "effectiveDate": "2023-01-15",
  "expirationDate": "2024-01-15",
  "annualPremium": 1800.00,
  "monthlyPremium": 150.00,
  "nextDueDate": "2024-01-15",
  "paymentFrequency": "Annual",
  "dwellingCoverage": 450000,
  "deductible": 2500,
  "confidence": 0.94
}

OCR EXTRACTION RULES:

1. Premium Amount
   - Look for: "Annual Premium", "Total Premium", "Amount Due"
   - Handle: "$1,800.00" or "1800" or "$1,800"
   - Validate: Typical range $500-$10,000

2. Dates
   - Look for: "Policy Period", "Effective", "Expires", "Renewal"
   - Parse: MM/DD/YYYY, MM-DD-YY, Month DD, YYYY
   - Calculate: Next due = Expiration date

3. Policy Number
   - Various formats by carrier
   - Usually near top of document

VALIDATION:
- Cross-reference extracted carrier with known formats
- Flag low-confidence extractions for review
- Verify premium is reasonable for property type/location

ERROR HANDLING:
- Handwritten documents: Flag for manual entry
- Poor scan quality: Request rescan
- Missing fields: Highlight what's missing`,
                integration: `INTEGRATION POINTS:
1. Document Upload
   - Trigger on insurance doc upload to loan file
   - Process in background, notify when complete
   - Support drag-and-drop to escrow screen

2. Byte Escrow Fields
   - Auto-populate $/Mo field
   - Set Starting Month and Year
   - Flag if existing data differs

3. Verification Workflow
   - Show extracted data for LO confirmation
   - Side-by-side view of document and fields
   - One-click accept or manual override

TECHNICAL STACK:
- OCR: Azure Form Recognizer or AWS Textract
- Pre-trained models for insurance documents
- Confidence scoring with human review threshold

TRAINING DATA:
- 10,000+ labeled insurance documents
- Carrier-specific fine-tuning
- Continuous learning from corrections`
            }
        };

        let currentPromptKey = '';

        function showAgentPrompt(key) {
            const prompt = agentPrompts[key];
            if (!prompt) return;

            currentPromptKey = key;

            document.getElementById('promptModalTitle').textContent = prompt.name + ' - Build Prompt';
            document.getElementById('promptTags').innerHTML = prompt.tags.map(t => `<span class="prompt-tag">${t}</span>`).join('');
            document.getElementById('promptPurpose').textContent = prompt.purpose;
            document.getElementById('promptContent').textContent = prompt.prompt;
            document.getElementById('promptIntegration').textContent = prompt.integration;

            document.getElementById('promptModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closePromptModal() {
            document.getElementById('promptModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyPromptToClipboard() {
            const prompt = agentPrompts[currentPromptKey];
            if (!prompt) return;

            const fullText = `# ${prompt.name}\n\n## Purpose\n${prompt.purpose}\n\n## Build Prompt\n${prompt.prompt}\n\n## Integration\n${prompt.integration}`;

            try {
                await navigator.clipboard.writeText(fullText);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) {
                alert('Failed to copy.');
            }
        }

        document.getElementById('promptModal').addEventListener('click', (e) => {
            if (e.target.id === 'promptModal') closePromptModal();
        });
    </script>
</body>
</html>
