<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Byte Rental Income Entry - Process Workflow</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: #111827;
            --bg-card: #1a2234;
            --accent-blue: #3b82f6;
            --accent-teal: #14b8a6;
            --accent-amber: #f59e0b;
            --accent-rose: #f43f5e;
            --accent-green: #22c55e;
            --accent-purple: #8b5cf6;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-subtle: rgba(255,255,255,0.08);
            --sidebar-width: 280px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Breadcrumb */
        .breadcrumb {
            background: linear-gradient(90deg, #0d1525 0%, #1a2234 100%);
            padding: 14px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
            border-bottom: 1px solid var(--border-subtle);
        }

        .breadcrumb a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            transition: all 0.2s;
            border: 1px solid var(--border-subtle);
        }

        .breadcrumb a:hover {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .breadcrumb .separator { color: var(--text-muted); font-size: 1.2rem; }
        .breadcrumb .current { color: var(--accent-amber); font-weight: 600; padding: 8px 16px; }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 54px;
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - 54px);
            background: var(--bg-secondary);
            overflow-y: auto;
            z-index: 1000;
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 25px 20px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-header h2 { color: var(--text-primary); font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
        .sidebar-header p { color: var(--text-muted); font-size: 0.85rem; }

        /* Tab Switch */
        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-tab {
            flex: 1;
            padding: 14px 10px;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            background: none;
            border-left: none;
            border-right: none;
            border-top: none;
        }

        .sidebar-tab:hover { background: rgba(255,255,255,0.03); color: var(--text-secondary); }
        .sidebar-tab.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); background: rgba(59, 130, 246, 0.08); }
        .sidebar-tab.agent-tab.active { color: var(--accent-purple); border-bottom-color: var(--accent-purple); background: rgba(139, 92, 246, 0.08); }

        .sidebar-nav { padding: 15px 0; flex: 1; overflow-y: auto; }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .nav-item:hover { background: rgba(255,255,255,0.03); color: var(--text-primary); }
        .nav-item.active { background: rgba(59, 130, 246, 0.1); border-left-color: var(--accent-blue); color: var(--text-primary); }

        .nav-number {
            background: rgba(255,255,255,0.1);
            color: var(--text-secondary);
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .nav-item.active .nav-number { background: var(--accent-blue); color: white; }
        .nav-label { font-size: 0.95rem; font-weight: 500; }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-subtle);
            background: rgba(0,0,0,0.2);
        }

        .doc-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px 20px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .doc-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3); }

        /* Main Content */
        .main-content { margin-left: var(--sidebar-width); padding: 80px 40px 40px 40px; }

        /* Tab Panels */
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        .header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(20, 184, 166, 0.08) 0%, transparent 50%);
            pointer-events: none;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        .header .meta { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; position: relative; }

        .header .meta-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-subtle);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); }
        .legend-color { width: 18px; height: 18px; border-radius: 4px; }

        /* Sections */
        .section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            margin-bottom: 25px;
            overflow: hidden;
            scroll-margin-top: 75px;
        }

        .section-header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(59, 130, 246, 0.1) 100%);
            border-bottom: 1px solid var(--border-subtle);
            padding: 22px 25px;
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .section-number {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .section-title h2 { font-size: 1.35rem; font-weight: 700; margin-bottom: 4px; color: var(--text-primary); }
        .section-title span { font-size: 0.9rem; color: var(--text-muted); }
        .section-content { padding: 28px; }

        /* Workflow Diagrams */
        .workflow-diagram {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 28px;
            margin-bottom: 22px;
        }

        .flow-row { display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 12px; margin: 15px 0; }

        .flow-node {
            padding: 14px 22px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            min-width: 150px;
            border: 1px solid var(--border-subtle);
        }

        .flow-node.start { background: linear-gradient(135deg, var(--accent-green) 0%, #16a34a 100%); color: white; border-radius: 25px; border: none; }
        .flow-node.action { background: linear-gradient(135deg, var(--accent-blue) 0%, #2563eb 100%); color: white; border: none; }
        .flow-node.decision { background: linear-gradient(135deg, var(--accent-amber) 0%, #d97706 100%); color: var(--bg-primary); border: none; }
        .flow-node.input { background: var(--bg-secondary); border: 2px solid var(--accent-blue); color: var(--text-primary); }
        .flow-node.output { background: linear-gradient(135deg, var(--accent-teal) 0%, #0d9488 100%); color: white; border: none; }
        .flow-node.exception { background: linear-gradient(135deg, var(--accent-rose) 0%, #dc2626 100%); color: white; border: none; }

        .flow-arrow { color: var(--accent-blue); font-size: 1.5rem; }
        .flow-arrow.down { transform: rotate(90deg); }

        .decision-branch { display: flex; gap: 40px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
        .branch { display: flex; flex-direction: column; align-items: center; gap: 10px; }

        .branch-label {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        /* Tables */
        .field-table { width: 100%; border-collapse: collapse; margin: 18px 0; }

        .field-table th {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            padding: 14px 18px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border-subtle);
        }

        .field-table td { padding: 14px 18px; border-bottom: 1px solid var(--border-subtle); color: var(--text-secondary); }
        .field-table tr:hover { background: rgba(255,255,255,0.02); }

        .badge { display: inline-block; padding: 4px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge.required-badge { background: rgba(244, 63, 94, 0.15); color: var(--accent-rose); }
        .badge.optional-badge { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .badge.calculated-badge { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }
        .badge.warning-badge { background: rgba(245, 158, 11, 0.15); color: var(--accent-amber); }

        /* Info Boxes */
        .exception-box, .tip-box, .info-box {
            padding: 18px 22px;
            margin: 18px 0;
            border-radius: 0 10px 10px 0;
            border-left-width: 4px;
            border-left-style: solid;
        }

        .exception-box { background: rgba(244, 63, 94, 0.08); border-color: var(--accent-rose); border: 1px solid rgba(244, 63, 94, 0.2); border-left: 4px solid var(--accent-rose); }
        .exception-box h4 { color: var(--accent-rose); margin-bottom: 10px; font-size: 1rem; }
        .exception-box p, .exception-box li { color: var(--text-secondary); }

        .tip-box { background: rgba(34, 197, 94, 0.08); border-color: var(--accent-green); border: 1px solid rgba(34, 197, 94, 0.2); border-left: 4px solid var(--accent-green); }
        .tip-box h4 { color: var(--accent-green); margin-bottom: 10px; font-size: 1rem; }
        .tip-box p, .tip-box li { color: var(--text-secondary); }

        .info-box { background: rgba(59, 130, 246, 0.08); border-color: var(--accent-blue); border: 1px solid rgba(59, 130, 246, 0.2); border-left: 4px solid var(--accent-blue); }
        .info-box h4 { color: var(--accent-blue); margin-bottom: 10px; font-size: 1rem; }
        .info-box p, .info-box li { color: var(--text-secondary); }

        /* Decision Tree */
        .decision-tree {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 22px;
            margin: 22px 0;
        }

        .decision-tree h3 { color: var(--accent-blue); margin-bottom: 18px; padding-bottom: 12px; border-bottom: 1px solid var(--border-subtle); font-size: 1.1rem; }

        .tree-node { margin-left: 20px; padding: 12px; border-left: 2px solid var(--accent-teal); position: relative; color: var(--text-secondary); }
        .tree-node::before { content: ''; position: absolute; left: -2px; top: 22px; width: 15px; height: 2px; background: var(--accent-teal); }
        .tree-node.level-1 { margin-left: 0; border-left: none; }
        .tree-node.level-1::before { display: none; }

        .tree-label { background: var(--accent-amber); color: var(--bg-primary); padding: 6px 14px; border-radius: 6px; font-weight: 700; display: inline-block; margin-bottom: 6px; font-size: 0.9rem; }

        /* Summary Grid */
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 18px; margin: 22px 0; }

        .summary-card { background: rgba(0,0,0,0.3); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 22px; text-align: center; }
        .summary-card h4 { color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9rem; }
        .summary-card .value {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .summary-card .label { font-size: 0.85rem; color: var(--text-muted); margin-top: 8px; }

        /* MI Comparison Cards */
        .mi-comparison { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 22px 0; }

        .mi-card { background: rgba(0,0,0,0.2); border: 1px solid var(--border-subtle); border-radius: 12px; overflow: hidden; }
        .mi-card-header { background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%); color: white; padding: 18px; text-align: center; }
        .mi-card-header h4 { font-size: 1.05rem; }
        .mi-card-body { padding: 22px; }
        .mi-card ul { list-style: none; padding: 0; }
        .mi-card li { padding: 10px 0; border-bottom: 1px solid var(--border-subtle); display: flex; align-items: center; gap: 12px; color: var(--text-secondary); font-size: 0.95rem; }
        .mi-card li:last-child { border-bottom: none; }
        .check-icon { color: var(--accent-green); font-weight: bold; }
        .x-icon { color: var(--accent-rose); font-weight: bold; }

        /* Quick Reference */
        .quick-ref {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
            border: 1px solid var(--border-subtle);
            padding: 28px;
            border-radius: 16px;
            margin-top: 30px;
            font-family: 'JetBrains Mono', monospace;
            scroll-margin-top: 75px;
        }

        .quick-ref h3 { color: var(--accent-amber); margin-bottom: 18px; font-family: 'Plus Jakarta Sans', sans-serif; }
        .quick-ref pre { background: rgba(0,0,0,0.4); border: 1px solid var(--border-subtle); padding: 20px; border-radius: 10px; overflow-x: auto; font-size: 0.85rem; line-height: 1.7; color: var(--text-secondary); }

        /* ====== AGENT OPPORTUNITIES STYLES ====== */
        .agent-header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .agent-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(139, 92, 246, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .agent-header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        /* Heat Map */
        .heat-map-container { margin-bottom: 35px; }
        .heat-map-title { font-size: 1.3rem; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }

        .heat-map-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .heat-item {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .heat-item:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .heat-item:active { transform: scale(0.98); }

        .heat-item::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 4px;
        }

        .heat-item.critical::before { background: linear-gradient(90deg, #ef4444, #f97316); }
        .heat-item.high::before { background: linear-gradient(90deg, #f97316, #eab308); }
        .heat-item.medium::before { background: linear-gradient(90deg, #eab308, #22c55e); }
        .heat-item.low::before { background: linear-gradient(90deg, #22c55e, #14b8a6); }

        .heat-score {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.8rem;
            font-weight: 800;
        }

        .heat-item.critical .heat-score { color: #ef4444; }
        .heat-item.high .heat-score { color: #f97316; }
        .heat-item.medium .heat-score { color: #eab308; }
        .heat-item.low .heat-score { color: #22c55e; }

        .heat-name { font-size: 1rem; font-weight: 700; color: var(--text-primary); margin-bottom: 6px; padding-right: 50px; }
        .heat-desc { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; }

        .heat-metrics { display: flex; gap: 15px; margin-top: 12px; }
        .heat-metric { font-size: 0.75rem; color: var(--text-muted); }
        .heat-metric span { color: var(--text-secondary); font-weight: 600; }

        /* Agent Cards */
        .agent-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 25px; margin-bottom: 35px; }

        .agent-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .agent-card:hover { transform: translateY(-5px); box-shadow: 0 15px 50px rgba(0,0,0,0.3); }

        .agent-card.highlight {
            animation: highlightPulse 2s ease;
            box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.4);
        }

        @keyframes highlightPulse {
            0% { box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.6); }
            50% { box-shadow: 0 0 0 6px rgba(139, 92, 246, 0.5), 0 15px 50px rgba(139, 92, 246, 0.3); }
            100% { box-shadow: 0 0 0 0px transparent, 0 15px 50px rgba(0,0,0,0.3); }
        }

        .agent-card-header {
            padding: 22px;
            display: flex;
            align-items: flex-start;
            gap: 18px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .agent-icon {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            flex-shrink: 0;
        }

        .agent-info { flex: 1; }
        .agent-name { font-size: 1.15rem; font-weight: 700; color: var(--text-primary); margin-bottom: 5px; }
        .agent-type { font-size: 0.8rem; color: var(--accent-purple); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-priority {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .agent-priority.critical { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .agent-priority.high { background: rgba(249, 115, 22, 0.15); color: #f97316; }
        .agent-priority.medium { background: rgba(234, 179, 8, 0.15); color: #eab308; }
        .agent-priority.low { background: rgba(34, 197, 94, 0.15); color: #22c55e; }

        .agent-card-body { padding: 22px; }
        .agent-description { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; }

        .agent-flow {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 20px;
        }

        .agent-flow-title { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-flow-diagram { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; justify-content: center; }

        .agent-step {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .agent-arrow { color: var(--accent-purple); font-size: 1.2rem; }

        .agent-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }

        .agent-stat {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .agent-stat-value {
            font-size: 1.3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-top: 4px; }

        /* View Prompt Button */
        .agent-prompt-btn {
            width: 100%;
            margin-top: 18px;
            padding: 14px 20px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 10px;
            color: var(--accent-purple);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .agent-prompt-btn:hover {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(59, 130, 246, 0.3) 100%);
            border-color: var(--accent-purple);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.25);
        }

        /* Summary Stats */
        .agent-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .agent-summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            padding: 25px;
            text-align: center;
        }

        .agent-summary-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-summary-label { font-size: 0.9rem; color: var(--text-muted); margin-top: 8px; }

        /* Heat Map Legend */
        .heat-legend {
            display: flex;
            gap: 25px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .heat-legend-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; color: var(--text-secondary); }
        .heat-legend-color { width: 24px; height: 24px; border-radius: 6px; }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(10, 15, 26, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.show { display: flex; }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            width: 100%;
            max-width: 950px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 80px rgba(0,0,0,0.5);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            padding: 22px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 16px 16px 0 0;
        }

        .modal-header h3 { font-size: 1.25rem; font-weight: 700; }
        .modal-actions { display: flex; gap: 12px; }

        .modal-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: transform 0.2s;
            font-size: 0.9rem;
        }

        .modal-btn:hover { transform: scale(1.05); }
        .modal-btn.copy { background: white; color: var(--accent-blue); }
        .modal-btn.close { background: rgba(255,255,255,0.2); color: white; }

        .modal-body { padding: 28px; overflow-y: auto; flex: 1; }

        .modal-body pre {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            padding: 22px;
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.7;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--text-secondary);
        }

        .copy-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--accent-green);
            color: white;
            padding: 18px 35px;
            border-radius: 10px;
            font-weight: 700;
            z-index: 3000;
            display: none;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut { 0%, 100% { opacity: 0; } 10%, 90% { opacity: 1; } }

        /* Prompt Modal */
        .prompt-modal .modal { max-width: 800px; }
        .prompt-modal .modal-header { background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%); }

        .prompt-section { margin-bottom: 25px; }
        .prompt-section h4 { color: var(--accent-purple); font-size: 1rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }

        .prompt-box {
            background: rgba(0,0,0,0.4);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.7;
            color: var(--text-secondary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .prompt-tags { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .prompt-tag { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 75px 20px 30px 20px; }
            .agent-grid { grid-template-columns: 1fr; }
        }
        .breadcrumb-logo-link { display: inline-flex; align-items: center; padding: 4px 8px; background: rgba(255,255,255,0.08); border-radius: 8px; border: 1px solid rgba(255,255,255,0.12); transition: all 0.2s; flex-shrink: 0; margin-right: 4px; }
        .breadcrumb-logo-link:hover { background: rgba(255,255,255,0.15); }
        .breadcrumb-logo { height: 24px; width: auto; display: block; }
    </style>
</head>
<body>
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
<a href="../../index.html" class="breadcrumb-logo-link"><img src="../../images/clear-ai-logo.png" alt="Clear AI" class="breadcrumb-logo"></a>
        <a href="../../index.html">Portal Home</a>
        <span class="separator">></span>
        <a href="./index.html">Byte</a>
        <span class="separator">></span>
        <span class="current">Rental Income Entry</span>
    </nav>

    <!-- Fixed Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>Rental Income Entry</h2>
            <p>Interactive Workflow Guide</p>
        </div>

        <!-- Tab Switcher -->
        <div class="sidebar-tabs">
            <button class="sidebar-tab active" onclick="switchTab('workflow')">Workflow</button>
            <button class="sidebar-tab agent-tab" onclick="switchTab('agents')">AI Agents</button>
        </div>

        <!-- Workflow Navigation -->
        <nav class="sidebar-nav" id="workflow-nav">
            <a href="#section-0" class="nav-item active">
                <span class="nav-number">0</span>
                <span class="nav-label">Overview</span>
            </a>
            <a href="#section-1" class="nav-item">
                <span class="nav-number">1</span>
                <span class="nav-label">Subject Purchase</span>
            </a>
            <a href="#section-2" class="nav-item">
                <span class="nav-number">2</span>
                <span class="nav-label">Refi - No Tax Return</span>
            </a>
            <a href="#section-3" class="nav-item">
                <span class="nav-number">3</span>
                <span class="nav-label">Schedule E - Primary</span>
            </a>
            <a href="#section-4" class="nav-item">
                <span class="nav-number">4</span>
                <span class="nav-label">Schedule E - Investment</span>
            </a>
            <a href="#section-5" class="nav-item">
                <span class="nav-number">5</span>
                <span class="nav-label">1008 Verification</span>
            </a>
            <a href="#quick-ref" class="nav-item">
                <span class="nav-number">*</span>
                <span class="nav-label">Quick Reference</span>
            </a>
        </nav>

        <!-- Agent Navigation -->
        <nav class="sidebar-nav" id="agents-nav" style="display: none;">
            <a href="#agent-summary" class="nav-item active">
                <span class="nav-number">S</span>
                <span class="nav-label">Summary</span>
            </a>
            <a href="#agent-heatmap" class="nav-item">
                <span class="nav-number">H</span>
                <span class="nav-label">Heat Map</span>
            </a>
            <a href="#agent-details" class="nav-item">
                <span class="nav-number">A</span>
                <span class="nav-label">Agent Details</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="doc-btn" onclick="openDocModal()">
                View Workflow Markdown
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

        <!-- ==================== WORKFLOW TAB ==================== -->
        <div id="workflow-panel" class="tab-panel active">
            <!-- Header -->
            <div class="header">
                <h1>Rental Income Entry</h1>
                <p class="subtitle">Complete Guide to REO Rental Income Entry in Byte</p>
                <div class="meta">
                    <span class="meta-item">System: Byte LOS</span>
                    <span class="meta-item">Role: Processor / Underwriter</span>
                    <span class="meta-item">Updated: Jan 27, 2026</span>
                    <span class="meta-item">Duration: 5-10 min</span>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #22c55e, #16a34a);"></div><span>Start/End</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></div><span>Action Step</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></div><span>Decision Point</span></div>
                <div class="legend-item"><div class="legend-color" style="background: #111827; border: 2px solid #3b82f6;"></div><span>User Input</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f43f5e, #dc2626);"></div><span>Exception</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #14b8a6, #0d9488);"></div><span>Output</span></div>
            </div>

            <!-- Section 0: Overview -->
            <section id="section-0" class="section">
                <div class="section-header">
                    <div class="section-number">0</div>
                    <div class="section-title"><h2>Rental Income Overview</h2><span>Understanding where and how to enter rental income</span></div>
                </div>
                <div class="section-content">
                    <div class="info-box">
                        <h4>Key Concept</h4>
                        <p>When a Borrower has Rental Income, it is entered in the <strong>Real Estate Owned (REO)</strong> section of the URLA Borrower screen. The specific entry method depends on the loan scenario.</p>
                    </div>

                    <div class="summary-grid">
                        <div class="summary-card"><h4>Scenarios Covered</h4><div class="value">4</div><div class="label">Different rental income types</div></div>
                        <div class="summary-card"><h4>Default Vacancy</h4><div class="value">25%</div><div class="label">Standard vacancy factor</div></div>
                        <div class="summary-card"><h4>Output Location</h4><div class="value">1008</div><div class="label">Stable Monthly Income</div></div>
                    </div>

                    <div class="decision-tree">
                        <h3>Rental Income Scenario Decision Tree</h3>
                        <div class="tree-node level-1"><span class="tree-label">What type of rental income?</span></div>
                        <div class="tree-node"><span class="tree-label" style="background: var(--accent-blue); color: white;">Subject Property</span> - Purchase with rental from non-owner units -> Section 1</div>
                        <div class="tree-node"><span class="tree-label" style="background: var(--accent-teal); color: white;">REO - No Tax Return</span> - Refinance with rental NOT on Schedule E -> Section 2</div>
                        <div class="tree-node"><span class="tree-label" style="background: var(--accent-green); color: white;">Schedule E - Primary</span> - Rental on tax return, Primary Residence -> Section 3</div>
                        <div class="tree-node"><span class="tree-label" style="background: var(--accent-purple); color: white;">Schedule E - Investment</span> - Rental on tax return, Investment Property -> Section 4</div>
                    </div>
                </div>
            </section>

            <!-- Section 1: Subject Purchase with Rental Income -->
            <section id="section-1" class="section">
                <div class="section-header">
                    <div class="section-number">1</div>
                    <div class="section-title"><h2>Subject Purchase with Rental Income</h2><span>Multi-unit purchase where borrower will occupy one unit</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Start</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Go to Borrower URLA</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Navigate to "Rental Income on the Property You Want to Purchase"</div>
                        </div>
                        <div class="flow-row"><span class="flow-arrow down">|</span></div>
                        <div class="flow-row">
                            <div class="flow-node action">Click "Click here" to open Subject Property Cash Flow</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">Enter Gross Rental Income</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Cash Flow Calculated</div>
                        </div>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr><th>Field</th><th>Status</th><th>Default</th><th>Instructions</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Gross Rental Income</strong></td>
                                <td><span class="badge required-badge">Required</span></td>
                                <td>-</td>
                                <td>Enter lease amount for units OTHER than owner-occupied</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Vacancy Factor</strong></td>
                                <td><span class="badge optional-badge">Overridable</span></td>
                                <td>25%</td>
                                <td>Click field to override if product allows different factor</td>
                            </tr>
                            <tr>
                                <td>Cash Flow</td>
                                <td><span class="badge calculated-badge">Calculated</span></td>
                                <td>-</td>
                                <td>Gross Rental Income x (1 - Vacancy Factor)</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="tip-box">
                        <h4>Pro Tip: Vacancy Factor Override</h4>
                        <p>If the product you are using allows a different vacancy factor (such as 0% for certain investment programs), you can click on the Vacancy Factor field to override the default 25%.</p>
                    </div>

                    <div class="info-box">
                        <h4>Example Calculation</h4>
                        <p><strong>Gross Rental Income:</strong> $1,900.00<br>
                        <strong>Vacancy Factor:</strong> 25%<br>
                        <strong>Cash Flow:</strong> $1,900 x 0.75 = <strong>$1,425.00</strong></p>
                        <p style="margin-top: 10px;">This $1,425.00 will appear on the 1008 as "Sub. Prop. Income" in the Stable Monthly Income section.</p>
                    </div>
                </div>
            </section>

            <!-- Section 2: Refinance With Rental Income - Not on Tax Return -->
            <section id="section-2" class="section">
                <div class="section-header">
                    <div class="section-number">2</div>
                    <div class="section-title"><h2>Refinance With Rental Income - Not on Tax Return</h2><span>Primary Residence or Investment Property without Schedule E</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Start</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Open Edit REO Screen</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">Complete All Fields</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Net Rental Income Calculates</div>
                        </div>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr><th>Step</th><th>Field</th><th>Value/Action</th><th>Notes</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong style="color: var(--accent-blue);">1</strong></td>
                                <td><strong style="color: var(--text-primary);">Usage</strong></td>
                                <td>Complete as applicable</td>
                                <td>Primary Residence or Investment</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--accent-blue);">2</strong></td>
                                <td><strong style="color: var(--text-primary);">Status</strong></td>
                                <td><span class="badge required-badge">Retained - Rental</span></td>
                                <td>Must select "Retained - Rental"</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--accent-blue);">3</strong></td>
                                <td><strong style="color: var(--text-primary);">Type</strong></td>
                                <td>Two To Four Unit Property</td>
                                <td>Select appropriate property type</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--accent-blue);">4</strong></td>
                                <td><strong style="color: var(--text-primary);">No. Units</strong></td>
                                <td>2 to 4</td>
                                <td>Enter number of units</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--accent-blue);">5</strong></td>
                                <td><strong style="color: var(--text-primary);">Amount of Monthly Rents</strong></td>
                                <td><span class="badge required-badge">Required</span></td>
                                <td>Enter gross monthly rent received</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--accent-blue);">6</strong></td>
                                <td><strong style="color: var(--text-primary);">Vacancy Factor</strong></td>
                                <td><span class="badge warning-badge">Override to 0</span></td>
                                <td>Default 25% - MUST override to 0%</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--accent-blue);">7</strong></td>
                                <td>Mortgage Payment</td>
                                <td>Auto-linked</td>
                                <td>Payment from Mortgage tied to this REO</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--accent-blue);">8</strong></td>
                                <td>Net Rental Income</td>
                                <td><span class="badge calculated-badge">Calculated</span></td>
                                <td><strong style="color: var(--accent-rose);">DO NOT override</strong></td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="exception-box">
                        <h4>Critical: Do NOT Override Net Rental Income</h4>
                        <p>The Net Rental Income field will calculate automatically. <strong>DO NOT</strong> manually override this value or calculations will be incorrect on the 1008.</p>
                    </div>

                    <div class="info-box">
                        <h4>Net Rental Income Calculation Formula</h4>
                        <p>Net Rental Income = Gross Rents - (Gross Rents x Vacancy Factor) - Mortgage Payment</p>
                        <p style="margin-top: 10px;">When Vacancy Factor is overridden to 0%: Net Rental Income = Gross Rents - Mortgage Payment</p>
                    </div>
                </div>
            </section>

            <!-- Section 3: Schedule E - Primary Residence -->
            <section id="section-3" class="section">
                <div class="section-header">
                    <div class="section-number">3</div>
                    <div class="section-title"><h2>Refinance or Purchase with Rental Income - On Schedule E</h2><span>Primary Residence Property with tax return documentation</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Start</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Calculate Schedule E Income</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Open Edit REO Screen</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">Enter Schedule E Calculation</div>
                        </div>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr><th>Step</th><th>Field</th><th>Value/Action</th><th>Notes</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong style="color: var(--accent-blue);">1</strong></td>
                                <td><strong style="color: var(--text-primary);">Usage</strong></td>
                                <td>Primary Residence for BOTH</td>
                                <td>Current Usage AND Intended Usage = Primary</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--accent-blue);">2</strong></td>
                                <td><strong style="color: var(--text-primary);">Status</strong></td>
                                <td><span class="badge required-badge">Retained - Rental</span></td>
                                <td>Must select "Retained - Rental"</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--accent-blue);">3</strong></td>
                                <td><strong style="color: var(--text-primary);">Type</strong></td>
                                <td>Choose appropriate type</td>
                                <td>Match property type</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--accent-blue);">4</strong></td>
                                <td><strong style="color: var(--text-primary);">No. Units</strong></td>
                                <td>Enter number of units</td>
                                <td>Actual unit count</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--accent-blue);">5</strong></td>
                                <td><strong style="color: var(--text-primary);">Amount of Monthly Rents</strong></td>
                                <td><span class="badge required-badge">Schedule E Calculation</span></td>
                                <td>Enter the calculated Schedule E amount</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--accent-blue);">6</strong></td>
                                <td><strong style="color: var(--text-primary);">Vacancy Factor</strong></td>
                                <td><span class="badge warning-badge">Override to 0</span></td>
                                <td>MUST override to 0% (already factored in Schedule E)</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--accent-blue);">7</strong></td>
                                <td>Mortgage Payment</td>
                                <td>Auto-linked</td>
                                <td>Payment from Mortgage tied to this REO</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--accent-blue);">8</strong></td>
                                <td>Net Rental Income</td>
                                <td><span class="badge calculated-badge">Matches Input</span></td>
                                <td>Will equal Amount of Monthly Rents entered</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="tip-box">
                        <h4>Why Override Vacancy to 0%?</h4>
                        <p>When using Schedule E calculations, vacancy and expenses are already factored into the Schedule E income figure. Setting vacancy to 0% prevents double-counting these deductions.</p>
                    </div>
                </div>
            </section>

            <!-- Section 4: Schedule E - Investment Property -->
            <section id="section-4" class="section">
                <div class="section-header">
                    <div class="section-number">4</div>
                    <div class="section-title"><h2>Refinance or Purchase with Rental Income - Investment Property</h2><span>Schedule E income on Investment Property</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node decision">Current Usage?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">Investment Property</span>
                                <span class="flow-arrow down">|</span>
                                <div class="flow-node action">Investment for BOTH usages</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">Currently Primary</span>
                                <span class="flow-arrow down">|</span>
                                <div class="flow-node action">Primary -> Investment</div>
                            </div>
                        </div>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr><th>Step</th><th>Field</th><th>Value/Action</th><th>Notes</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong style="color: var(--accent-blue);">1</strong></td>
                                <td><strong style="color: var(--text-primary);">Usage</strong></td>
                                <td>See decision above</td>
                                <td>If current Investment: Investment for both<br>If current Primary: Primary -> Investment</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--accent-blue);">2</strong></td>
                                <td><strong style="color: var(--text-primary);">Status</strong></td>
                                <td><span class="badge required-badge">Retained - Rental</span></td>
                                <td>Must select "Retained - Rental"</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--accent-blue);">3</strong></td>
                                <td><strong style="color: var(--text-primary);">Type</strong></td>
                                <td>Choose appropriate type</td>
                                <td>Match property type</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--accent-blue);">4</strong></td>
                                <td><strong style="color: var(--text-primary);">No. Units</strong></td>
                                <td>Enter number of units</td>
                                <td>Actual unit count</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--accent-blue);">5</strong></td>
                                <td><strong style="color: var(--text-primary);">Amount of Monthly Rents</strong></td>
                                <td><span class="badge required-badge">Schedule E Calculation</span></td>
                                <td>Enter the calculated Schedule E amount</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--accent-blue);">6</strong></td>
                                <td><strong style="color: var(--text-primary);">Vacancy Factor</strong></td>
                                <td><span class="badge warning-badge">Override to 0</span></td>
                                <td>MUST override to 0%</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--accent-blue);">7</strong></td>
                                <td>Mortgage Payment</td>
                                <td>Auto-linked</td>
                                <td>Payment from Mortgage tied to this REO</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--accent-blue);">8</strong></td>
                                <td>Taxes, Insurance, HOD</td>
                                <td>Enter if not in payment</td>
                                <td>If T&I not included in payment, enter separately</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--accent-blue);">9</strong></td>
                                <td>Net Rental Income</td>
                                <td><span class="badge calculated-badge">Calculated</span></td>
                                <td>Rents - T&I (if not included in payment)</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="exception-box">
                        <h4>Important: 1008 Display for Investment Property</h4>
                        <p>The Rental Income will show on the 1008 in the Stable Monthly Income section <strong>ONLY if the Current AND Intended Usage is Primary Residence</strong>.</p>
                        <p style="margin-top: 10px;">For Investment Properties, the rental income flows differently through the underwriting calculations.</p>
                    </div>

                    <div class="info-box">
                        <h4>Taxes & Insurance Handling</h4>
                        <p>If Taxes and Insurance are NOT included in the mortgage payment, the Net Rental Income will be:</p>
                        <p style="margin-top: 10px;"><strong>Net Rental Income = Amount of Rents Received - Taxes - Insurance</strong></p>
                    </div>
                </div>
            </section>

            <!-- Section 5: 1008 Verification -->
            <section id="section-5" class="section">
                <div class="section-header">
                    <div class="section-number">5</div>
                    <div class="section-title"><h2>1008 Verification</h2><span>Confirming rental income displays correctly</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Complete REO Entry</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Navigate to 1008 Form</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Review Section III</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Verify Stable Monthly Income</div>
                        </div>
                    </div>

                    <div class="mi-comparison">
                        <div class="mi-card">
                            <div class="mi-card-header"><h4>Subject Property Income</h4></div>
                            <div class="mi-card-body">
                                <ul>
                                    <li><span class="check-icon">+</span> Shows as "Sub. Prop. Income"</li>
                                    <li><span class="check-icon">+</span> Located in Stable Monthly Income</li>
                                    <li><span class="check-icon">+</span> Purchase scenarios only</li>
                                    <li><span class="check-icon">+</span> After 25% vacancy (or override)</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mi-card">
                            <div class="mi-card-header"><h4>Net Rental Income</h4></div>
                            <div class="mi-card-body">
                                <ul>
                                    <li><span class="check-icon">+</span> Shows as "Net Rental Income"</li>
                                    <li><span class="check-icon">+</span> Primary Residence REOs only</li>
                                    <li><span class="x-icon">x</span> Investment: flows separately</li>
                                    <li><span class="check-icon">+</span> Schedule E pre-calculated</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="tip-box">
                        <h4>Verification Checklist</h4>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>1008 Section III: Underwriting Information displays correctly</li>
                            <li>Stable Monthly Income includes appropriate rental income line</li>
                            <li>Total Income calculation is accurate</li>
                            <li>No duplicate rental income entries</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Quick Reference -->
            <section id="quick-ref" class="quick-ref">
                <h3>Quick Reference Card</h3>
                <pre>
RENTAL INCOME ENTRY QUICK GUIDE
================================

LOCATION: Borrower URLA > Real Estate Owned (REO) Section

SCENARIO 1: SUBJECT PURCHASE
- Use: "Rental Income on the Property You Want to Purchase"
- Enter: Gross Rental Income for non-owner units
- Vacancy: 25% default (override if product allows)
- Result: Cash Flow = Gross x (1 - Vacancy%)

SCENARIO 2: REFINANCE - NO TAX RETURN
- REO Status: Retained - Rental
- Type: Two To Four Unit Property
- Vacancy: OVERRIDE TO 0%
- Net Income: DO NOT override (auto-calculates)

SCENARIO 3: SCHEDULE E - PRIMARY RESIDENCE
- Usage: Primary Residence for BOTH fields
- Status: Retained - Rental
- Rents: Enter Schedule E calculated amount
- Vacancy: OVERRIDE TO 0% (already in Schedule E)

SCENARIO 4: SCHEDULE E - INVESTMENT
- Usage: Investment/Investment OR Primary/Investment
- Status: Retained - Rental
- Rents: Enter Schedule E calculated amount
- Vacancy: OVERRIDE TO 0%
- Note: 1008 shows ONLY if Usage = Primary/Primary

KEY RULES:
* Status MUST be "Retained - Rental" for all REO scenarios
* NEVER override Net Rental Income calculation
* Schedule E scenarios: ALWAYS set Vacancy to 0%
* Verify 1008 Stable Monthly Income section after entry
                </pre>
            </section>
        </div>

        <!-- ==================== AGENT OPPORTUNITIES TAB ==================== -->
        <div id="agents-panel" class="tab-panel">
            <!-- Header -->
            <div class="agent-header">
                <h1>AI Agent Opportunities</h1>
                <p class="subtitle">Automation Analysis for Rental Income Entry Workflow</p>
                <div class="meta">
                    <span class="meta-item">5 Process Steps Analyzed</span>
                    <span class="meta-item">4 Agent Candidates Identified</span>
                    <span class="meta-item">Est. 45% Time Savings</span>
                </div>
            </div>

            <!-- Summary Stats -->
            <div class="agent-summary" id="agent-summary">
                <div class="agent-summary-card">
                    <div class="agent-summary-value">4</div>
                    <div class="agent-summary-label">Agent Candidates</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">2</div>
                    <div class="agent-summary-label">High Priority</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">45%</div>
                    <div class="agent-summary-label">Time Savings</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">80%</div>
                    <div class="agent-summary-label">Automation Potential</div>
                </div>
            </div>

            <!-- Heat Map Legend -->
            <div class="heat-legend" id="agent-heatmap">
                <div class="heat-legend-item"><div class="heat-legend-color" style="background: linear-gradient(135deg, #ef4444, #f97316);"></div><span><strong>Critical (90-100)</strong> - Immediate ROI</span></div>
                <div class="heat-legend-item"><div class="heat-legend-color" style="background: linear-gradient(135deg, #f97316, #eab308);"></div><span><strong>High (70-89)</strong> - Strong candidate</span></div>
                <div class="heat-legend-item"><div class="heat-legend-color" style="background: linear-gradient(135deg, #eab308, #22c55e);"></div><span><strong>Medium (50-69)</strong> - Consider</span></div>
                <div class="heat-legend-item"><div class="heat-legend-color" style="background: linear-gradient(135deg, #22c55e, #14b8a6);"></div><span><strong>Low (0-49)</strong> - Future phase</span></div>
            </div>

            <!-- Heat Map Grid -->
            <div class="heat-map-container">
                <div class="heat-map-title">Automation Priority Heat Map <span style="font-size: 0.8rem; font-weight: 400; color: var(--text-muted);">(Click to jump to agent)</span></div>
                <div class="heat-map-grid">
                    <div class="heat-item critical" onclick="scrollToAgent('agent-schedule-e')" title="Click to view agent details">
                        <div class="heat-score">92</div>
                        <div class="heat-name">Schedule E Calculator</div>
                        <div class="heat-desc">Auto-calculate rental income from tax docs</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Effort: <span>Medium</span></div>
                            <div class="heat-metric">Impact: <span>High</span></div>
                            <div class="heat-metric">Step: <span>3-4</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-scenario')" title="Click to view agent details">
                        <div class="heat-score">85</div>
                        <div class="heat-name">Scenario Router</div>
                        <div class="heat-desc">Auto-detect rental income scenario type</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Effort: <span>Low</span></div>
                            <div class="heat-metric">Impact: <span>High</span></div>
                            <div class="heat-metric">Step: <span>0</span></div>
                        </div>
                    </div>
                    <div class="heat-item medium" onclick="scrollToAgent('agent-validation')" title="Click to view agent details">
                        <div class="heat-score">68</div>
                        <div class="heat-name">REO Validation Agent</div>
                        <div class="heat-desc">Validate REO entries and flag errors</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Effort: <span>Low</span></div>
                            <div class="heat-metric">Impact: <span>Medium</span></div>
                            <div class="heat-metric">Step: <span>5</span></div>
                        </div>
                    </div>
                    <div class="heat-item medium" onclick="scrollToAgent('agent-1008')" title="Click to view agent details">
                        <div class="heat-score">62</div>
                        <div class="heat-name">1008 Reconciliation</div>
                        <div class="heat-desc">Verify 1008 matches REO entries</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Effort: <span>Medium</span></div>
                            <div class="heat-metric">Impact: <span>Medium</span></div>
                            <div class="heat-metric">Step: <span>5</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agent Details -->
            <h2 style="font-size: 1.4rem; margin: 35px 0 22px; color: var(--text-primary);" id="agent-details">Agent Specifications</h2>

            <div class="agent-grid">
                <!-- Agent 1: Schedule E Calculator -->
                <div class="agent-card" id="agent-schedule-e">
                    <div class="agent-card-header">
                        <div class="agent-icon">$</div>
                        <div class="agent-info">
                            <div class="agent-name">Schedule E Calculator Agent</div>
                            <div class="agent-type">Document Analysis Agent</div>
                        </div>
                        <span class="agent-priority critical">Critical</span>
                    </div>
                    <div class="agent-card-body">
                        <p class="agent-description">Automatically extracts rental income, expenses, and depreciation from Schedule E tax documents and calculates the qualifying monthly rental income using Fannie Mae/Freddie Mac guidelines.</p>
                        <div class="agent-flow">
                            <div class="agent-flow-title">Agent Flow</div>
                            <div class="agent-flow-diagram">
                                <div class="agent-step">Upload Schedule E</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">OCR Extract</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Apply Formula</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Output Amount</div>
                            </div>
                        </div>
                        <div class="agent-stats">
                            <div class="agent-stat"><div class="agent-stat-value">8min</div><div class="agent-stat-label">Time Saved</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">98%</div><div class="agent-stat-label">Accuracy</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">Med</div><div class="agent-stat-label">Complexity</div></div>
                        </div>
                        <button class="agent-prompt-btn" onclick="showAgentPrompt('schedule-e')">
                            View AI Prompt to Build This Agent
                        </button>
                    </div>
                </div>

                <!-- Agent 2: Scenario Router -->
                <div class="agent-card" id="agent-scenario">
                    <div class="agent-card-header">
                        <div class="agent-icon">R</div>
                        <div class="agent-info">
                            <div class="agent-name">Rental Scenario Router</div>
                            <div class="agent-type">Classification Agent</div>
                        </div>
                        <span class="agent-priority high">High</span>
                    </div>
                    <div class="agent-card-body">
                        <p class="agent-description">Analyzes loan file data to automatically determine which rental income entry scenario applies (Subject Purchase, Refi-No Tax Return, Schedule E Primary, or Schedule E Investment) and routes to appropriate workflow.</p>
                        <div class="agent-flow">
                            <div class="agent-flow-title">Agent Flow</div>
                            <div class="agent-flow-diagram">
                                <div class="agent-step">Read Loan Data</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Check Docs</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Classify</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Route User</div>
                            </div>
                        </div>
                        <div class="agent-stats">
                            <div class="agent-stat"><div class="agent-stat-value">2min</div><div class="agent-stat-label">Time Saved</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">95%</div><div class="agent-stat-label">Accuracy</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">Low</div><div class="agent-stat-label">Complexity</div></div>
                        </div>
                        <button class="agent-prompt-btn" onclick="showAgentPrompt('scenario')">
                            View AI Prompt to Build This Agent
                        </button>
                    </div>
                </div>

                <!-- Agent 3: REO Validation -->
                <div class="agent-card" id="agent-validation">
                    <div class="agent-card-header">
                        <div class="agent-icon">V</div>
                        <div class="agent-info">
                            <div class="agent-name">REO Validation Agent</div>
                            <div class="agent-type">Quality Control Agent</div>
                        </div>
                        <span class="agent-priority medium">Medium</span>
                    </div>
                    <div class="agent-card-body">
                        <p class="agent-description">Validates REO entries for completeness and accuracy. Checks that Status is "Retained - Rental", Vacancy Factor is correctly set, and Net Rental Income was not manually overridden.</p>
                        <div class="agent-flow">
                            <div class="agent-flow-title">Agent Flow</div>
                            <div class="agent-flow-diagram">
                                <div class="agent-step">Scan REO</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Check Rules</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Flag Errors</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Report</div>
                            </div>
                        </div>
                        <div class="agent-stats">
                            <div class="agent-stat"><div class="agent-stat-value">3min</div><div class="agent-stat-label">Time Saved</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">100%</div><div class="agent-stat-label">Coverage</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">Low</div><div class="agent-stat-label">Complexity</div></div>
                        </div>
                        <button class="agent-prompt-btn" onclick="showAgentPrompt('validation')">
                            View AI Prompt to Build This Agent
                        </button>
                    </div>
                </div>

                <!-- Agent 4: 1008 Reconciliation -->
                <div class="agent-card" id="agent-1008">
                    <div class="agent-card-header">
                        <div class="agent-icon">1K</div>
                        <div class="agent-info">
                            <div class="agent-name">1008 Reconciliation Agent</div>
                            <div class="agent-type">Audit Agent</div>
                        </div>
                        <span class="agent-priority medium">Medium</span>
                    </div>
                    <div class="agent-card-body">
                        <p class="agent-description">Compares REO rental income entries against the 1008 Stable Monthly Income section to ensure all income flows correctly and identifies any discrepancies between source data and output.</p>
                        <div class="agent-flow">
                            <div class="agent-flow-title">Agent Flow</div>
                            <div class="agent-flow-diagram">
                                <div class="agent-step">Read REO</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Read 1008</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Compare</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Alert</div>
                            </div>
                        </div>
                        <div class="agent-stats">
                            <div class="agent-stat"><div class="agent-stat-value">5min</div><div class="agent-stat-label">Time Saved</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">100%</div><div class="agent-stat-label">Accuracy</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">Med</div><div class="agent-stat-label">Complexity</div></div>
                        </div>
                        <button class="agent-prompt-btn" onclick="showAgentPrompt('reconciliation')">
                            View AI Prompt to Build This Agent
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Documentation Modal -->
    <div class="modal-overlay" id="docModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Rental Income Entry - Workflow Markdown</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyToClipboard()">Copy</button>
                    <button class="modal-btn close" onclick="closeDocModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <pre id="docContent"># Rental Income Entry - Byte

## Overview
When a Borrower has Rental Income, it is entered in the Real Estate Owned (REO) Section of the URLA Borrower.

## Scenarios

### 1. Subject Purchase with Rental Income
- Navigate to: Borrower URLA > Rental Income on the Property You Want to Purchase
- Click "Click here" to open Subject Property Cash Flow
- Enter Gross Rental Income for non-owner-occupied units
- Vacancy Factor defaults to 25% (override if product allows)
- Result shows on 1008 as "Sub. Prop. Income"

### 2. Refinance With Rental Income - Not on Tax Return
Edit REO Screen Steps:
1. Usage: Complete as applicable
2. Status: Retained - Rental
3. Type: Two To Four Unit Property
4. No. Units: 2 to 4
5. Amount of Monthly Rents: Enter gross rent
6. Vacancy Factor: Override to 0%
7. Mortgage Payment: Auto-linked
8. Net Rental Income: DO NOT override

### 3. Schedule E - Primary Residence
Edit REO Screen Steps:
1. Usage: Primary Residence for BOTH
2. Status: Retained - Rental
3. Type: Appropriate property type
4. No. Units: Actual count
5. Amount of Monthly Rents: Schedule E calculation
6. Vacancy Factor: Override to 0%
7. Mortgage Payment: Auto-linked
8. Net Rental Income: Matches input

### 4. Schedule E - Investment Property
Edit REO Screen Steps:
1. Usage: Investment/Investment OR Primary/Investment
2. Status: Retained - Rental
3. Type: Appropriate property type
4. No. Units: Actual count
5. Amount of Monthly Rents: Schedule E calculation
6. Vacancy Factor: Override to 0%
7. Mortgage Payment: Auto-linked
8. Taxes/Insurance: Enter if not in payment
9. Net Rental Income: Calculated

**Important:** 1008 shows rental income ONLY if Current and Intended Usage is Primary Residence.

## Key Rules
- Status MUST be "Retained - Rental"
- NEVER override Net Rental Income
- Schedule E: ALWAYS set Vacancy to 0%
- Verify 1008 Stable Monthly Income after entry</pre>
            </div>
        </div>
    </div>

    <div class="copy-success" id="copySuccess">Copied to clipboard!</div>

    <!-- AI Prompt Modal -->
    <div class="modal-overlay prompt-modal" id="promptModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="promptModalTitle">AI Agent Build Prompt</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyPromptToClipboard()">Copy Prompt</button>
                    <button class="modal-btn close" onclick="closePromptModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="prompt-tags" id="promptTags"></div>
                <div class="prompt-section">
                    <h4>Agent Purpose</h4>
                    <div class="prompt-box" id="promptPurpose"></div>
                </div>
                <div class="prompt-section">
                    <h4>Full Build Prompt</h4>
                    <div class="prompt-box" id="promptContent"></div>
                </div>
                <div class="prompt-section">
                    <h4>Integration Points</h4>
                    <div class="prompt-box" id="promptIntegration"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));

            if (tab === 'workflow') {
                document.querySelector('.sidebar-tab:not(.agent-tab)').classList.add('active');
                document.getElementById('workflow-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'block';
                document.getElementById('agents-nav').style.display = 'none';
            } else {
                document.querySelector('.sidebar-tab.agent-tab').classList.add('active');
                document.getElementById('agents-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'none';
                document.getElementById('agents-nav').style.display = 'block';
            }

            window.scrollTo(0, 0);
        }

        // Scroll spy with isScrolling flag and 1000ms timeout
        const sections = document.querySelectorAll('.section, .quick-ref');
        const navItems = document.querySelectorAll('#workflow-nav .nav-item');
        let isScrolling = false;
        let scrollTimeout;

        function updateActiveNav() {
            if (isScrolling) return;

            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                if (window.scrollY >= sectionTop) current = section.getAttribute('id');
            });
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + current) item.classList.add('active');
            });
        }

        // Handle nav clicks with scroll flag
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                isScrolling = true;
                clearTimeout(scrollTimeout);

                // Update active state immediately
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');

                // Reset flag after 1000ms
                scrollTimeout = setTimeout(() => {
                    isScrolling = false;
                }, 1000);
            });
        });

        window.addEventListener('scroll', updateActiveNav);

        // Modal functions
        function openDocModal() {
            document.getElementById('docModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeDocModal() {
            document.getElementById('docModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyToClipboard() {
            try {
                const content = document.getElementById('docContent').textContent;
                await navigator.clipboard.writeText(content);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeDocModal(); closePromptModal(); } });
        document.getElementById('docModal').addEventListener('click', (e) => { if (e.target.id === 'docModal') closeDocModal(); });

        document.addEventListener('DOMContentLoaded', () => { updateActiveNav(); });

        // ====== AGENT PROMPT SYSTEM ======
        const agentPrompts = {
            'schedule-e': {
                name: 'Schedule E Calculator Agent',
                tags: ['Document Analysis', 'OCR', 'Medium Complexity', 'Critical Priority'],
                purpose: `This agent automatically extracts rental income data from Schedule E tax documents and calculates the qualifying monthly rental income using agency guidelines. It eliminates manual calculation errors and speeds up income analysis.`,
                prompt: `You are building a Document Analysis Agent for CMG Financial's Byte LOS system.

AGENT NAME: Schedule E Calculator Agent
TYPE: Document Analysis / OCR / Income Calculation

OBJECTIVE:
Create an agent that processes Schedule E (Form 1040) tax documents to automatically calculate qualifying rental income for mortgage underwriting.

INPUT DATA SOURCES:
1. Schedule E PDF/Image
   - Rental income (Line 3)
   - Expenses (Lines 5-19)
   - Depreciation (Line 18)
   - Total expenses (Line 20)
   - Net rental income/loss (Line 21)

2. Loan File Data
   - Number of properties
   - Property addresses
   - Ownership percentage

CALCULATION FORMULA (Fannie Mae):
Monthly Rental Income = (Net Rental Income + Depreciation + Interest + Taxes + Insurance + HOA) / 12

STEP-BY-STEP LOGIC:
1. OCR extract all Schedule E line items
2. Identify property by address
3. Add back non-cash expenses:
   - Line 18: Depreciation
   - Line 12: Interest (if escrowed)
   - Line 16: Taxes (if escrowed)
   - Line 9: Insurance (if escrowed)
4. Calculate: (Line 21 + Add-backs) / 12
5. Output monthly qualifying income

OUTPUT FORMAT:
{
  "propertyAddress": "123 Main St",
  "taxYear": "2024",
  "grossRents": 24000,
  "totalExpenses": 18000,
  "depreciation": 8000,
  "netIncome": 6000,
  "addBacks": 8000,
  "qualifyingMonthly": 1166.67,
  "confidence": 0.95
}

VALIDATION RULES:
- Gross rents must be > $0
- Depreciation cannot exceed gross rents
- Flag if Schedule E shows loss > $15,000
- Verify property address matches loan file`,
                integration: `INTEGRATION POINTS:
1. Byte Document Upload
   - Trigger on Schedule E document upload
   - Support PDF, JPG, PNG formats
   - Handle multi-page Schedule E

2. REO Screen Auto-Fill
   - Populate "Amount of Monthly Rents" field
   - Set flag for "Schedule E Calculated"
   - Store calculation audit trail

3. OCR Service
   - AWS Textract or Google Document AI
   - IRS form-specific model training
   - 98%+ accuracy target

DEPLOYMENT:
- Byte API integration
- Real-time processing (<10 seconds)
- Audit log for compliance`
            },
            'scenario': {
                name: 'Rental Scenario Router',
                tags: ['Classification', 'Decision Support', 'Low Complexity', 'High Priority'],
                purpose: `This agent analyzes loan file data to automatically determine which rental income entry scenario applies and guides users to the correct workflow, reducing errors from incorrect scenario selection.`,
                prompt: `You are building a Classification Agent for CMG Financial's Byte LOS system.

AGENT NAME: Rental Scenario Router
TYPE: Classification / Decision Support

OBJECTIVE:
Create an agent that analyzes loan and property data to automatically classify which rental income entry scenario should be used, then route the user to the correct workflow.

INPUT DATA:
1. Loan Purpose (Purchase/Refinance)
2. Property Type (2-4 unit, SFR, etc.)
3. Occupancy Type (Primary, Investment)
4. Document Checklist (Schedule E present?)
5. Subject Property indicator

CLASSIFICATION LOGIC:

 IF Loan Purpose = Purchase                              
 AND Property Type = 2-4 Unit                           
 AND Occupancy = Primary (owner-occupied)               
 THEN Scenario = "SUBJECT PURCHASE"                      

 IF Loan Purpose = Refinance                             
 AND Property is REO (not subject)                       
 AND Schedule E NOT present                              
 THEN Scenario = "REFI - NO TAX RETURN"                  

 IF Schedule E present                                   
 AND Occupancy = Primary Residence                       
 THEN Scenario = "SCHEDULE E - PRIMARY"                  

 IF Schedule E present                                   
 AND Occupancy = Investment                              
 THEN Scenario = "SCHEDULE E - INVESTMENT"               


OUTPUT FORMAT:
{
  "scenario": "SUBJECT PURCHASE",
  "confidence": 0.95,
  "reasoning": "Purchase transaction with 2-unit property, borrower occupying one unit",
  "workflowSection": 1,
  "keyFields": ["Gross Rental Income", "Vacancy Factor"],
  "warnings": []
}

EDGE CASES:
- Mixed-use property: Flag for manual review
- Multiple REO properties: Process each separately
- Conversion (Primary to Investment): Route to Section 4`,
                integration: `INTEGRATION POINTS:
1. Byte Loan File
   - Read loan purpose, occupancy, property type
   - Check document checklist for Schedule E
   - Identify REO vs subject property

2. User Interface
   - Display recommended scenario with explanation
   - "Start Entry" button routes to correct section
   - Allow override with reason capture

3. Training Data
   - Historical loan files with correct scenarios
   - Learn from user overrides
   - Improve classification over time

DEPLOYMENT:
- Trigger when entering REO screen
- Response time <2 seconds
- No external API dependencies`
            },
            'validation': {
                name: 'REO Validation Agent',
                tags: ['Quality Control', 'Rules Engine', 'Low Complexity', 'Medium Priority'],
                purpose: `This agent validates REO rental income entries for completeness and accuracy, catching common errors like incorrect Status, wrong Vacancy Factor settings, or manually overridden Net Rental Income calculations.`,
                prompt: `You are building a Quality Control Agent for CMG Financial's Byte LOS system.

AGENT NAME: REO Validation Agent
TYPE: Rules Engine / Quality Control

OBJECTIVE:
Create an agent that validates REO rental income entries against business rules and flags errors before submission, preventing downstream issues in underwriting.

VALIDATION RULES:

RULE 1: Status Check
- IF rental income expected
- THEN Status MUST = "Retained - Rental"
- ERROR: "Status must be 'Retained - Rental' for rental properties"

RULE 2: Vacancy Factor for Schedule E
- IF Schedule E income used
- THEN Vacancy Factor MUST = 0%
- ERROR: "Vacancy Factor must be 0% when using Schedule E (already factored)"

RULE 3: Net Rental Income Override
- IF Net Rental Income manually changed
- THEN flag as ERROR
- ERROR: "Net Rental Income should not be overridden - system calculates automatically"

RULE 4: Property Type Match
- IF rental income entered
- AND Property Type = Single Family
- THEN flag as WARNING
- WARNING: "Single family property with rental income - verify property type"

RULE 5: Unit Count
- IF Type = "Two To Four Unit Property"
- THEN No. Units MUST be 2, 3, or 4
- ERROR: "Unit count must be 2-4 for multi-unit property type"

RULE 6: Mortgage Link
- IF rental property has mortgage
- THEN Mortgage Payment field should be populated
- WARNING: "No mortgage linked to rental property - verify if property is free and clear"

OUTPUT FORMAT:
{
  "valid": false,
  "errors": [
    {"field": "Status", "message": "Must be 'Retained - Rental'", "severity": "ERROR"},
    {"field": "Vacancy Factor", "message": "Override to 0% for Schedule E", "severity": "ERROR"}
  ],
  "warnings": [
    {"field": "Mortgage Payment", "message": "Verify if property is free and clear", "severity": "WARNING"}
  ],
  "passed": 4,
  "failed": 2
}`,
                integration: `INTEGRATION POINTS:
1. Byte REO Screen
   - Run validation on Save
   - Block save if critical errors
   - Allow save with warnings (require acknowledgment)

2. Visual Indicators
   - Red highlight on error fields
   - Yellow highlight on warning fields
   - Tooltip with error message

3. Audit Trail
   - Log all validation runs
   - Track error patterns
   - Generate compliance reports

DEPLOYMENT:
- Client-side validation (instant)
- Server-side validation (on save)
- Batch validation for QC reviews`
            },
            'reconciliation': {
                name: '1008 Reconciliation Agent',
                tags: ['Audit', 'Reconciliation', 'Medium Complexity', 'Medium Priority'],
                purpose: `This agent compares REO rental income entries against the 1008 Stable Monthly Income section to ensure all income flows correctly and identifies any discrepancies between source data and the underwriting summary.`,
                prompt: `You are building an Audit Agent for CMG Financial's Byte LOS system.

AGENT NAME: 1008 Reconciliation Agent
TYPE: Data Reconciliation / Audit

OBJECTIVE:
Create an agent that compares rental income data entered in REO screens against the values displayed on the 1008 form, ensuring data integrity and catching calculation or flow errors.

DATA SOURCES TO COMPARE:

SOURCE 1: REO Screen
- Net Rental Income per property
- Property address
- Occupancy type
- Status

SOURCE 2: 1008 Form (Section III: Underwriting Information)
- Sub. Prop. Income
- Net Rental Income
- Total Income

RECONCILIATION LOGIC:

CHECK 1: Subject Property Income
- REO Subject Property Cash Flow = 1008 Sub. Prop. Income
- Tolerance: $0.00 (exact match)

CHECK 2: Net Rental Income (Primary Residence)
- SUM of REO Net Rental Income (where Usage = Primary/Primary)
- Should equal 1008 Net Rental Income line
- Tolerance: $1.00 (rounding)

CHECK 3: Investment Property Flow
- Investment property rental should NOT appear in 1008 Stable Monthly Income
- If Investment rental in 1008: Flag as ERROR

CHECK 4: Total Income
- After rental income, verify Total Income calculation
- All components should sum correctly

OUTPUT FORMAT:
{
  "reconciled": false,
  "discrepancies": [
    {
      "item": "Subject Property Income",
      "reoValue": 1425.00,
      "form1008Value": 1400.00,
      "difference": 25.00,
      "severity": "ERROR"
    }
  ],
  "matched": [
    {
      "item": "Net Rental Income",
      "value": 1297.00,
      "status": "MATCHED"
    }
  ],
  "recommendation": "Review Subject Property Cash Flow calculation in REO screen"
}

ERROR HANDLING:
- Missing 1008 data: Generate 1008 first
- Multiple rental properties: Reconcile each
- Negative rental income: Verify loss handling`,
                integration: `INTEGRATION POINTS:
1. Byte Forms Engine
   - Read REO screen data via API
   - Read 1008 form data via API
   - Support real-time and batch comparison

2. User Interface
   - "Reconcile" button on 1008 screen
   - Side-by-side comparison view
   - Click to navigate to discrepancy source

3. Workflow Integration
   - Run before underwriting submission
   - Block submission if critical discrepancies
   - Generate reconciliation report for file

DEPLOYMENT:
- On-demand reconciliation
- Pre-submission validation
- Nightly batch for QC dashboard`
            }
        };

        // Scroll to agent card and highlight
        function scrollToAgent(agentId) {
            const agentCard = document.getElementById(agentId);
            if (agentCard) {
                document.querySelectorAll('.agent-card.highlight').forEach(card => {
                    card.classList.remove('highlight');
                });

                agentCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

                setTimeout(() => {
                    agentCard.classList.add('highlight');
                }, 300);

                setTimeout(() => {
                    agentCard.classList.remove('highlight');
                }, 2500);
            }
        }

        // Show agent prompt modal
        let currentPromptContent = '';

        function showAgentPrompt(agentKey) {
            const agent = agentPrompts[agentKey];
            if (!agent) return;

            document.getElementById('promptModalTitle').textContent = `${agent.name} - Build Prompt`;

            const tagsHtml = agent.tags.map(tag => `<span class="prompt-tag">${tag}</span>`).join('');
            document.getElementById('promptTags').innerHTML = tagsHtml;

            document.getElementById('promptPurpose').textContent = agent.purpose;
            document.getElementById('promptContent').textContent = agent.prompt;
            document.getElementById('promptIntegration').textContent = agent.integration;

            currentPromptContent = `# ${agent.name}\n\n## Purpose\n${agent.purpose}\n\n## Build Prompt\n${agent.prompt}\n\n## Integration Points\n${agent.integration}`;

            document.getElementById('promptModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closePromptModal() {
            document.getElementById('promptModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyPromptToClipboard() {
            try {
                await navigator.clipboard.writeText(currentPromptContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) {
                alert('Failed to copy prompt.');
            }
        }

        document.getElementById('promptModal').addEventListener('click', (e) => {
            if (e.target.id === 'promptModal') closePromptModal();
        });
    </script>
</body>
</html>
