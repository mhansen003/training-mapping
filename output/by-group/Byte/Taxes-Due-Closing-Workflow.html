<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Byte Taxes Due at Closing - Process Workflow</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: #111827;
            --bg-card: #1a2234;
            --accent-blue: #3b82f6;
            --accent-teal: #14b8a6;
            --accent-amber: #f59e0b;
            --accent-rose: #f43f5e;
            --accent-green: #22c55e;
            --accent-purple: #8b5cf6;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-subtle: rgba(255,255,255,0.08);
            --sidebar-width: 280px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Breadcrumb */
        .breadcrumb {
            background: linear-gradient(90deg, #0d1525 0%, #1a2234 100%);
            padding: 14px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
            border-bottom: 1px solid var(--border-subtle);
        }

        .breadcrumb a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            transition: all 0.2s;
            border: 1px solid var(--border-subtle);
        }

        .breadcrumb a:hover {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .breadcrumb .separator { color: var(--text-muted); font-size: 1.2rem; }
        .breadcrumb .current { color: var(--accent-amber); font-weight: 600; padding: 8px 16px; }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 54px;
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - 54px);
            background: var(--bg-secondary);
            overflow-y: auto;
            z-index: 1000;
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 25px 20px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-header h2 { color: var(--text-primary); font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
        .sidebar-header p { color: var(--text-muted); font-size: 0.85rem; }

        /* Tab Switch */
        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-tab {
            flex: 1;
            padding: 14px 10px;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            background: none;
            border-left: none;
            border-right: none;
            border-top: none;
        }

        .sidebar-tab:hover { background: rgba(255,255,255,0.03); color: var(--text-secondary); }
        .sidebar-tab.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); background: rgba(59, 130, 246, 0.08); }
        .sidebar-tab.agent-tab.active { color: var(--accent-purple); border-bottom-color: var(--accent-purple); background: rgba(139, 92, 246, 0.08); }

        .sidebar-nav { padding: 15px 0; flex: 1; overflow-y: auto; }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .nav-item:hover { background: rgba(255,255,255,0.03); color: var(--text-primary); }
        .nav-item.active { background: rgba(59, 130, 246, 0.1); border-left-color: var(--accent-blue); color: var(--text-primary); }

        .nav-number {
            background: rgba(255,255,255,0.1);
            color: var(--text-secondary);
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .nav-item.active .nav-number { background: var(--accent-blue); color: white; }
        .nav-label { font-size: 0.95rem; font-weight: 500; }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-subtle);
            background: rgba(0,0,0,0.2);
        }

        .doc-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px 20px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .doc-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3); }

        /* Main Content */
        .main-content { margin-left: var(--sidebar-width); padding: 80px 40px 40px 40px; }

        /* Tab Panels */
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        .header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(20, 184, 166, 0.08) 0%, transparent 50%);
            pointer-events: none;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        .header .meta { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; position: relative; }

        .header .meta-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-subtle);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); }
        .legend-color { width: 18px; height: 18px; border-radius: 4px; }

        /* Sections */
        .section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            margin-bottom: 25px;
            overflow: hidden;
            scroll-margin-top: 75px;
        }

        .section-header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(59, 130, 246, 0.1) 100%);
            border-bottom: 1px solid var(--border-subtle);
            padding: 22px 25px;
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .section-number {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .section-title h2 { font-size: 1.35rem; font-weight: 700; margin-bottom: 4px; color: var(--text-primary); }
        .section-title span { font-size: 0.9rem; color: var(--text-muted); }
        .section-content { padding: 28px; }

        /* Workflow Diagrams */
        .workflow-diagram {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 28px;
            margin-bottom: 22px;
        }

        .flow-row { display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 12px; margin: 15px 0; }

        .flow-node {
            padding: 14px 22px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            min-width: 150px;
            border: 1px solid var(--border-subtle);
        }

        .flow-node.start { background: linear-gradient(135deg, var(--accent-green) 0%, #16a34a 100%); color: white; border-radius: 25px; border: none; }
        .flow-node.action { background: linear-gradient(135deg, var(--accent-blue) 0%, #2563eb 100%); color: white; border: none; }
        .flow-node.decision { background: linear-gradient(135deg, var(--accent-amber) 0%, #d97706 100%); color: var(--bg-primary); border: none; }
        .flow-node.input { background: var(--bg-secondary); border: 2px solid var(--accent-blue); color: var(--text-primary); }
        .flow-node.output { background: linear-gradient(135deg, var(--accent-teal) 0%, #0d9488 100%); color: white; border: none; }
        .flow-node.exception { background: linear-gradient(135deg, var(--accent-rose) 0%, #dc2626 100%); color: white; border: none; }

        .flow-arrow { color: var(--accent-blue); font-size: 1.5rem; }
        .flow-arrow.down { transform: rotate(90deg); }

        .decision-branch { display: flex; gap: 40px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
        .branch { display: flex; flex-direction: column; align-items: center; gap: 10px; }

        .branch-label {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        /* Tables */
        .field-table { width: 100%; border-collapse: collapse; margin: 18px 0; }

        .field-table th {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            padding: 14px 18px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border-subtle);
        }

        .field-table td { padding: 14px 18px; border-bottom: 1px solid var(--border-subtle); color: var(--text-secondary); }
        .field-table tr:hover { background: rgba(255,255,255,0.02); }

        .badge { display: inline-block; padding: 4px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge.required-badge { background: rgba(244, 63, 94, 0.15); color: var(--accent-rose); }
        .badge.optional-badge { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .badge.calculated-badge { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }

        /* Info Boxes */
        .exception-box, .tip-box, .info-box, .warning-box {
            padding: 18px 22px;
            margin: 18px 0;
            border-radius: 0 10px 10px 0;
            border-left-width: 4px;
            border-left-style: solid;
        }

        .exception-box { background: rgba(244, 63, 94, 0.08); border-color: var(--accent-rose); border: 1px solid rgba(244, 63, 94, 0.2); border-left: 4px solid var(--accent-rose); }
        .exception-box h4 { color: var(--accent-rose); margin-bottom: 10px; font-size: 1rem; }
        .exception-box p, .exception-box li { color: var(--text-secondary); }

        .tip-box { background: rgba(34, 197, 94, 0.08); border-color: var(--accent-green); border: 1px solid rgba(34, 197, 94, 0.2); border-left: 4px solid var(--accent-green); }
        .tip-box h4 { color: var(--accent-green); margin-bottom: 10px; font-size: 1rem; }
        .tip-box p, .tip-box li { color: var(--text-secondary); }

        .info-box { background: rgba(59, 130, 246, 0.08); border-color: var(--accent-blue); border: 1px solid rgba(59, 130, 246, 0.2); border-left: 4px solid var(--accent-blue); }
        .info-box h4 { color: var(--accent-blue); margin-bottom: 10px; font-size: 1rem; }
        .info-box p, .info-box li { color: var(--text-secondary); }

        .warning-box { background: rgba(245, 158, 11, 0.08); border-color: var(--accent-amber); border: 1px solid rgba(245, 158, 11, 0.2); border-left: 4px solid var(--accent-amber); }
        .warning-box h4 { color: var(--accent-amber); margin-bottom: 10px; font-size: 1rem; }
        .warning-box p, .warning-box li { color: var(--text-secondary); }

        /* Decision Tree */
        .decision-tree {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 22px;
            margin: 22px 0;
        }

        .decision-tree h3 { color: var(--accent-blue); margin-bottom: 18px; padding-bottom: 12px; border-bottom: 1px solid var(--border-subtle); font-size: 1.1rem; }

        .tree-node { margin-left: 20px; padding: 12px; border-left: 2px solid var(--accent-teal); position: relative; color: var(--text-secondary); }
        .tree-node::before { content: ''; position: absolute; left: -2px; top: 22px; width: 15px; height: 2px; background: var(--accent-teal); }
        .tree-node.level-1 { margin-left: 0; border-left: none; }
        .tree-node.level-1::before { display: none; }

        .tree-label { background: var(--accent-amber); color: var(--bg-primary); padding: 6px 14px; border-radius: 6px; font-weight: 700; display: inline-block; margin-bottom: 6px; font-size: 0.9rem; }

        /* Summary Grid */
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 18px; margin: 22px 0; }

        .summary-card { background: rgba(0,0,0,0.3); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 22px; text-align: center; }
        .summary-card h4 { color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9rem; }
        .summary-card .value {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .summary-card .label { font-size: 0.85rem; color: var(--text-muted); margin-top: 8px; }

        /* Step Cards */
        .step-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 22px 0; }

        .step-card { background: rgba(0,0,0,0.2); border: 1px solid var(--border-subtle); border-radius: 12px; overflow: hidden; }
        .step-card-header { background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%); color: white; padding: 18px; text-align: center; }
        .step-card-header h4 { font-size: 1.05rem; }
        .step-card-body { padding: 22px; }
        .step-card ul { list-style: none; padding: 0; }
        .step-card li { padding: 10px 0; border-bottom: 1px solid var(--border-subtle); display: flex; align-items: flex-start; gap: 12px; color: var(--text-secondary); font-size: 0.95rem; }
        .step-card li:last-child { border-bottom: none; }
        .check-icon { color: var(--accent-green); font-weight: bold; flex-shrink: 0; }
        .x-icon { color: var(--accent-rose); font-weight: bold; }

        /* Quick Reference */
        .quick-ref {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
            border: 1px solid var(--border-subtle);
            padding: 28px;
            border-radius: 16px;
            margin-top: 30px;
            font-family: 'JetBrains Mono', monospace;
            scroll-margin-top: 75px;
        }

        .quick-ref h3 { color: var(--accent-amber); margin-bottom: 18px; font-family: 'Plus Jakarta Sans', sans-serif; }
        .quick-ref pre { background: rgba(0,0,0,0.4); border: 1px solid var(--border-subtle); padding: 20px; border-radius: 10px; overflow-x: auto; font-size: 0.85rem; line-height: 1.7; color: var(--text-secondary); }

        /* ====== AGENT OPPORTUNITIES STYLES ====== */
        .agent-header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .agent-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(139, 92, 246, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .agent-header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        /* Heat Map */
        .heat-map-container { margin-bottom: 35px; }
        .heat-map-title { font-size: 1.3rem; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }

        .heat-map-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .heat-item {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .heat-item:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .heat-item:active { transform: scale(0.98); }

        .heat-item::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 4px;
        }

        .heat-item.critical::before { background: linear-gradient(90deg, #ef4444, #f97316); }
        .heat-item.high::before { background: linear-gradient(90deg, #f97316, #eab308); }
        .heat-item.medium::before { background: linear-gradient(90deg, #eab308, #22c55e); }
        .heat-item.low::before { background: linear-gradient(90deg, #22c55e, #14b8a6); }

        .heat-score {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.8rem;
            font-weight: 800;
        }

        .heat-item.critical .heat-score { color: #ef4444; }
        .heat-item.high .heat-score { color: #f97316; }
        .heat-item.medium .heat-score { color: #eab308; }
        .heat-item.low .heat-score { color: #22c55e; }

        .heat-name { font-size: 1rem; font-weight: 700; color: var(--text-primary); margin-bottom: 6px; padding-right: 50px; }
        .heat-desc { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; }

        .heat-metrics { display: flex; gap: 15px; margin-top: 12px; }
        .heat-metric { font-size: 0.75rem; color: var(--text-muted); }
        .heat-metric span { color: var(--text-secondary); font-weight: 600; }

        /* Agent Cards */
        .agent-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 25px; margin-bottom: 35px; }

        .agent-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .agent-card:hover { transform: translateY(-5px); box-shadow: 0 15px 50px rgba(0,0,0,0.3); }

        .agent-card.highlight {
            animation: highlightPulse 2s ease;
            box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.4);
        }

        @keyframes highlightPulse {
            0% { box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.6); }
            50% { box-shadow: 0 0 0 6px rgba(139, 92, 246, 0.5), 0 15px 50px rgba(139, 92, 246, 0.3); }
            100% { box-shadow: 0 0 0 0px transparent, 0 15px 50px rgba(0,0,0,0.3); }
        }

        .agent-card-header {
            padding: 22px;
            display: flex;
            align-items: flex-start;
            gap: 18px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .agent-icon {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            flex-shrink: 0;
        }

        .agent-info { flex: 1; }
        .agent-name { font-size: 1.15rem; font-weight: 700; color: var(--text-primary); margin-bottom: 5px; }
        .agent-type { font-size: 0.8rem; color: var(--accent-purple); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-priority {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .agent-priority.critical { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .agent-priority.high { background: rgba(249, 115, 22, 0.15); color: #f97316; }
        .agent-priority.medium { background: rgba(234, 179, 8, 0.15); color: #eab308; }
        .agent-priority.low { background: rgba(34, 197, 94, 0.15); color: #22c55e; }

        .agent-card-body { padding: 22px; }
        .agent-description { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; }

        .agent-flow {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 20px;
        }

        .agent-flow-title { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-flow-diagram { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; justify-content: center; }

        .agent-step {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .agent-arrow { color: var(--accent-purple); font-size: 1.2rem; }

        .agent-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }

        .agent-stat {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .agent-stat-value {
            font-size: 1.3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-top: 4px; }

        .agent-prompt-btn {
            width: 100%;
            margin-top: 18px;
            padding: 14px 20px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 10px;
            color: var(--accent-purple);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .agent-prompt-btn:hover {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(59, 130, 246, 0.3) 100%);
            border-color: var(--accent-purple);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.25);
        }

        /* Summary Stats */
        .agent-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .agent-summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            padding: 25px;
            text-align: center;
        }

        .agent-summary-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-summary-label { font-size: 0.9rem; color: var(--text-muted); margin-top: 8px; }

        /* Heat Map Legend */
        .heat-legend {
            display: flex;
            gap: 25px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .heat-legend-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; color: var(--text-secondary); }
        .heat-legend-color { width: 24px; height: 24px; border-radius: 6px; }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(10, 15, 26, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.show { display: flex; }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            width: 100%;
            max-width: 950px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 80px rgba(0,0,0,0.5);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            padding: 22px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 16px 16px 0 0;
        }

        .modal-header h3 { font-size: 1.25rem; font-weight: 700; }
        .modal-actions { display: flex; gap: 12px; }

        .modal-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: transform 0.2s;
            font-size: 0.9rem;
        }

        .modal-btn:hover { transform: scale(1.05); }
        .modal-btn.copy { background: white; color: var(--accent-blue); }
        .modal-btn.close { background: rgba(255,255,255,0.2); color: white; }

        .modal-body { padding: 28px; overflow-y: auto; flex: 1; }

        .modal-body pre {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            padding: 22px;
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.7;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--text-secondary);
        }

        .copy-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--accent-green);
            color: white;
            padding: 18px 35px;
            border-radius: 10px;
            font-weight: 700;
            z-index: 3000;
            display: none;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut { 0%, 100% { opacity: 0; } 10%, 90% { opacity: 1; } }

        /* Prompt Modal */
        .prompt-modal .modal { max-width: 800px; }
        .prompt-modal .modal-header { background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%); }

        .prompt-section { margin-bottom: 25px; }
        .prompt-section h4 { color: var(--accent-purple); font-size: 1rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }

        .prompt-box {
            background: rgba(0,0,0,0.4);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.7;
            color: var(--text-secondary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .prompt-tags { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .prompt-tag { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 75px 20px 30px 20px; }
            .agent-grid { grid-template-columns: 1fr; }
        }
        .breadcrumb-logo-link { display: inline-flex; align-items: center; padding: 4px 8px; background: rgba(255,255,255,0.08); border-radius: 8px; border: 1px solid rgba(255,255,255,0.12); transition: all 0.2s; flex-shrink: 0; margin-right: 4px; }
        .breadcrumb-logo-link:hover { background: rgba(255,255,255,0.15); }
        .breadcrumb-logo { height: 24px; width: auto; display: block; }
    </style>
</head>
<body>
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
<a href="../../index.html" class="breadcrumb-logo-link"><img src="../../images/clear-ai-logo.png" alt="Clear AI" class="breadcrumb-logo"></a>
        <a href="../../index.html">Portal Home</a>
        <span class="separator">></span>
        <a href="./index.html">Byte</a>
        <span class="separator">></span>
        <span class="current">Taxes Due at Closing</span>
    </nav>

    <!-- Fixed Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>Taxes Due at Closing</h2>
            <p>Interactive Workflow Guide</p>
        </div>

        <!-- Tab Switcher -->
        <div class="sidebar-tabs">
            <button class="sidebar-tab active" onclick="switchTab('workflow')">Workflow</button>
            <button class="sidebar-tab agent-tab" onclick="switchTab('agents')">AI Agents</button>
        </div>

        <!-- Workflow Navigation -->
        <nav class="sidebar-nav" id="workflow-nav">
            <a href="#section-0" class="nav-item active">
                <span class="nav-number">0</span>
                <span class="nav-label">Overview</span>
            </a>
            <a href="#section-1" class="nav-item">
                <span class="nav-number">1</span>
                <span class="nav-label">60-Day Rule</span>
            </a>
            <a href="#section-2" class="nav-item">
                <span class="nav-number">2</span>
                <span class="nav-label">Enter Tax Amount</span>
            </a>
            <a href="#section-3" class="nav-item">
                <span class="nav-number">3</span>
                <span class="nav-label">Override & Notes</span>
            </a>
            <a href="#section-4" class="nav-item">
                <span class="nav-number">4</span>
                <span class="nav-label">Net From Wire</span>
            </a>
            <a href="#section-5" class="nav-item">
                <span class="nav-number">5</span>
                <span class="nav-label">Escrow Setup</span>
            </a>
            <a href="#quick-ref" class="nav-item">
                <span class="nav-number">*</span>
                <span class="nav-label">Quick Reference</span>
            </a>
        </nav>

        <!-- Agent Navigation -->
        <nav class="sidebar-nav" id="agents-nav" style="display: none;">
            <a href="#agent-summary" class="nav-item active">
                <span class="nav-number">1</span>
                <span class="nav-label">Summary</span>
            </a>
            <a href="#agent-heatmap" class="nav-item">
                <span class="nav-number">2</span>
                <span class="nav-label">Heat Map</span>
            </a>
            <a href="#agent-details" class="nav-item">
                <span class="nav-number">3</span>
                <span class="nav-label">Agent Details</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="doc-btn" onclick="openDocModal()">
                View Workflow Markdown
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

        <!-- ==================== WORKFLOW TAB ==================== -->
        <div id="workflow-panel" class="tab-panel active">
            <!-- Header -->
            <div class="header">
                <h1>Taxes Due at Closing</h1>
                <p class="subtitle">Byte LOS Tax Collection Process for 60-Day Due Dates</p>
                <div class="meta">
                    <span class="meta-item">System: Byte LOS</span>
                    <span class="meta-item">Role: Closer / Processor</span>
                    <span class="meta-item">Updated: Nov 19, 2024</span>
                    <span class="meta-item">Servicer: Cenlar</span>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #22c55e, #16a34a);"></div><span>Start/End</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></div><span>Action Step</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></div><span>Decision Point</span></div>
                <div class="legend-item"><div class="legend-color" style="background: #111827; border: 2px solid #3b82f6;"></div><span>User Input</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f43f5e, #dc2626);"></div><span>Exception</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #14b8a6, #0d9488);"></div><span>Output</span></div>
            </div>

            <!-- Section 0: Overview -->
            <section id="section-0" class="section">
                <div class="section-header">
                    <div class="section-number">0</div>
                    <div class="section-title"><h2>Overview & Key Concepts</h2><span>Understanding Taxes Due at Closing</span></div>
                </div>
                <div class="section-content">
                    <div class="summary-grid">
                        <div class="summary-card"><h4>Critical Window</h4><div class="value">60</div><div class="label">Days from closing</div></div>
                        <div class="summary-card"><h4>Tax Table Source</h4><div class="value">Cenlar</div><div class="label">Servicer tax table</div></div>
                        <div class="summary-card"><h4>CD Section</h4><div class="value">F</div><div class="label">Prepaids location</div></div>
                        <div class="summary-card"><h4>Escrow Section</h4><div class="value">G</div><div class="label">Initial escrow</div></div>
                    </div>

                    <div class="info-box">
                        <h4>How Byte Handles Property Taxes</h4>
                        <p>Byte is programmed to collect taxes based on the <strong>Cenlar Tax Table</strong>. Cenlar (the servicer) will collect and disburse tax payments prior to the tax bill due date.</p>
                    </div>

                    <div class="warning-box">
                        <h4>IMPORTANT: 60-Day Rule</h4>
                        <p>If taxes are due within <strong>60 days</strong> of the funding date, they <strong>MUST</strong> be collected at closing.</p>
                        <ul style="margin-top: 12px; padding-left: 20px;">
                            <li>Ensure the initial deposit includes enough funds to cover the tax payment</li>
                            <li>Collect the full amount needed for the upcoming tax payment as part of closing costs</li>
                            <li>Include funds in the Closing Disclosure, labeled correctly as an escrow payment</li>
                            <li>Funds must be Netted from Wire</li>
                        </ul>
                    </div>

                    <div class="exception-box">
                        <h4>When Bills Are Not Available</h4>
                        <p>If tax bills are not available for title/escrow to pay directly through closing, the funds will be netted from the wire and disbursed by CMG, as the escrow account will not be established in time to pay.</p>
                    </div>
                </div>
            </section>

            <!-- Section 1: 60-Day Decision -->
            <section id="section-1" class="section">
                <div class="section-header">
                    <div class="section-number">1</div>
                    <div class="section-title"><h2>Determine 60-Day Rule Applicability</h2><span>Check if taxes are due within 60 days of closing</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Start</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">Identify Closing Date</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">Identify Tax Due Date</div>
                        </div>
                        <div class="flow-row"><span class="flow-arrow down">|</span></div>
                        <div class="flow-row">
                            <div class="flow-node decision">Taxes Due Within 60 Days?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">YES</span>
                                <span class="flow-arrow down">|</span>
                                <div class="flow-node action">Collect at Closing</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">NO</span>
                                <span class="flow-arrow down">|</span>
                                <div class="flow-node output">Standard Escrow Process</div>
                            </div>
                        </div>
                    </div>

                    <div class="step-cards">
                        <div class="step-card">
                            <div class="step-card-header"><h4>Example Scenario</h4></div>
                            <div class="step-card-body">
                                <ul>
                                    <li><span class="check-icon">*</span><strong>Closing Date:</strong> February 28th</li>
                                    <li><span class="check-icon">*</span><strong>Property Taxes Due:</strong> Annually in April</li>
                                    <li><span class="check-icon">*</span><strong>County Property Tax:</strong> $881.96</li>
                                    <li><span class="check-icon">*</span><strong>City Property Tax:</strong> $255.64</li>
                                    <li><span class="check-icon">*</span><strong>Total Taxes Due:</strong> $1,137.60</li>
                                </ul>
                            </div>
                        </div>
                        <div class="step-card">
                            <div class="step-card-header"><h4>Why Collect at Closing?</h4></div>
                            <div class="step-card-body">
                                <ul>
                                    <li><span class="check-icon">*</span>Escrow account won't be established in time</li>
                                    <li><span class="check-icon">*</span>Cenlar cannot disburse without funds</li>
                                    <li><span class="check-icon">*</span>Tax bill due before first mortgage payment</li>
                                    <li><span class="check-icon">*</span>Protects borrower from late penalties</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="tip-box">
                        <h4>Pro Tip</h4>
                        <p>In this example, both City and County taxes are due every April. Since the loan closes in February, the full tax amount must be paid at closing in Section F, and escrow will be set up in Section G for the <em>next</em> year's taxes.</p>
                    </div>
                </div>
            </section>

            <!-- Section 2: Enter Tax Amount -->
            <section id="section-2" class="section">
                <div class="section-header">
                    <div class="section-number">2</div>
                    <div class="section-title"><h2>Enter Tax Amount Due - CD Page 2</h2><span>Section F (Prepaids) entry</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Navigate to CD Page 2</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Locate Section F (Prepaids)</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Click Edit on Property Taxes</div>
                        </div>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr><th>Field</th><th>Value</th><th>Notes</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Name</strong></td>
                                <td>Property Taxes</td>
                                <td>Standard field name</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Type</strong></td>
                                <td>County Property Tax</td>
                                <td>Select appropriate type</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Paid To</strong></td>
                                <td><span style="color: var(--accent-amber); font-weight: 700;">Taxes Due at Closing</span></td>
                                <td><span class="badge required-badge">Critical</span> Must say "Taxes Due at Closing"</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Monthly Payment</strong></td>
                                <td>73.50 (example)</td>
                                <td>Click Fill for Exact Periodic Payment</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Payment Frequency</strong></td>
                                <td>Annually</td>
                                <td>Set based on tax schedule</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="exception-box">
                        <h4>IMPORTANT: Combine City and County Taxes</h4>
                        <p>City and County Taxes should be added to the <strong>SAME LINE</strong> in Section F. Do not create separate line items for each tax type.</p>
                    </div>

                    <div class="info-box">
                        <h4>Calculation Example</h4>
                        <p style="font-family: 'JetBrains Mono', monospace; font-size: 0.95rem;">
                            County Property Tax: $881.96<br>
                            + City Property Tax: $255.64<br>
                            ─────────────────────────<br>
                            <strong>Total Taxes Due: $1,137.60</strong>
                        </p>
                    </div>
                </div>
            </section>

            <!-- Section 3: Override & Notes -->
            <section id="section-3" class="section">
                <div class="section-header">
                    <div class="section-number">3</div>
                    <div class="section-title"><h2>Override Total & Add Notes</h2><span>Combine taxes and notify Interim Servicing</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <h3 style="text-align: center; margin-bottom: 22px; color: var(--accent-blue);">Override Process Flow</h3>
                        <div class="flow-row">
                            <div class="flow-node input">Locate Total Paid in Advance Field</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Override Calculated Value</div>
                        </div>
                        <div class="flow-row"><span class="flow-arrow down">|</span></div>
                        <div class="flow-row">
                            <div class="flow-node action">Right-Click Total Paid in Advance</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Select "Edit Notes"</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Enter Split Payment Details</div>
                        </div>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr><th>Field</th><th>Action</th><th>Value</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Months Paid in Advance</strong></td>
                                <td>Enter</td>
                                <td>12</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Total Paid in Advance</strong></td>
                                <td><span class="badge required-badge">Override</span></td>
                                <td>$1,137.60 (Combined City + County)</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Paid by Borrower</strong></td>
                                <td>Auto-calculated</td>
                                <td>$1,137.60</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="decision-tree">
                        <h3>Override Calculated Value Dialog</h3>
                        <div class="tree-node level-1">
                            <span class="tree-label">Option 1</span> Use calculated value: $882.00 (County only)
                        </div>
                        <div class="tree-node">
                            <span class="tree-label" style="background: var(--accent-green); color: white;">Option 2 - SELECT THIS</span> Override the calculation with this value: <strong style="color: var(--text-primary);">$1,137.60</strong>
                        </div>
                    </div>

                    <div class="warning-box">
                        <h4>CRITICAL: Edit Notes for Interim Servicing</h4>
                        <p>It's <strong>IMPORTANT</strong> to let Interim Servicing know that the payment should be <strong>SPLIT</strong> between City and County tax collectors.</p>
                    </div>

                    <div class="info-box">
                        <h4>Example Note Entry</h4>
                        <p style="font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin-top: 10px;">
                            &lt; UserName : 10/24/2024 8:23 PM &gt;<br>
                            North Codorus Township 12 months taxes = $255.64<br>
                            York County Tax Collector 12 months taxes = $881.96
                        </p>
                    </div>

                    <div class="tip-box">
                        <h4>How to Add Notes</h4>
                        <ul style="padding-left: 20px; margin-top: 10px;">
                            <li>Right-click in the <strong>Total Paid in Advance</strong> field</li>
                            <li>Select <strong>Edit Notes</strong> from the context menu</li>
                            <li>Enter the breakdown showing amounts paid and to whom</li>
                            <li>Click <strong>OK</strong> to save</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 4: Net From Wire -->
            <section id="section-4" class="section">
                <div class="section-header">
                    <div class="section-number">4</div>
                    <div class="section-title"><h2>Net From Wire Configuration</h2><span>Closing screen settings for netted property taxes</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Select "Net From Wire"</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Enter Amount</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Navigate to Closing Screen</div>
                        </div>
                        <div class="flow-row"><span class="flow-arrow down">|</span></div>
                        <div class="flow-row">
                            <div class="flow-node output">Configure Netted Property Taxes Section</div>
                        </div>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr><th>Property Taxes Dialog Field</th><th>Value</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Net From Wire</strong></td>
                                <td><span class="badge required-badge">Checked</span></td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Amount</strong></td>
                                <td>$1,137.60</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Paid to</strong></td>
                                <td>Other</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="info-box">
                        <h4>Closing Screen - Netted Property Taxes Section</h4>
                        <table class="field-table" style="margin-top: 15px;">
                            <thead>
                                <tr><th>Field</th><th>Setting</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong style="color: var(--text-primary);">Servicing to Pay Taxes</strong></td>
                                    <td><span style="color: var(--accent-green); font-weight: 700;">Yes</span></td>
                                </tr>
                                <tr>
                                    <td><strong style="color: var(--text-primary);">Type of Taxes</strong></td>
                                    <td>Taxes due at closing</td>
                                </tr>
                                <tr>
                                    <td><strong style="color: var(--text-primary);">Tax Due Date</strong></td>
                                    <td>Date taxes are due (e.g., 03/01/2024)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="warning-box">
                        <h4>City Taxes Override</h4>
                        <p>Confirm that <strong>City Taxes</strong> are overridden to be <strong>$0</strong> on the separate city tax line. The combined amount is captured on the County Property Tax line. Months Paid in Advance should still be <strong>12</strong>.</p>
                    </div>
                </div>
            </section>

            <!-- Section 5: Escrow Setup -->
            <section id="section-5" class="section">
                <div class="section-header">
                    <div class="section-number">5</div>
                    <div class="section-title"><h2>Initial Escrow Setup - Section G</h2><span>Configure escrow for next year's taxes</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <h3 style="text-align: center; margin-bottom: 22px; color: var(--accent-blue);">Section G Configuration Flow</h3>
                        <div class="flow-row">
                            <div class="flow-node action">Navigate to Section G</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Edit Property Taxes</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Set Escrow Reserves</div>
                        </div>
                        <div class="flow-row"><span class="flow-arrow down">|</span></div>
                        <div class="flow-row">
                            <div class="flow-node output">Initial Escrow Complete</div>
                        </div>
                    </div>

                    <div class="info-box">
                        <h4>Understanding the Two Sections</h4>
                        <p><strong>Section F (Prepaids):</strong> Collects the CURRENT year's tax payment due at closing<br>
                        <strong>Section G (Initial Escrow):</strong> Sets up reserves for NEXT year's tax payment</p>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr><th>Section G - Property Taxes</th><th>Setting</th><th>Notes</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Disburse</strong></td>
                                <td>Annually</td>
                                <td>Match tax payment schedule</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Starting</strong></td>
                                <td>March 2025</td>
                                <td>Next year's first disbursement month</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Year</strong></td>
                                <td>2025</td>
                                <td>Next tax year</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Months to Collect</strong></td>
                                <td>2 mo x</td>
                                <td>Based on time until next tax due</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Payment</strong></td>
                                <td>73.50</td>
                                <td>Monthly escrow amount</td>
                            </tr>
                            <tr>
                                <td><strong style="color: var(--text-primary);">Borrower Amount</strong></td>
                                <td>$147.00</td>
                                <td>2 months x $73.50</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="step-cards">
                        <div class="step-card">
                            <div class="step-card-header"><h4>Escrow Reserves Settings</h4></div>
                            <div class="step-card-body">
                                <ul>
                                    <li><span class="check-icon">*</span><strong>Months in Reserve:</strong> 2</li>
                                    <li><span class="check-icon">*</span><strong>Total Reserves:</strong> $147.00</li>
                                    <li><span class="check-icon">*</span><strong>Paid by Borrower:</strong> $147.00</li>
                                    <li><span class="check-icon">*</span><strong>Disbursement Sched:</strong> Annually</li>
                                    <li><span class="check-icon">*</span><strong>Disbursement Starts:</strong> March 2025</li>
                                    <li><span class="check-icon">*</span><strong>Cushion:</strong> 2</li>
                                </ul>
                            </div>
                        </div>
                        <div class="step-card">
                            <div class="step-card-header"><h4>Why 2 Months Reserve?</h4></div>
                            <div class="step-card-body">
                                <ul>
                                    <li><span class="check-icon">*</span>Property taxes are due again in April next year</li>
                                    <li><span class="check-icon">*</span>Collect 2 months of reserves for taxes</li>
                                    <li><span class="check-icon">*</span>Buyer prepays 2 months into escrow</li>
                                    <li><span class="check-icon">*</span>Provides cushion for servicer to pay on time</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="tip-box">
                        <h4>Complete Picture</h4>
                        <p>The borrower pays <strong>$1,137.60</strong> in Section F for this year's taxes due at closing, PLUS <strong>$147.00</strong> in Section G to start building escrow reserves for next year's taxes.</p>
                    </div>
                </div>
            </section>

            <!-- Quick Reference -->
            <section id="quick-ref" class="quick-ref">
                <h3>Quick Reference Card</h3>
                <pre>
TAXES DUE AT CLOSING - QUICK CHECKLIST

TRIGGER: Taxes due within 60 days of funding date

SECTION F (Prepaids) - Current Year Taxes:
-----------------------------------------
1. Edit Property Taxes line
2. Set "Paid To" = Taxes Due at Closing
3. Combine City + County on SAME line
4. Override Total Paid in Advance
5. Add Edit Notes with payment split details
6. Check "Net From Wire" box
7. Enter total amount

CLOSING SCREEN - Netted Property Taxes:
---------------------------------------
* Servicing to Pay Taxes = YES
* Type of Taxes = Taxes due at closing
* Tax Due Date = [Actual due date]

SECTION G (Escrow) - Next Year Taxes:
-------------------------------------
1. Set Disbursement Schedule = Annually
2. Starting Month/Year = Next tax due date
3. Collect 2 months reserves
4. Configure cushion

CRITICAL REMINDERS:
------------------
! City taxes line should be $0 (combined on County line)
! Add notes for Interim Servicing showing split
! Months Paid in Advance = 12 (even when overriding)
! Verify Net From Wire amount matches total

EXAMPLE CALCULATION:
-------------------
County Tax:    $881.96
City Tax:    + $255.64
             ---------
Total:       $1,137.60  -> Section F (Net From Wire)
Reserves:      $147.00  -> Section G (2 months)
                </pre>
            </section>
        </div>

        <!-- ==================== AGENT OPPORTUNITIES TAB ==================== -->
        <div id="agents-panel" class="tab-panel">
            <!-- Header -->
            <div class="agent-header">
                <h1>AI Agent Opportunities</h1>
                <p class="subtitle">Automation Analysis for Taxes Due at Closing Workflow</p>
                <div class="meta">
                    <span class="meta-item">6 Process Steps Analyzed</span>
                    <span class="meta-item">4 Agent Candidates Identified</span>
                    <span class="meta-item">Est. 35% Time Savings</span>
                </div>
            </div>

            <!-- Summary Stats -->
            <div class="agent-summary" id="agent-summary">
                <div class="agent-summary-card">
                    <div class="agent-summary-value">4</div>
                    <div class="agent-summary-label">Agent Candidates</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">2</div>
                    <div class="agent-summary-label">High Priority</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">35%</div>
                    <div class="agent-summary-label">Time Savings</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">80%</div>
                    <div class="agent-summary-label">Automation Potential</div>
                </div>
            </div>

            <!-- Heat Map Legend -->
            <div class="heat-legend" id="agent-heatmap">
                <div class="heat-legend-item"><div class="heat-legend-color" style="background: linear-gradient(135deg, #ef4444, #f97316);"></div><span><strong>Critical (90-100)</strong> - Immediate ROI</span></div>
                <div class="heat-legend-item"><div class="heat-legend-color" style="background: linear-gradient(135deg, #f97316, #eab308);"></div><span><strong>High (70-89)</strong> - Strong candidate</span></div>
                <div class="heat-legend-item"><div class="heat-legend-color" style="background: linear-gradient(135deg, #eab308, #22c55e);"></div><span><strong>Medium (50-69)</strong> - Consider</span></div>
                <div class="heat-legend-item"><div class="heat-legend-color" style="background: linear-gradient(135deg, #22c55e, #14b8a6);"></div><span><strong>Low (0-49)</strong> - Future phase</span></div>
            </div>

            <!-- Heat Map Grid -->
            <div class="heat-map-container">
                <div class="heat-map-title">Automation Priority Heat Map <span style="font-size: 0.8rem; font-weight: 400; color: var(--text-muted);">(Click to jump to agent)</span></div>
                <div class="heat-map-grid">
                    <div class="heat-item critical" onclick="scrollToAgent('agent-taxdetect')" title="Click to view agent details">
                        <div class="heat-score">92</div>
                        <div class="heat-name">60-Day Tax Detector</div>
                        <div class="heat-desc">Auto-detect taxes due within 60 days</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Effort: <span>Low</span></div>
                            <div class="heat-metric">Impact: <span>High</span></div>
                            <div class="heat-metric">Step: <span>1</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-taxcalc')" title="Click to view agent details">
                        <div class="heat-score">85</div>
                        <div class="heat-name">Tax Amount Calculator</div>
                        <div class="heat-desc">Auto-calculate combined City/County taxes</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Effort: <span>Low</span></div>
                            <div class="heat-metric">Impact: <span>High</span></div>
                            <div class="heat-metric">Step: <span>2-3</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-escrow')" title="Click to view agent details">
                        <div class="heat-score">78</div>
                        <div class="heat-name">Escrow Setup Agent</div>
                        <div class="heat-desc">Auto-configure Section G escrow reserves</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Effort: <span>Medium</span></div>
                            <div class="heat-metric">Impact: <span>High</span></div>
                            <div class="heat-metric">Step: <span>5</span></div>
                        </div>
                    </div>
                    <div class="heat-item medium" onclick="scrollToAgent('agent-notes')" title="Click to view agent details">
                        <div class="heat-score">65</div>
                        <div class="heat-name">Servicing Notes Generator</div>
                        <div class="heat-desc">Auto-generate Interim Servicing notes</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Effort: <span>Low</span></div>
                            <div class="heat-metric">Impact: <span>Medium</span></div>
                            <div class="heat-metric">Step: <span>3</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agent Details -->
            <h2 style="font-size: 1.4rem; margin: 35px 0 22px; color: var(--text-primary);" id="agent-details">Agent Specifications</h2>

            <div class="agent-grid">
                <!-- Agent 1: 60-Day Tax Detector -->
                <div class="agent-card" id="agent-taxdetect">
                    <div class="agent-card-header">
                        <div class="agent-icon">!</div>
                        <div class="agent-info">
                            <div class="agent-name">60-Day Tax Detector Agent</div>
                            <div class="agent-type">Alert & Compliance Agent</div>
                        </div>
                        <span class="agent-priority critical">Critical</span>
                    </div>
                    <div class="agent-card-body">
                        <p class="agent-description">Automatically monitors closing dates against property tax due dates and alerts closers when taxes fall within the 60-day window. Prevents compliance issues and ensures proper fund collection.</p>
                        <div class="agent-flow">
                            <div class="agent-flow-title">Agent Flow</div>
                            <div class="agent-flow-diagram">
                                <div class="agent-step">Closing Date</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Tax Calendar</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Calculate Gap</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Alert if &lt;60</div>
                            </div>
                        </div>
                        <div class="agent-stats">
                            <div class="agent-stat"><div class="agent-stat-value">5min</div><div class="agent-stat-label">Time Saved</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">100%</div><div class="agent-stat-label">Detection</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">Low</div><div class="agent-stat-label">Complexity</div></div>
                        </div>
                        <button class="agent-prompt-btn" onclick="showAgentPrompt('taxdetect')">
                            View AI Prompt to Build This Agent
                        </button>
                    </div>
                </div>

                <!-- Agent 2: Tax Amount Calculator -->
                <div class="agent-card" id="agent-taxcalc">
                    <div class="agent-card-header">
                        <div class="agent-icon">$</div>
                        <div class="agent-info">
                            <div class="agent-name">Tax Amount Calculator Agent</div>
                            <div class="agent-type">Data Processing Agent</div>
                        </div>
                        <span class="agent-priority high">High</span>
                    </div>
                    <div class="agent-card-body">
                        <p class="agent-description">Automatically retrieves tax amounts from title documents or tax records, combines City and County taxes, and pre-fills Section F with correct totals and override values.</p>
                        <div class="agent-flow">
                            <div class="agent-flow-title">Agent Flow</div>
                            <div class="agent-flow-diagram">
                                <div class="agent-step">Extract Taxes</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Combine Totals</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Pre-fill CD</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Verify</div>
                            </div>
                        </div>
                        <div class="agent-stats">
                            <div class="agent-stat"><div class="agent-stat-value">8min</div><div class="agent-stat-label">Time Saved</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">98%</div><div class="agent-stat-label">Accuracy</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">Low</div><div class="agent-stat-label">Complexity</div></div>
                        </div>
                        <button class="agent-prompt-btn" onclick="showAgentPrompt('taxcalc')">
                            View AI Prompt to Build This Agent
                        </button>
                    </div>
                </div>

                <!-- Agent 3: Escrow Setup Agent -->
                <div class="agent-card" id="agent-escrow">
                    <div class="agent-card-header">
                        <div class="agent-icon">G</div>
                        <div class="agent-info">
                            <div class="agent-name">Escrow Setup Agent</div>
                            <div class="agent-type">Configuration Agent</div>
                        </div>
                        <span class="agent-priority high">High</span>
                    </div>
                    <div class="agent-card-body">
                        <p class="agent-description">Automatically configures Section G escrow settings based on tax schedule, calculating proper reserve months, disbursement dates, and cushion amounts for next year's taxes.</p>
                        <div class="agent-flow">
                            <div class="agent-flow-title">Agent Flow</div>
                            <div class="agent-flow-diagram">
                                <div class="agent-step">Tax Schedule</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Calc Reserves</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Set Dates</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Configure G</div>
                            </div>
                        </div>
                        <div class="agent-stats">
                            <div class="agent-stat"><div class="agent-stat-value">6min</div><div class="agent-stat-label">Time Saved</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">95%</div><div class="agent-stat-label">Accuracy</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">Med</div><div class="agent-stat-label">Complexity</div></div>
                        </div>
                        <button class="agent-prompt-btn" onclick="showAgentPrompt('escrow')">
                            View AI Prompt to Build This Agent
                        </button>
                    </div>
                </div>

                <!-- Agent 4: Servicing Notes Generator -->
                <div class="agent-card" id="agent-notes">
                    <div class="agent-card-header">
                        <div class="agent-icon">N</div>
                        <div class="agent-info">
                            <div class="agent-name">Servicing Notes Generator</div>
                            <div class="agent-type">Documentation Agent</div>
                        </div>
                        <span class="agent-priority medium">Medium</span>
                    </div>
                    <div class="agent-card-body">
                        <p class="agent-description">Automatically generates properly formatted notes for Interim Servicing, documenting the split payment details between City and County tax collectors with timestamps.</p>
                        <div class="agent-flow">
                            <div class="agent-flow-title">Agent Flow</div>
                            <div class="agent-flow-diagram">
                                <div class="agent-step">Tax Data</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Format Note</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Add Timestamp</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Insert</div>
                            </div>
                        </div>
                        <div class="agent-stats">
                            <div class="agent-stat"><div class="agent-stat-value">3min</div><div class="agent-stat-label">Time Saved</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">100%</div><div class="agent-stat-label">Consistency</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">Low</div><div class="agent-stat-label">Complexity</div></div>
                        </div>
                        <button class="agent-prompt-btn" onclick="showAgentPrompt('notes')">
                            View AI Prompt to Build This Agent
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Documentation Modal -->
    <div class="modal-overlay" id="docModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Taxes Due at Closing - Workflow Markdown</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyToClipboard()">Copy</button>
                    <button class="modal-btn close" onclick="closeDocModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <pre id="docContent">Loading documentation...</pre>
            </div>
        </div>
    </div>

    <div class="copy-success" id="copySuccess">Copied to clipboard!</div>

    <!-- AI Prompt Modal -->
    <div class="modal-overlay prompt-modal" id="promptModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="promptModalTitle">AI Agent Build Prompt</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyPromptToClipboard()">Copy Prompt</button>
                    <button class="modal-btn close" onclick="closePromptModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="prompt-tags" id="promptTags"></div>
                <div class="prompt-section">
                    <h4>Agent Purpose</h4>
                    <div class="prompt-box" id="promptPurpose"></div>
                </div>
                <div class="prompt-section">
                    <h4>Full Build Prompt</h4>
                    <div class="prompt-box" id="promptContent"></div>
                </div>
                <div class="prompt-section">
                    <h4>Integration Points</h4>
                    <div class="prompt-box" id="promptIntegration"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));

            if (tab === 'workflow') {
                document.querySelector('.sidebar-tab:not(.agent-tab)').classList.add('active');
                document.getElementById('workflow-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'block';
                document.getElementById('agents-nav').style.display = 'none';
            } else {
                document.querySelector('.sidebar-tab.agent-tab').classList.add('active');
                document.getElementById('agents-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'none';
                document.getElementById('agents-nav').style.display = 'block';
            }

            window.scrollTo(0, 0);
        }

        // Scroll spy with isScrolling flag and timeout
        const sections = document.querySelectorAll('.section, .quick-ref');
        const navItems = document.querySelectorAll('#workflow-nav .nav-item');
        let isScrolling = false;
        let scrollTimeout;

        function updateActiveNav() {
            if (isScrolling) return;

            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                if (window.scrollY >= sectionTop) current = section.getAttribute('id');
            });
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + current) item.classList.add('active');
            });
        }

        // Nav click handler with scroll flag
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                isScrolling = true;

                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');

                const targetId = this.getAttribute('href').substring(1);
                const targetSection = document.getElementById(targetId);
                if (targetSection) {
                    targetSection.scrollIntoView({ behavior: 'smooth' });
                }

                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    isScrolling = false;
                }, 1000);
            });
        });

        window.addEventListener('scroll', updateActiveNav);

        // Scroll to agent function
        function scrollToAgent(agentId) {
            const agentCard = document.getElementById(agentId);
            if (agentCard) {
                agentCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                agentCard.classList.add('highlight');
                setTimeout(() => agentCard.classList.remove('highlight'), 2000);
            }
        }

        // Modal functions
        let docContent = `# Taxes Due at Closing - Byte Workflow

## Overview
Byte collects taxes based on the Cenlar Tax Table. Cenlar will collect and disburse
tax payments prior to the tax bill due date.

## 60-Day Rule
If taxes are due within 60 days of the funding date, they MUST be collected at closing.

## Process Steps

### Step 1: Identify Tax Due Date
- Compare closing date to property tax due dates
- If within 60 days, proceed with collection at closing

### Step 2: Enter Tax Amount (Section F)
- Navigate to CD Page 2, Section F (Prepaids)
- Click Edit on Property Taxes
- Set "Paid To" = "Taxes Due at Closing"
- Combine City and County taxes on SAME line

### Step 3: Override & Add Notes
- Override Total Paid in Advance with combined amount
- Right-click field -> Edit Notes
- Document payment split for Interim Servicing

### Step 4: Net From Wire
- Check "Net From Wire" box
- Enter total tax amount
- On Closing screen: Set Servicing to Pay Taxes = Yes
- Set Type = "Taxes due at closing"
- Enter Tax Due Date

### Step 5: Configure Section G Escrow
- Set up reserves for NEXT year's taxes
- Typically 2 months reserve
- Set disbursement schedule and start date

## Example Calculation
County Tax:  $881.96
City Tax:  + $255.64
Total:     $1,137.60 (Section F)
Reserves:    $147.00 (Section G - 2 months)

## Critical Reminders
- City taxes line should be $0 (combined on County line)
- Add notes for Interim Servicing showing split
- Months Paid in Advance = 12 (even when overriding)
- Verify Net From Wire amount matches total

Updated: November 19, 2024`;

        function openDocModal() {
            document.getElementById('docModal').classList.add('show');
            document.getElementById('docContent').textContent = docContent;
            document.body.style.overflow = 'hidden';
        }

        function closeDocModal() {
            document.getElementById('docModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyToClipboard() {
            try {
                await navigator.clipboard.writeText(docContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeDocModal(); closePromptModal(); } });
        document.getElementById('docModal').addEventListener('click', (e) => { if (e.target.id === 'docModal') closeDocModal(); });

        document.addEventListener('DOMContentLoaded', () => { updateActiveNav(); });

        // ====== AGENT PROMPT SYSTEM ======
        const agentPrompts = {
            taxdetect: {
                name: '60-Day Tax Detector Agent',
                tags: ['Alert System', 'Compliance', 'Low Complexity', 'Critical Priority'],
                purpose: `This agent automatically monitors loan closing dates against property tax due dates and alerts closers when taxes fall within the 60-day window, ensuring proper fund collection and regulatory compliance.`,
                prompt: `You are building an Alert & Compliance Agent for CMG Financial's Byte LOS system.

AGENT NAME: 60-Day Tax Detector Agent
TYPE: Alert & Compliance / Date Monitoring

OBJECTIVE:
Create an agent that monitors closing dates against property tax due dates and triggers alerts when taxes are due within 60 days of closing.

INPUT DATA SOURCES:
1. Loan Record
   - Scheduled Closing Date
   - Property Address
   - Property Zip Code
   - County

2. Tax Calendar Database
   - County tax due dates
   - City tax due dates
   - School tax due dates
   - Special assessment dates

DETECTION LOGIC:
┌─────────────────────────────────────────────┐
│ For each tax type in property jurisdiction: │
│   tax_gap = tax_due_date - closing_date     │
│   IF tax_gap <= 60 days AND tax_gap > 0     │
│   THEN trigger_alert = TRUE                 │
└─────────────────────────────────────────────┘

ALERT OUTPUT FORMAT:
{
  "loanNumber": "2024-001234",
  "closingDate": "2024-02-28",
  "alertLevel": "CRITICAL",
  "taxesWithin60Days": [
    {
      "taxType": "County Property Tax",
      "dueDate": "2024-04-15",
      "daysUntilDue": 46,
      "estimatedAmount": 881.96
    },
    {
      "taxType": "City Property Tax",
      "dueDate": "2024-04-15",
      "daysUntilDue": 46,
      "estimatedAmount": 255.64
    }
  ],
  "totalTaxesDue": 1137.60,
  "action": "COLLECT_AT_CLOSING",
  "instructions": "Taxes must be collected at closing and netted from wire"
}

TRIGGER POINTS:
- Loan status changes to "Docs Ordered"
- Closing date is entered or modified
- 7 days before scheduled closing
- Daily batch scan of pipeline

ERROR HANDLING:
- If tax calendar not available for jurisdiction: Flag for manual review
- If closing date changes: Re-calculate and update alerts
- If multiple closing dates exist: Use earliest confirmed date`,
                integration: `INTEGRATION POINTS:

1. Byte LOS Database
   - Read loan closing dates
   - Read property jurisdiction data
   - Write alerts to conversation log

2. Tax Calendar Service
   - Cenlar Tax Table integration
   - County assessor API (where available)
   - State tax calendar database

3. Alert Delivery
   - Byte task/alert system
   - Email notification to closer
   - Pipeline flag/indicator

4. Reporting
   - Daily report of loans requiring tax collection
   - Weekly compliance summary

DEPLOYMENT:
- Scheduled job running every 15 minutes
- Real-time trigger on closing date changes
- Integration with Byte workflow engine`
            },
            taxcalc: {
                name: 'Tax Amount Calculator Agent',
                tags: ['Data Processing', 'Document Extraction', 'Low Complexity', 'High Priority'],
                purpose: `This agent automatically retrieves tax amounts from title documents or tax records, combines City and County taxes, and pre-fills Section F of the Closing Disclosure with correct totals and override values.`,
                prompt: `You are building a Data Processing Agent for CMG Financial's Byte LOS system.

AGENT NAME: Tax Amount Calculator Agent
TYPE: Data Processing / Document Extraction

OBJECTIVE:
Create an agent that extracts property tax amounts from title documents, combines multiple tax types, and pre-fills Section F with the correct override values.

INPUT DATA SOURCES:
1. Title Commitment / Tax Certificate
   - County property tax amount
   - City/Town property tax amount
   - School tax amount (if applicable)
   - Special assessments

2. Tax Records
   - Prior year tax bills
   - Assessed value
   - Tax rates by jurisdiction

EXTRACTION RULES:
┌─────────────────────────────────────────────┐
│ COMBINE ON SAME LINE:                       │
│   County Tax + City Tax = Total Property Tax│
│                                             │
│ KEEP SEPARATE (if applicable):              │
│   School Tax                                │
│   Special Assessments                       │
└─────────────────────────────────────────────┘

CALCULATION OUTPUT:
{
  "propertyTaxes": {
    "county": {
      "amount": 881.96,
      "collector": "York County Tax Collector",
      "frequency": "Annually"
    },
    "city": {
      "amount": 255.64,
      "collector": "North Codorus Township",
      "frequency": "Annually"
    }
  },
  "combinedTotal": 1137.60,
  "monthlyEquivalent": 94.80,
  "sectionFEntry": {
    "name": "Property Taxes",
    "type": "County Property Tax",
    "paidTo": "Taxes Due at Closing",
    "monthsInAdvance": 12,
    "totalPaidInAdvance": 1137.60,
    "paidByBorrower": 1137.60,
    "netFromWire": true
  }
}

VALIDATION:
- Total must equal sum of components
- Amounts must be positive
- Cross-reference with prior year if available
- Flag discrepancies > 10% from prior year`,
                integration: `INTEGRATION POINTS:

1. Document Repository
   - Read tax certificates from stored docs
   - OCR/extraction from PDF documents
   - Structured data from title company feeds

2. Byte LOS Forms
   - Pre-fill Section F fields
   - Set override values
   - Configure Net From Wire checkbox

3. Validation Service
   - Compare to Cenlar tax table
   - Verify jurisdiction codes
   - Flag anomalies

TECHNICAL REQUIREMENTS:
- Document parsing capability (PDF/image)
- Field mapping to Byte schema
- Audit trail of extracted values`
            },
            escrow: {
                name: 'Escrow Setup Agent',
                tags: ['Configuration', 'Calculation', 'Medium Complexity', 'High Priority'],
                purpose: `This agent automatically configures Section G escrow settings based on the tax schedule, calculating proper reserve months, disbursement dates, and cushion amounts for next year's taxes.`,
                prompt: `You are building a Configuration Agent for CMG Financial's Byte LOS system.

AGENT NAME: Escrow Setup Agent
TYPE: Configuration / Calculation

OBJECTIVE:
Create an agent that automatically configures Section G (Initial Escrow Payment at Closing) based on tax schedules and closing date, ensuring proper reserves for next year's tax payments.

INPUT PARAMETERS:
1. Closing Date
2. Tax Due Dates (next cycle)
3. Annual Tax Amounts
4. Monthly Tax Equivalent
5. State/Jurisdiction requirements

CALCULATION LOGIC:

┌─────────────────────────────────────────────────┐
│ 1. Determine next tax due date after closing    │
│ 2. Calculate months until disbursement needed   │
│ 3. Determine required cushion (typically 2 mo)  │
│ 4. Calculate monthly escrow collection amount   │
│ 5. Set disbursement schedule and start date     │
└─────────────────────────────────────────────────┘

RESERVE CALCULATION:
Example: Closing Feb 28, Next Tax Due April 2025
- Months to collect: 2 (March, April payments before disbursement)
- Monthly payment: $73.50
- Total reserves at closing: 2 x $73.50 = $147.00
- Cushion: 2 months

OUTPUT FORMAT:
{
  "sectionGConfig": {
    "propertyTaxes": {
      "disburse": "Annually",
      "startingMonth": "March",
      "startingYear": 2025,
      "monthsToCollect": 2,
      "monthlyPayment": 73.50,
      "borrowerAmount": 147.00,
      "cushion": 2
    }
  },
  "escrowReserves": {
    "monthsInReserve": 2,
    "totalReserves": 147.00,
    "disbursementSchedule": "Annually",
    "disbursementStarts": "March 2025"
  }
}

RULES:
- Cushion cannot exceed 2 months (RESPA limit)
- Disbursement month should precede tax due date
- Account for multiple tax types with different schedules`,
                integration: `INTEGRATION POINTS:

1. Byte Section G Form
   - Auto-populate all escrow fields
   - Set disbursement schedule
   - Configure reserve amounts

2. Tax Calendar
   - Next year's tax due dates
   - Disbursement timing rules

3. Compliance Engine
   - RESPA cushion limits
   - State-specific requirements
   - Aggregate escrow analysis

VALIDATION:
- Verify cushion within limits
- Confirm disbursement dates align with due dates
- Cross-check with Section F entries`
            },
            notes: {
                name: 'Servicing Notes Generator',
                tags: ['Documentation', 'Formatting', 'Low Complexity', 'Medium Priority'],
                purpose: `This agent automatically generates properly formatted notes for Interim Servicing, documenting the split payment details between City and County tax collectors with timestamps and user attribution.`,
                prompt: `You are building a Documentation Agent for CMG Financial's Byte LOS system.

AGENT NAME: Servicing Notes Generator
TYPE: Documentation / Text Generation

OBJECTIVE:
Create an agent that generates properly formatted notes for Interim Servicing, documenting how tax payments should be split between different collectors.

INPUT DATA:
1. Tax breakdown by collector
2. Current user name
3. Current timestamp
4. Loan number

NOTE FORMAT TEMPLATE:
┌─────────────────────────────────────────────────┐
│ < [UserName] : [Date] [Time] >                  │
│ [Collector 1] [Period] taxes = $[Amount]        │
│ [Collector 2] [Period] taxes = $[Amount]        │
│ Total taxes due at closing = $[Total]           │
│ [Additional instructions if applicable]         │
└─────────────────────────────────────────────────┘

EXAMPLE OUTPUT:
"< LauraSwearingen : 10/24/2024 8:23 PM >
North Codorus Township 12 months taxes = $255.64
York County Tax Collector 12 months taxes = $881.96
Total taxes due at closing = $1,137.60
Payment should be SPLIT between collectors."

FORMATTING RULES:
- Timestamp in MM/DD/YYYY H:MM AM/PM format
- Dollar amounts with 2 decimal places
- Collector names as they appear in official records
- Period description (e.g., "12 months taxes")
- Clear instruction that payment should be SPLIT

PLACEMENT:
- Insert into "Total Paid in Advance" field notes
- Accessible via right-click -> Edit Notes`,
                integration: `INTEGRATION POINTS:

1. Byte LOS
   - Insert notes into appropriate field
   - Capture current user context
   - Generate timestamp automatically

2. Data Sources
   - Tax breakdown from calculation agent
   - User session information
   - Collector names from tax records

3. Audit Trail
   - Log note generation
   - Track modifications
   - Version history

DEPLOYMENT:
- Triggered after tax amounts confirmed
- Button click or automatic insertion
- Editable before final save`
            }
        };

        // Show agent prompt modal
        let currentPromptContent = '';

        function showAgentPrompt(agentKey) {
            const agent = agentPrompts[agentKey];
            if (!agent) return;

            document.getElementById('promptModalTitle').textContent = agent.name + ' - Build Prompt';

            const tagsHtml = agent.tags.map(tag => `<span class="prompt-tag">${tag}</span>`).join('');
            document.getElementById('promptTags').innerHTML = tagsHtml;

            document.getElementById('promptPurpose').textContent = agent.purpose;
            document.getElementById('promptContent').textContent = agent.prompt;
            document.getElementById('promptIntegration').textContent = agent.integration;

            currentPromptContent = `# ${agent.name}\n\n## Purpose\n${agent.purpose}\n\n## Build Prompt\n${agent.prompt}\n\n## Integration Points\n${agent.integration}`;

            document.getElementById('promptModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closePromptModal() {
            document.getElementById('promptModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyPromptToClipboard() {
            try {
                await navigator.clipboard.writeText(currentPromptContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) {
                alert('Failed to copy prompt.');
            }
        }

        document.getElementById('promptModal').addEventListener('click', (e) => {
            if (e.target.id === 'promptModal') closePromptModal();
        });
    </script>
</body>
</html>
