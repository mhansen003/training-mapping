<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Byte Mortgage Insurance - Process Workflow</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: #111827;
            --bg-card: #1a2234;
            --accent-blue: #3b82f6;
            --accent-teal: #14b8a6;
            --accent-amber: #f59e0b;
            --accent-rose: #f43f5e;
            --accent-green: #22c55e;
            --accent-purple: #8b5cf6;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-subtle: rgba(255,255,255,0.08);
            --sidebar-width: 280px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Breadcrumb */
        .breadcrumb {
            background: linear-gradient(90deg, #0d1525 0%, #1a2234 100%);
            padding: 14px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
            border-bottom: 1px solid var(--border-subtle);
        }

        .breadcrumb a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            transition: all 0.2s;
            border: 1px solid var(--border-subtle);
        }

        .breadcrumb a:hover {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .breadcrumb .separator { color: var(--text-muted); font-size: 1.2rem; }
        .breadcrumb .current { color: var(--accent-amber); font-weight: 600; padding: 8px 16px; }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 54px;
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - 54px);
            background: var(--bg-secondary);
            overflow-y: auto;
            z-index: 1000;
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 25px 20px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-header h2 { color: var(--text-primary); font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
        .sidebar-header p { color: var(--text-muted); font-size: 0.85rem; }

        /* Tab Switch */
        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-tab {
            flex: 1;
            padding: 14px 10px;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            background: none;
            border-left: none;
            border-right: none;
            border-top: none;
        }

        .sidebar-tab:hover { background: rgba(255,255,255,0.03); color: var(--text-secondary); }
        .sidebar-tab.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); background: rgba(59, 130, 246, 0.08); }
        .sidebar-tab.agent-tab.active { color: var(--accent-purple); border-bottom-color: var(--accent-purple); background: rgba(139, 92, 246, 0.08); }

        .sidebar-nav { padding: 15px 0; flex: 1; overflow-y: auto; }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .nav-item:hover { background: rgba(255,255,255,0.03); color: var(--text-primary); }
        .nav-item.active { background: rgba(59, 130, 246, 0.1); border-left-color: var(--accent-blue); color: var(--text-primary); }

        .nav-number {
            background: rgba(255,255,255,0.1);
            color: var(--text-secondary);
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .nav-item.active .nav-number { background: var(--accent-blue); color: white; }
        .nav-label { font-size: 0.95rem; font-weight: 500; }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-subtle);
            background: rgba(0,0,0,0.2);
        }

        .doc-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px 20px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .doc-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3); }

        /* Main Content */
        .main-content { margin-left: var(--sidebar-width); padding: 80px 40px 40px 40px; }

        /* Tab Panels */
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        .header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(20, 184, 166, 0.08) 0%, transparent 50%);
            pointer-events: none;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        .header .meta { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; position: relative; }

        .header .meta-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-subtle);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); }
        .legend-color { width: 18px; height: 18px; border-radius: 4px; }

        /* Sections */
        .section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            margin-bottom: 25px;
            overflow: hidden;
            scroll-margin-top: 75px;
        }

        .section-header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(59, 130, 246, 0.1) 100%);
            border-bottom: 1px solid var(--border-subtle);
            padding: 22px 25px;
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .section-number {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .section-title h2 { font-size: 1.35rem; font-weight: 700; margin-bottom: 4px; color: var(--text-primary); }
        .section-title span { font-size: 0.9rem; color: var(--text-muted); }
        .section-content { padding: 28px; }

        /* Workflow Diagrams */
        .workflow-diagram {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 28px;
            margin-bottom: 22px;
        }

        .flow-row { display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 12px; margin: 15px 0; }

        .flow-node {
            padding: 14px 22px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            min-width: 150px;
            border: 1px solid var(--border-subtle);
        }

        .flow-node.start { background: linear-gradient(135deg, var(--accent-green) 0%, #16a34a 100%); color: white; border-radius: 25px; border: none; }
        .flow-node.action { background: linear-gradient(135deg, var(--accent-blue) 0%, #2563eb 100%); color: white; border: none; }
        .flow-node.decision { background: linear-gradient(135deg, var(--accent-amber) 0%, #d97706 100%); color: var(--bg-primary); border: none; }
        .flow-node.input { background: var(--bg-secondary); border: 2px solid var(--accent-blue); color: var(--text-primary); }
        .flow-node.output { background: linear-gradient(135deg, var(--accent-teal) 0%, #0d9488 100%); color: white; border: none; }
        .flow-node.exception { background: linear-gradient(135deg, var(--accent-rose) 0%, #dc2626 100%); color: white; border: none; }

        .flow-arrow { color: var(--accent-blue); font-size: 1.5rem; }
        .flow-arrow.down { transform: rotate(90deg); }

        .decision-branch { display: flex; gap: 40px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
        .branch { display: flex; flex-direction: column; align-items: center; gap: 10px; }

        .branch-label {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        /* Tables */
        .field-table { width: 100%; border-collapse: collapse; margin: 18px 0; }

        .field-table th {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            padding: 14px 18px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border-subtle);
        }

        .field-table td { padding: 14px 18px; border-bottom: 1px solid var(--border-subtle); color: var(--text-secondary); }
        .field-table tr:hover { background: rgba(255,255,255,0.02); }

        .badge { display: inline-block; padding: 4px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge.required-badge { background: rgba(244, 63, 94, 0.15); color: var(--accent-rose); }
        .badge.optional-badge { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .badge.calculated-badge { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }
        .badge.delegated-badge { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); }

        /* Info Boxes */
        .exception-box, .tip-box, .info-box {
            padding: 18px 22px;
            margin: 18px 0;
            border-radius: 0 10px 10px 0;
            border-left-width: 4px;
            border-left-style: solid;
        }

        .exception-box { background: rgba(244, 63, 94, 0.08); border-color: var(--accent-rose); border: 1px solid rgba(244, 63, 94, 0.2); border-left: 4px solid var(--accent-rose); }
        .exception-box h4 { color: var(--accent-rose); margin-bottom: 10px; font-size: 1rem; }
        .exception-box p, .exception-box li { color: var(--text-secondary); }

        .tip-box { background: rgba(34, 197, 94, 0.08); border-color: var(--accent-green); border: 1px solid rgba(34, 197, 94, 0.2); border-left: 4px solid var(--accent-green); }
        .tip-box h4 { color: var(--accent-green); margin-bottom: 10px; font-size: 1rem; }
        .tip-box p, .tip-box li { color: var(--text-secondary); }

        .info-box { background: rgba(59, 130, 246, 0.08); border-color: var(--accent-blue); border: 1px solid rgba(59, 130, 246, 0.2); border-left: 4px solid var(--accent-blue); }
        .info-box h4 { color: var(--accent-blue); margin-bottom: 10px; font-size: 1rem; }
        .info-box p, .info-box li { color: var(--text-secondary); }

        /* Decision Tree */
        .decision-tree {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 22px;
            margin: 22px 0;
        }

        .decision-tree h3 { color: var(--accent-blue); margin-bottom: 18px; padding-bottom: 12px; border-bottom: 1px solid var(--border-subtle); font-size: 1.1rem; }

        .tree-node { margin-left: 20px; padding: 12px; border-left: 2px solid var(--accent-teal); position: relative; color: var(--text-secondary); }
        .tree-node::before { content: ''; position: absolute; left: -2px; top: 22px; width: 15px; height: 2px; background: var(--accent-teal); }
        .tree-node.level-1 { margin-left: 0; border-left: none; }
        .tree-node.level-1::before { display: none; }

        .tree-label { background: var(--accent-amber); color: var(--bg-primary); padding: 6px 14px; border-radius: 6px; font-weight: 700; display: inline-block; margin-bottom: 6px; font-size: 0.9rem; }

        /* Summary Grid */
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 18px; margin: 22px 0; }

        .summary-card { background: rgba(0,0,0,0.3); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 22px; text-align: center; }
        .summary-card h4 { color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9rem; }
        .summary-card .value {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .summary-card .label { font-size: 0.85rem; color: var(--text-muted); margin-top: 8px; }

        /* MI Comparison Cards */
        .mi-comparison { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 22px 0; }

        .mi-card { background: rgba(0,0,0,0.2); border: 1px solid var(--border-subtle); border-radius: 12px; overflow: hidden; }
        .mi-card-header { background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%); color: white; padding: 18px; text-align: center; }
        .mi-card-header h4 { font-size: 1.05rem; }
        .mi-card-body { padding: 22px; }
        .mi-card ul { list-style: none; padding: 0; }
        .mi-card li { padding: 10px 0; border-bottom: 1px solid var(--border-subtle); display: flex; align-items: center; gap: 12px; color: var(--text-secondary); font-size: 0.95rem; }
        .mi-card li:last-child { border-bottom: none; }
        .check-icon { color: var(--accent-green); font-weight: bold; }
        .x-icon { color: var(--accent-rose); font-weight: bold; }

        /* Quick Reference */
        .quick-ref {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
            border: 1px solid var(--border-subtle);
            padding: 28px;
            border-radius: 16px;
            margin-top: 30px;
            font-family: 'JetBrains Mono', monospace;
        }

        .quick-ref h3 { color: var(--accent-amber); margin-bottom: 18px; font-family: 'Plus Jakarta Sans', sans-serif; }
        .quick-ref pre { background: rgba(0,0,0,0.4); border: 1px solid var(--border-subtle); padding: 20px; border-radius: 10px; overflow-x: auto; font-size: 0.85rem; line-height: 1.7; color: var(--text-secondary); }

        /* ====== AGENT OPPORTUNITIES STYLES ====== */
        .agent-header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .agent-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(139, 92, 246, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .agent-header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        /* Heat Map */
        .heat-map-container { margin-bottom: 35px; }
        .heat-map-title { font-size: 1.3rem; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }

        .heat-map-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .heat-item {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .heat-item:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .heat-item:active { transform: scale(0.98); }

        .heat-item::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 4px;
        }

        .heat-item.critical::before { background: linear-gradient(90deg, #ef4444, #f97316); }
        .heat-item.high::before { background: linear-gradient(90deg, #f97316, #eab308); }
        .heat-item.medium::before { background: linear-gradient(90deg, #eab308, #22c55e); }
        .heat-item.low::before { background: linear-gradient(90deg, #22c55e, #14b8a6); }

        .heat-score {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.8rem;
            font-weight: 800;
        }

        .heat-item.critical .heat-score { color: #ef4444; }
        .heat-item.high .heat-score { color: #f97316; }
        .heat-item.medium .heat-score { color: #eab308; }
        .heat-item.low .heat-score { color: #22c55e; }

        .heat-name { font-size: 1rem; font-weight: 700; color: var(--text-primary); margin-bottom: 6px; padding-right: 50px; }
        .heat-desc { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; }

        .heat-metrics { display: flex; gap: 15px; margin-top: 12px; }
        .heat-metric { font-size: 0.75rem; color: var(--text-muted); }
        .heat-metric span { color: var(--text-secondary); font-weight: 600; }

        /* Agent Cards */
        .agent-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 25px; margin-bottom: 35px; }

        .agent-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .agent-card:hover { transform: translateY(-5px); box-shadow: 0 15px 50px rgba(0,0,0,0.3); }

        .agent-card.highlight {
            animation: highlightPulse 2s ease;
            box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.4);
        }

        @keyframes highlightPulse {
            0% { box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.6); }
            50% { box-shadow: 0 0 0 6px rgba(139, 92, 246, 0.5), 0 15px 50px rgba(139, 92, 246, 0.3); }
            100% { box-shadow: 0 0 0 0px transparent, 0 15px 50px rgba(0,0,0,0.3); }
        }

        .agent-card-header {
            padding: 22px;
            display: flex;
            align-items: flex-start;
            gap: 18px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .agent-icon {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            flex-shrink: 0;
        }

        .agent-info { flex: 1; }
        .agent-name { font-size: 1.15rem; font-weight: 700; color: var(--text-primary); margin-bottom: 5px; }
        .agent-type { font-size: 0.8rem; color: var(--accent-purple); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-priority {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .agent-priority.critical { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .agent-priority.high { background: rgba(249, 115, 22, 0.15); color: #f97316; }
        .agent-priority.medium { background: rgba(234, 179, 8, 0.15); color: #eab308; }
        .agent-priority.low { background: rgba(34, 197, 94, 0.15); color: #22c55e; }

        .agent-card-body { padding: 22px; }
        .agent-description { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; }

        .agent-flow {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 20px;
        }

        .agent-flow-title { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-flow-diagram { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; justify-content: center; }

        .agent-step {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .agent-arrow { color: var(--accent-purple); font-size: 1.2rem; }

        .agent-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }

        .agent-stat {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .agent-stat-value {
            font-size: 1.3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-top: 4px; }

        .agent-prompt-btn {
            width: 100%;
            margin-top: 18px;
            padding: 14px 20px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 10px;
            color: var(--accent-purple);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .agent-prompt-btn:hover {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(59, 130, 246, 0.3) 100%);
            border-color: var(--accent-purple);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.25);
        }

        /* Summary Stats */
        .agent-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .agent-summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            padding: 25px;
            text-align: center;
        }

        .agent-summary-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-summary-label { font-size: 0.9rem; color: var(--text-muted); margin-top: 8px; }

        /* Heat Map Legend */
        .heat-legend {
            display: flex;
            gap: 25px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .heat-legend-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; color: var(--text-secondary); }
        .heat-legend-color { width: 24px; height: 24px; border-radius: 6px; }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(10, 15, 26, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.show { display: flex; }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            width: 100%;
            max-width: 950px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 80px rgba(0,0,0,0.5);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            padding: 22px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 16px 16px 0 0;
        }

        .modal-header h3 { font-size: 1.25rem; font-weight: 700; }
        .modal-actions { display: flex; gap: 12px; }

        .modal-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: transform 0.2s;
            font-size: 0.9rem;
        }

        .modal-btn:hover { transform: scale(1.05); }
        .modal-btn.copy { background: white; color: var(--accent-blue); }
        .modal-btn.close { background: rgba(255,255,255,0.2); color: white; }

        .modal-body { padding: 28px; overflow-y: auto; flex: 1; }

        .modal-body pre {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            padding: 22px;
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.7;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--text-secondary);
        }

        .copy-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--accent-green);
            color: white;
            padding: 18px 35px;
            border-radius: 10px;
            font-weight: 700;
            z-index: 3000;
            display: none;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut { 0%, 100% { opacity: 0; } 10%, 90% { opacity: 1; } }

        /* Prompt Modal */
        .prompt-modal .modal { max-width: 800px; }
        .prompt-modal .modal-header { background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%); }

        .prompt-section { margin-bottom: 25px; }
        .prompt-section h4 { color: var(--accent-purple); font-size: 1rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }

        .prompt-box {
            background: rgba(0,0,0,0.4);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.7;
            color: var(--text-secondary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .prompt-tags { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .prompt-tag { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 75px 20px 30px 20px; }
            .agent-grid { grid-template-columns: 1fr; }
        }
        .breadcrumb-logo-link { display: inline-flex; align-items: center; padding: 4px 8px; background: rgba(255,255,255,0.08); border-radius: 8px; border: 1px solid rgba(255,255,255,0.12); transition: all 0.2s; flex-shrink: 0; margin-right: 4px; }
        .breadcrumb-logo-link:hover { background: rgba(255,255,255,0.15); }
        .breadcrumb-logo { height: 24px; width: auto; display: block; }
    </style>
</head>
<body>
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
<a href="../../index.html" class="breadcrumb-logo-link"><img src="../../images/clear-ai-logo.png" alt="Clear AI" class="breadcrumb-logo"></a>
        <a href="../../index.html">Portal Home</a>
        <span class="separator">></span>
        <a href="./index.html">Byte</a>
        <span class="separator">></span>
        <span class="current">Mortgage Insurance Manual</span>
    </nav>

    <!-- Fixed Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>Mortgage Insurance</h2>
            <p>Byte LOS Workflow Guide</p>
        </div>

        <!-- Tab Switcher -->
        <div class="sidebar-tabs">
            <button class="sidebar-tab active" onclick="switchTab('workflow')">Workflow</button>
            <button class="sidebar-tab agent-tab" onclick="switchTab('agents')">AI Agents</button>
        </div>

        <!-- Workflow Navigation -->
        <nav class="sidebar-nav" id="workflow-nav">
            <a href="#section-0" class="nav-item active">
                <span class="nav-number">0</span>
                <span class="nav-label">MI Overview</span>
            </a>
            <a href="#section-1" class="nav-item">
                <span class="nav-number">1</span>
                <span class="nav-label">MI Types</span>
            </a>
            <a href="#section-2" class="nav-item">
                <span class="nav-number">2</span>
                <span class="nav-label">MI Certificate</span>
            </a>
            <a href="#section-3" class="nav-item">
                <span class="nav-number">3</span>
                <span class="nav-label">PMI Quotes</span>
            </a>
            <a href="#section-4" class="nav-item">
                <span class="nav-number">4</span>
                <span class="nav-label">Order Delegated</span>
            </a>
            <a href="#section-5" class="nav-item">
                <span class="nav-number">5</span>
                <span class="nav-label">Order Non-Delegated</span>
            </a>
            <a href="#section-6" class="nav-item">
                <span class="nav-number">6</span>
                <span class="nav-label">Review & Enter</span>
            </a>
            <a href="#quick-ref" class="nav-item">
                <span class="nav-number">*</span>
                <span class="nav-label">Quick Reference</span>
            </a>
        </nav>

        <!-- Agent Navigation -->
        <nav class="sidebar-nav" id="agents-nav" style="display: none;">
            <a href="#agent-summary" class="nav-item active">
                <span class="nav-number">S</span>
                <span class="nav-label">Summary</span>
            </a>
            <a href="#agent-heatmap" class="nav-item">
                <span class="nav-number">H</span>
                <span class="nav-label">Heat Map</span>
            </a>
            <a href="#agent-details" class="nav-item">
                <span class="nav-number">A</span>
                <span class="nav-label">Agent Details</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="doc-btn" onclick="openDocModal()">
                View Workflow Markdown
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

        <!-- ==================== WORKFLOW TAB ==================== -->
        <div id="workflow-panel" class="tab-panel active">
            <!-- Header -->
            <div class="header">
                <h1>Byte Mortgage Insurance Manual</h1>
                <p class="subtitle">Complete Guide to PMI Quoting, Ordering & Certificate Management</p>
                <div class="meta">
                    <span class="meta-item">System: Byte LOS</span>
                    <span class="meta-item">Roles: LO / LP / UW</span>
                    <span class="meta-item">Updated: July 2021</span>
                    <span class="meta-item">Duration: 5-15 min per task</span>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #22c55e, #16a34a);"></div><span>Start/End</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></div><span>Action Step</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></div><span>Decision Point</span></div>
                <div class="legend-item"><div class="legend-color" style="background: #111827; border: 2px solid #3b82f6;"></div><span>User Input</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f43f5e, #dc2626);"></div><span>Exception</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #14b8a6, #0d9488);"></div><span>Output</span></div>
            </div>

            <!-- Section 0: MI Overview -->
            <section id="section-0" class="section">
                <div class="section-header">
                    <div class="section-number">0</div>
                    <div class="section-title"><h2>Mortgage Insurance Overview</h2><span>When and why MI is required</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Loan Application</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">LTV > 80%?</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">MI Required</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Select MI Type</div>
                        </div>
                    </div>
                    <div class="info-box">
                        <h4>Key Requirement</h4>
                        <p>Mortgage Insurance is <strong>required for all Loan-To-Values over 80%</strong>. All MI can be added/modified in the Home Screen in Byte or in the Product & Pricing Tab in CLEAR.</p>
                    </div>
                    <div class="exception-box">
                        <h4>Prohibited MI Types</h4>
                        <p>CMG does <strong>NOT</strong> allow Level Annual or Standard Annual MI premium types.</p>
                    </div>
                    <div class="tip-box">
                        <h4>Pro Tip</h4>
                        <p>All MI can and should be quoted and ordered through the system to get the lowest premium available for all loan types <strong>except AIO</strong>.</p>
                    </div>
                </div>
            </section>

            <!-- Section 1: MI Types -->
            <section id="section-1" class="section">
                <div class="section-header">
                    <div class="section-number">1</div>
                    <div class="section-title"><h2>Common Types of MI</h2><span>Understanding your MI options</span></div>
                </div>
                <div class="section-content">
                    <div class="mi-comparison">
                        <div class="mi-card">
                            <div class="mi-card-header"><h4>Monthly Non-Refundable</h4></div>
                            <div class="mi-card-body">
                                <ul>
                                    <li><span class="check-icon">+</span> Added to monthly payment</li>
                                    <li><span class="check-icon">+</span> Lower upfront cost</li>
                                    <li><span class="x-icon">-</span> Not eligible for refund</li>
                                    <li><span class="check-icon">+</span> Most common option</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mi-card">
                            <div class="mi-card-header"><h4>Single Premium Non-Refundable</h4></div>
                            <div class="mi-card-body">
                                <ul>
                                    <li><span class="check-icon">+</span> One-time payment at closing</li>
                                    <li><span class="check-icon">+</span> Can be financed or paid cash</li>
                                    <li><span class="x-icon">-</span> Not eligible for refund</li>
                                    <li><span class="check-icon">+</span> No monthly premium</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mi-card">
                            <div class="mi-card-header"><h4>Split Premium Non-Refundable</h4></div>
                            <div class="mi-card-body">
                                <ul>
                                    <li><span class="check-icon">+</span> Upfront + lower monthly</li>
                                    <li><span class="check-icon">+</span> Flexible coverage options</li>
                                    <li><span class="x-icon">-</span> Not eligible for refund</li>
                                    <li><span class="check-icon">+</span> Balance of both options</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mi-card">
                            <div class="mi-card-header"><h4>Lender Paid (LPMI)</h4></div>
                            <div class="mi-card-body">
                                <ul>
                                    <li><span class="check-icon">+</span> Paid upfront by CMG</li>
                                    <li><span class="check-icon">+</span> No borrower MI payment</li>
                                    <li><span class="x-icon">-</span> Higher interest rate</li>
                                    <li><span class="check-icon">+</span> May benefit certain profiles</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 2: MI Certificate -->
            <section id="section-2" class="section">
                <div class="section-header">
                    <div class="section-number">2</div>
                    <div class="section-title"><h2>MI Certificate Process</h2><span>Three stages of MI management</span></div>
                </div>
                <div class="section-content">
                    <div class="summary-grid">
                        <div class="summary-card">
                            <h4>Stage 1</h4>
                            <div class="value">Quote</div>
                            <div class="label">Home Screen in Byte<br/>LO or LP</div>
                        </div>
                        <div class="summary-card">
                            <h4>Stage 2</h4>
                            <div class="value">Order</div>
                            <div class="label">MI Insurance Screen<br/>Loan Processor</div>
                        </div>
                        <div class="summary-card">
                            <h4>Stage 3</h4>
                            <div class="value">Validate</div>
                            <div class="label">MI Cert Screen<br/>Underwriter</div>
                        </div>
                    </div>
                    <div class="exception-box">
                        <h4>Critical: Always Validate</h4>
                        <p>Byte screens, AUS and MI Certs must always be <strong>updated and validated</strong> with any changes to the loan data especially: <strong>program, DTI, credit score, LTV and loan amount</strong>.</p>
                    </div>
                    <div class="decision-tree">
                        <h3>Coverage Amount from AUS</h3>
                        <div class="tree-node level-1"><span class="tree-label">DU (Desktop Underwriter)</span></div>
                        <div class="tree-node">Find coverage in <strong>Verification Messages Section</strong></div>
                        <div class="tree-node level-1"><span class="tree-label">LP (Loan Prospector)</span></div>
                        <div class="tree-node">Find coverage in <strong>Mortgage Insurance & Fees Section</strong></div>
                        <div class="tree-node level-1" style="color: var(--accent-rose); font-weight: 700;">Always use the HIGHER figure from AUS when quoting MI. Using the lower amount will cause pricing errors.</div>
                    </div>
                    <div class="info-box">
                        <h4>Pre-AUS Scenarios</h4>
                        <p>If AUS has not been run and MI is required due to a change in sales price, appraised value or loan amount, refer to the MGIC MI chart for details on the coverage requirement.</p>
                    </div>
                </div>
            </section>

            <!-- Section 3: PMI Quotes -->
            <section id="section-3" class="section">
                <div class="section-header">
                    <div class="section-number">3</div>
                    <div class="section-title"><h2>Byte PMI Quotes</h2><span>Step-by-step quoting process by MI type</span></div>
                </div>
                <div class="section-content">
                    <!-- Monthly Non-Refundable -->
                    <h3 style="color: var(--accent-blue); margin-bottom: 18px;">Monthly Non-Refundable (Not Financed)</h3>
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node input">PMI Type: Monthly Non-Refundable</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">MIP Percent: Not Financed</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Click Quote</div>
                        </div>
                        <div class="flow-row">
                            <div class="flow-node input">Enter Coverage % from AUS</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Check MI Companies</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Click Submit</div>
                        </div>
                        <div class="flow-row">
                            <div class="flow-node decision">Select Best Quote</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Click Accept Quote</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Factors Auto-populate</div>
                        </div>
                    </div>

                    <!-- Single Premium Not Financed -->
                    <h3 style="color: var(--accent-blue); margin: 28px 0 18px;">Single Premium Non-Refundable (Paid Cash)</h3>
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node input">PMI Type: Single Prem. Non-Refundable</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">MIP Percent: Not Financed</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Click Quote</div>
                        </div>
                        <div class="flow-row">
                            <div class="flow-node action">Select & Accept Quote</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">MIP/FF Paid in Cash populates</div>
                        </div>
                    </div>
                    <div class="tip-box">
                        <h4>Verification</h4>
                        <p>Verify the <strong>MIP/FF Paid in Cash</strong> matches the <strong>MI Dollar Amount</strong>.</p>
                    </div>

                    <!-- Single Premium Financed -->
                    <h3 style="color: var(--accent-blue); margin: 28px 0 18px;">Single Premium Non-Refundable (Financed)</h3>
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node input">PMI Type: Single Prem. Non-Refundable</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">MIP Percent: Financed</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Quote & Accept</div>
                        </div>
                        <div class="flow-row">
                            <div class="flow-node output">Loan with MIP/FF auto-updates</div>
                        </div>
                    </div>

                    <!-- Split Premium -->
                    <h3 style="color: var(--accent-blue); margin: 28px 0 18px;">Split Premium Non-Refundable</h3>
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node input">PMI Type: Split Prem. Non-Refundable</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">Enter UFMIP Percent</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Quote & Accept</div>
                        </div>
                    </div>
                    <div class="info-box">
                        <h4>UFMIP Percent Options</h4>
                        <p>Enter UFMIP Percent per Loan Officer direction. Options vary: <strong>0.50%, 0.75%, 1.00%, 1.25%, 1.50%, 1.75%</strong> depending on coverage needs.</p>
                    </div>

                    <!-- LPMI -->
                    <h3 style="color: var(--accent-blue); margin: 28px 0 18px;">Lender Paid Mortgage Insurance (LPMI)</h3>
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node input">PMI Type: Lender Paid</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Quote & Select Lowest UFMIP</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node exception">Delete MIP Percent & Cash values</div>
                        </div>
                        <div class="flow-row">
                            <div class="flow-node action">Price through Optimal Blue</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">Borrower Pays MI = No</div>
                        </div>
                    </div>

                    <!-- MI Companies -->
                    <h3 style="color: var(--accent-teal); margin: 28px 0 18px;">Available MI Companies</h3>
                    <table class="field-table">
                        <thead><tr><th>Company</th><th>Quote Available</th><th>Notes</th></tr></thead>
                        <tbody>
                            <tr><td><strong style="color: var(--text-primary);">Arch MI</strong></td><td><span class="badge optional-badge">Yes</span></td><td>Full integration</td></tr>
                            <tr><td><strong style="color: var(--text-primary);">Essent MI</strong></td><td><span class="badge optional-badge">Yes</span></td><td>Quote with Eligibility option</td></tr>
                            <tr><td><strong style="color: var(--text-primary);">Genworth</strong></td><td><span class="badge optional-badge">Yes</span></td><td>Full integration</td></tr>
                            <tr><td><strong style="color: var(--text-primary);">MGIC</strong></td><td><span class="badge optional-badge">Yes</span></td><td>Coverage chart available</td></tr>
                            <tr><td><strong style="color: var(--text-primary);">National MI</strong></td><td><span class="badge optional-badge">Yes</span></td><td>Quote with Eligibility option</td></tr>
                            <tr><td><strong style="color: var(--text-primary);">Radian</strong></td><td><span class="badge optional-badge">Yes</span></td><td>Full integration</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Section 4: Order Delegated -->
            <section id="section-4" class="section">
                <div class="section-header">
                    <div class="section-number">4</div>
                    <div class="section-title"><h2>Ordering MI: Delegated</h2><span>Standard underwriting process</span></div>
                </div>
                <div class="section-content">
                    <div class="decision-tree">
                        <h3>Delegated Eligibility (Excludes Manufactured Homes)</h3>
                        <div class="tree-node level-1"><span class="tree-label" style="background: var(--accent-green); color: white;">Delegated</span></div>
                        <div class="tree-node">All LTVs 90% or below</div>
                        <div class="tree-node">LTV 90.01% - 95% when FICO >= 680</div>
                        <div class="tree-node level-1"><span class="tree-label" style="background: var(--accent-rose); color: white;">Non-Delegated Required</span></div>
                        <div class="tree-node">All LTVs > 95%</div>
                        <div class="tree-node">LTVs > 90% when FICO < 680</div>
                        <div class="tree-node">All manufactured homes regardless of LTV/FICO</div>
                    </div>

                    <div class="workflow-diagram">
                        <h3 style="text-align: center; margin-bottom: 22px; color: var(--accent-blue);">Delegated Order Flow</h3>
                        <div class="flow-row">
                            <div class="flow-node start">Start</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Open Mortgage Insurance Screen</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Click MI Company from Quote</div>
                        </div>
                        <div class="flow-row">
                            <div class="flow-node input">Select Delegated Method</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Confirm MI Company</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Click Order MI Certificate</div>
                        </div>
                        <div class="flow-row">
                            <div class="flow-node decision">BytePro Popup: Confirm?</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Click Yes</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">MI Cert to Stored Docs</div>
                        </div>
                    </div>

                    <div class="exception-box">
                        <h4>Non-Borrower Warning</h4>
                        <p>Any non-borrowers will show on the MI cert and can affect pricing as they are pulled as co-borrowers. <strong>Remove from Byte prior to submission.</strong></p>
                    </div>

                    <div class="info-box">
                        <h4>Error Handling</h4>
                        <p>An error may appear if the loan is delegated but requires manual submission. Follow the Byte non-delegated process for ordering MI if this occurs.</p>
                    </div>
                </div>
            </section>

            <!-- Section 5: Order Non-Delegated -->
            <section id="section-5" class="section">
                <div class="section-header">
                    <div class="section-number">5</div>
                    <div class="section-title"><h2>Ordering MI: Non-Delegated</h2><span>Manual underwriting submission</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <h3 style="text-align: center; margin-bottom: 22px; color: var(--accent-blue);">Non-Delegated Order Flow</h3>
                        <div class="flow-row">
                            <div class="flow-node start">Start</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Open MI Screen</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">Select Non-Delegated</div>
                        </div>
                        <div class="flow-row">
                            <div class="flow-node action">Click Order MI Certificate</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Confirm in BytePro Popup</div>
                        </div>
                    </div>

                    <h3 style="color: var(--accent-teal); margin: 28px 0 18px;">Document Bundle Process</h3>
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Open Stored Documents</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Click Stacking Order/Bundle</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">Select MI Company Bundle</div>
                        </div>
                        <div class="flow-row">
                            <div class="flow-node output">Documents Auto-Selected</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Click Export</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Click Deliver Bundle</div>
                        </div>
                        <div class="flow-row">
                            <div class="flow-node decision">Confirm Send?</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Click Yes</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Bundle Uploaded</div>
                        </div>
                    </div>

                    <div class="tip-box">
                        <h4>Bundle Success</h4>
                        <p>A pop-up window will confirm the bundle was successfully sent to the MI company. The MI Certificate auto-populates to Stored Documents and a copy is sent to the submitter once generated.</p>
                    </div>
                </div>
            </section>

            <!-- Section 6: Review & Enter -->
            <section id="section-6" class="section">
                <div class="section-header">
                    <div class="section-number">6</div>
                    <div class="section-title"><h2>Reviewing and Entering PMI</h2><span>Processor and Underwriter responsibilities</span></div>
                </div>
                <div class="section-content">
                    <div class="summary-grid">
                        <div class="summary-card" style="background: rgba(59, 130, 246, 0.1);">
                            <h4 style="color: var(--accent-blue);">Processor Role</h4>
                            <div class="value" style="font-size: 1.5rem;">LP</div>
                            <div class="label">Change status to<br/>Conditions for Review</div>
                        </div>
                        <div class="summary-card" style="background: rgba(139, 92, 246, 0.1);">
                            <h4 style="color: var(--accent-purple);">Underwriter Role</h4>
                            <div class="value" style="font-size: 1.5rem;">UW</div>
                            <div class="label">Validate MI Cert<br/>Enter & Clear Conditions</div>
                        </div>
                    </div>

                    <h3 style="color: var(--accent-blue); margin: 28px 0 18px;">Processor Steps</h3>
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Open Status Screen</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">Select: Conditions for Review</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Submit for UW Review</div>
                        </div>
                    </div>
                    <div class="info-box">
                        <h4>Processor Note</h4>
                        <p>Mortgage Insurance does not need to be reviewed as an individual condition. The MI can be reviewed as part of resubmission.</p>
                    </div>

                    <h3 style="color: var(--accent-purple); margin: 28px 0 18px;">Underwriter Steps</h3>
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Open Stored Documents</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Open MI Certificate</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Open MI Cert Screen</div>
                        </div>
                        <div class="flow-row">
                            <div class="flow-node decision">Cert Matches Byte?</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">Enter MI Certificate #</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">Add MI Received Date</div>
                        </div>
                        <div class="flow-row">
                            <div class="flow-node action">Review & Clear MI Conditions</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Update Loan Status</div>
                        </div>
                    </div>

                    <table class="field-table">
                        <thead><tr><th>Field to Validate</th><th>Location</th><th>Action</th></tr></thead>
                        <tbody>
                            <tr><td><strong style="color: var(--text-primary);">Occupancy</strong></td><td>MI Certificate</td><td>Match to Byte</td></tr>
                            <tr><td><strong style="color: var(--text-primary);">Property Value</strong></td><td>MI Certificate</td><td>Match to Byte</td></tr>
                            <tr><td><strong style="color: var(--text-primary);">Premium Payment Option</strong></td><td>MI Certificate</td><td>Match to Byte</td></tr>
                            <tr><td><strong style="color: var(--text-primary);">LTV</strong></td><td>MI Certificate</td><td>Match to Byte</td></tr>
                            <tr><td><strong style="color: var(--text-primary);">Coverage %</strong></td><td>MI Certificate</td><td>Match AUS requirement</td></tr>
                            <tr><td><strong style="color: var(--text-primary);">Insured Loan Amount</strong></td><td>MI Certificate</td><td>Match to Byte</td></tr>
                            <tr><td><strong style="color: var(--text-primary);">Credit Score</strong></td><td>MI Certificate</td><td>Match to Byte</td></tr>
                            <tr><td><strong style="color: var(--text-primary);">Loan Program (HFA, Affordable)</strong></td><td>MI Certificate</td><td>Match if applicable</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Quick Reference -->
            <section id="quick-ref" class="quick-ref">
                <h3>Quick Reference Card</h3>
                <pre>
MI REQUIRED: LTV > 80% on Conventional loans

DELEGATED (excludes manufactured homes):
  - All LTVs 90% or below
  - LTV 90.01-95% when FICO >= 680

NON-DELEGATED:
  - All LTVs > 95%
  - LTVs > 90% when FICO < 680
  - All manufactured homes (any LTV/FICO)

MI TYPES:
  - Monthly Non-Refundable (most common)
  - Single Premium Non-Refundable (cash or financed)
  - Split Premium Non-Refundable (upfront + monthly)
  - Lender Paid (higher rate, no borrower MI payment)

PROCESS:
  1. Quote: Home Screen (LO/LP)
  2. Order: MI Insurance Screen (LP)
  3. Validate: MI Cert Screen (UW)

KEY RULES:
  - Use HIGHER coverage % from AUS
  - MI quote BEFORE Title Fees Integration
  - Remove non-borrowers before MI submission
  - No Level Annual or Standard Annual MI types
                </pre>
            </section>
        </div>

        <!-- ==================== AGENT OPPORTUNITIES TAB ==================== -->
        <div id="agents-panel" class="tab-panel">
            <!-- Header -->
            <div class="agent-header">
                <h1>AI Agent Opportunities</h1>
                <p class="subtitle">Automation Analysis for Mortgage Insurance Workflow</p>
                <div class="meta">
                    <span class="meta-item">7 Process Steps Analyzed</span>
                    <span class="meta-item">5 Agent Candidates Identified</span>
                    <span class="meta-item">Est. 45% Time Savings</span>
                </div>
            </div>

            <!-- Summary Stats -->
            <div class="agent-summary" id="agent-summary">
                <div class="agent-summary-card">
                    <div class="agent-summary-value">5</div>
                    <div class="agent-summary-label">Agent Candidates</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">2</div>
                    <div class="agent-summary-label">High Priority</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">45%</div>
                    <div class="agent-summary-label">Time Savings</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">90%</div>
                    <div class="agent-summary-label">Automation Potential</div>
                </div>
            </div>

            <!-- Heat Map Legend -->
            <div class="heat-legend" id="agent-heatmap">
                <div class="heat-legend-item"><div class="heat-legend-color" style="background: linear-gradient(135deg, #ef4444, #f97316);"></div><span><strong>Critical (90-100)</strong> - Immediate ROI</span></div>
                <div class="heat-legend-item"><div class="heat-legend-color" style="background: linear-gradient(135deg, #f97316, #eab308);"></div><span><strong>High (70-89)</strong> - Strong candidate</span></div>
                <div class="heat-legend-item"><div class="heat-legend-color" style="background: linear-gradient(135deg, #eab308, #22c55e);"></div><span><strong>Medium (50-69)</strong> - Consider</span></div>
                <div class="heat-legend-item"><div class="heat-legend-color" style="background: linear-gradient(135deg, #22c55e, #14b8a6);"></div><span><strong>Low (0-49)</strong> - Future phase</span></div>
            </div>

            <!-- Heat Map Grid -->
            <div class="heat-map-container">
                <div class="heat-map-title">Automation Priority Heat Map <span style="font-size: 0.8rem; font-weight: 400; color: var(--text-muted);">(Click to jump to agent)</span></div>
                <div class="heat-map-grid">
                    <div class="heat-item critical" onclick="scrollToAgent('agent-miselect')" title="Click to view agent details">
                        <div class="heat-score">94</div>
                        <div class="heat-name">MI Type Auto-Select</div>
                        <div class="heat-desc">Recommend optimal MI type based on borrower profile</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Effort: <span>Low</span></div>
                            <div class="heat-metric">Impact: <span>High</span></div>
                            <div class="heat-metric">Step: <span>1</span></div>
                        </div>
                    </div>
                    <div class="heat-item critical" onclick="scrollToAgent('agent-coverage')" title="Click to view agent details">
                        <div class="heat-score">92</div>
                        <div class="heat-name">AUS Coverage Extractor</div>
                        <div class="heat-desc">Auto-extract coverage % from DU/LP findings</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Effort: <span>Medium</span></div>
                            <div class="heat-metric">Impact: <span>High</span></div>
                            <div class="heat-metric">Step: <span>2</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-delegated')" title="Click to view agent details">
                        <div class="heat-score">85</div>
                        <div class="heat-name">Delegated/Non-Del Router</div>
                        <div class="heat-desc">Auto-determine submission method</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Effort: <span>Low</span></div>
                            <div class="heat-metric">Impact: <span>High</span></div>
                            <div class="heat-metric">Step: <span>4-5</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-validate')" title="Click to view agent details">
                        <div class="heat-score">78</div>
                        <div class="heat-name">MI Cert Validator</div>
                        <div class="heat-desc">Auto-compare cert to Byte data</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Effort: <span>Medium</span></div>
                            <div class="heat-metric">Impact: <span>High</span></div>
                            <div class="heat-metric">Step: <span>6</span></div>
                        </div>
                    </div>
                    <div class="heat-item medium" onclick="scrollToAgent('agent-bundle')" title="Click to view agent details">
                        <div class="heat-score">65</div>
                        <div class="heat-name">Bundle Auto-Assembler</div>
                        <div class="heat-desc">Prepare non-delegated doc packages</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Effort: <span>Medium</span></div>
                            <div class="heat-metric">Impact: <span>Medium</span></div>
                            <div class="heat-metric">Step: <span>5</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agent Details -->
            <h2 style="font-size: 1.4rem; margin: 35px 0 22px; color: var(--text-primary);" id="agent-details">Agent Specifications</h2>

            <div class="agent-grid">
                <!-- Agent 1: MI Type Auto-Select -->
                <div class="agent-card" id="agent-miselect">
                    <div class="agent-card-header">
                        <div class="agent-icon">S</div>
                        <div class="agent-info">
                            <div class="agent-name">MI Type Auto-Select Agent</div>
                            <div class="agent-type">Decision Support Agent</div>
                        </div>
                        <span class="agent-priority critical">Critical</span>
                    </div>
                    <div class="agent-card-body">
                        <p class="agent-description">Analyzes borrower financial profile, loan terms, and preferences to recommend the optimal MI type (Monthly, Single, Split, or LPMI). Calculates total cost comparison over various time horizons.</p>
                        <div class="agent-flow">
                            <div class="agent-flow-title">Agent Flow</div>
                            <div class="agent-flow-diagram">
                                <div class="agent-step">Loan Data</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Cost Model</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Compare Types</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Recommend</div>
                            </div>
                        </div>
                        <div class="agent-stats">
                            <div class="agent-stat"><div class="agent-stat-value">5min</div><div class="agent-stat-label">Time Saved</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">$300</div><div class="agent-stat-label">Avg Savings</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">Low</div><div class="agent-stat-label">Complexity</div></div>
                        </div>
                        <button class="agent-prompt-btn" onclick="showAgentPrompt('miselect')">
                            View AI Prompt to Build This Agent
                        </button>
                    </div>
                </div>

                <!-- Agent 2: AUS Coverage Extractor -->
                <div class="agent-card" id="agent-coverage">
                    <div class="agent-card-header">
                        <div class="agent-icon">E</div>
                        <div class="agent-info">
                            <div class="agent-name">AUS Coverage Extractor</div>
                            <div class="agent-type">Document Analysis Agent</div>
                        </div>
                        <span class="agent-priority critical">Critical</span>
                    </div>
                    <div class="agent-card-body">
                        <p class="agent-description">Automatically extracts MI coverage percentage from DU Verification Messages or LP Mortgage Insurance & Fees sections. Ensures the higher figure is always used to prevent pricing errors.</p>
                        <div class="agent-flow">
                            <div class="agent-flow-title">Agent Flow</div>
                            <div class="agent-flow-diagram">
                                <div class="agent-step">AUS Findings</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Parse Sections</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Extract %</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Auto-Fill</div>
                            </div>
                        </div>
                        <div class="agent-stats">
                            <div class="agent-stat"><div class="agent-stat-value">3min</div><div class="agent-stat-label">Time Saved</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">99%</div><div class="agent-stat-label">Accuracy</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">Med</div><div class="agent-stat-label">Complexity</div></div>
                        </div>
                        <button class="agent-prompt-btn" onclick="showAgentPrompt('coverage')">
                            View AI Prompt to Build This Agent
                        </button>
                    </div>
                </div>

                <!-- Agent 3: Delegated Router -->
                <div class="agent-card" id="agent-delegated">
                    <div class="agent-card-header">
                        <div class="agent-icon">R</div>
                        <div class="agent-info">
                            <div class="agent-name">Delegated/Non-Del Router</div>
                            <div class="agent-type">Rules Engine Agent</div>
                        </div>
                        <span class="agent-priority high">High</span>
                    </div>
                    <div class="agent-card-body">
                        <p class="agent-description">Applies CMG's delegated vs non-delegated rules automatically based on LTV, FICO, and property type. Routes loans to correct submission path and pre-selects appropriate MI underwriting method.</p>
                        <div class="agent-flow">
                            <div class="agent-flow-title">Agent Flow</div>
                            <div class="agent-flow-diagram">
                                <div class="agent-step">LTV/FICO/Type</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Apply Rules</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Route</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Pre-Select</div>
                            </div>
                        </div>
                        <div class="agent-stats">
                            <div class="agent-stat"><div class="agent-stat-value">2min</div><div class="agent-stat-label">Time Saved</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">100%</div><div class="agent-stat-label">Accuracy</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">Low</div><div class="agent-stat-label">Complexity</div></div>
                        </div>
                        <button class="agent-prompt-btn" onclick="showAgentPrompt('delegated')">
                            View AI Prompt to Build This Agent
                        </button>
                    </div>
                </div>

                <!-- Agent 4: MI Cert Validator -->
                <div class="agent-card" id="agent-validate">
                    <div class="agent-card-header">
                        <div class="agent-icon">V</div>
                        <div class="agent-info">
                            <div class="agent-name">MI Certificate Validator</div>
                            <div class="agent-type">QC Automation Agent</div>
                        </div>
                        <span class="agent-priority high">High</span>
                    </div>
                    <div class="agent-card-body">
                        <p class="agent-description">Compares MI Certificate data against Byte loan file data. Highlights discrepancies in occupancy, property value, LTV, coverage, credit score, and loan program for underwriter review.</p>
                        <div class="agent-flow">
                            <div class="agent-flow-title">Agent Flow</div>
                            <div class="agent-flow-diagram">
                                <div class="agent-step">MI Cert PDF</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Extract Data</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Compare</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Report</div>
                            </div>
                        </div>
                        <div class="agent-stats">
                            <div class="agent-stat"><div class="agent-stat-value">8min</div><div class="agent-stat-label">Time Saved</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">-50%</div><div class="agent-stat-label">Errors</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">Med</div><div class="agent-stat-label">Complexity</div></div>
                        </div>
                        <button class="agent-prompt-btn" onclick="showAgentPrompt('validate')">
                            View AI Prompt to Build This Agent
                        </button>
                    </div>
                </div>

                <!-- Agent 5: Bundle Auto-Assembler -->
                <div class="agent-card" id="agent-bundle">
                    <div class="agent-card-header">
                        <div class="agent-icon">B</div>
                        <div class="agent-info">
                            <div class="agent-name">Bundle Auto-Assembler</div>
                            <div class="agent-type">Document Automation Agent</div>
                        </div>
                        <span class="agent-priority medium">Medium</span>
                    </div>
                    <div class="agent-card-body">
                        <p class="agent-description">Automatically assembles non-delegated MI submission packages by identifying required documents, verifying approval status, and preparing bundles for each MI company's specific requirements.</p>
                        <div class="agent-flow">
                            <div class="agent-flow-title">Agent Flow</div>
                            <div class="agent-flow-diagram">
                                <div class="agent-step">MI Company</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Check Docs</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Assemble</div>
                                <span class="agent-arrow">-></span>
                                <div class="agent-step">Ready</div>
                            </div>
                        </div>
                        <div class="agent-stats">
                            <div class="agent-stat"><div class="agent-stat-value">10min</div><div class="agent-stat-label">Time Saved</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">-30%</div><div class="agent-stat-label">Rejects</div></div>
                            <div class="agent-stat"><div class="agent-stat-value">Med</div><div class="agent-stat-label">Complexity</div></div>
                        </div>
                        <button class="agent-prompt-btn" onclick="showAgentPrompt('bundle')">
                            View AI Prompt to Build This Agent
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Documentation Modal -->
    <div class="modal-overlay" id="docModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Mortgage Insurance - Workflow Markdown</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyToClipboard()">Copy</button>
                    <button class="modal-btn close" onclick="closeDocModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <pre id="docContent"># Byte Mortgage Insurance Manual

## Overview
Mortgage Insurance is required for Loan-To-Values over 80%.

## Common MI Types
1. Monthly Non-Refundable - Added to monthly payment
2. Single Premium Non-Refundable - One-time at closing (cash/financed)
3. Split Premium Non-Refundable - Upfront + lower monthly
4. Lender Paid (LPMI) - Higher rate, no borrower MI payment

## Process Stages
1. **Quote** - Home Screen (LO/LP)
2. **Order** - MI Insurance Screen (LP)
3. **Validate** - MI Cert Screen (UW)

## Delegated vs Non-Delegated

### Delegated (excludes manufactured homes)
- All LTVs 90% or below
- LTV 90.01-95% when FICO >= 680

### Non-Delegated
- All LTVs > 95%
- LTVs > 90% when FICO < 680
- All manufactured homes

## Key Rules
- Use HIGHER coverage % from AUS
- MI quote BEFORE Title Fees Integration
- Remove non-borrowers before MI submission
- No Level Annual or Standard Annual MI types

## MI Companies
- Arch MI
- Essent MI
- Genworth
- MGIC
- National MI
- Radian</pre>
            </div>
        </div>
    </div>

    <div class="copy-success" id="copySuccess">Copied to clipboard!</div>

    <!-- AI Prompt Modal -->
    <div class="modal-overlay prompt-modal" id="promptModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="promptModalTitle">AI Agent Build Prompt</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyPromptToClipboard()">Copy Prompt</button>
                    <button class="modal-btn close" onclick="closePromptModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="prompt-tags" id="promptTags"></div>
                <div class="prompt-section">
                    <h4>Agent Purpose</h4>
                    <div class="prompt-box" id="promptPurpose"></div>
                </div>
                <div class="prompt-section">
                    <h4>Full Build Prompt</h4>
                    <div class="prompt-box" id="promptContent"></div>
                </div>
                <div class="prompt-section">
                    <h4>Integration Points</h4>
                    <div class="prompt-box" id="promptIntegration"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Scroll-spy with isScrolling flag and timeout
        let isScrolling = false;
        let scrollTimeout;

        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));

            if (tab === 'workflow') {
                document.querySelector('.sidebar-tab:not(.agent-tab)').classList.add('active');
                document.getElementById('workflow-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'block';
                document.getElementById('agents-nav').style.display = 'none';
            } else {
                document.querySelector('.sidebar-tab.agent-tab').classList.add('active');
                document.getElementById('agents-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'none';
                document.getElementById('agents-nav').style.display = 'block';
            }

            window.scrollTo(0, 0);
        }

        // Scroll spy with isScrolling flag
        const sections = document.querySelectorAll('.section, .quick-ref');
        const navItems = document.querySelectorAll('#workflow-nav .nav-item');

        function updateActiveNav() {
            if (isScrolling) return;

            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                if (window.scrollY >= sectionTop) current = section.getAttribute('id');
            });
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + current) item.classList.add('active');
            });
        }

        // Handle nav clicks with scroll flag
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                isScrolling = true;

                // Clear any existing timeout
                clearTimeout(scrollTimeout);

                // Update active state immediately
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');

                // Scroll to section
                const targetId = this.getAttribute('href').substring(1);
                const targetSection = document.getElementById(targetId);
                if (targetSection) {
                    targetSection.scrollIntoView({ behavior: 'smooth' });
                }

                // Reset scrolling flag after 1000ms
                scrollTimeout = setTimeout(() => {
                    isScrolling = false;
                }, 1000);
            });
        });

        window.addEventListener('scroll', updateActiveNav);

        // Modal functions
        function openDocModal() {
            document.getElementById('docModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeDocModal() {
            document.getElementById('docModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyToClipboard() {
            try {
                const content = document.getElementById('docContent').textContent;
                await navigator.clipboard.writeText(content);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeDocModal();
                closePromptModal();
            }
        });

        document.getElementById('docModal').addEventListener('click', (e) => {
            if (e.target.id === 'docModal') closeDocModal();
        });

        // Scroll to agent from heat map
        function scrollToAgent(agentId) {
            const agent = document.getElementById(agentId);
            if (agent) {
                agent.scrollIntoView({ behavior: 'smooth', block: 'center' });
                agent.classList.add('highlight');
                setTimeout(() => agent.classList.remove('highlight'), 2500);
            }
        }

        // Agent Prompts
        const agentPrompts = {
            miselect: {
                name: 'MI Type Auto-Select Agent',
                tags: ['Decision Support', 'Cost Analysis', 'Low Complexity', 'Critical Priority'],
                purpose: 'Analyzes borrower profile and loan terms to recommend optimal MI type (Monthly, Single, Split, or LPMI) with total cost projections.',
                prompt: `AGENT: MI Type Auto-Select
TYPE: Decision Support

OBJECTIVE: Recommend optimal MI type based on borrower scenario

INPUT:
- Loan Amount, LTV, FICO, DTI
- Property Type, Occupancy
- Borrower preferences (low payment vs low upfront)
- Expected time in home

DECISION MATRIX:
IF short-term (< 5 years) AND cash available -> Single Premium
IF long-term AND tight monthly budget -> LPMI
IF uncertain timeline -> Monthly Non-Refundable
IF moderate upfront + lower monthly needed -> Split Premium

OUTPUT:
{
  "recommendation": "Monthly Non-Refundable",
  "reasoning": "Best for uncertain timeline",
  "costComparison": {
    "monthly_5yr": 12000,
    "single_5yr": 8500,
    "lpmi_5yr": 14000
  }
}`,
                integration: `INTEGRATION:
1. Byte Home Screen - Add "Recommend MI Type" button
2. Pull loan data from current file
3. Display comparison modal with Accept button
4. Auto-populate PMI Type field on selection`
            },
            coverage: {
                name: 'AUS Coverage Extractor',
                tags: ['Document Analysis', 'OCR', 'Medium Complexity', 'Critical Priority'],
                purpose: 'Automatically extracts MI coverage percentage from DU/LP findings and ensures higher figure is used.',
                prompt: `AGENT: AUS Coverage Extractor
TYPE: Document Analysis

OBJECTIVE: Extract MI coverage % from AUS findings

INPUT: AUS Findings document (DU or LP)

EXTRACTION RULES:
FOR DU:
- Search "Verification Messages Section"
- Pattern: "mortgage insurance coverage of X%"
- Extract both 6% and 12% options if present

FOR LP:
- Search "Mortgage Insurance & Fees Section"
- Pattern: "MI coverage: X%"

VALIDATION:
- Always return HIGHER percentage
- Flag if no coverage found
- Alert if values differ significantly

OUTPUT:
{
  "source": "DU",
  "coverageOptions": [6, 12],
  "recommended": 12,
  "confidence": 0.98
}`,
                integration: `INTEGRATION:
1. Trigger on AUS document upload to Stored Docs
2. Parse PDF/XML response
3. Auto-populate Coverage % field in MI Quote screen
4. Display source and confidence to user`
            },
            delegated: {
                name: 'Delegated/Non-Del Router',
                tags: ['Rules Engine', 'Routing', 'Low Complexity', 'High Priority'],
                purpose: 'Applies CMG delegated vs non-delegated rules and routes to correct submission path.',
                prompt: `AGENT: Delegated/Non-Delegated Router
TYPE: Rules Engine

OBJECTIVE: Determine correct MI submission method

RULES:
DELEGATED (manufactured homes excluded):
- LTV <= 90%: DELEGATED
- LTV 90.01-95% AND FICO >= 680: DELEGATED

NON-DELEGATED:
- LTV > 95%: NON-DELEGATED
- LTV > 90% AND FICO < 680: NON-DELEGATED
- Property Type = Manufactured: NON-DELEGATED

INPUT:
{
  "ltv": 92.5,
  "fico": 720,
  "propertyType": "Single Family"
}

OUTPUT:
{
  "method": "Delegated",
  "reason": "LTV 92.5% with FICO 720 qualifies",
  "preSelect": true
}`,
                integration: `INTEGRATION:
1. Trigger when MI Order screen opens
2. Read LTV, FICO, Property Type from loan file
3. Auto-select MI Underwriting Method dropdown
4. Display rule explanation if manual override`
            },
            validate: {
                name: 'MI Certificate Validator',
                tags: ['QC Automation', 'Document Comparison', 'Medium Complexity', 'High Priority'],
                purpose: 'Compares MI Certificate to Byte loan data and highlights discrepancies.',
                prompt: `AGENT: MI Certificate Validator
TYPE: QC Automation

OBJECTIVE: Validate MI Cert matches Byte data

FIELDS TO COMPARE:
- Occupancy Type
- Property Value
- Premium Payment Option
- LTV
- Coverage %
- Insured Loan Amount
- Financed Premium
- Total Loan Amount
- Credit Score
- Loan Program (HFA, Affordable)

VALIDATION:
FOR EACH field:
  IF cert_value != byte_value:
    ADD to discrepancies
    CALCULATE variance %

OUTPUT:
{
  "status": "DISCREPANCIES_FOUND",
  "matches": ["Occupancy", "LTV"],
  "discrepancies": [
    {"field": "Coverage", "cert": "12%", "byte": "6%", "action": "UPDATE BYTE"}
  ],
  "recommendation": "Review before proceeding"
}`,
                integration: `INTEGRATION:
1. Trigger when MI Cert added to Stored Docs
2. OCR extract cert data
3. Pull Byte screen values via API
4. Display comparison report in MI Cert Screen
5. Add "Accept All" or "Flag for Review" buttons`
            },
            bundle: {
                name: 'Bundle Auto-Assembler',
                tags: ['Document Automation', 'Packaging', 'Medium Complexity', 'Medium Priority'],
                purpose: 'Prepares non-delegated MI submission packages with required documents.',
                prompt: `AGENT: Bundle Auto-Assembler
TYPE: Document Automation

OBJECTIVE: Assemble complete MI submission packages

REQUIRED DOCS BY COMPANY:
ARCH MI:
- Appraisal Report
- Credit Report
- AUS Findings
- Bank Statements
- Title Commitment

ALL COMPANIES:
- Initial 1003
- Purchase Agreement (if applicable)
- Tax Returns
- Letter of Explanation (if needed)

VALIDATION:
FOR EACH required doc:
  CHECK exists in Stored Docs
  CHECK status = Approved
  IF missing: ADD to checklist

OUTPUT:
{
  "company": "ARCH MI",
  "bundleReady": false,
  "missing": ["Letter of Explanation"],
  "approved": 8,
  "total": 9
}`,
                integration: `INTEGRATION:
1. Trigger when Non-Delegated selected
2. Scan Stored Documents inventory
3. Check document approval status
4. Pre-select matching stacking order
5. Highlight missing/unapproved docs
6. Enable "Deliver Bundle" when complete`
            }
        };

        function showAgentPrompt(agentKey) {
            const agent = agentPrompts[agentKey];
            if (!agent) return;

            document.getElementById('promptModalTitle').textContent = agent.name;
            document.getElementById('promptTags').innerHTML = agent.tags.map(t => `<span class="prompt-tag">${t}</span>`).join('');
            document.getElementById('promptPurpose').textContent = agent.purpose;
            document.getElementById('promptContent').textContent = agent.prompt;
            document.getElementById('promptIntegration').textContent = agent.integration;

            document.getElementById('promptModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closePromptModal() {
            document.getElementById('promptModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyPromptToClipboard() {
            const content = document.getElementById('promptContent').textContent;
            try {
                await navigator.clipboard.writeText(content);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.getElementById('promptModal').addEventListener('click', (e) => {
            if (e.target.id === 'promptModal') closePromptModal();
        });

        document.addEventListener('DOMContentLoaded', () => { updateActiveNav(); });
    </script>
</body>
</html>
