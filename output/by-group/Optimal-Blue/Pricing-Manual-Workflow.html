<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optimal Blue Pricing Manual - Process Workflow</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: #111827;
            --bg-card: #1a2234;
            --accent-blue: #3b82f6;
            --accent-teal: #14b8a6;
            --accent-amber: #f59e0b;
            --accent-rose: #f43f5e;
            --accent-green: #22c55e;
            --accent-purple: #8b5cf6;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-subtle: rgba(255,255,255,0.08);
            --sidebar-width: 280px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Breadcrumb */
        .breadcrumb {
            background: linear-gradient(90deg, #0d1525 0%, #1a2234 100%);
            padding: 14px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
            border-bottom: 1px solid var(--border-subtle);
        }

        .breadcrumb a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            transition: all 0.2s;
            border: 1px solid var(--border-subtle);
        }

        .breadcrumb a:hover {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .breadcrumb .separator { color: var(--text-muted); font-size: 1.2rem; }
        .breadcrumb .current { color: var(--accent-amber); font-weight: 600; padding: 8px 16px; }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 54px;
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - 54px);
            background: var(--bg-secondary);
            overflow-y: auto;
            z-index: 1000;
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 25px 20px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-header h2 { color: var(--text-primary); font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
        .sidebar-header p { color: var(--text-muted); font-size: 0.85rem; }

        /* Tab Switch */
        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-tab {
            flex: 1;
            padding: 14px 10px;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            background: none;
            border-left: none;
            border-right: none;
            border-top: none;
        }

        .sidebar-tab:hover { background: rgba(255,255,255,0.03); color: var(--text-secondary); }
        .sidebar-tab.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); background: rgba(59, 130, 246, 0.08); }
        .sidebar-tab.agent-tab.active { color: var(--accent-purple); border-bottom-color: var(--accent-purple); background: rgba(139, 92, 246, 0.08); }

        .sidebar-nav { padding: 15px 0; flex: 1; overflow-y: auto; }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .nav-item:hover { background: rgba(255,255,255,0.03); color: var(--text-primary); }
        .nav-item.active { background: rgba(59, 130, 246, 0.1); border-left-color: var(--accent-blue); color: var(--text-primary); }

        .nav-number {
            background: rgba(255,255,255,0.1);
            color: var(--text-secondary);
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .nav-item.active .nav-number { background: var(--accent-blue); color: white; }
        .nav-label { font-size: 0.95rem; font-weight: 500; }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-subtle);
            background: rgba(0,0,0,0.2);
        }

        .doc-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px 20px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .doc-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3); }

        /* Main Content */
        .main-content { margin-left: var(--sidebar-width); padding: 80px 40px 40px 40px; }

        /* Tab Panels */
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        .header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(20, 184, 166, 0.08) 0%, transparent 50%);
            pointer-events: none;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        .header .meta { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; position: relative; }

        .header .meta-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-subtle);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); }
        .legend-color { width: 18px; height: 18px; border-radius: 4px; }

        /* Sections */
        .section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            margin-bottom: 25px;
            overflow: hidden;
            scroll-margin-top: 75px;
        }

        .section-header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(59, 130, 246, 0.1) 100%);
            border-bottom: 1px solid var(--border-subtle);
            padding: 22px 25px;
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .section-number {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .section-title h2 { font-size: 1.35rem; font-weight: 700; margin-bottom: 4px; color: var(--text-primary); }
        .section-title span { font-size: 0.9rem; color: var(--text-muted); }
        .section-content { padding: 28px; }

        /* Workflow Diagrams */
        .workflow-diagram {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 28px;
            margin-bottom: 22px;
        }

        .flow-row { display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 12px; margin: 15px 0; }

        .flow-node {
            padding: 14px 22px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            min-width: 150px;
            border: 1px solid var(--border-subtle);
        }

        .flow-node.start { background: linear-gradient(135deg, var(--accent-green) 0%, #16a34a 100%); color: white; border-radius: 25px; border: none; }
        .flow-node.action { background: linear-gradient(135deg, var(--accent-blue) 0%, #2563eb 100%); color: white; border: none; }
        .flow-node.decision { background: linear-gradient(135deg, var(--accent-amber) 0%, #d97706 100%); color: var(--bg-primary); border: none; }
        .flow-node.input { background: var(--bg-secondary); border: 2px solid var(--accent-blue); color: var(--text-primary); }
        .flow-node.output { background: linear-gradient(135deg, var(--accent-teal) 0%, #0d9488 100%); color: white; border: none; }
        .flow-node.exception { background: linear-gradient(135deg, var(--accent-rose) 0%, #dc2626 100%); color: white; border: none; }

        .flow-arrow { color: var(--accent-blue); font-size: 1.5rem; }
        .flow-arrow.down { transform: rotate(90deg); }

        .decision-branch { display: flex; gap: 40px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
        .branch { display: flex; flex-direction: column; align-items: center; gap: 10px; }

        .branch-label {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        /* Tables */
        .field-table { width: 100%; border-collapse: collapse; margin: 18px 0; }

        .field-table th {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            padding: 14px 18px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border-subtle);
        }

        .field-table td { padding: 14px 18px; border-bottom: 1px solid var(--border-subtle); color: var(--text-secondary); }
        .field-table tr:hover { background: rgba(255,255,255,0.02); }

        .badge { display: inline-block; padding: 4px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge.required-badge { background: rgba(244, 63, 94, 0.15); color: var(--accent-rose); }
        .badge.optional-badge { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .badge.calculated-badge { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }

        /* Info Boxes */
        .exception-box, .tip-box, .info-box {
            padding: 18px 22px;
            margin: 18px 0;
            border-radius: 0 10px 10px 0;
            border-left-width: 4px;
            border-left-style: solid;
        }

        .exception-box { background: rgba(244, 63, 94, 0.08); border-color: var(--accent-rose); border: 1px solid rgba(244, 63, 94, 0.2); border-left: 4px solid var(--accent-rose); }
        .exception-box h4 { color: var(--accent-rose); margin-bottom: 10px; font-size: 1rem; }
        .exception-box p, .exception-box li { color: var(--text-secondary); }

        .tip-box { background: rgba(34, 197, 94, 0.08); border-color: var(--accent-green); border: 1px solid rgba(34, 197, 94, 0.2); border-left: 4px solid var(--accent-green); }
        .tip-box h4 { color: var(--accent-green); margin-bottom: 10px; font-size: 1rem; }
        .tip-box p, .tip-box li { color: var(--text-secondary); }

        .info-box { background: rgba(59, 130, 246, 0.08); border-color: var(--accent-blue); border: 1px solid rgba(59, 130, 246, 0.2); border-left: 4px solid var(--accent-blue); }
        .info-box h4 { color: var(--accent-blue); margin-bottom: 10px; font-size: 1rem; }
        .info-box p, .info-box li { color: var(--text-secondary); }

        /* Decision Tree */
        .decision-tree {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 22px;
            margin: 22px 0;
        }

        .decision-tree h3 { color: var(--accent-blue); margin-bottom: 18px; padding-bottom: 12px; border-bottom: 1px solid var(--border-subtle); font-size: 1.1rem; }

        .tree-node { margin-left: 20px; padding: 12px; border-left: 2px solid var(--accent-teal); position: relative; color: var(--text-secondary); }
        .tree-node::before { content: ''; position: absolute; left: -2px; top: 22px; width: 15px; height: 2px; background: var(--accent-teal); }
        .tree-node.level-1 { margin-left: 0; border-left: none; }
        .tree-node.level-1::before { display: none; }

        .tree-label { background: var(--accent-amber); color: var(--bg-primary); padding: 6px 14px; border-radius: 6px; font-weight: 700; display: inline-block; margin-bottom: 6px; font-size: 0.9rem; }

        /* Summary Grid */
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 18px; margin: 22px 0; }

        .summary-card { background: rgba(0,0,0,0.3); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 22px; text-align: center; }
        .summary-card h4 { color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9rem; }
        .summary-card .value {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .summary-card .label { font-size: 0.85rem; color: var(--text-muted); margin-top: 8px; }

        /* Quick Reference */
        .quick-ref {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
            border: 1px solid var(--border-subtle);
            padding: 28px;
            border-radius: 16px;
            margin-top: 30px;
            font-family: 'JetBrains Mono', monospace;
            scroll-margin-top: 75px;
        }

        .quick-ref h3 { color: var(--accent-amber); margin-bottom: 18px; font-family: 'Plus Jakarta Sans', sans-serif; }
        .quick-ref pre { background: rgba(0,0,0,0.4); border: 1px solid var(--border-subtle); padding: 20px; border-radius: 10px; overflow-x: auto; font-size: 0.85rem; line-height: 1.7; color: var(--text-secondary); }

        /* Step List */
        .step-list { list-style: none; padding: 0; margin: 18px 0; }
        .step-list li {
            padding: 14px 18px;
            border-left: 3px solid var(--accent-blue);
            background: rgba(0,0,0,0.2);
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
        }
        .step-list li strong { color: var(--text-primary); }

        /* ====== AGENT OPPORTUNITIES STYLES ====== */
        .agent-header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .agent-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(139, 92, 246, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .agent-header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        /* Heat Map */
        .heat-map-container { margin-bottom: 35px; }
        .heat-map-title { font-size: 1.3rem; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }

        .heat-map-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .heat-item {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .heat-item:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .heat-item:active { transform: scale(0.98); }

        .heat-item::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 4px;
        }

        .heat-item.critical::before { background: linear-gradient(90deg, #ef4444, #f97316); }
        .heat-item.high::before { background: linear-gradient(90deg, #f97316, #eab308); }
        .heat-item.medium::before { background: linear-gradient(90deg, #eab308, #22c55e); }
        .heat-item.low::before { background: linear-gradient(90deg, #22c55e, #14b8a6); }

        .heat-score {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.8rem;
            font-weight: 800;
        }

        .heat-item.critical .heat-score { color: #ef4444; }
        .heat-item.high .heat-score { color: #f97316; }
        .heat-item.medium .heat-score { color: #eab308; }
        .heat-item.low .heat-score { color: #22c55e; }

        .heat-name { font-size: 1rem; font-weight: 700; color: var(--text-primary); margin-bottom: 6px; padding-right: 50px; }
        .heat-desc { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; }

        .heat-metrics { display: flex; gap: 15px; margin-top: 12px; }
        .heat-metric { font-size: 0.75rem; color: var(--text-muted); }
        .heat-metric span { color: var(--text-secondary); font-weight: 600; }

        /* Agent Cards */
        .agent-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 25px; margin-bottom: 35px; }

        .agent-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .agent-card:hover { transform: translateY(-5px); box-shadow: 0 15px 50px rgba(0,0,0,0.3); }

        .agent-card.highlight {
            animation: highlightPulse 2s ease;
            box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.4);
        }

        @keyframes highlightPulse {
            0% { box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.6); }
            50% { box-shadow: 0 0 0 6px rgba(139, 92, 246, 0.5), 0 15px 50px rgba(139, 92, 246, 0.3); }
            100% { box-shadow: 0 0 0 0px transparent, 0 15px 50px rgba(0,0,0,0.3); }
        }

        .agent-card-header {
            padding: 22px;
            display: flex;
            align-items: flex-start;
            gap: 18px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .agent-icon {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            flex-shrink: 0;
        }

        .agent-info { flex: 1; }
        .agent-name { font-size: 1.15rem; font-weight: 700; color: var(--text-primary); margin-bottom: 5px; }
        .agent-type { font-size: 0.8rem; color: var(--accent-purple); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-priority {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .agent-priority.critical { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .agent-priority.high { background: rgba(249, 115, 22, 0.15); color: #f97316; }
        .agent-priority.medium { background: rgba(234, 179, 8, 0.15); color: #eab308; }
        .agent-priority.low { background: rgba(34, 197, 94, 0.15); color: #22c55e; }

        .agent-card-body { padding: 22px; }
        .agent-description { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; }

        .agent-flow {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 20px;
        }

        .agent-flow-title { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-flow-diagram { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; justify-content: center; }

        .agent-step {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .agent-arrow { color: var(--accent-purple); font-size: 1.2rem; }

        .agent-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }

        .agent-stat {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .agent-stat-value {
            font-size: 1.3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-top: 4px; }

        /* View Prompt Button */
        .agent-prompt-btn {
            width: 100%;
            margin-top: 18px;
            padding: 14px 20px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 10px;
            color: var(--accent-purple);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .agent-prompt-btn:hover {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(59, 130, 246, 0.3) 100%);
            border-color: var(--accent-purple);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.25);
        }

        /* Summary Stats */
        .agent-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .agent-summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            padding: 25px;
            text-align: center;
        }

        .agent-summary-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-summary-label { font-size: 0.9rem; color: var(--text-muted); margin-top: 8px; }

        /* Heat Map Legend */
        .heat-legend {
            display: flex;
            gap: 25px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .heat-legend-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; color: var(--text-secondary); }
        .heat-legend-color { width: 24px; height: 24px; border-radius: 6px; }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(10, 15, 26, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.show { display: flex; }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            width: 100%;
            max-width: 950px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 80px rgba(0,0,0,0.5);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            padding: 22px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 16px 16px 0 0;
        }

        .modal-header h3 { font-size: 1.25rem; font-weight: 700; }
        .modal-actions { display: flex; gap: 12px; }

        .modal-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: transform 0.2s;
            font-size: 0.9rem;
        }

        .modal-btn:hover { transform: scale(1.05); }
        .modal-btn.copy { background: white; color: var(--accent-blue); }
        .modal-btn.close { background: rgba(255,255,255,0.2); color: white; }

        .modal-body { padding: 28px; overflow-y: auto; flex: 1; }

        .modal-body pre {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            padding: 22px;
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.7;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--text-secondary);
        }

        .copy-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--accent-green);
            color: white;
            padding: 18px 35px;
            border-radius: 10px;
            font-weight: 700;
            z-index: 3000;
            display: none;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut { 0%, 100% { opacity: 0; } 10%, 90% { opacity: 1; } }

        /* Prompt Modal */
        .prompt-modal .modal { max-width: 800px; }
        .prompt-modal .modal-header { background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%); }

        .prompt-section { margin-bottom: 25px; }
        .prompt-section h4 { color: var(--accent-purple); font-size: 1rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }

        .prompt-box {
            background: rgba(0,0,0,0.4);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.7;
            color: var(--text-secondary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .prompt-tags { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .prompt-tag { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 75px 20px 30px 20px; }
            .agent-grid { grid-template-columns: 1fr; }
        }
        .breadcrumb-logo-link { display: inline-flex; align-items: center; padding: 4px 8px; background: rgba(255,255,255,0.08); border-radius: 8px; border: 1px solid rgba(255,255,255,0.12); transition: all 0.2s; flex-shrink: 0; margin-right: 4px; }
        .breadcrumb-logo-link:hover { background: rgba(255,255,255,0.15); }
        .breadcrumb-logo { height: 24px; width: auto; display: block; }
    </style>
</head>
<body>
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
<a href="../../index.html" class="breadcrumb-logo-link"><img src="../../images/clear-ai-logo.png" alt="Clear AI" class="breadcrumb-logo"></a>
        <a href="../../index.html">Portal Home</a>
        <span class="separator">></span>
        <a href="./index.html">Optimal Blue</a>
        <span class="separator">></span>
        <span class="current">Pricing Manual</span>
    </nav>

    <!-- Fixed Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>Pricing Manual</h2>
            <p>Optimal Blue Pricing Guide</p>
        </div>

        <!-- Tab Switcher -->
        <div class="sidebar-tabs">
            <button class="sidebar-tab active" onclick="switchTab('workflow')">Workflow</button>
            <button class="sidebar-tab agent-tab" onclick="switchTab('agents')">AI Agents</button>
        </div>

        <!-- Workflow Navigation -->
        <nav class="sidebar-nav" id="workflow-nav">
            <a href="#section-1" class="nav-item active">
                <span class="nav-number">1</span>
                <span class="nav-label">Access Pricing</span>
            </a>
            <a href="#section-2" class="nav-item">
                <span class="nav-number">2</span>
                <span class="nav-label">Search Results</span>
            </a>
            <a href="#section-3" class="nav-item">
                <span class="nav-number">3</span>
                <span class="nav-label">Multiple Scenarios</span>
            </a>
            <a href="#section-4" class="nav-item">
                <span class="nav-number">4</span>
                <span class="nav-label">Lock the Loan</span>
            </a>
            <a href="#section-5" class="nav-item">
                <span class="nav-number">5</span>
                <span class="nav-label">Price Concessions</span>
            </a>
            <a href="#section-6" class="nav-item">
                <span class="nav-number">6</span>
                <span class="nav-label">Post-Lock Changes</span>
            </a>
            <a href="#section-7" class="nav-item">
                <span class="nav-number">7</span>
                <span class="nav-label">Lock Extension</span>
            </a>
            <a href="#section-8" class="nav-item">
                <span class="nav-number">8</span>
                <span class="nav-label">Float Down</span>
            </a>
            <a href="#section-9" class="nav-item">
                <span class="nav-number">9</span>
                <span class="nav-label">Re-Lock</span>
            </a>
            <a href="#quick-ref" class="nav-item">
                <span class="nav-number">*</span>
                <span class="nav-label">Quick Reference</span>
            </a>
        </nav>

        <!-- Agent Navigation -->
        <nav class="sidebar-nav" id="agents-nav" style="display: none;">
            <a href="#agent-summary" class="nav-item active">
                <span class="nav-number">S</span>
                <span class="nav-label">Summary</span>
            </a>
            <a href="#agent-heatmap" class="nav-item">
                <span class="nav-number">H</span>
                <span class="nav-label">Heat Map</span>
            </a>
            <a href="#agent-details" class="nav-item">
                <span class="nav-number">A</span>
                <span class="nav-label">Agent Details</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="doc-btn" onclick="openDocModal()">
                View Workflow Markdown
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

        <!-- ==================== WORKFLOW TAB ==================== -->
        <div id="workflow-panel" class="tab-panel active">
            <!-- Header -->
            <div class="header">
                <h1>Pricing Manual - Optimal Blue</h1>
                <p class="subtitle">Complete guide for pricing loans, locking rates, and managing post-lock changes in Optimal Blue</p>
                <div class="meta">
                    <span class="meta-item">System: Optimal Blue PPE</span>
                    <span class="meta-item">Role: Loan Officer / Processor</span>
                    <span class="meta-item">Updated: Jan 9, 2026</span>
                    <span class="meta-item">LOS: Clear / Byte</span>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #22c55e, #16a34a);"></div><span>Start/End</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></div><span>Action Step</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></div><span>Decision Point</span></div>
                <div class="legend-item"><div class="legend-color" style="background: #111827; border: 2px solid #3b82f6;"></div><span>User Input</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f43f5e, #dc2626);"></div><span>Exception</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #14b8a6, #0d9488);"></div><span>Output</span></div>
            </div>

            <!-- Section 1: Access Pricing -->
            <section id="section-1" class="section">
                <div class="section-header">
                    <div class="section-number">1</div>
                    <div class="section-title"><h2>Access Pricing Screen</h2><span>Navigate to Optimal Blue from Clear or Byte</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Start</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Open Loan File</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Which LOS?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">CLEAR</span>
                                <div class="flow-node action">Click Pricing Shortcut</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">BYTE</span>
                                <div class="flow-node action">Pricing and Lock Request Form</div>
                            </div>
                        </div>
                    </div>

                    <div class="decision-tree">
                        <h3>Accessing from Clear</h3>
                        <ul class="step-list">
                            <li><strong>Step 1:</strong> Click the <strong>Pricing</strong> shortcut in Clear</li>
                            <li><strong>Step 2:</strong> Two tabs appear at the top: <strong>Pricing</strong> (default) and <strong>What if Pricing</strong></li>
                            <li><strong>Step 3:</strong> For full Pricing functions, click <strong>Search</strong></li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Accessing from Byte</h3>
                        <ul class="step-list">
                            <li><strong>Step 1:</strong> Select the <strong>Pricing and Lock Request</strong> form</li>
                            <li><strong>Step 2:</strong> Two options: <strong>What if as Loan Officer</strong> or <strong>Submit as Loan Officer</strong></li>
                            <li><strong>Step 3:</strong> Leave on Pricing, then click <strong>Submit</strong> to view full pricing results</li>
                        </ul>
                    </div>

                    <div class="info-box">
                        <h4>What if Pricing Mode</h4>
                        <p><strong>What if Pricing</strong> allows you to access all Loan Scenario functions and Add Scenario functions, including changing data in the scenarios <strong>without</strong> the ability/risk of data fields or pricing terms flowing back to the loan.</p>
                    </div>

                    <div class="exception-box">
                        <h4>Important: Data Sync Warning</h4>
                        <p>Any changes needed to loan parameters on unlocked loans should be made in the <strong>Clear/Byte file itself</strong>, not on the OB Search page. Data changed in the loan fields in OB <strong>DO push back to the loan</strong>.</p>
                    </div>
                </div>
            </section>

            <!-- Section 2: Search Results -->
            <section id="section-2" class="section">
                <div class="section-header">
                    <div class="section-number">2</div>
                    <div class="section-title"><h2>Search Results Screen</h2><span>Review eligible and ineligible products</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Click Search</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">View Eligible Products</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Product Eligible?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">YES</span>
                                <div class="flow-node action">Click Product Name</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">NO</span>
                                <div class="flow-node exception">Review Disqualifiers</div>
                            </div>
                        </div>
                    </div>

                    <ul class="step-list">
                        <li><strong>Eligible Products:</strong> Displayed below the blue banner with Rate, Price, Discount/Rebate, Lock Days, and P&I columns</li>
                        <li><strong>Ineligible Products:</strong> Appear below the list of eligible products</li>
                        <li><strong>If Ineligible:</strong> Review the <strong>Disqualifiers</strong> column to understand why</li>
                        <li><strong>Click Product Name:</strong> Displays rate options, lock periods, price adjustments, and advisories</li>
                    </ul>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Column</th>
                                <th>Description</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Rate</strong></td>
                                <td>Interest rate for the product</td>
                                <td>Compare across products</td>
                            </tr>
                            <tr>
                                <td><strong>Price</strong></td>
                                <td>Loan price (par = 100)</td>
                                <td>Higher = more rebate</td>
                            </tr>
                            <tr>
                                <td><strong>Discount/Rebate</strong></td>
                                <td>Points charged or credited</td>
                                <td>Negative = rebate to borrower</td>
                            </tr>
                            <tr>
                                <td><strong>Lock Days</strong></td>
                                <td>Number of days until lock expires</td>
                                <td>Select 21, 30, 45, or 60</td>
                            </tr>
                            <tr>
                                <td><strong>P&I</strong></td>
                                <td>Principal and Interest payment</td>
                                <td>Monthly payment estimate</td>
                            </tr>
                            <tr>
                                <td><strong>i Icon</strong></td>
                                <td>Product and pricing details</td>
                                <td>View payment schedule</td>
                            </tr>
                            <tr>
                                <td><strong>MI Icon</strong></td>
                                <td>Mortgage Insurance quote tool</td>
                                <td>Get PMI vendor quotes</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="tip-box">
                        <h4>Originator Assistant</h4>
                        <p><strong>Originator Assistant</strong> analyzes the best-priced product and responds with suggestions for borrowers to obtain better loan terms. It examines LTV (+/- 5%), Loan Amount, FICO (+/- 10pts), and DTI (+/- 5%), showing the effect on Rate, Price, and Discount/Rebate.</p>
                    </div>

                    <div class="exception-box">
                        <h4>PMI Quote Note</h4>
                        <p>To achieve a full and correct PMI quote exact to the loan, you must run <strong>GET PMI</strong> in Clear or <strong>PMI Get quote</strong> in Byte within the loan. The OB PMI tool provides only a general quote.</p>
                    </div>
                </div>
            </section>

            <!-- Section 3: Multiple Scenarios -->
            <section id="section-3" class="section">
                <div class="section-header">
                    <div class="section-number">3</div>
                    <div class="section-title"><h2>Pricing Multiple Scenarios</h2><span>Compare different loan scenarios simultaneously</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Click Add Scenario</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">Name Each Scenario</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Modify Parameters</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Click Submit</div>
                        </div>
                    </div>

                    <ul class="step-list">
                        <li><strong>Step 1:</strong> Click <strong>Add Scenario</strong> prior to pressing Submit on the OB input screen</li>
                        <li><strong>Step 2:</strong> Give each scenario a descriptive name (e.g., "Conventional 5% Down", "Purchase 10% Down")</li>
                        <li><strong>Step 3:</strong> Modify loan parameters for each scenario (Loan Type, Amount, LTV, etc.)</li>
                        <li><strong>Step 4:</strong> Click <strong>Submit</strong> to view pricing results for all scenarios</li>
                    </ul>

                    <div class="info-box">
                        <h4>Scenario Comparison</h4>
                        <p>Search results will display all scenarios with an <strong>Include Scenarios</strong> dropdown to filter. Results show scenario name prefix (e.g., "Purchase 5% Down - CMG Retail FNMA Conforming 30 Year Fixed").</p>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Scenario Field</th>
                                <th>Description</th>
                                <th>Example</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Scenario Name</strong></td>
                                <td>Identifier for the scenario</td>
                                <td>Purchase 10% Down</td>
                            </tr>
                            <tr>
                                <td><strong>Lien Position</strong></td>
                                <td>First Lien or Second Lien</td>
                                <td>First Lien</td>
                            </tr>
                            <tr>
                                <td><strong>Loan Type</strong></td>
                                <td>Conforming, FHA, VA, etc.</td>
                                <td>Conventional</td>
                            </tr>
                            <tr>
                                <td><strong>Base Loan Amount</strong></td>
                                <td>Loan amount before financed fees</td>
                                <td>$450,000</td>
                            </tr>
                            <tr>
                                <td><strong>Appraised Value</strong></td>
                                <td>Property value</td>
                                <td>$500,000</td>
                            </tr>
                            <tr>
                                <td><strong>LTV / CLTV</strong></td>
                                <td>Loan-to-Value ratios</td>
                                <td><span class="badge calculated-badge">Auto-Calculated</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Section 4: Lock the Loan -->
            <section id="section-4" class="section">
                <div class="section-header">
                    <div class="section-number">4</div>
                    <div class="section-title"><h2>Lock the Loan</h2><span>Request a rate lock or update the LOS</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Select Rate from Stack</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Click Proceed to Lock Form</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">Enter Lock Contact Email</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Lock or Float?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">LOCK</span>
                                <div class="flow-node action">Click Request Lock</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">FLOAT</span>
                                <div class="flow-node action">Click Update LOS</div>
                            </div>
                        </div>
                    </div>

                    <ul class="step-list">
                        <li><strong>Step 1:</strong> Select a product to open the rate stack and view all available interest rates</li>
                        <li><strong>Step 2:</strong> Review the row, then click the <strong>"I" icon</strong> for the desired interest rate</li>
                        <li><strong>Step 3:</strong> Click <strong>Proceed to Lock Form</strong></li>
                        <li><strong>Step 4:</strong> Enter the <strong>Lock Contact Email</strong> (separate multiple emails with semicolons)</li>
                        <li><strong>Step 5:</strong> Click <strong>Request Lock</strong> to lock, or <strong>Update LOS</strong> to float</li>
                    </ul>

                    <div class="info-box">
                        <h4>Lock Confirmation</h4>
                        <p>When pricing information is pushed to Byte/Clear from OB, a confirmation message appears. Click <strong>Refresh</strong> to see the lock data populate into the LOS.</p>
                    </div>

                    <div class="tip-box">
                        <h4>Update LOS (Float)</h4>
                        <p>Click <strong>Update LOS</strong> to update the LOS without locking or floating the interest rate. This saves the loan information without committing to a rate.</p>
                    </div>
                </div>
            </section>

            <!-- Section 5: Price Concessions -->
            <section id="section-5" class="section">
                <div class="section-header">
                    <div class="section-number">5</div>
                    <div class="section-title"><h2>Request Lock with Concession</h2><span>Submit price concession requests</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Click Request Lock Dropdown</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Select Request Lock with Concession</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">Complete Concession Form</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Click Submit</div>
                        </div>
                    </div>

                    <div class="decision-tree">
                        <h3>Price Concession Reasons</h3>
                        <ul class="step-list">
                            <li><strong>Net LC (Net Lender Credit):</strong> A price-improvement adjustment typically used to reduce discount points charged to the borrower. A net lender credit resulting in an overage (price above par) can also be used toward closing costs.</li>
                            <li><strong>General LC (General Lender Credit):</strong> A lump-sum credit itemized on the LE and CD. Once disclosed to the borrower, a general lender credit <strong>cannot be reduced or removed</strong>.</li>
                            <li><strong>Competitive Price Match:</strong> Requires the <strong>Competitive Price Match Request Form</strong> (fillable PDF)</li>
                        </ul>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Field</th>
                                <th>Description</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Price Concession Reason</strong></td>
                                <td>Select from dropdown (Net LC, General LC, Price Match, etc.)</td>
                                <td><span class="badge required-badge">Required</span></td>
                            </tr>
                            <tr>
                                <td><strong>Price Concession Amount</strong></td>
                                <td>Dollar or Percentage amount of desired concession</td>
                                <td><span class="badge required-badge">Required*</span></td>
                            </tr>
                            <tr>
                                <td><strong>Desired Price with Concession</strong></td>
                                <td>Enter desired Final price to calculate required concession</td>
                                <td><span class="badge required-badge">Required*</span></td>
                            </tr>
                            <tr>
                                <td><strong>Supporting Documents</strong></td>
                                <td>Click Add files to upload (Price Match Form if applicable)</td>
                                <td><span class="badge required-badge">Required</span></td>
                            </tr>
                            <tr>
                                <td><strong>Comments</strong></td>
                                <td>Justification for price concession and/or lock desk notes</td>
                                <td><span class="badge required-badge">Required</span></td>
                            </tr>
                        </tbody>
                    </table>
                    <p style="color: var(--text-muted); font-size: 0.85rem; margin-top: 10px;">* Enter either Amount OR Desired Price - not both</p>

                    <div class="info-box">
                        <h4>Approval Process</h4>
                        <p>An email is automatically generated and sent to the approver with the appropriate authority. The Loan Officer will receive an email once the price concession is approved and applied in the system.</p>
                    </div>
                </div>
            </section>

            <!-- Section 6: Post-Lock Changes -->
            <section id="section-6" class="section">
                <div class="section-header">
                    <div class="section-number">6</div>
                    <div class="section-title"><h2>Post-Lock Changes</h2><span>Profile changes on locked loans</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Click Profile Change</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">Make Changes on OB Search</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Click Submit</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Review Side-by-Side Comparison</div>
                        </div>
                    </div>

                    <ul class="step-list">
                        <li><strong>Step 1:</strong> In Clear, click <strong>Profile Change</strong> on the Pricing Screen</li>
                        <li><strong>Step 2:</strong> Make desired changes on the OB Search screen (loan amount, property type, appraised value, product/program)</li>
                        <li><strong>Step 3:</strong> When satisfied with terms, click <strong>Submit</strong></li>
                        <li><strong>Step 4:</strong> OB displays a summary of changes side-by-side with original loan structure</li>
                        <li><strong>Step 5:</strong> Select desired interest rate from the note stack and click <strong>Select</strong></li>
                        <li><strong>Step 6:</strong> Click <strong>Submit</strong> at top of page to re-commit the loan with changes</li>
                    </ul>

                    <div class="info-box">
                        <h4>Profile Change Use Cases</h4>
                        <p>Profile changes are used to modify locked loans, particularly fields that may affect pricing or product eligibility. This includes loan program changes, such as moving from FHA to Conventional or vice versa.</p>
                    </div>

                    <div class="exception-box">
                        <h4>Changes Do Not Auto-Update</h4>
                        <p>Search results changes in fields in OB do <strong>not</strong> automatically update the file when the loan is locked, <strong>except</strong> when performed as a Profile Change on a locked loan. Re-run the Search for qualifying products.</p>
                    </div>
                </div>
            </section>

            <!-- Section 7: Lock Extension -->
            <section id="section-7" class="section">
                <div class="section-header">
                    <div class="section-number">7</div>
                    <div class="section-title"><h2>Lock Extension</h2><span>Extend the lock period on a locked loan</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Select Lock Extension</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">Enter # of Days</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Review Cost Impact</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Click Apply</div>
                        </div>
                    </div>

                    <ul class="step-list">
                        <li><strong>Step 1:</strong> Select <strong>Lock Extension</strong> from within the Pricing screen</li>
                        <li><strong>Step 2:</strong> Enter the desired number of days to extend</li>
                        <li><strong>Step 3:</strong> Review the calculated cost and impact on Price, Lock Days, Lock Expiration, and Discount/Rebate</li>
                        <li><strong>Step 4:</strong> Click <strong>Apply</strong> to confirm the extension</li>
                    </ul>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Field</th>
                                <th>Current Value</th>
                                <th>With Extension</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Price</strong></td>
                                <td>Current locked price</td>
                                <td><span class="badge calculated-badge">Adjusted</span></td>
                            </tr>
                            <tr>
                                <td><strong>Lock Days</strong></td>
                                <td>Original lock period</td>
                                <td><span class="badge calculated-badge">+ Extension Days</span></td>
                            </tr>
                            <tr>
                                <td><strong>Lock Expiration</strong></td>
                                <td>Original expiration date</td>
                                <td><span class="badge calculated-badge">New Date</span></td>
                            </tr>
                            <tr>
                                <td><strong>Discount/Rebate</strong></td>
                                <td>Current amount</td>
                                <td><span class="badge calculated-badge">Adjusted for Cost</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Section 8: Float Down -->
            <section id="section-8" class="section">
                <div class="section-header">
                    <div class="section-number">8</div>
                    <div class="section-title"><h2>Float Down</h2><span>Take advantage of improved market rates</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Select Float Down</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Click Single Lock Period Tab</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Click Program Name</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Click Select</div>
                        </div>
                    </div>

                    <ul class="step-list">
                        <li><strong>Step 1:</strong> Select <strong>Float Down</strong> from within the Pricing Screen</li>
                        <li><strong>Step 2:</strong> Click the <strong>Single Lock Period</strong> tab</li>
                        <li><strong>Step 3:</strong> Click the program name to expand the note stack</li>
                        <li><strong>Step 4:</strong> Click <strong>Select</strong> for the desired rate</li>
                    </ul>

                    <div class="info-box">
                        <h4>Review Page</h4>
                        <p>OB displays a review page that lets you confirm the change details and ensure it benefits the borrower. The page shows original values vs. changed values, adjustment reasons, and notes/advisories.</p>
                    </div>

                    <div class="exception-box">
                        <h4>Policy Compliance Required</h4>
                        <p>Consult the <strong>Retail Lending Lock Desk Policy</strong> to confirm the float-down meets policy requirements. Optimal Blue does <strong>not</strong> evaluate whether a float down is valid or "worth it" to the customer. The float-down fee is included in the pricing.</p>
                    </div>
                </div>
            </section>

            <!-- Section 9: Re-Lock -->
            <section id="section-9" class="section">
                <div class="section-header">
                    <div class="section-number">9</div>
                    <div class="section-title"><h2>Re-Lock</h2><span>Relock an expired rate lock</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Select Relock</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Select First Lien</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Click Select Rate and Price</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Click Request Lock</div>
                        </div>
                    </div>

                    <ul class="step-list">
                        <li><strong>Step 1:</strong> Select <strong>Relock</strong> on a loan with an expired rate lock</li>
                        <li><strong>Step 2:</strong> Select <strong>First Lien</strong></li>
                        <li><strong>Step 3:</strong> Click <strong>Select Rate and Price</strong></li>
                        <li><strong>Step 4:</strong> Select the desired interest rate from the note stack and click the <strong>Lock icon</strong></li>
                        <li><strong>Step 5:</strong> Review the summary comparing changes to Original Lock</li>
                        <li><strong>Step 6:</strong> Click <strong>Request Lock</strong></li>
                    </ul>

                    <div class="exception-box">
                        <h4>Worst-Case Pricing</h4>
                        <p>Re-locked loans are based on <strong>worst-case pricing</strong> between the original lock date and current market rates. Final pricing includes all prior extension and/or relock fees. The original lock term will be used to determine pricing.</p>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Days</th>
                                <th>Relock Fee</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>10 days</td>
                                <td>0.000</td>
                            </tr>
                            <tr>
                                <td>21 days</td>
                                <td>0.125</td>
                            </tr>
                            <tr>
                                <td>30 days</td>
                                <td>0.250</td>
                            </tr>
                            <tr>
                                <td>45 days</td>
                                <td>0.375</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="tip-box">
                        <h4>Policy Reference</h4>
                        <p>Please consult the <strong>Retail Lending Lock Desk Policy</strong> for the full relock policy. OB has built-in logic based on the re-lock policy and will identify original locked pricing vs. current pricing.</p>
                    </div>
                </div>
            </section>

            <!-- Quick Reference -->
            <div id="quick-ref" class="quick-ref">
                <h3>Pricing Quick Reference</h3>
                <pre>
OPTIMAL BLUE PRICING SUMMARY
============================

ACCESS METHODS
--------------
Clear: Pricing shortcut > Search
Byte:  Pricing and Lock Request > Submit as Loan Officer

PRICING MODES
-------------
Pricing Tab:      Full functionality, data syncs to LOS
What if Pricing:  Scenario testing, NO data sync to LOS

LOCK OPTIONS
------------
Request Lock:           Lock the rate
Update LOS:             Save without locking (float)
Request Lock + Concession: Lock with price adjustment

PRICE CONCESSION TYPES
----------------------
Net LC:      Price improvement, reduces discount points
General LC:  Lump-sum credit on LE/CD (cannot be removed once disclosed)

POST-LOCK CHANGE OPTIONS
------------------------
Option          | Description                    | Use Case
----------------|--------------------------------|----------------------------------
Profile Change  | Modify locked loan fields      | Program change, loan amount, etc.
Price Concession| Request price improvement      | Competitive match, lender credit
Lock Extension  | Extend lock expiration         | Closing delays
Float Down      | Take lower rate if available   | Market improvement
Relock          | Relock expired lock            | Lock expired before closing

RELOCK FEE SCHEDULE
-------------------
Days    | Fee
--------|--------
10 days | 0.000
21 days | 0.125
30 days | 0.250
45 days | 0.375

IMPORTANT REMINDERS
===================
- Changes in OB DO push back to unlocked loans
- Profile Changes on locked loans update the file
- Always verify terms before clicking Submit
- Consult Lock Desk Policy for relock/float-down rules
- PMI quotes in OB are estimates - use LOS for exact quotes

EXTENDED RATE LOCK
==================
Clear: Loan > URLA > Loan Features > Extended Rate Lock - OB
Byte:  Loan > Pricing and Lock > Extended Rate Lock - OB
See Extended Rate Lock Fee Procedure for full details
                </pre>
            </div>
        </div>

        <!-- ==================== AI AGENTS TAB ==================== -->
        <div id="agents-panel" class="tab-panel">
            <!-- Agent Header -->
            <div class="agent-header">
                <h1>AI Agent Opportunities</h1>
                <p class="subtitle">Automation opportunities identified for the Optimal Blue Pricing process</p>
            </div>

            <!-- Summary Stats -->
            <div class="agent-summary" id="agent-summary">
                <div class="agent-summary-card">
                    <div class="agent-summary-value">5</div>
                    <div class="agent-summary-label">Agent Opportunities</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">68%</div>
                    <div class="agent-summary-label">Automation Potential</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">12 min</div>
                    <div class="agent-summary-label">Est. Time Saved</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">High</div>
                    <div class="agent-summary-label">Revenue Impact</div>
                </div>
            </div>

            <!-- Heat Map Legend -->
            <div class="heat-legend">
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #ef4444, #f97316);"></div>
                    <span>Critical Priority (9-10)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #f97316, #eab308);"></div>
                    <span>High Priority (7-8)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #eab308, #22c55e);"></div>
                    <span>Medium Priority (5-6)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #22c55e, #14b8a6);"></div>
                    <span>Low Priority (1-4)</span>
                </div>
            </div>

            <!-- Heat Map Grid -->
            <div class="heat-map-container" id="agent-heatmap">
                <div class="heat-map-title">Priority Heat Map</div>
                <div class="heat-map-grid">
                    <div class="heat-item critical" onclick="scrollToAgent('agent-ratewatch')">
                        <div class="heat-score">9.4</div>
                        <div class="heat-name">Rate Watch Agent</div>
                        <div class="heat-desc">Monitor rates and alert LOs to float-down opportunities</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>5 min</span></div>
                            <div class="heat-metric">Complexity: <span>Medium</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-scenario')">
                        <div class="heat-score">8.2</div>
                        <div class="heat-name">Scenario Builder</div>
                        <div class="heat-desc">Auto-generate optimal pricing scenarios</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>3 min</span></div>
                            <div class="heat-metric">Complexity: <span>Medium</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-lockexp')">
                        <div class="heat-score">7.8</div>
                        <div class="heat-name">Lock Expiration Monitor</div>
                        <div class="heat-desc">Alert before locks expire to prevent relock fees</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>N/A</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                    <div class="heat-item medium" onclick="scrollToAgent('agent-concession')">
                        <div class="heat-score">6.5</div>
                        <div class="heat-name">Concession Analyzer</div>
                        <div class="heat-desc">Evaluate competitive pricing and recommend concessions</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>2 min</span></div>
                            <div class="heat-metric">Complexity: <span>High</span></div>
                        </div>
                    </div>
                    <div class="heat-item medium" onclick="scrollToAgent('agent-pmi')">
                        <div class="heat-score">5.8</div>
                        <div class="heat-name">PMI Optimizer</div>
                        <div class="heat-desc">Auto-quote PMI and recommend best provider</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>2 min</span></div>
                            <div class="heat-metric">Complexity: <span>Medium</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agent Details -->
            <div id="agent-details">
                <h2 style="color: var(--text-primary); margin-bottom: 25px; font-size: 1.5rem;">Agent Details</h2>
                <div class="agent-grid">
                    <!-- Rate Watch Agent -->
                    <div class="agent-card" id="agent-ratewatch">
                        <div class="agent-card-header">
                            <div class="agent-icon">R</div>
                            <div class="agent-info">
                                <div class="agent-name">Rate Watch Agent</div>
                                <div class="agent-type">Market Monitoring / Alerts</div>
                            </div>
                            <span class="agent-priority critical">Critical</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Continuously monitors market rates against locked loans and proactively alerts Loan Officers when float-down opportunities arise that could benefit borrowers, ensuring no savings opportunities are missed.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Monitor Rates</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Compare to Locks</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Calculate Savings</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Alert LO</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">5 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">$800</div>
                                    <div class="agent-stat-label">Avg Savings</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Med</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('ratewatch')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Scenario Builder Agent -->
                    <div class="agent-card" id="agent-scenario">
                        <div class="agent-card-header">
                            <div class="agent-icon">S</div>
                            <div class="agent-info">
                                <div class="agent-name">Scenario Builder Agent</div>
                                <div class="agent-type">Pricing Optimization</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Automatically generates optimal pricing scenarios based on borrower profile, analyzing different down payment amounts, loan types, and products to find the best options without manual configuration.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Read Loan Data</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Generate Scenarios</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Price All</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Rank & Present</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">3 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">95%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Med</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('scenario')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Lock Expiration Monitor -->
                    <div class="agent-card" id="agent-lockexp">
                        <div class="agent-card-header">
                            <div class="agent-icon">L</div>
                            <div class="agent-info">
                                <div class="agent-name">Lock Expiration Monitor</div>
                                <div class="agent-type">Monitoring / Prevention</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Monitors all locked loans and sends proactive alerts before lock expiration to prevent costly relock fees. Calculates optimal extension timing and cost-benefit analysis.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Scan Locks</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Check Closing Date</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Calculate Risk</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Send Alert</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">$1,200</div>
                                    <div class="agent-stat-label">Fees Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">99%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('lockexp')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Concession Analyzer -->
                    <div class="agent-card" id="agent-concession">
                        <div class="agent-card-header">
                            <div class="agent-icon">C</div>
                            <div class="agent-info">
                                <div class="agent-name">Concession Analyzer</div>
                                <div class="agent-type">Competitive Analysis</div>
                            </div>
                            <span class="agent-priority medium">Medium</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Analyzes competitive pricing data and borrower situation to recommend optimal price concessions, auto-populating the Competitive Price Match Request Form with supporting documentation.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Analyze Competitor</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Calculate Gap</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Generate Form</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Submit Request</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">2 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">85%</div>
                                    <div class="agent-stat-label">Approval Rate</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">High</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('concession')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- PMI Optimizer -->
                    <div class="agent-card" id="agent-pmi">
                        <div class="agent-card-header">
                            <div class="agent-icon">P</div>
                            <div class="agent-info">
                                <div class="agent-name">PMI Optimizer Agent</div>
                                <div class="agent-type">Insurance Optimization</div>
                            </div>
                            <span class="agent-priority medium">Medium</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Automatically requests PMI quotes from all available providers, compares rates and terms, and recommends the optimal PMI option for the borrower's situation.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Get Loan Data</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Request Quotes</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Compare Options</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Recommend Best</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">2 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">$45</div>
                                    <div class="agent-stat-label">Avg Mo. Savings</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Med</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('pmi')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Documentation Modal -->
    <div class="modal-overlay" id="docModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Pricing Manual Workflow Documentation</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyToClipboard()">Copy</button>
                    <button class="modal-btn close" onclick="closeDocModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <pre id="docContent"># Pricing Manual - Optimal Blue

## Overview
Complete guide for pricing loans, locking rates, and managing post-lock changes in Optimal Blue Product and Pricing Engine (PPE).

## Access Methods

### From Clear
1. Click the Pricing shortcut
2. Two tabs: Pricing (default) and What if Pricing
3. Click Search for full pricing functions

### From Byte
1. Select Pricing and Lock Request form
2. Click Submit as Loan Officer
3. Leave on Pricing, click Submit

## Key Functions

### Lock the Loan
1. Select rate from note stack
2. Click Proceed to Lock Form
3. Enter Lock Contact Email
4. Click Request Lock

### Update LOS (Float)
- Click Update LOS to save without locking

### Request Lock with Concession
- Net LC: Price improvement, reduces discount points
- General LC: Lump-sum credit (cannot remove once disclosed)
- Price Match: Requires Competitive Price Match Request Form

## Post-Lock Options

### Profile Change
- Modify locked loan fields affecting pricing/eligibility
- Side-by-side comparison before committing

### Lock Extension
- Extend lock period
- Fee impacts price/rebate

### Float Down
- Take advantage of improved market rates
- Includes float-down fee

### Relock
- Relock expired locks
- Worst-case pricing applies
- Relock fees: 10d=0.000, 21d=0.125, 30d=0.250, 45d=0.375

## Important Notes
- Changes in OB push back to unlocked loans
- Consult Lock Desk Policy for relock/float-down rules
- PMI quotes in OB are estimates only</pre>
            </div>
        </div>
    </div>

    <!-- AI Prompt Modal -->
    <div class="modal-overlay prompt-modal" id="promptModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="promptModalTitle">AI Agent Build Prompt</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyPromptToClipboard()">Copy Prompt</button>
                    <button class="modal-btn close" onclick="closePromptModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="prompt-tags" id="promptTags"></div>
                <div class="prompt-section">
                    <h4>Agent Purpose</h4>
                    <div class="prompt-box" id="promptPurpose"></div>
                </div>
                <div class="prompt-section">
                    <h4>Full Build Prompt</h4>
                    <div class="prompt-box" id="promptContent"></div>
                </div>
                <div class="prompt-section">
                    <h4>Integration Points</h4>
                    <div class="prompt-box" id="promptIntegration"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="copy-success" id="copySuccess">Copied to clipboard!</div>

    <script>
        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));

            if (tab === 'workflow') {
                document.querySelector('.sidebar-tab:not(.agent-tab)').classList.add('active');
                document.getElementById('workflow-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'block';
                document.getElementById('agents-nav').style.display = 'none';
            } else {
                document.querySelector('.sidebar-tab.agent-tab').classList.add('active');
                document.getElementById('agents-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'none';
                document.getElementById('agents-nav').style.display = 'block';
            }

            window.scrollTo(0, 0);
        }

        // Scroll spy with isScrolling flag and 1000ms timeout
        const sections = document.querySelectorAll('.section, .quick-ref');
        const navItems = document.querySelectorAll('#workflow-nav .nav-item');
        let isScrolling = false;
        let scrollTimeout;

        function updateActiveNav() {
            if (isScrolling) return;

            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                if (window.scrollY >= sectionTop) current = section.getAttribute('id');
            });
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + current) item.classList.add('active');
            });
        }

        // Handle nav click to temporarily disable scroll spy
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                isScrolling = true;
                clearTimeout(scrollTimeout);

                // Remove active from all, add to clicked
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');

                // Re-enable scroll spy after 1000ms
                scrollTimeout = setTimeout(() => {
                    isScrolling = false;
                }, 1000);
            });
        });

        window.addEventListener('scroll', updateActiveNav);

        // Modal
        function openDocModal() {
            document.getElementById('docModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeDocModal() {
            document.getElementById('docModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyToClipboard() {
            try {
                await navigator.clipboard.writeText(document.getElementById('docContent').textContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeDocModal(); closePromptModal(); } });
        document.getElementById('docModal').addEventListener('click', (e) => { if (e.target.id === 'docModal') closeDocModal(); });

        document.addEventListener('DOMContentLoaded', () => { updateActiveNav(); });

        // Scroll to agent card and highlight
        function scrollToAgent(agentId) {
            const agentCard = document.getElementById(agentId);
            if (agentCard) {
                document.querySelectorAll('.agent-card.highlight').forEach(card => {
                    card.classList.remove('highlight');
                });

                agentCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

                setTimeout(() => {
                    agentCard.classList.add('highlight');
                }, 300);

                setTimeout(() => {
                    agentCard.classList.remove('highlight');
                }, 2500);
            }
        }

        // Agent Prompt System
        const agentPrompts = {
            ratewatch: {
                name: 'Rate Watch Agent',
                tags: ['Market Monitoring', 'Alerts', 'Medium Complexity', 'Critical Priority'],
                purpose: `This agent continuously monitors market rates against all locked loans in the pipeline and proactively alerts Loan Officers when float-down opportunities arise that could benefit borrowers, ensuring no savings opportunities are missed and improving customer satisfaction.`,
                prompt: `You are building a Market Monitoring Agent for CMG Financial's Optimal Blue pricing process.

AGENT NAME: Rate Watch Agent
TYPE: Market Monitoring / Push Notifications

OBJECTIVE:
Monitor real-time market rates against all locked loans and alert Loan Officers when float-down opportunities arise that meet policy thresholds.

MONITORING LOGIC:
1. Pull current OB rates every 15 minutes
2. Compare against all locked loans in pipeline
3. Calculate potential savings (rate diff * loan amount * factor)
4. Filter by float-down policy eligibility
5. Trigger alerts when savings exceed threshold

ALERT THRESHOLDS:
- Minimum rate improvement: 0.125%
- Minimum dollar savings: $500
- Days until closing: > 7 days
- Float-down fee consideration: Net benefit positive

DATA SOURCES:
- Optimal Blue rate feed API
- LOS locked loan database
- Lock expiration dates
- Float-down policy rules

ALERT MESSAGE FORMAT:
{
  "loan_number": "2026-001234",
  "borrower_name": "John Smith",
  "current_rate": "7.125%",
  "available_rate": "6.875%",
  "rate_improvement": "0.250%",
  "monthly_savings": "$125.00",
  "total_savings": "$45,000",
  "float_down_fee": "-$1,200",
  "net_benefit": "$43,800",
  "action": "Float-down recommended"
}

ERROR HANDLING:
- API timeout: Retry with exponential backoff
- Rate data stale: Alert ops team
- Policy conflict: Flag for manual review`,
                integration: `INTEGRATION POINTS:
1. Optimal Blue API
   - Real-time rate polling
   - Locked loan data sync
   - Float-down submission

2. LOS Integration
   - Locked loan pipeline query
   - Closing date tracking
   - Loan officer assignments

3. Notification Services
   - Email alerts with action buttons
   - Mobile push notifications
   - Dashboard widgets

4. Analytics
   - Track float-down conversion rate
   - Calculate savings delivered
   - LO response time metrics`
            },
            scenario: {
                name: 'Scenario Builder Agent',
                tags: ['Pricing Optimization', 'Automation', 'Medium Complexity', 'High Priority'],
                purpose: `This agent automatically generates optimal pricing scenarios based on borrower profile, analyzing different down payment amounts, loan types, and products to find the best options without manual configuration, saving LOs time and ensuring comprehensive pricing analysis.`,
                prompt: `You are building a Pricing Optimization Agent for CMG Financial's Optimal Blue pricing process.

AGENT NAME: Scenario Builder Agent
TYPE: Pricing Automation / Optimization

OBJECTIVE:
Automatically generate and price multiple loan scenarios to identify optimal options for the borrower without manual scenario creation.

SCENARIO GENERATION RULES:
1. Base Scenario: Current loan parameters
2. Down Payment Variations: 5%, 10%, 15%, 20%, 25%
3. Product Types: Conv 30yr, Conv 15yr, FHA, VA (if eligible)
4. Rate Types: Fixed, 5/1 ARM, 7/1 ARM

INPUT DATA:
- Purchase price / Appraised value
- Down payment amount
- Credit score
- DTI ratios
- Property type
- Occupancy
- VA/FHA eligibility

OPTIMIZATION CRITERIA:
1. Lowest monthly payment
2. Lowest total cost (fees + interest over 5 years)
3. Lowest upfront cash required
4. Best rate/price combination

OUTPUT FORMAT:
{
  "scenarios": [
    {
      "name": "Conv 20% Down - 30yr Fixed",
      "rate": "6.875%",
      "payment": "$2,850",
      "closing_costs": "$8,500",
      "cash_to_close": "$108,500",
      "total_5yr_cost": "$179,500",
      "recommendation": "Best for long-term savings"
    }
  ],
  "top_recommendation": "scenario_id",
  "comparison_matrix": {...}
}

PROCESSING:
1. Generate all valid scenario combinations
2. Submit batch pricing request to OB
3. Filter ineligible results
4. Rank by optimization criteria
5. Present top 5 options with comparison`,
                integration: `INTEGRATION POINTS:
1. Optimal Blue API
   - Batch scenario submission
   - Product eligibility check
   - Rate retrieval

2. LOS Data
   - Borrower profile
   - Property details
   - Income/asset data

3. Presentation Layer
   - Comparison grid
   - Visual charts
   - PDF export for borrower

4. Learning System
   - Track which scenarios convert
   - Improve recommendations over time`
            },
            lockexp: {
                name: 'Lock Expiration Monitor',
                tags: ['Monitoring', 'Prevention', 'Low Complexity', 'High Priority'],
                purpose: `This agent monitors all locked loans and sends proactive alerts before lock expiration to prevent costly relock fees. It calculates optimal extension timing and provides cost-benefit analysis to help LOs make informed decisions.`,
                prompt: `You are building a Prevention Agent for CMG Financial's Optimal Blue pricing process.

AGENT NAME: Lock Expiration Monitor
TYPE: Monitoring / Cost Prevention

OBJECTIVE:
Prevent lock expirations and associated relock fees by proactively alerting stakeholders and recommending optimal actions.

MONITORING LOGIC:
1. Daily scan of all locked loans
2. Calculate days until lock expiration
3. Compare to estimated closing date
4. Factor in processing time buffer (5 days)
5. Determine risk level and recommended action

ALERT SCHEDULE:
- 14 days out: INFO - Lock status update
- 10 days out: WARNING - Closing timeline review
- 7 days out: URGENT - Extension decision required
- 3 days out: CRITICAL - Immediate action needed
- 1 day out: EMERGENCY - Lock expires tomorrow

RISK CALCULATION:
{
  "lock_expiration": "2026-02-15",
  "estimated_closing": "2026-02-20",
  "buffer_days": 5,
  "gap": -10, // negative = at risk
  "risk_level": "HIGH",
  "recommended_action": "Extend 7 days",
  "extension_cost": "$1,125",
  "relock_cost_if_expires": "$2,250",
  "savings": "$1,125"
}

ESCALATION MATRIX:
- Day 14-10: LO only
- Day 10-7: LO + Processor
- Day 7-3: LO + Processor + Manager
- Day 3-0: All + Lock Desk

AUTOMATED ACTIONS:
- Generate extension request draft
- Calculate optimal extension days
- Pre-fill forms with loan data`,
                integration: `INTEGRATION POINTS:
1. LOS Database
   - Lock dates
   - Estimated closing dates
   - Milestone tracking

2. Optimal Blue
   - Extension pricing
   - Relock fee schedule
   - Lock status

3. Notifications
   - Tiered alerting
   - Escalation workflows
   - Acknowledgment tracking

4. Reporting
   - Locks saved from expiration
   - Cost avoidance metrics
   - Response time analytics`
            },
            concession: {
                name: 'Concession Analyzer',
                tags: ['Competitive Analysis', 'Document Generation', 'High Complexity', 'Medium Priority'],
                purpose: `This agent analyzes competitive pricing data and borrower situation to recommend optimal price concessions, auto-populating the Competitive Price Match Request Form with supporting documentation and justification.`,
                prompt: `You are building a Competitive Analysis Agent for CMG Financial's Optimal Blue pricing process.

AGENT NAME: Concession Analyzer
TYPE: Competitive Intelligence / Document Automation

OBJECTIVE:
Analyze competitive pricing scenarios and auto-generate price concession requests with supporting documentation to maximize approval rates.

ANALYSIS INPUTS:
- Competitor Loan Estimate (uploaded)
- CMG current pricing
- Borrower profile strength
- Historical concession data
- Market conditions

COMPETITIVE GAP ANALYSIS:
{
  "competitor_rate": "6.750%",
  "competitor_price": "100.500",
  "cmg_rate": "6.750%",
  "cmg_price": "99.875",
  "price_gap": "0.625",
  "dollar_gap": "$2,812.50",
  "recommendation": "Request Net LC of 0.625"
}

FORM AUTO-POPULATION:
1. Extract competitor data from uploaded LE
2. Map to Price Match Request Form fields
3. Generate justification narrative
4. Calculate requested concession amount
5. Attach supporting documentation

JUSTIFICATION TEMPLATE:
"Borrower has received competitive offer from [Lender]
at [Rate] with [Price]. Gap analysis shows [Dollar Amount]
difference. Borrower profile: [FICO], [LTV], [DTI].
Market data supports competitive adjustment.
Recommended concession: [Amount] as [Net/General LC]."

APPROVAL PREDICTION:
- Score request likelihood (1-10)
- Flag potential issues
- Suggest modifications to improve odds`,
                integration: `INTEGRATION POINTS:
1. Document Processing
   - OCR competitor LE
   - Extract rate/price data
   - Parse fee breakdown

2. Optimal Blue
   - Current CMG pricing
   - Concession submission
   - Status tracking

3. Form Generation
   - PDF form filling
   - Digital signature prep
   - Auto-attachment

4. Analytics
   - Approval rate by type
   - Average concession amount
   - Competitive win rate`
            },
            pmi: {
                name: 'PMI Optimizer Agent',
                tags: ['Insurance Optimization', 'API Integration', 'Medium Complexity', 'Medium Priority'],
                purpose: `This agent automatically requests PMI quotes from all available providers, compares rates and terms, and recommends the optimal PMI option for the borrower's situation, including considerations for BPMI vs LPMI vs single premium.`,
                prompt: `You are building an Insurance Optimization Agent for CMG Financial's Optimal Blue pricing process.

AGENT NAME: PMI Optimizer Agent
TYPE: Insurance Comparison / Recommendation

OBJECTIVE:
Automatically obtain and compare PMI quotes from all approved providers to identify the optimal mortgage insurance option for each borrower.

PMI PROVIDERS:
1. MGIC
2. Radian
3. Essent
4. National MI
5. Arch MI
6. Genworth

QUOTE REQUEST DATA:
{
  "loan_amount": 450000,
  "property_value": 500000,
  "ltv": 90,
  "fico": 720,
  "dti": 38,
  "loan_type": "Conventional",
  "occupancy": "Primary",
  "property_type": "SFR"
}

COMPARISON MATRIX:
{
  "provider": "MGIC",
  "monthly_premium": "$185.00",
  "annual_rate": "0.49%",
  "upfront_premium": "$0",
  "cancellation_policy": "80% LTV auto-cancel",
  "total_cost_5yr": "$11,100",
  "recommendation_score": 8.5
}

PMI TYPE ANALYSIS:
1. BPMI (Borrower-Paid): Monthly premium
2. LPMI (Lender-Paid): Higher rate, no monthly
3. Single Premium: One-time upfront (financed or cash)
4. Split Premium: Combination approach

OPTIMIZATION FACTORS:
- Monthly payment impact
- Total cost over expected ownership
- Tax deductibility (if applicable)
- Cancellation timeline
- Cash-to-close impact`,
                integration: `INTEGRATION POINTS:
1. PMI Provider APIs
   - Real-time quote requests
   - Rate card updates
   - Eligibility verification

2. Optimal Blue
   - PMI quote tool
   - Scenario pricing with PMI

3. LOS Integration
   - Auto-populate selected PMI
   - Update loan fees
   - Document MI selection

4. Reporting
   - Provider performance
   - Average savings delivered
   - Quote conversion rates`
            }
        };

        // Show agent prompt modal
        let currentPromptContent = '';

        function showAgentPrompt(agentKey) {
            const agent = agentPrompts[agentKey];
            if (!agent) return;

            document.getElementById('promptModalTitle').textContent = agent.name + ' - Build Prompt';

            const tagsHtml = agent.tags.map(tag => '<span class="prompt-tag">' + tag + '</span>').join('');
            document.getElementById('promptTags').innerHTML = tagsHtml;

            document.getElementById('promptPurpose').textContent = agent.purpose;
            document.getElementById('promptContent').textContent = agent.prompt;
            document.getElementById('promptIntegration').textContent = agent.integration;

            currentPromptContent = '# ' + agent.name + '\n\n## Purpose\n' + agent.purpose + '\n\n## Build Prompt\n' + agent.prompt + '\n\n## Integration Points\n' + agent.integration;

            document.getElementById('promptModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closePromptModal() {
            document.getElementById('promptModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyPromptToClipboard() {
            try {
                await navigator.clipboard.writeText(currentPromptContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) {
                alert('Failed to copy prompt.');
            }
        }

        document.getElementById('promptModal').addEventListener('click', (e) => {
            if (e.target.id === 'promptModal') closePromptModal();
        });
    </script>
</body>
</html>
