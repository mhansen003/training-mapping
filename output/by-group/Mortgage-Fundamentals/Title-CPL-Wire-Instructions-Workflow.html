<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preliminary Title, CPL & Wire Instructions - Process Workflow</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: #111827;
            --bg-card: #1a2234;
            --accent-blue: #3b82f6;
            --accent-teal: #14b8a6;
            --accent-amber: #f59e0b;
            --accent-rose: #f43f5e;
            --accent-green: #22c55e;
            --accent-purple: #8b5cf6;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-subtle: rgba(255,255,255,0.08);
            --sidebar-width: 280px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Breadcrumb */
        .breadcrumb {
            background: linear-gradient(90deg, #0d1525 0%, #1a2234 100%);
            padding: 14px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
            border-bottom: 1px solid var(--border-subtle);
        }

        .breadcrumb a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            transition: all 0.2s;
            border: 1px solid var(--border-subtle);
        }

        .breadcrumb a:hover {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .breadcrumb .separator { color: var(--text-muted); font-size: 1.2rem; }
        .breadcrumb .current { color: var(--accent-amber); font-weight: 600; padding: 8px 16px; }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 54px;
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - 54px);
            background: var(--bg-secondary);
            overflow-y: auto;
            z-index: 1000;
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 25px 20px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-header h2 { color: var(--text-primary); font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
        .sidebar-header p { color: var(--text-muted); font-size: 0.85rem; }

        /* Tab Switch */
        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-tab {
            flex: 1;
            padding: 14px 10px;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            background: none;
            border-left: none;
            border-right: none;
            border-top: none;
        }

        .sidebar-tab:hover { background: rgba(255,255,255,0.03); color: var(--text-secondary); }
        .sidebar-tab.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); background: rgba(59, 130, 246, 0.08); }
        .sidebar-tab.agent-tab.active { color: var(--accent-purple); border-bottom-color: var(--accent-purple); background: rgba(139, 92, 246, 0.08); }

        .sidebar-nav { padding: 15px 0; flex: 1; overflow-y: auto; }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .nav-item:hover { background: rgba(255,255,255,0.03); color: var(--text-primary); }
        .nav-item.active { background: rgba(59, 130, 246, 0.1); border-left-color: var(--accent-blue); color: var(--text-primary); }

        .nav-number {
            background: rgba(255,255,255,0.1);
            color: var(--text-secondary);
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .nav-item.active .nav-number { background: var(--accent-blue); color: white; }
        .nav-label { font-size: 0.95rem; font-weight: 500; }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-subtle);
            background: rgba(0,0,0,0.2);
        }

        .doc-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px 20px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .doc-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3); }

        /* Main Content */
        .main-content { margin-left: var(--sidebar-width); padding: 80px 40px 40px 40px; }

        /* Tab Panels */
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        .header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(20, 184, 166, 0.08) 0%, transparent 50%);
            pointer-events: none;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        .header .meta { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; position: relative; }

        .header .meta-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-subtle);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); }
        .legend-color { width: 18px; height: 18px; border-radius: 4px; }

        /* Sections */
        .section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            margin-bottom: 25px;
            overflow: hidden;
            scroll-margin-top: 75px;
        }

        .section-header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(59, 130, 246, 0.1) 100%);
            border-bottom: 1px solid var(--border-subtle);
            padding: 22px 25px;
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .section-number {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .section-title h2 { font-size: 1.35rem; font-weight: 700; margin-bottom: 4px; color: var(--text-primary); }
        .section-title span { font-size: 0.9rem; color: var(--text-muted); }
        .section-content { padding: 28px; }

        /* Workflow Diagrams */
        .workflow-diagram {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 28px;
            margin-bottom: 22px;
        }

        .flow-row { display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 12px; margin: 15px 0; }

        .flow-node {
            padding: 14px 22px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            min-width: 150px;
            border: 1px solid var(--border-subtle);
        }

        .flow-node.start { background: linear-gradient(135deg, var(--accent-green) 0%, #16a34a 100%); color: white; border-radius: 25px; border: none; }
        .flow-node.action { background: linear-gradient(135deg, var(--accent-blue) 0%, #2563eb 100%); color: white; border: none; }
        .flow-node.decision { background: linear-gradient(135deg, var(--accent-amber) 0%, #d97706 100%); color: var(--bg-primary); border: none; }
        .flow-node.input { background: var(--bg-secondary); border: 2px solid var(--accent-blue); color: var(--text-primary); }
        .flow-node.output { background: linear-gradient(135deg, var(--accent-teal) 0%, #0d9488 100%); color: white; border: none; }
        .flow-node.exception { background: linear-gradient(135deg, var(--accent-rose) 0%, #dc2626 100%); color: white; border: none; }

        .flow-arrow { color: var(--accent-blue); font-size: 1.5rem; }
        .flow-arrow.down { transform: rotate(90deg); }

        .decision-branch { display: flex; gap: 40px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
        .branch { display: flex; flex-direction: column; align-items: center; gap: 10px; }

        .branch-label {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        /* Tables */
        .field-table { width: 100%; border-collapse: collapse; margin: 18px 0; }

        .field-table th {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            padding: 14px 18px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border-subtle);
        }

        .field-table td { padding: 14px 18px; border-bottom: 1px solid var(--border-subtle); color: var(--text-secondary); }
        .field-table tr:hover { background: rgba(255,255,255,0.02); }

        .badge { display: inline-block; padding: 4px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge.required-badge { background: rgba(244, 63, 94, 0.15); color: var(--accent-rose); }
        .badge.optional-badge { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .badge.calculated-badge { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }

        /* Info Boxes */
        .exception-box, .tip-box, .info-box {
            padding: 18px 22px;
            margin: 18px 0;
            border-radius: 0 10px 10px 0;
            border-left-width: 4px;
            border-left-style: solid;
        }

        .exception-box { background: rgba(244, 63, 94, 0.08); border-color: var(--accent-rose); border: 1px solid rgba(244, 63, 94, 0.2); border-left: 4px solid var(--accent-rose); }
        .exception-box h4 { color: var(--accent-rose); margin-bottom: 10px; font-size: 1rem; }
        .exception-box p, .exception-box li { color: var(--text-secondary); }

        .tip-box { background: rgba(34, 197, 94, 0.08); border-color: var(--accent-green); border: 1px solid rgba(34, 197, 94, 0.2); border-left: 4px solid var(--accent-green); }
        .tip-box h4 { color: var(--accent-green); margin-bottom: 10px; font-size: 1rem; }
        .tip-box p, .tip-box li { color: var(--text-secondary); }

        .info-box { background: rgba(59, 130, 246, 0.08); border-color: var(--accent-blue); border: 1px solid rgba(59, 130, 246, 0.2); border-left: 4px solid var(--accent-blue); }
        .info-box h4 { color: var(--accent-blue); margin-bottom: 10px; font-size: 1rem; }
        .info-box p, .info-box li { color: var(--text-secondary); }

        /* Decision Tree */
        .decision-tree {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 22px;
            margin: 22px 0;
        }

        .decision-tree h3 { color: var(--accent-blue); margin-bottom: 18px; padding-bottom: 12px; border-bottom: 1px solid var(--border-subtle); font-size: 1.1rem; }

        .tree-node { margin-left: 20px; padding: 12px; border-left: 2px solid var(--accent-teal); position: relative; color: var(--text-secondary); }
        .tree-node::before { content: ''; position: absolute; left: -2px; top: 22px; width: 15px; height: 2px; background: var(--accent-teal); }
        .tree-node.level-1 { margin-left: 0; border-left: none; }
        .tree-node.level-1::before { display: none; }

        .tree-label { background: var(--accent-amber); color: var(--bg-primary); padding: 6px 14px; border-radius: 6px; font-weight: 700; display: inline-block; margin-bottom: 6px; font-size: 0.9rem; }

        /* Summary Grid */
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 18px; margin: 22px 0; }

        .summary-card { background: rgba(0,0,0,0.3); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 22px; text-align: center; }
        .summary-card h4 { color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9rem; }
        .summary-card .value {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .summary-card .label { font-size: 0.85rem; color: var(--text-muted); margin-top: 8px; }

        /* MI Comparison Cards */
        .mi-comparison { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 22px 0; }

        .mi-card { background: rgba(0,0,0,0.2); border: 1px solid var(--border-subtle); border-radius: 12px; overflow: hidden; }
        .mi-card-header { background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%); color: white; padding: 18px; text-align: center; }
        .mi-card-header h4 { font-size: 1.05rem; }
        .mi-card-body { padding: 22px; }
        .mi-card ul { list-style: none; padding: 0; }
        .mi-card li { padding: 10px 0; border-bottom: 1px solid var(--border-subtle); display: flex; align-items: center; gap: 12px; color: var(--text-secondary); font-size: 0.95rem; }
        .mi-card li:last-child { border-bottom: none; }
        .check-icon { color: var(--accent-green); font-weight: bold; }
        .x-icon { color: var(--accent-rose); font-weight: bold; }

        /* Quick Reference */
        .quick-ref {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
            border: 1px solid var(--border-subtle);
            padding: 28px;
            border-radius: 16px;
            margin-top: 30px;
            font-family: 'JetBrains Mono', monospace;
            scroll-margin-top: 75px;
        }

        .quick-ref h3 { color: var(--accent-amber); margin-bottom: 18px; font-family: 'Plus Jakarta Sans', sans-serif; }
        .quick-ref pre { background: rgba(0,0,0,0.4); border: 1px solid var(--border-subtle); padding: 20px; border-radius: 10px; overflow-x: auto; font-size: 0.85rem; line-height: 1.7; color: var(--text-secondary); }

        /* Step List */
        .step-list { list-style: none; padding: 0; margin: 18px 0; }
        .step-list li {
            padding: 14px 18px;
            border-left: 3px solid var(--accent-blue);
            background: rgba(0,0,0,0.2);
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
        }
        .step-list li strong { color: var(--text-primary); }

        /* ====== AGENT OPPORTUNITIES STYLES ====== */
        .agent-header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .agent-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(139, 92, 246, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .agent-header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        /* Heat Map */
        .heat-map-container { margin-bottom: 35px; }
        .heat-map-title { font-size: 1.3rem; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }

        .heat-map-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .heat-item {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .heat-item:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .heat-item:active { transform: scale(0.98); }

        .heat-item::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 4px;
        }

        .heat-item.critical::before { background: linear-gradient(90deg, #ef4444, #f97316); }
        .heat-item.high::before { background: linear-gradient(90deg, #f97316, #eab308); }
        .heat-item.medium::before { background: linear-gradient(90deg, #eab308, #22c55e); }
        .heat-item.low::before { background: linear-gradient(90deg, #22c55e, #14b8a6); }

        .heat-score {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.8rem;
            font-weight: 800;
        }

        .heat-item.critical .heat-score { color: #ef4444; }
        .heat-item.high .heat-score { color: #f97316; }
        .heat-item.medium .heat-score { color: #eab308; }
        .heat-item.low .heat-score { color: #22c55e; }

        .heat-name { font-size: 1rem; font-weight: 700; color: var(--text-primary); margin-bottom: 6px; padding-right: 50px; }
        .heat-desc { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; }

        .heat-metrics { display: flex; gap: 15px; margin-top: 12px; }
        .heat-metric { font-size: 0.75rem; color: var(--text-muted); }
        .heat-metric span { color: var(--text-secondary); font-weight: 600; }

        /* Agent Cards */
        .agent-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 25px; margin-bottom: 35px; }

        .agent-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .agent-card:hover { transform: translateY(-5px); box-shadow: 0 15px 50px rgba(0,0,0,0.3); }

        .agent-card.highlight {
            animation: highlightPulse 2s ease;
            box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.4);
        }

        @keyframes highlightPulse {
            0% { box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.6); }
            50% { box-shadow: 0 0 0 6px rgba(139, 92, 246, 0.5), 0 15px 50px rgba(139, 92, 246, 0.3); }
            100% { box-shadow: 0 0 0 0px transparent, 0 15px 50px rgba(0,0,0,0.3); }
        }

        .agent-card-header {
            padding: 22px;
            display: flex;
            align-items: flex-start;
            gap: 18px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .agent-icon {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            flex-shrink: 0;
        }

        .agent-info { flex: 1; }
        .agent-name { font-size: 1.15rem; font-weight: 700; color: var(--text-primary); margin-bottom: 5px; }
        .agent-type { font-size: 0.8rem; color: var(--accent-purple); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-priority {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .agent-priority.critical { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .agent-priority.high { background: rgba(249, 115, 22, 0.15); color: #f97316; }
        .agent-priority.medium { background: rgba(234, 179, 8, 0.15); color: #eab308; }
        .agent-priority.low { background: rgba(34, 197, 94, 0.15); color: #22c55e; }

        .agent-card-body { padding: 22px; }
        .agent-description { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; }

        .agent-flow {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 20px;
        }

        .agent-flow-title { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-flow-diagram { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; justify-content: center; }

        .agent-step {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .agent-arrow { color: var(--accent-purple); font-size: 1.2rem; }

        .agent-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }

        .agent-stat {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .agent-stat-value {
            font-size: 1.3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-top: 4px; }

        /* View Prompt Button */
        .agent-prompt-btn {
            width: 100%;
            margin-top: 18px;
            padding: 14px 20px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 10px;
            color: var(--accent-purple);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .agent-prompt-btn:hover {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(59, 130, 246, 0.3) 100%);
            border-color: var(--accent-purple);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.25);
        }

        /* Summary Stats */
        .agent-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .agent-summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            padding: 25px;
            text-align: center;
        }

        .agent-summary-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-summary-label { font-size: 0.9rem; color: var(--text-muted); margin-top: 8px; }

        /* Heat Map Legend */
        .heat-legend {
            display: flex;
            gap: 25px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .heat-legend-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; color: var(--text-secondary); }
        .heat-legend-color { width: 24px; height: 24px; border-radius: 6px; }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(10, 15, 26, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.show { display: flex; }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            width: 100%;
            max-width: 950px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 80px rgba(0,0,0,0.5);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            padding: 22px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 16px 16px 0 0;
        }

        .modal-header h3 { font-size: 1.25rem; font-weight: 700; }
        .modal-actions { display: flex; gap: 12px; }

        .modal-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: transform 0.2s;
            font-size: 0.9rem;
        }

        .modal-btn:hover { transform: scale(1.05); }
        .modal-btn.copy { background: white; color: var(--accent-blue); }
        .modal-btn.close { background: rgba(255,255,255,0.2); color: white; }

        .modal-body { padding: 28px; overflow-y: auto; flex: 1; }

        .modal-body pre {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            padding: 22px;
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.7;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--text-secondary);
        }

        .copy-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--accent-green);
            color: white;
            padding: 18px 35px;
            border-radius: 10px;
            font-weight: 700;
            z-index: 3000;
            display: none;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut { 0%, 100% { opacity: 0; } 10%, 90% { opacity: 1; } }

        /* Prompt Modal */
        .prompt-modal .modal { max-width: 800px; }
        .prompt-modal .modal-header { background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%); }

        .prompt-section { margin-bottom: 25px; }
        .prompt-section h4 { color: var(--accent-purple); font-size: 1rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }

        .prompt-box {
            background: rgba(0,0,0,0.4);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.7;
            color: var(--text-secondary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .prompt-tags { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .prompt-tag { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 75px 20px 30px 20px; }
            .agent-grid { grid-template-columns: 1fr; }
        }
            .breadcrumb-logo-link { display: flex; align-items: center; padding: 4px 8px; background: rgba(255,255,255,0.08); border-radius: 8px; border: 1px solid rgba(255,255,255,0.12); transition: all 0.2s; }
        .breadcrumb-logo-link:hover { background: rgba(255,255,255,0.15); }
        .breadcrumb-logo { height: 28px; width: auto; }
    </style>
</head>
<body>
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <a href="../../index.html" class="breadcrumb-logo-link"><img src="../../images/clear-ai-logo.png" alt="Clear AI" class="breadcrumb-logo"></a>
        <a href="../../index.html">Portal Home</a>
        <span class="separator">></span>
        <a href="./index.html">Mortgage Fundamentals</a>
        <span class="separator">></span>
        <span class="current">Preliminary Title, CPL & Wire Instructions</span>
    </nav>

    <!-- Fixed Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>Title & CPL Guide</h2>
            <p>Interactive Workflow Guide</p>
        </div>

        <!-- Tab Switcher -->
        <div class="sidebar-tabs">
            <button class="sidebar-tab active" onclick="switchTab('workflow')">Workflow</button>
            <button class="sidebar-tab agent-tab" onclick="switchTab('agents')">AI Agents</button>
        </div>

        <!-- Workflow Navigation -->
        <nav class="sidebar-nav" id="workflow-nav">
            <a href="#section-1" class="nav-item active">
                <span class="nav-number">1</span>
                <span class="nav-label">What is Preliminary Title?</span>
            </a>
            <a href="#section-2" class="nav-item">
                <span class="nav-number">2</span>
                <span class="nav-label">Schedule A Review</span>
            </a>
            <a href="#section-3" class="nav-item">
                <span class="nav-number">3</span>
                <span class="nav-label">Vesting Types</span>
            </a>
            <a href="#section-4" class="nav-item">
                <span class="nav-number">4</span>
                <span class="nav-label">Schedule B Requirements</span>
            </a>
            <a href="#section-5" class="nav-item">
                <span class="nav-number">5</span>
                <span class="nav-label">Liens & Exceptions</span>
            </a>
            <a href="#section-6" class="nav-item">
                <span class="nav-number">6</span>
                <span class="nav-label">Schedule B-2 Exceptions</span>
            </a>
            <a href="#section-7" class="nav-item">
                <span class="nav-number">7</span>
                <span class="nav-label">Byte Data Entry</span>
            </a>
            <a href="#section-8" class="nav-item">
                <span class="nav-number">8</span>
                <span class="nav-label">CPL Requirements</span>
            </a>
            <a href="#section-9" class="nav-item">
                <span class="nav-number">9</span>
                <span class="nav-label">Wire Instructions</span>
            </a>
            <a href="#quick-ref" class="nav-item">
                <span class="nav-number">*</span>
                <span class="nav-label">Quick Reference</span>
            </a>
        </nav>

        <!-- Agent Navigation -->
        <nav class="sidebar-nav" id="agents-nav" style="display: none;">
            <a href="#agent-summary" class="nav-item active">
                <span class="nav-number">S</span>
                <span class="nav-label">Summary</span>
            </a>
            <a href="#agent-heatmap" class="nav-item">
                <span class="nav-number">H</span>
                <span class="nav-label">Heat Map</span>
            </a>
            <a href="#agent-details" class="nav-item">
                <span class="nav-number">A</span>
                <span class="nav-label">Agent Details</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="doc-btn" onclick="openDocModal()">
                View Workflow Markdown
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

        <!-- ==================== WORKFLOW TAB ==================== -->
        <div id="workflow-panel" class="tab-panel active">
            <!-- Header -->
            <div class="header">
                <h1>Preliminary Title, CPL & Wire Instructions</h1>
                <p class="subtitle">Complete guide for reviewing preliminary title reports, closing protection letters, and wire instructions</p>
                <div class="meta">
                    <span class="meta-item">System: Byte LOS</span>
                    <span class="meta-item">Role: Processor</span>
                    <span class="meta-item">Updated: Mar 23, 2021</span>
                    <span class="meta-item">Duration: 15-30 min per loan</span>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #22c55e, #16a34a);"></div><span>Start/End</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></div><span>Action Step</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></div><span>Decision Point</span></div>
                <div class="legend-item"><div class="legend-color" style="background: #111827; border: 2px solid #3b82f6;"></div><span>User Input</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f43f5e, #dc2626);"></div><span>Exception/Hard Stop</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #14b8a6, #0d9488);"></div><span>Output</span></div>
            </div>

            <!-- Section 1: What is Preliminary Title -->
            <section id="section-1" class="section">
                <div class="section-header">
                    <div class="section-number">1</div>
                    <div class="section-title"><h2>What is a Preliminary Title Report?</h2><span>Understanding title reports and title insurance fundamentals</span></div>
                </div>
                <div class="section-content">
                    <div class="info-box">
                        <h4>Definition</h4>
                        <p>The Preliminary Title Report (sometimes referred to as a Title Commitment) is the result of a title search on a property and is a required step before a mortgage loan (purchase or refinance) can be approved. It establishes legal ownership of the property and contains the conditions under which the title company will issue a title insurance policy.</p>
                    </div>

                    <div class="decision-tree">
                        <h3>What Does a Prelim Report Show?</h3>
                        <ul class="step-list">
                            <li><strong>Purchase:</strong> Proves seller is rightful owner and lists any mortgages/liens and claims against property for unpaid debts (property taxes, income taxes)</li>
                            <li><strong>Refinance:</strong> Reports any existing judgments, liens, and mortgages on the property</li>
                            <li><strong>First Lien Position:</strong> CMG requires the Title Company to ensure our interests are in first lien position - no other liens paid before ours in foreclosure</li>
                        </ul>
                    </div>

                    <div class="mi-comparison">
                        <div class="mi-card">
                            <div class="mi-card-header"><h4>Lender's Title Insurance</h4></div>
                            <div class="mi-card-body">
                                <ul>
                                    <li><span class="check-icon">+</span> Protects lender against title problems</li>
                                    <li><span class="check-icon">+</span> Covers legal claims against the home</li>
                                    <li><span class="check-icon">+</span> Only protects lender interests</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mi-card">
                            <div class="mi-card-header"><h4>Owner's Title Insurance</h4></div>
                            <div class="mi-card-body">
                                <ul>
                                    <li><span class="check-icon">+</span> Protects homeowner if someone sues</li>
                                    <li><span class="check-icon">+</span> Covers claims from before purchase</li>
                                    <li><span class="check-icon">+</span> Optional but recommended</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="tip-box">
                        <h4>Possible Title Defects Covered</h4>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>Errors or omissions in deeds</li>
                            <li>Mistakes in examining records</li>
                            <li>Forgery</li>
                            <li>Undisclosed or missing heirs</li>
                            <li>Liens for unpaid taxes</li>
                            <li>Liens by contractors</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 2: Schedule A Review -->
            <section id="section-2" class="section">
                <div class="section-header">
                    <div class="section-number">2</div>
                    <div class="section-title"><h2>Schedule A Review</h2><span>The "Who, What, and Where" of the property</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Open Prelim Report</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Review Schedule A</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">All Info Correct?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">YES</span>
                                <div class="flow-node output">Proceed to Schedule B</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">NO</span>
                                <div class="flow-node exception">Contact Title for Correction</div>
                            </div>
                        </div>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Schedule A Item</th>
                                <th>Description</th>
                                <th>Verification</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Commitment Date</strong></td>
                                <td>Date report was completed and public records examined</td>
                                <td><span class="badge required-badge">Enter in Byte</span></td>
                            </tr>
                            <tr>
                                <td><strong>Proposed Insured</strong></td>
                                <td>Purchase: Lender and Buyer | Refinance: Lender only (owner's policy blank)</td>
                                <td><span class="badge required-badge">Verify CMG Mortgage Inc.</span></td>
                            </tr>
                            <tr>
                                <td><strong>Policy Amount</strong></td>
                                <td>Loan amount for lender's policy</td>
                                <td><span class="badge required-badge">Must Match Loan</span></td>
                            </tr>
                            <tr>
                                <td><strong>Current Vested Owner</strong></td>
                                <td>Name(s) of current property owner(s)</td>
                                <td><span class="badge required-badge">Verify Against File</span></td>
                            </tr>
                            <tr>
                                <td><strong>Legal Description</strong></td>
                                <td>Property as reflected in public records</td>
                                <td><span class="badge required-badge">Match to Byte/Appraisal</span></td>
                            </tr>
                            <tr>
                                <td><strong>APN Number</strong></td>
                                <td>Assessor's Parcel Number</td>
                                <td><span class="badge required-badge">Must Match Appraisal</span></td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="exception-box">
                        <h4>Condo Properties</h4>
                        <p>If property is a condo, legal description will reflect "unit". Refer to the 'Condo Review Submission Procedure' checklist to ensure you have everything needed to submit to the Condo Review Department.</p>
                    </div>

                    <div class="info-box">
                        <h4>Types of Estate</h4>
                        <p>The estate type indicates the degree, quantity, nature, duration, or extent of interest in the land:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>Fee Simple (A Fee):</strong> Most common - owner owns land and structures, can sell, give away, trade, lease, or pass upon death</li>
                            <li><strong>Leasehold:</strong> Right to use land for predetermined time via ground lease; reverts to Lessor at end</li>
                            <li><strong>Life Estate:</strong> Ownership limited to someone's lifetime; cannot alienate property or allow waste</li>
                        </ul>
                    </div>

                    <div class="exception-box">
                        <h4>Life Estate Alert</h4>
                        <p>If you see that a refinance is in a Life Estate - please escalate to Credit Policy for requirements.</p>
                    </div>
                </div>
            </section>

            <!-- Section 3: Vesting Types -->
            <section id="section-3" class="section">
                <div class="section-header">
                    <div class="section-number">3</div>
                    <div class="section-title"><h2>Vesting Types</h2><span>Understanding how owners hold title to property</span></div>
                </div>
                <div class="section-content">
                    <div class="info-box">
                        <h4>Refinance Vesting Check</h4>
                        <p>If the transaction is a refinance, the Borrower's name should match the currently vested name in the preliminary report. If there are any discrepancies, confirm with the Borrower who should remain on the Deed.</p>
                    </div>

                    <div class="decision-tree">
                        <h3>Sole Ownership Types</h3>
                        <ul class="step-list">
                            <li><strong>Single/Unmarried/Widow(er):</strong> Not legally married or in domestic partnership. Example: "Bruce Buyer, a single man"</li>
                            <li><strong>Married as Sole & Separate Property:</strong> Married person acquiring title alone. Spouse must disclaim/relinquish rights. Example: "Bruce Buyer, a married man, as his sole and separate property"</li>
                            <li><strong>Domestic Partner as Sole & Separate:</strong> Same as married - partner must disclaim rights</li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Co-Ownership Types</h3>
                        <ul class="step-list">
                            <li><strong>Community Property:</strong> Owned together by married persons or domestic partners. Distinguished from separate property acquired before marriage/partnership</li>
                            <li><strong>Community Property with Right of Survivorship:</strong> On death, decedent's interest ends and survivor owns all interests</li>
                            <li><strong>Joint Tenancy:</strong> Two or more persons in equal interests with right of survivorship. Must be acquired same time, same conveyance. Not subject to disposition by will</li>
                            <li><strong>Tenancy in Common:</strong> Two or more individuals in undivided fractional interests (can be unequal). Each can sell, lease, or will their share independently</li>
                        </ul>
                    </div>

                    <div class="tip-box">
                        <h4>Trust Vesting</h4>
                        <p>If the borrower(s) will be vesting in a Trust at closing, you will need to request a copy of the Trust Agreement and the Underwriter & Closer will complete the 'Trust Review Checklist'.</p>
                    </div>

                    <div class="exception-box">
                        <h4>Joint Tenancy with Non-Spouse</h4>
                        <p>If a married person enters into a joint tenancy that does not include their spouse, the title company may require the spouse to specifically consent to the joint tenancy. Same rules apply for same-sex married couples and domestic partners.</p>
                    </div>
                </div>
            </section>

            <!-- Section 4: Schedule B Requirements -->
            <section id="section-4" class="section">
                <div class="section-header">
                    <div class="section-number">4</div>
                    <div class="section-title"><h2>Schedule B - Section I Requirements</h2><span>Items that must be addressed prior to or at closing</span></div>
                </div>
                <div class="section-content">
                    <div class="info-box">
                        <h4>Requirements Section Overview</h4>
                        <p>Schedule B Section I lists all things that must be addressed prior to or at closing:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>Paying off taxes</li>
                            <li>Paying off seller's existing mortgages</li>
                            <li>Releasing liens on the title</li>
                            <li>Recording the new deed and any new loan documents</li>
                            <li>Correcting any errors in the title</li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Property Taxes</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 15px;">Tax information is always shown as the first item because taxes have priority over all other matters.</p>
                        <ul class="step-list">
                            <li><strong>Current Status:</strong> Depending on location, taxes can be paid annually, semi-annually, or quarterly - shown as Paid or Due</li>
                            <li><strong>Delinquent Taxes:</strong> If unpaid, taxing authority places a lien on property with "superior" status - must be paid before any other liens if property is sold</li>
                        </ul>
                    </div>

                    <div class="exception-box">
                        <h4>Property Tax Handling</h4>
                        <ul style="margin-left: 20px;">
                            <li><strong>Refinances:</strong> Obtain proof of status from borrower(s). Is it paid up to date and just not reflected on title yet? If not, the Underwriter must include a PTF condition for it to be paid off at closing.</li>
                            <li><strong>Purchase:</strong> Proceed - It is title's responsibility to make sure sellers pay PTF</li>
                        </ul>
                    </div>

                    <div class="mi-comparison">
                        <div class="mi-card">
                            <div class="mi-card-header"><h4>Purchase Requirements</h4></div>
                            <div class="mi-card-body">
                                <ul>
                                    <li><span class="check-icon">+</span> Liens being paid by existing owner</li>
                                    <li><span class="check-icon">+</span> New recorded Deed for purchaser</li>
                                    <li><span class="check-icon">+</span> Property taxes due</li>
                                    <li><span class="check-icon">+</span> 24-month Chain of Title</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mi-card">
                            <div class="mi-card-header"><h4>Refinance Requirements</h4></div>
                            <div class="mi-card-body">
                                <ul>
                                    <li><span class="check-icon">+</span> Delinquent property taxes</li>
                                    <li><span class="check-icon">+</span> Liens to be paid off or subordinated</li>
                                    <li><span class="check-icon">+</span> Proposed lien to be recorded</li>
                                    <li><span class="check-icon">+</span> 24-month chain of title</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 5: Liens & Exceptions -->
            <section id="section-5" class="section">
                <div class="section-header">
                    <div class="section-number">5</div>
                    <div class="section-title"><h2>Liens & Common Title Issues</h2><span>Understanding and resolving lien types on title</span></div>
                </div>
                <div class="section-content">
                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Lien Type</th>
                                <th>Description</th>
                                <th>Action Required</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Deed of Trust</strong></td>
                                <td>Agreement between lender (Beneficiary) and borrower (Trustor) with Title Company as Trustee</td>
                                <td><span class="badge required-badge">Check if 2nd DOT - verify payoff or subordination</span></td>
                            </tr>
                            <tr>
                                <td><strong>Subordination</strong></td>
                                <td>Ranking home loans by order of importance</td>
                                <td><span class="badge required-badge">Refi: Obtain subordination agreement from 2nd lien holder</span></td>
                            </tr>
                            <tr>
                                <td><strong>TX A6</strong></td>
                                <td>Cash out refi on primary home in Texas</td>
                                <td><span class="badge required-badge">Check guidelines for year restrictions</span></td>
                            </tr>
                            <tr>
                                <td><strong>SBA Loans</strong></td>
                                <td>Small Business Association loans</td>
                                <td><span class="badge required-badge">SBA prefers payoff at closing; will subordinate in certain situations</span></td>
                            </tr>
                            <tr>
                                <td><strong>Mechanic's Lien</strong></td>
                                <td>Lien from contractor for unpaid work</td>
                                <td><span class="badge required-badge">Refi: Pay off or add to liabilities + subordinate</span></td>
                            </tr>
                            <tr>
                                <td><strong>Federal/State Tax Lien</strong></td>
                                <td>Government claim for unpaid taxes</td>
                                <td><span class="badge required-badge">Per guidelines: payoff at closing or payment plan in liabilities</span></td>
                            </tr>
                            <tr>
                                <td><strong>Abstract of Judgment</strong></td>
                                <td>Lien on all real property until satisfied</td>
                                <td><span class="badge required-badge">Must be paid off at close</span></td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="exception-box">
                        <h4>HARD STOPS - Cannot Lend</h4>
                        <ul style="margin-left: 20px;">
                            <li><strong>Notice of Action (Lis Pendens):</strong> Lawsuit pending that affects property ownership - Cannot lend if Purchase or Refinance. Can show up on Loansafe.</li>
                            <li><strong>Bankruptcy:</strong> Proceeding in U.S. Bankruptcy Court - Cannot lend if Purchase or Refinance. Can show up on credit report or Loansafe.</li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Solar Panel/Clean Energy Liens (PACE/HERO)</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 15px;">Property Assessed Clean Energy loans provide 100% financing for energy-efficient products. Most common in California and Florida.</p>
                        <ul class="step-list">
                            <li><strong>Important:</strong> Some loans are paid back through property taxes and are considered a tax lien - takes first priority in default</li>
                            <li><strong>Action:</strong> Immediately refer to 'Leased and Solar PPA checklist' to confirm eligibility</li>
                            <li><strong>Request:</strong> Copy of Solar/Energy Efficient Lien Agreement</li>
                        </ul>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Loan Type</th>
                                <th>Solar Lien Requirements</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Conventional</strong></td>
                                <td>Must include solar lease payments in DTI</td>
                            </tr>
                            <tr>
                                <td><strong>FHA</strong></td>
                                <td>Property value cannot include unowned equipment value; lease must have no restrictions on conveyance</td>
                            </tr>
                            <tr>
                                <td><strong>VA</strong></td>
                                <td>Leased panels get no value in appraisal; HERO/PACE liens paid through taxes NOT acceptable for VA</td>
                            </tr>
                            <tr>
                                <td><strong>USDA</strong></td>
                                <td>Follows FHA: max 4 hookups and requires tests</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Section 6: Schedule B-2 Exceptions -->
            <section id="section-6" class="section">
                <div class="section-header">
                    <div class="section-number">6</div>
                    <div class="section-title"><h2>Schedule B-2 Exceptions</h2><span>Items tied to the property that transfer with ownership</span></div>
                </div>
                <div class="section-content">
                    <div class="info-box">
                        <h4>What Are Exceptions?</h4>
                        <p>Schedule B-2 exceptions are items tied to the subject property that will remain of record and transfer with the property. The buyer's rights will be subject to these conditions.</p>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Exception Type</th>
                                <th>Description</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Easements</strong></td>
                                <td>Right of someone else to use, privilege, or benefit upon the land. Most common: Public Utilities</td>
                                <td><span class="badge optional-badge">Review for impact</span></td>
                            </tr>
                            <tr>
                                <td><strong>CC&Rs</strong></td>
                                <td>Covenants, Conditions, and Restrictions - limitations on property use (single family, one-story, etc.)</td>
                                <td><span class="badge optional-badge">Review for marketability</span></td>
                            </tr>
                            <tr>
                                <td><strong>Deed Restrictions</strong></td>
                                <td>Rules about the property (vehicles, pets, fencing, colors, home businesses, building requirements)</td>
                                <td><span class="badge optional-badge">Review appraisal for marketability</span></td>
                            </tr>
                            <tr>
                                <td><strong>Encroachments</strong></td>
                                <td>Neighbor built something on/overhanging property (fences, gardens, trees, garages)</td>
                                <td><span class="badge optional-badge">Title reviews survey; review appraisal for marketability</span></td>
                            </tr>
                            <tr>
                                <td><strong>Right of First Refusal</strong></td>
                                <td>Provision giving party right to buy before seller negotiates other offers</td>
                                <td><span class="badge required-badge">Obtain copy of contract/CC&Rs - verify terms don't affect marketability</span></td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="decision-tree">
                        <h3>Chain of Title & Flips</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 15px;">The Chain of Title shows property ownership in the last 24 months.</p>
                        <ul class="step-list">
                            <li><strong>Flip Transaction:</strong> If ownership changed in last 6 months, refer to product guidelines</li>
                            <li><strong>Conventional:</strong> No flip rules at this time</li>
                            <li><strong>FHA/VA:</strong> Flips not allowed before 90 days. For 91-180 days see guidelines for restrictions</li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Private Roads</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 15px;">Roads not maintained by state - maintained by property owners or HOA.</p>
                        <ul class="step-list">
                            <li><strong>Action:</strong> Request copy of Recorded Road Maintenance Agreement</li>
                            <li><strong>HOA/PUD:</strong> Request CC&Rs - usually states HOA maintains road</li>
                            <li><strong>Exception:</strong> FHA & Freddie Mac do not require Road Maintenance Agreement review at this time</li>
                            <li><strong>Requirement:</strong> Property must have safe pedestrian access and adequate vehicular access from public or private street</li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Shared Well Agreement</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 15px;">Contract regarding drilling, maintenance, and use of a well. Number of parcel numbers indicates hookups.</p>
                        <ul class="step-list">
                            <li><strong>Conventional:</strong> No limit on hookups</li>
                            <li><strong>FHA:</strong> Max 4 hookups, requires tests</li>
                            <li><strong>VA:</strong> No limit, requires tests</li>
                            <li><strong>USDA:</strong> Follows FHA - max 4 hookups, requires tests</li>
                        </ul>
                    </div>

                    <div class="tip-box">
                        <h4>Affidavit of Affixture</h4>
                        <p>A recorded legal document certifying a manufactured home is permanently affixed to the land, making it "real property" required for financing. Obtain a copy from title if doing a refinance or purchase of a manufactured home.</p>
                    </div>
                </div>
            </section>

            <!-- Section 7: Byte Data Entry -->
            <section id="section-7" class="section">
                <div class="section-header">
                    <div class="section-number">7</div>
                    <div class="section-title"><h2>Requirements to Enter into Byte</h2><span>Data entry from preliminary report to Byte LOS</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Open Prelim in Stored Docs</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Navigate to Doc Prep Screen</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Enter Title Company Info</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Verify All Fields</div>
                        </div>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Byte Field</th>
                                <th>Source on Prelim</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Title Report Date</strong></td>
                                <td>Commitment Date from prelim</td>
                                <td>Doc Prep screen > Title Company section</td>
                            </tr>
                            <tr>
                                <td><strong>Title Officer Name</strong></td>
                                <td>Title Officer on prelim</td>
                                <td>Auto-populates to Parties screen</td>
                            </tr>
                            <tr>
                                <td><strong>Title Account No</strong></td>
                                <td>Escrow/Commitment/File Number</td>
                                <td>May be referred to differently on prelim</td>
                            </tr>
                            <tr>
                                <td><strong>Escrow Officer Name</strong></td>
                                <td>Escrow Officer on prelim</td>
                                <td>Auto-populates to Parties screen</td>
                            </tr>
                            <tr>
                                <td><strong>Escrow Account No</strong></td>
                                <td>From prelim</td>
                                <td>May differ from Title Account No in attorney states</td>
                            </tr>
                            <tr>
                                <td><strong>Assessors Parcel Number</strong></td>
                                <td>APN from prelim</td>
                                <td>Must match appraisal APN</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="info-box">
                        <h4>Verification Checklist</h4>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>Verify Proposed Insured reads CMG Mortgage, Inc. as new Lender</li>
                            <li>Confirm loan amount is correct</li>
                            <li>Confirm Borrower name is correct</li>
                            <li>Confirm purchase price is correct (if purchase)</li>
                            <li>Verify current vested name matches Seller on purchase contract (if purchase)</li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Trust Vesting at Closing</h3>
                        <ul class="step-list">
                            <li><strong>If NOT closing in Trust:</strong> Inform Underwriter, log note in conversation log, add to Cover Letter screen</li>
                            <li><strong>If closing in Trust:</strong> Obtain copy of revocable Trust agreement, provide to Underwriter for approval</li>
                            <li><strong>After Approval:</strong> On Closing Screen, click Trust tab, enter Trust name in Trust Name field</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 8: CPL Requirements -->
            <section id="section-8" class="section">
                <div class="section-header">
                    <div class="section-number">8</div>
                    <div class="section-title"><h2>Closing Protection Letter (CPL)</h2><span>Title Underwriter indemnification for closing agent misconduct</span></div>
                </div>
                <div class="section-content">
                    <div class="info-box">
                        <h4>What is a CPL?</h4>
                        <p>A Closing Protection Letter (CPL) is a form from the Title Insurance Underwriter to the Lender, in which the Title Insurance Underwriter agrees to indemnify the Lender for actual losses caused by certain kinds of misconduct by the closing agent.</p>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>CPL Requirement</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Addressed To</strong></td>
                                <td>CMG Mortgage Inc. as written on preliminary report request form</td>
                            </tr>
                            <tr>
                                <td><strong>Signature</strong></td>
                                <td>Signed by a representative of the Title Underwriter</td>
                            </tr>
                            <tr>
                                <td><strong>Letterhead</strong></td>
                                <td>Must be on Title Underwriter letterhead</td>
                            </tr>
                            <tr>
                                <td><strong>Party Names</strong></td>
                                <td>Must have all title holder names and property address matching Byte</td>
                            </tr>
                            <tr>
                                <td><strong>Title/Escrow Address</strong></td>
                                <td>If not on page one, addendum page may be attached with correct address</td>
                            </tr>
                            <tr>
                                <td><strong>Font Type</strong></td>
                                <td>Must appear consistent - NO typed or hand-written information added</td>
                            </tr>
                            <tr>
                                <td><strong>Legibility</strong></td>
                                <td>Must be legible and all pages present</td>
                            </tr>
                            <tr>
                                <td><strong>Expiration</strong></td>
                                <td>30 days from date issued - enter on Doc Prep screen</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="exception-box">
                        <h4>CPL Expiration Alert</h4>
                        <p>CPL Expiration date is 30 days from date issued. Enter this date on the Doc Prep screen and monitor for expiration before closing.</p>
                    </div>
                </div>
            </section>

            <!-- Section 9: Wire Instructions -->
            <section id="section-9" class="section">
                <div class="section-header">
                    <div class="section-number">9</div>
                    <div class="section-title"><h2>Wire Instructions</h2><span>Ensuring funds are sent to the correct Title Company</span></div>
                </div>
                <div class="section-content">
                    <div class="info-box">
                        <h4>Purpose</h4>
                        <p>Wire instructions ensure the money can be sent from CMG Mortgage Inc. to the Title Company at closing. The CPL and Wire Instructions must have exact information to ensure funds are sent to the correct Title Company.</p>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Wire Instruction Requirement</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Agent Name/Address Match</strong></td>
                                <td>Issuing agent's name and address on CPL must match wire instructions</td>
                            </tr>
                            <tr>
                                <td><strong>Legibility</strong></td>
                                <td>Must be legible and complete - if you can't read it, neither can Warehouse Banks for funding</td>
                            </tr>
                            <tr>
                                <td><strong>Font Consistency</strong></td>
                                <td>NO typed or hand-written information should be added</td>
                            </tr>
                            <tr>
                                <td><strong>Byte Entry</strong></td>
                                <td>Enter wire instruction information on Title and Escrow screen</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Review Wire Instructions</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Matches CPL?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">YES</span>
                                <div class="flow-node action">Enter in Byte Title/Escrow Screen</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">NO</span>
                                <div class="flow-node exception">Contact Title for Correction</div>
                            </div>
                        </div>
                    </div>

                    <div class="tip-box">
                        <h4>Power of Attorney Requirements</h4>
                        <p>If a Power of Attorney is being used for the transaction:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>Must be a Specific POA</li>
                            <li>Must reference the subject property</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Quick Reference -->
            <div id="quick-ref" class="quick-ref">
                <h3>Title Review Quick Reference</h3>
                <pre>
PRELIMINARY TITLE REVIEW CHECKLIST
===================================

SCHEDULE A - VERIFY:
[ ] Commitment Date entered in Byte
[ ] Proposed Insured = CMG Mortgage Inc.
[ ] Loan amount matches
[ ] Borrower name(s) correct
[ ] Legal description matches Byte/appraisal
[ ] APN matches appraisal
[ ] Vesting matches (refinance) or seller matches contract (purchase)

SCHEDULE B - SECTION I REQUIREMENTS:
[ ] Property taxes status (paid/due/delinquent)
[ ] All liens identified
[ ] Payoff or subordination determined for each lien
[ ] 24-month chain of title reviewed
[ ] Flip transaction check (6-month ownership change)

SCHEDULE B - SECTION II EXCEPTIONS:
[ ] Easements reviewed for impact
[ ] CC&Rs reviewed for marketability
[ ] Encroachments noted
[ ] Private road - Road Maintenance Agreement obtained
[ ] Shared well - Well Agreement obtained
[ ] Manufactured home - Affidavit of Affixture obtained

HARD STOPS (CANNOT LEND):
X  Notice of Action (Lis Pendens)
X  Bankruptcy

LIENS REQUIRING ACTION:
- Deed of Trust: Payoff or subordinate
- SBA Loan: Prefers payoff, will subordinate sometimes
- Mechanic's Lien: Payoff or subordinate + add to liabilities
- Tax Lien: Per guidelines - payoff or payment plan
- Abstract of Judgment: Must pay off at close
- Solar/PACE: Check eligibility per loan type

CLOSING PROTECTION LETTER (CPL):
[ ] Addressed to CMG Mortgage Inc.
[ ] Signed by Title Underwriter rep
[ ] On Title Underwriter letterhead
[ ] All party names match Byte
[ ] Property address matches
[ ] No hand-written additions
[ ] Legible and complete
[ ] Expiration date entered (30 days from issue)

WIRE INSTRUCTIONS:
[ ] Agent name/address matches CPL
[ ] Legible and complete
[ ] No hand-written additions
[ ] Entered in Byte Title/Escrow screen

POWER OF ATTORNEY (if applicable):
[ ] Specific POA
[ ] References subject property
                </pre>
            </div>
        </div>

        <!-- ==================== AI AGENTS TAB ==================== -->
        <div id="agents-panel" class="tab-panel">
            <!-- Agent Header -->
            <div class="agent-header">
                <h1>AI Agent Opportunities</h1>
                <p class="subtitle">Automation opportunities identified for the Title Review process</p>
            </div>

            <!-- Summary Stats -->
            <div class="agent-summary" id="agent-summary">
                <div class="agent-summary-card">
                    <div class="agent-summary-value">5</div>
                    <div class="agent-summary-label">Agent Opportunities</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">68%</div>
                    <div class="agent-summary-label">Automation Potential</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">15 min</div>
                    <div class="agent-summary-label">Est. Time Saved</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">High</div>
                    <div class="agent-summary-label">Compliance Impact</div>
                </div>
            </div>

            <!-- Heat Map Legend -->
            <div class="heat-legend">
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #ef4444, #f97316);"></div>
                    <span>Critical Priority (9-10)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #f97316, #eab308);"></div>
                    <span>High Priority (7-8)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #eab308, #22c55e);"></div>
                    <span>Medium Priority (5-6)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #22c55e, #14b8a6);"></div>
                    <span>Low Priority (1-4)</span>
                </div>
            </div>

            <!-- Heat Map Grid -->
            <div class="heat-map-container" id="agent-heatmap">
                <div class="heat-map-title">Priority Heat Map</div>
                <div class="heat-map-grid">
                    <div class="heat-item critical" onclick="scrollToAgent('agent-titleparser')">
                        <div class="heat-score">9.4</div>
                        <div class="heat-name">Title Parser Agent</div>
                        <div class="heat-desc">Auto-extract and validate Schedule A/B data</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>8 min</span></div>
                            <div class="heat-metric">Complexity: <span>High</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-liencheck')">
                        <div class="heat-score">8.5</div>
                        <div class="heat-name">Lien Checker Agent</div>
                        <div class="heat-desc">Identify and flag liens requiring action</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>5 min</span></div>
                            <div class="heat-metric">Complexity: <span>Medium</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-cplvalidator')">
                        <div class="heat-score">7.8</div>
                        <div class="heat-name">CPL Validator Agent</div>
                        <div class="heat-desc">Validate CPL against wire instructions</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>3 min</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                    <div class="heat-item medium" onclick="scrollToAgent('agent-flipdetector')">
                        <div class="heat-score">6.2</div>
                        <div class="heat-name">Flip Detector Agent</div>
                        <div class="heat-desc">Analyze chain of title for flip transactions</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>2 min</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                    <div class="heat-item medium" onclick="scrollToAgent('agent-vestingmatch')">
                        <div class="heat-score">5.8</div>
                        <div class="heat-name">Vesting Match Agent</div>
                        <div class="heat-desc">Compare vesting across loan documents</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>2 min</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agent Details -->
            <div id="agent-details">
                <h2 style="color: var(--text-primary); margin-bottom: 25px; font-size: 1.5rem;">Agent Details</h2>
                <div class="agent-grid">
                    <!-- Title Parser Agent -->
                    <div class="agent-card" id="agent-titleparser">
                        <div class="agent-card-header">
                            <div class="agent-icon">T</div>
                            <div class="agent-info">
                                <div class="agent-name">Title Parser Agent</div>
                                <div class="agent-type">Document Processing / OCR</div>
                            </div>
                            <span class="agent-priority critical">Critical</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Automatically extracts key data from preliminary title reports including Schedule A (proposed insured, vesting, legal description, APN) and Schedule B (requirements, exceptions, liens). Validates against Byte data and flags discrepancies.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Upload Prelim</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">OCR Extract</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Validate vs Byte</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Flag Issues</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">8 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">92%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">High</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('titleparser')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Lien Checker Agent -->
                    <div class="agent-card" id="agent-liencheck">
                        <div class="agent-card-header">
                            <div class="agent-icon">L</div>
                            <div class="agent-info">
                                <div class="agent-name">Lien Checker Agent</div>
                                <div class="agent-type">Risk Assessment / Compliance</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Analyzes Schedule B liens and automatically identifies hard stops (Notice of Action, Bankruptcy), liens requiring payoff, and liens that may be subordinated. Cross-references with liabilities in loan file.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Extract Liens</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Classify Type</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Check Guidelines</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Generate Actions</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">5 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">96%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Med</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('liencheck')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- CPL Validator Agent -->
                    <div class="agent-card" id="agent-cplvalidator">
                        <div class="agent-card-header">
                            <div class="agent-icon">C</div>
                            <div class="agent-info">
                                <div class="agent-name">CPL Validator Agent</div>
                                <div class="agent-type">Document Validation</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Validates Closing Protection Letter against requirements: checks addressee, signature, letterhead, party names, property address, font consistency, and calculates expiration date. Cross-validates against wire instructions.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Parse CPL</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Check Requirements</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Match to Wire</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Calculate Exp</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">3 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">99%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('cplvalidator')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Flip Detector Agent -->
                    <div class="agent-card" id="agent-flipdetector">
                        <div class="agent-card-header">
                            <div class="agent-icon">F</div>
                            <div class="agent-info">
                                <div class="agent-name">Flip Detector Agent</div>
                                <div class="agent-type">Risk Detection / Compliance</div>
                            </div>
                            <span class="agent-priority medium">Medium</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Analyzes 24-month chain of title to detect flip transactions. Calculates days since last ownership change and applies loan-type-specific guidelines (FHA 90-day rule, 91-180 day restrictions).</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Extract Chain</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Calculate Days</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Apply Rules</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Flag if Flip</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">2 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">100%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('flipdetector')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Vesting Match Agent -->
                    <div class="agent-card" id="agent-vestingmatch">
                        <div class="agent-card-header">
                            <div class="agent-icon">V</div>
                            <div class="agent-info">
                                <div class="agent-name">Vesting Match Agent</div>
                                <div class="agent-type">Data Validation</div>
                            </div>
                            <span class="agent-priority medium">Medium</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Compares vesting information across title report, loan application, and Byte. For purchases, verifies seller matches contract. For refinances, verifies borrower matches current vesting. Identifies trust vesting requiring additional documentation.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Extract Vesting</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Compare Sources</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Flag Mismatches</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Check Trust</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">2 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">98%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('vestingmatch')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Documentation Modal -->
    <div class="modal-overlay" id="docModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Title Review Workflow Documentation</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyToClipboard()">Copy</button>
                    <button class="modal-btn close" onclick="closeDocModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <pre id="docContent"># Preliminary Title, CPL & Wire Instructions - Byte LOS

## Overview
The Preliminary Title Report establishes legal ownership and lists conditions for title insurance. Required for all purchase and refinance transactions.

## Schedule A Review
- Commitment Date
- Proposed Insured (must be CMG Mortgage Inc.)
- Policy Amount (must match loan)
- Current Vested Owner
- Legal Description (must match Byte/appraisal)
- APN (must match appraisal)

## Schedule B - Requirements
- Property taxes status
- Liens to be paid off or subordinated
- 24-month chain of title
- Flip transaction check

## Hard Stops (Cannot Lend)
- Notice of Action (Lis Pendens)
- Bankruptcy

## CPL Requirements
- Addressed to CMG Mortgage Inc.
- Signed by Title Underwriter
- On Title Underwriter letterhead
- 30-day expiration from issue date

## Wire Instructions
- Must match CPL agent name/address
- Enter in Byte Title/Escrow screen</pre>
            </div>
        </div>
    </div>

    <!-- AI Prompt Modal -->
    <div class="modal-overlay prompt-modal" id="promptModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="promptModalTitle">AI Agent Build Prompt</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyPromptToClipboard()">Copy Prompt</button>
                    <button class="modal-btn close" onclick="closePromptModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="prompt-tags" id="promptTags"></div>
                <div class="prompt-section">
                    <h4>Agent Purpose</h4>
                    <div class="prompt-box" id="promptPurpose"></div>
                </div>
                <div class="prompt-section">
                    <h4>Full Build Prompt</h4>
                    <div class="prompt-box" id="promptContent"></div>
                </div>
                <div class="prompt-section">
                    <h4>Integration Points</h4>
                    <div class="prompt-box" id="promptIntegration"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="copy-success" id="copySuccess">Copied to clipboard!</div>

    <script>
        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));

            if (tab === 'workflow') {
                document.querySelector('.sidebar-tab:not(.agent-tab)').classList.add('active');
                document.getElementById('workflow-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'block';
                document.getElementById('agents-nav').style.display = 'none';
            } else {
                document.querySelector('.sidebar-tab.agent-tab').classList.add('active');
                document.getElementById('agents-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'none';
                document.getElementById('agents-nav').style.display = 'block';
            }

            window.scrollTo(0, 0);
        }

        // Scroll spy with isScrolling flag and 1000ms timeout
        const sections = document.querySelectorAll('.section, .quick-ref');
        const navItems = document.querySelectorAll('#workflow-nav .nav-item');
        let isScrolling = false;
        let scrollTimeout;

        function updateActiveNav() {
            if (isScrolling) return;

            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                if (window.scrollY >= sectionTop) current = section.getAttribute('id');
            });
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + current) item.classList.add('active');
            });
        }

        // Handle nav click to temporarily disable scroll spy
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                isScrolling = true;
                clearTimeout(scrollTimeout);

                // Remove active from all, add to clicked
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');

                // Re-enable scroll spy after 1000ms
                scrollTimeout = setTimeout(() => {
                    isScrolling = false;
                }, 1000);
            });
        });

        window.addEventListener('scroll', updateActiveNav);

        // Modal
        function openDocModal() {
            document.getElementById('docModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeDocModal() {
            document.getElementById('docModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyToClipboard() {
            try {
                await navigator.clipboard.writeText(document.getElementById('docContent').textContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeDocModal(); closePromptModal(); } });
        document.getElementById('docModal').addEventListener('click', (e) => { if (e.target.id === 'docModal') closeDocModal(); });

        document.addEventListener('DOMContentLoaded', () => { updateActiveNav(); });

        // Scroll to agent card and highlight
        function scrollToAgent(agentId) {
            const agentCard = document.getElementById(agentId);
            if (agentCard) {
                document.querySelectorAll('.agent-card.highlight').forEach(card => {
                    card.classList.remove('highlight');
                });

                agentCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

                setTimeout(() => {
                    agentCard.classList.add('highlight');
                }, 300);

                setTimeout(() => {
                    agentCard.classList.remove('highlight');
                }, 2500);
            }
        }

        // Agent Prompt System
        const agentPrompts = {
            titleparser: {
                name: 'Title Parser Agent',
                tags: ['Document Processing', 'OCR', 'High Complexity', 'Critical Priority'],
                purpose: 'Automatically extracts key data from preliminary title reports including Schedule A and Schedule B information, validates against Byte data, and flags discrepancies for processor review.',
                prompt: `You are building a Document Processing Agent for CMG Financial's Title Review process.

AGENT NAME: Title Parser Agent
TYPE: Document Processing / OCR

OBJECTIVE:
Extract and validate all key data from preliminary title reports (PDF format) and compare against Byte LOS data.

EXTRACTION TARGETS - SCHEDULE A:
- Commitment Date
- Proposed Insured (verify CMG Mortgage Inc.)
- Policy Amount (Lender's and Owner's)
- Current Vested Owner(s)
- Legal Description
- APN (Assessor's Parcel Number)
- Property Address
- Estate Type (Fee Simple, Leasehold, Life Estate)

EXTRACTION TARGETS - SCHEDULE B:
- Property Tax Status (Paid/Due/Delinquent)
- All Liens (Deeds of Trust, Judgments, Tax Liens)
- Chain of Title (24 months)
- Easements
- CC&Rs references
- Encroachments

VALIDATION RULES:
1. APN must match appraisal APN
2. Legal description must match Byte
3. Loan amount must match policy amount
4. Borrower names must match (fuzzy match OK)
5. Flag Life Estate for Credit Policy review`,
                integration: `INTEGRATION POINTS:
1. Byte LOS API - Read loan data for comparison
2. Stored Documents - Read uploaded prelim PDFs
3. OCR Service - Extract text from PDF images
4. Condition System - Auto-generate conditions for discrepancies`
            },
            liencheck: {
                name: 'Lien Checker Agent',
                tags: ['Risk Assessment', 'Compliance', 'Medium Complexity', 'High Priority'],
                purpose: 'Analyzes Schedule B liens and automatically identifies hard stops, liens requiring payoff, and liens that may be subordinated based on loan type guidelines.',
                prompt: `You are building a Compliance Agent for CMG Financial's Title Review process.

AGENT NAME: Lien Checker Agent
TYPE: Risk Assessment / Compliance

OBJECTIVE:
Identify and classify all liens on Schedule B, determine required actions based on loan type.

LIEN CLASSIFICATION:
1. HARD STOPS (Cannot Lend):
   - Notice of Action / Lis Pendens
   - Bankruptcy filings

2. MUST PAY OFF:
   - Abstract of Judgment
   - Delinquent property taxes (refinance)

3. PAY OFF OR SUBORDINATE:
   - Second Deed of Trust
   - HELOC
   - Mechanic's Lien
   - SBA Loans

4. SPECIAL HANDLING:
   - Solar/PACE liens (check loan type eligibility)
   - TX A6 (year restrictions)
   - Federal/State Tax Liens

LOAN TYPE RULES:
- FHA: PACE liens NOT acceptable
- VA: HERO/PACE paid through taxes NOT acceptable
- Conventional: Include solar lease in DTI`,
                integration: `INTEGRATION POINTS:
1. Byte Liabilities - Cross-reference existing liens
2. Product Guidelines API - Retrieve loan-type rules
3. Condition System - Generate PTF or subordination conditions
4. Alert System - Immediate notification for hard stops`
            },
            cplvalidator: {
                name: 'CPL Validator Agent',
                tags: ['Document Validation', 'Low Complexity', 'High Priority'],
                purpose: 'Validates Closing Protection Letter against all requirements and cross-validates with wire instructions to ensure funds will be sent correctly.',
                prompt: `You are building a Validation Agent for CMG Financial's Title Review process.

AGENT NAME: CPL Validator Agent
TYPE: Document Validation

OBJECTIVE:
Validate CPL meets all requirements and matches wire instructions.

CPL VALIDATION CHECKLIST:
[ ] Addressed to CMG Mortgage Inc.
[ ] Signed by Title Underwriter representative
[ ] On Title Underwriter letterhead
[ ] All party names match Byte
[ ] Property address matches
[ ] No typed/handwritten additions
[ ] Legible and complete
[ ] Calculate 30-day expiration

WIRE INSTRUCTION VALIDATION:
[ ] Agent name matches CPL
[ ] Agent address matches CPL
[ ] Bank information complete
[ ] ABA/Routing number format valid
[ ] Account number present

CROSS-VALIDATION:
- CPL issuing agent = Wire instructions recipient
- Property address consistent across documents`,
                integration: `INTEGRATION POINTS:
1. Document Parser - Extract CPL and wire instruction data
2. Byte Doc Prep Screen - Enter CPL expiration date
3. Byte Title/Escrow Screen - Enter wire instructions
4. Alert System - Notify if CPL approaching expiration`
            },
            flipdetector: {
                name: 'Flip Detector Agent',
                tags: ['Risk Detection', 'Compliance', 'Low Complexity', 'Medium Priority'],
                purpose: 'Analyzes 24-month chain of title to detect flip transactions and applies loan-type-specific guidelines.',
                prompt: `You are building a Risk Detection Agent for CMG Financial's Title Review process.

AGENT NAME: Flip Detector Agent
TYPE: Risk Detection / Compliance

OBJECTIVE:
Detect potential flip transactions by analyzing chain of title.

CHAIN OF TITLE ANALYSIS:
1. Extract all conveyances in last 24 months
2. Calculate days since each ownership change
3. Identify most recent transfer date

FLIP RULES BY LOAN TYPE:
- Conventional: No restrictions currently
- FHA: No flips before 90 days; 91-180 days special requirements
- VA: Same as FHA guidelines

FLAG CONDITIONS:
- Ownership change < 90 days: HARD STOP for FHA/VA
- Ownership change 91-180 days: WARNING - check guidelines
- Multiple transfers in 12 months: ELEVATED RISK`,
                integration: `INTEGRATION POINTS:
1. Title Parser - Receive chain of title data
2. Loan Data - Determine loan type (Conv/FHA/VA)
3. Condition System - Generate flip-related conditions
4. Alert System - Immediate notification for <90 day transfers`
            },
            vestingmatch: {
                name: 'Vesting Match Agent',
                tags: ['Data Validation', 'Low Complexity', 'Medium Priority'],
                purpose: 'Compares vesting information across title report, loan application, and Byte to identify discrepancies and trust vesting requirements.',
                prompt: `You are building a Validation Agent for CMG Financial's Title Review process.

AGENT NAME: Vesting Match Agent
TYPE: Data Validation

OBJECTIVE:
Ensure vesting consistency across all documents.

COMPARISON SOURCES:
1. Preliminary Title Report - Current vested owner
2. Loan Application (1003) - Borrower information
3. Byte LOS - Borrower and closing screens
4. Purchase Contract - Seller name (if purchase)

VALIDATION RULES:
- Purchase: Seller on title = Seller on contract
- Refinance: Borrower = Current vested owner
- Trust: Flag for Trust Agreement requirement

TRUST DETECTION:
- Keywords: "Trust", "Trustee", "Revocable"
- Action: Request Trust Agreement
- Routing: Underwriter for Trust Review Checklist`,
                integration: `INTEGRATION POINTS:
1. Title Parser - Vesting from prelim
2. Byte API - Borrower data from loan file
3. Document Storage - Retrieve purchase contract
4. Condition System - Generate trust documentation conditions`
            }
        };

        function showAgentPrompt(agentKey) {
            const agent = agentPrompts[agentKey];
            document.getElementById('promptModalTitle').textContent = agent.name + ' - Build Prompt';
            document.getElementById('promptTags').innerHTML = agent.tags.map(t => `<span class="prompt-tag">${t}</span>`).join('');
            document.getElementById('promptPurpose').textContent = agent.purpose;
            document.getElementById('promptContent').textContent = agent.prompt;
            document.getElementById('promptIntegration').textContent = agent.integration;
            document.getElementById('promptModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closePromptModal() {
            document.getElementById('promptModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyPromptToClipboard() {
            const fullPrompt = document.getElementById('promptContent').textContent + '\n\n' + document.getElementById('promptIntegration').textContent;
            try {
                await navigator.clipboard.writeText(fullPrompt);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.getElementById('promptModal').addEventListener('click', (e) => { if (e.target.id === 'promptModal') closePromptModal(); });
    </script>
</body>
</html>
