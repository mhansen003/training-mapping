<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Change of Circumstance Definitions - Process Workflow</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: #111827;
            --bg-card: #1a2234;
            --accent-blue: #3b82f6;
            --accent-teal: #14b8a6;
            --accent-amber: #f59e0b;
            --accent-rose: #f43f5e;
            --accent-green: #22c55e;
            --accent-purple: #8b5cf6;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-subtle: rgba(255,255,255,0.08);
            --sidebar-width: 280px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Breadcrumb */
        .breadcrumb {
            background: linear-gradient(90deg, #0d1525 0%, #1a2234 100%);
            padding: 14px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
            border-bottom: 1px solid var(--border-subtle);
        }

        .breadcrumb a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            transition: all 0.2s;
            border: 1px solid var(--border-subtle);
        }

        .breadcrumb a:hover {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .breadcrumb .separator { color: var(--text-muted); font-size: 1.2rem; }
        .breadcrumb .current { color: var(--accent-amber); font-weight: 600; padding: 8px 16px; }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 54px;
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - 54px);
            background: var(--bg-secondary);
            overflow-y: auto;
            z-index: 1000;
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 25px 20px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-header h2 { color: var(--text-primary); font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
        .sidebar-header p { color: var(--text-muted); font-size: 0.85rem; }

        /* Tab Switch */
        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-tab {
            flex: 1;
            padding: 14px 10px;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            background: none;
            border-left: none;
            border-right: none;
            border-top: none;
        }

        .sidebar-tab:hover { background: rgba(255,255,255,0.03); color: var(--text-secondary); }
        .sidebar-tab.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); background: rgba(59, 130, 246, 0.08); }
        .sidebar-tab.agent-tab.active { color: var(--accent-purple); border-bottom-color: var(--accent-purple); background: rgba(139, 92, 246, 0.08); }

        .sidebar-nav { padding: 15px 0; flex: 1; overflow-y: auto; }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .nav-item:hover { background: rgba(255,255,255,0.03); color: var(--text-primary); }
        .nav-item.active { background: rgba(59, 130, 246, 0.1); border-left-color: var(--accent-blue); color: var(--text-primary); }

        .nav-number {
            background: rgba(255,255,255,0.1);
            color: var(--text-secondary);
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .nav-item.active .nav-number { background: var(--accent-blue); color: white; }
        .nav-label { font-size: 0.95rem; font-weight: 500; }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-subtle);
            background: rgba(0,0,0,0.2);
        }

        .doc-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px 20px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .doc-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3); }

        /* Main Content */
        .main-content { margin-left: var(--sidebar-width); padding: 80px 40px 40px 40px; }

        /* Tab Panels */
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        .header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(20, 184, 166, 0.08) 0%, transparent 50%);
            pointer-events: none;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        .header .meta { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; position: relative; }

        .header .meta-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-subtle);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); }
        .legend-color { width: 18px; height: 18px; border-radius: 4px; }

        /* Sections */
        .section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            margin-bottom: 25px;
            overflow: hidden;
            scroll-margin-top: 75px;
        }

        .section-header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(59, 130, 246, 0.1) 100%);
            border-bottom: 1px solid var(--border-subtle);
            padding: 22px 25px;
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .section-number {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .section-title h2 { font-size: 1.35rem; font-weight: 700; margin-bottom: 4px; color: var(--text-primary); }
        .section-title span { font-size: 0.9rem; color: var(--text-muted); }
        .section-content { padding: 28px; }

        /* Workflow Diagrams */
        .workflow-diagram {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 28px;
            margin-bottom: 22px;
        }

        .flow-row { display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 12px; margin: 15px 0; }

        .flow-node {
            padding: 14px 22px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            min-width: 150px;
            border: 1px solid var(--border-subtle);
        }

        .flow-node.start { background: linear-gradient(135deg, var(--accent-green) 0%, #16a34a 100%); color: white; border-radius: 25px; border: none; }
        .flow-node.action { background: linear-gradient(135deg, var(--accent-blue) 0%, #2563eb 100%); color: white; border: none; }
        .flow-node.decision { background: linear-gradient(135deg, var(--accent-amber) 0%, #d97706 100%); color: var(--bg-primary); border: none; }
        .flow-node.input { background: var(--bg-secondary); border: 2px solid var(--accent-blue); color: var(--text-primary); }
        .flow-node.output { background: linear-gradient(135deg, var(--accent-teal) 0%, #0d9488 100%); color: white; border: none; }
        .flow-node.exception { background: linear-gradient(135deg, var(--accent-rose) 0%, #dc2626 100%); color: white; border: none; }

        .flow-arrow { color: var(--accent-blue); font-size: 1.5rem; }
        .flow-arrow.down { transform: rotate(90deg); }

        .decision-branch { display: flex; gap: 40px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
        .branch { display: flex; flex-direction: column; align-items: center; gap: 10px; }

        .branch-label {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        /* Tables */
        .field-table { width: 100%; border-collapse: collapse; margin: 18px 0; }

        .field-table th {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            padding: 14px 18px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border-subtle);
        }

        .field-table td { padding: 14px 18px; border-bottom: 1px solid var(--border-subtle); color: var(--text-secondary); }
        .field-table tr:hover { background: rgba(255,255,255,0.02); }

        .badge { display: inline-block; padding: 4px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge.required-badge { background: rgba(244, 63, 94, 0.15); color: var(--accent-rose); }
        .badge.optional-badge { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .badge.calculated-badge { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }
        .badge.common-badge { background: rgba(245, 158, 11, 0.15); color: var(--accent-amber); }

        /* Info Boxes */
        .exception-box, .tip-box, .info-box, .warning-box {
            padding: 18px 22px;
            margin: 18px 0;
            border-radius: 0 10px 10px 0;
            border-left-width: 4px;
            border-left-style: solid;
        }

        .exception-box { background: rgba(244, 63, 94, 0.08); border-color: var(--accent-rose); border: 1px solid rgba(244, 63, 94, 0.2); border-left: 4px solid var(--accent-rose); }
        .exception-box h4 { color: var(--accent-rose); margin-bottom: 10px; font-size: 1rem; }
        .exception-box p, .exception-box li { color: var(--text-secondary); }

        .tip-box { background: rgba(34, 197, 94, 0.08); border-color: var(--accent-green); border: 1px solid rgba(34, 197, 94, 0.2); border-left: 4px solid var(--accent-green); }
        .tip-box h4 { color: var(--accent-green); margin-bottom: 10px; font-size: 1rem; }
        .tip-box p, .tip-box li { color: var(--text-secondary); }

        .info-box { background: rgba(59, 130, 246, 0.08); border-color: var(--accent-blue); border: 1px solid rgba(59, 130, 246, 0.2); border-left: 4px solid var(--accent-blue); }
        .info-box h4 { color: var(--accent-blue); margin-bottom: 10px; font-size: 1rem; }
        .info-box p, .info-box li { color: var(--text-secondary); }

        .warning-box { background: rgba(245, 158, 11, 0.08); border-color: var(--accent-amber); border: 1px solid rgba(245, 158, 11, 0.2); border-left: 4px solid var(--accent-amber); }
        .warning-box h4 { color: var(--accent-amber); margin-bottom: 10px; font-size: 1rem; }
        .warning-box p, .warning-box li { color: var(--text-secondary); }

        /* Decision Tree */
        .decision-tree {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 22px;
            margin: 22px 0;
        }

        .decision-tree h3 { color: var(--accent-blue); margin-bottom: 18px; padding-bottom: 12px; border-bottom: 1px solid var(--border-subtle); font-size: 1.1rem; }

        .tree-node { margin-left: 20px; padding: 12px; border-left: 2px solid var(--accent-teal); position: relative; color: var(--text-secondary); }
        .tree-node::before { content: ''; position: absolute; left: -2px; top: 22px; width: 15px; height: 2px; background: var(--accent-teal); }
        .tree-node.level-1 { margin-left: 0; border-left: none; }
        .tree-node.level-1::before { display: none; }

        .tree-label { background: var(--accent-amber); color: var(--bg-primary); padding: 6px 14px; border-radius: 6px; font-weight: 700; display: inline-block; margin-bottom: 6px; font-size: 0.9rem; }

        /* Summary Grid */
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 18px; margin: 22px 0; }

        .summary-card { background: rgba(0,0,0,0.3); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 22px; text-align: center; }
        .summary-card h4 { color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9rem; }
        .summary-card .value {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .summary-card .label { font-size: 0.85rem; color: var(--text-muted); margin-top: 8px; }

        /* COC Reason Cards */
        .coc-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; margin: 22px 0; }

        .coc-card { background: rgba(0,0,0,0.2); border: 1px solid var(--border-subtle); border-radius: 12px; overflow: hidden; }
        .coc-card-header { background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%); color: white; padding: 18px; }
        .coc-card-header h4 { font-size: 1.05rem; }
        .coc-card-header.settlement { background: linear-gradient(135deg, var(--accent-amber) 0%, #d97706 100%); }
        .coc-card-header.eligibility { background: linear-gradient(135deg, var(--accent-purple) 0%, #7c3aed 100%); }
        .coc-card-header.consumer { background: linear-gradient(135deg, var(--accent-green) 0%, #16a34a 100%); }
        .coc-card-header.ratelock { background: linear-gradient(135deg, var(--accent-blue) 0%, #2563eb 100%); }
        .coc-card-header.expiration { background: linear-gradient(135deg, var(--accent-rose) 0%, #dc2626 100%); }
        .coc-card-header.construction { background: linear-gradient(135deg, var(--accent-teal) 0%, #0d9488 100%); }
        .coc-card-header.cure { background: linear-gradient(135deg, #ef4444 0%, #b91c1c 100%); }
        .coc-card-header.typo { background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); }
        .coc-card-header.prepaid { background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%); }
        .coc-card-header.lockchanges { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); }
        .coc-card-body { padding: 22px; }
        .coc-card ul { list-style: none; padding: 0; }
        .coc-card li { padding: 10px 0; border-bottom: 1px solid var(--border-subtle); display: flex; align-items: flex-start; gap: 12px; color: var(--text-secondary); font-size: 0.95rem; }
        .coc-card li:last-child { border-bottom: none; }
        .check-icon { color: var(--accent-green); font-weight: bold; flex-shrink: 0; }
        .x-icon { color: var(--accent-rose); font-weight: bold; }

        /* Quick Reference */
        .quick-ref {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
            border: 1px solid var(--border-subtle);
            padding: 28px;
            border-radius: 16px;
            margin-top: 30px;
            font-family: 'JetBrains Mono', monospace;
            scroll-margin-top: 75px;
        }

        .quick-ref h3 { color: var(--accent-amber); margin-bottom: 18px; font-family: 'Plus Jakarta Sans', sans-serif; }
        .quick-ref pre { background: rgba(0,0,0,0.4); border: 1px solid var(--border-subtle); padding: 20px; border-radius: 10px; overflow-x: auto; font-size: 0.85rem; line-height: 1.7; color: var(--text-secondary); }

        /* ====== AGENT OPPORTUNITIES STYLES ====== */
        .agent-header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .agent-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(139, 92, 246, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .agent-header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        /* Heat Map */
        .heat-map-container { margin-bottom: 35px; }
        .heat-map-title { font-size: 1.3rem; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }

        .heat-map-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .heat-item {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .heat-item:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .heat-item:active { transform: scale(0.98); }

        .heat-item::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 4px;
        }

        .heat-item.critical::before { background: linear-gradient(90deg, #ef4444, #f97316); }
        .heat-item.high::before { background: linear-gradient(90deg, #f97316, #eab308); }
        .heat-item.medium::before { background: linear-gradient(90deg, #eab308, #22c55e); }
        .heat-item.low::before { background: linear-gradient(90deg, #22c55e, #14b8a6); }

        .heat-score {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.8rem;
            font-weight: 800;
        }

        .heat-item.critical .heat-score { color: #ef4444; }
        .heat-item.high .heat-score { color: #f97316; }
        .heat-item.medium .heat-score { color: #eab308; }
        .heat-item.low .heat-score { color: #22c55e; }

        .heat-name { font-size: 1rem; font-weight: 700; color: var(--text-primary); margin-bottom: 6px; padding-right: 50px; }
        .heat-desc { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; }

        .heat-metrics { display: flex; gap: 15px; margin-top: 12px; }
        .heat-metric { font-size: 0.75rem; color: var(--text-muted); }
        .heat-metric span { color: var(--text-secondary); font-weight: 600; }

        /* Agent Cards */
        .agent-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 25px; margin-bottom: 35px; }

        .agent-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .agent-card:hover { transform: translateY(-5px); box-shadow: 0 15px 50px rgba(0,0,0,0.3); }

        .agent-card.highlight {
            animation: highlightPulse 2s ease;
            box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.4);
        }

        @keyframes highlightPulse {
            0% { box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.6); }
            50% { box-shadow: 0 0 0 6px rgba(139, 92, 246, 0.5), 0 15px 50px rgba(139, 92, 246, 0.3); }
            100% { box-shadow: 0 0 0 0px transparent, 0 15px 50px rgba(0,0,0,0.3); }
        }

        .agent-card-header {
            padding: 22px;
            display: flex;
            align-items: flex-start;
            gap: 18px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .agent-icon {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            flex-shrink: 0;
        }

        .agent-info { flex: 1; }
        .agent-name { font-size: 1.15rem; font-weight: 700; color: var(--text-primary); margin-bottom: 5px; }
        .agent-type { font-size: 0.8rem; color: var(--accent-purple); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-priority {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .agent-priority.critical { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .agent-priority.high { background: rgba(249, 115, 22, 0.15); color: #f97316; }
        .agent-priority.medium { background: rgba(234, 179, 8, 0.15); color: #eab308; }
        .agent-priority.low { background: rgba(34, 197, 94, 0.15); color: #22c55e; }

        .agent-card-body { padding: 22px; }
        .agent-description { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; }

        .agent-flow {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 20px;
        }

        .agent-flow-title { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-flow-diagram { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; justify-content: center; }

        .agent-step {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .agent-arrow { color: var(--accent-purple); font-size: 1.2rem; }

        .agent-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }

        .agent-stat {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .agent-stat-value {
            font-size: 1.3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-top: 4px; }

        /* View Prompt Button */
        .agent-prompt-btn {
            width: 100%;
            margin-top: 18px;
            padding: 14px 20px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 10px;
            color: var(--accent-purple);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .agent-prompt-btn:hover {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(59, 130, 246, 0.3) 100%);
            border-color: var(--accent-purple);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.25);
        }

        /* Summary Stats */
        .agent-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .agent-summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            padding: 25px;
            text-align: center;
        }

        .agent-summary-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-summary-label { font-size: 0.9rem; color: var(--text-muted); margin-top: 8px; }

        /* Heat Map Legend */
        .heat-legend {
            display: flex;
            gap: 25px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .heat-legend-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; color: var(--text-secondary); }
        .heat-legend-color { width: 24px; height: 24px; border-radius: 6px; }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(10, 15, 26, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.show { display: flex; }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            width: 100%;
            max-width: 950px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 80px rgba(0,0,0,0.5);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            padding: 22px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 16px 16px 0 0;
        }

        .modal-header h3 { font-size: 1.25rem; font-weight: 700; }
        .modal-actions { display: flex; gap: 12px; }

        .modal-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: transform 0.2s;
            font-size: 0.9rem;
        }

        .modal-btn:hover { transform: scale(1.05); }
        .modal-btn.copy { background: white; color: var(--accent-blue); }
        .modal-btn.close { background: rgba(255,255,255,0.2); color: white; }

        .modal-body { padding: 28px; overflow-y: auto; flex: 1; }

        .modal-body pre {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            padding: 22px;
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.7;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--text-secondary);
        }

        .copy-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--accent-green);
            color: white;
            padding: 18px 35px;
            border-radius: 10px;
            font-weight: 700;
            z-index: 3000;
            display: none;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut { 0%, 100% { opacity: 0; } 10%, 90% { opacity: 1; } }

        /* Prompt Modal */
        .prompt-modal .modal { max-width: 800px; }
        .prompt-modal .modal-header { background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%); }

        .prompt-section { margin-bottom: 25px; }
        .prompt-section h4 { color: var(--accent-purple); font-size: 1rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }

        .prompt-box {
            background: rgba(0,0,0,0.4);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.7;
            color: var(--text-secondary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .prompt-tags { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .prompt-tag { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }

        .copy-prompt-btn {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 15px;
        }

        .copy-prompt-btn:hover { transform: scale(1.05); box-shadow: 0 5px 20px rgba(139, 92, 246, 0.3); }

        /* Step List */
        .step-list { list-style: none; padding: 0; margin: 18px 0; }
        .step-list li {
            padding: 14px 18px;
            border-left: 3px solid var(--accent-blue);
            background: rgba(0,0,0,0.2);
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
        }
        .step-list li strong { color: var(--text-primary); }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 75px 20px 30px 20px; }
            .agent-grid { grid-template-columns: 1fr; }
        }
        .breadcrumb-logo-link { display: inline-flex; align-items: center; padding: 4px 8px; background: rgba(255,255,255,0.08); border-radius: 8px; border: 1px solid rgba(255,255,255,0.12); transition: all 0.2s; flex-shrink: 0; margin-right: 4px; }
        .breadcrumb-logo-link:hover { background: rgba(255,255,255,0.15); }
        .breadcrumb-logo { height: 24px; width: auto; display: block; }
    </style>
</head>
<body>
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
<a href="../../index.html" class="breadcrumb-logo-link"><img src="../../images/clear-ai-logo.png" alt="Clear AI" class="breadcrumb-logo"></a>
        <a href="../../index.html">Portal Home</a>
        <span class="separator">></span>
        <a href="./index.html">Mortgage Fundamentals</a>
        <span class="separator">></span>
        <span class="current">Change of Circumstance Definitions</span>
    </nav>

    <!-- Fixed Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>COC Reasons</h2>
            <p>TRID Disclosure Guide</p>
        </div>

        <!-- Tab Switcher -->
        <div class="sidebar-tabs">
            <button class="sidebar-tab active" onclick="switchTab('workflow')">Workflow</button>
            <button class="sidebar-tab agent-tab" onclick="switchTab('agents')">AI Agents</button>
        </div>

        <!-- Workflow Navigation -->
        <nav class="sidebar-nav" id="workflow-nav">
            <a href="#section-1" class="nav-item active">
                <span class="nav-number">1</span>
                <span class="nav-label">Settlement</span>
            </a>
            <a href="#section-2" class="nav-item">
                <span class="nav-number">2</span>
                <span class="nav-label">Eligibility</span>
            </a>
            <a href="#section-3" class="nav-item">
                <span class="nav-number">3</span>
                <span class="nav-label">Consumer Request</span>
            </a>
            <a href="#section-4" class="nav-item">
                <span class="nav-number">4</span>
                <span class="nav-label">Rate Lock & Relock</span>
            </a>
            <a href="#section-5" class="nav-item">
                <span class="nav-number">5</span>
                <span class="nav-label">Expiration of LE</span>
            </a>
            <a href="#section-6" class="nav-item">
                <span class="nav-number">6</span>
                <span class="nav-label">New Construction</span>
            </a>
            <a href="#section-7" class="nav-item">
                <span class="nav-number">7</span>
                <span class="nav-label">Not a Valid CoC-Cure</span>
            </a>
            <a href="#section-8" class="nav-item">
                <span class="nav-number">8</span>
                <span class="nav-label">Typographical Correction</span>
            </a>
            <a href="#section-9" class="nav-item">
                <span class="nav-number">9</span>
                <span class="nav-label">PrePaid Items</span>
            </a>
            <a href="#section-10" class="nav-item">
                <span class="nav-number">10</span>
                <span class="nav-label">Lock Related Changes</span>
            </a>
            <a href="#quick-ref" class="nav-item">
                <span class="nav-number">*</span>
                <span class="nav-label">Quick Reference</span>
            </a>
        </nav>

        <!-- Agent Navigation -->
        <nav class="sidebar-nav" id="agents-nav" style="display: none;">
            <a href="#agent-summary" class="nav-item active">
                <span class="nav-number">S</span>
                <span class="nav-label">Summary</span>
            </a>
            <a href="#agent-heatmap" class="nav-item">
                <span class="nav-number">H</span>
                <span class="nav-label">Heat Map</span>
            </a>
            <a href="#agent-details" class="nav-item">
                <span class="nav-number">A</span>
                <span class="nav-label">Agent Details</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="doc-btn" onclick="openDocModal()">
                View Workflow Markdown
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

        <!-- ==================== WORKFLOW TAB ==================== -->
        <div id="workflow-panel" class="tab-panel active">
            <!-- Header -->
            <div class="header">
                <h1>Change of Circumstance Definitions</h1>
                <p class="subtitle">Complete guide for setting Change of Circumstance reasons under TRID regulations for Loan Estimate redisclosures</p>
                <div class="meta">
                    <span class="meta-item">Regulation: TRID</span>
                    <span class="meta-item">Role: Processor / Closer</span>
                    <span class="meta-item">Updated: Aug 12, 2022</span>
                    <span class="meta-item">Reference: TRID COC Matrix</span>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></div><span>Most Common (Settlement)</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);"></div><span>Program Change</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></div><span>Rate/Lock Related</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f43f5e, #dc2626);"></div><span>Cure/Exception</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #22c55e, #16a34a);"></div><span>Borrower Initiated</span></div>
            </div>

            <!-- Summary Stats -->
            <div class="summary-grid">
                <div class="summary-card">
                    <h4>COC Reasons</h4>
                    <div class="value">10</div>
                    <div class="label">Total Options</div>
                </div>
                <div class="summary-card">
                    <h4>Most Used</h4>
                    <div class="value">S</div>
                    <div class="label">Settlement</div>
                </div>
                <div class="summary-card">
                    <h4>Note Required</h4>
                    <div class="value">7</div>
                    <div class="label">Reasons Need Notes</div>
                </div>
                <div class="summary-card">
                    <h4>Auto-Date</h4>
                    <div class="value">2</div>
                    <div class="label">Lock-Related</div>
                </div>
            </div>

            <div class="info-box">
                <h4>TRID COC Matrix Reference</h4>
                <p>For a complete list of detailed reasons and when to use each, view the <strong>TRID COC Matrix</strong> found in SharePoint. This matrix provides comprehensive guidance on fee tolerances and valid change circumstances.</p>
            </div>

            <!-- Section 1: Settlement -->
            <section id="section-1" class="section">
                <div class="section-header">
                    <div class="section-number">1</div>
                    <div class="section-title"><h2>Settlement</h2><span>Most common COC reason for Processors and Closers</span></div>
                </div>
                <div class="section-content">
                    <div class="warning-box">
                        <h4>Note Required</h4>
                        <p>This COC reason <strong>requires a note</strong> to be added explaining why the change happened.</p>
                    </div>

                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Change Occurs</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Settlement Applies?</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Select Settlement</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">Add Explanation Note</div>
                        </div>
                    </div>

                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Settlement consists of the following changed circumstances:</p>

                    <div class="decision-tree">
                        <h3>Extraordinary Event Beyond Anyone's Control</h3>
                        <ul class="step-list">
                            <li><span class="check-icon">+</span> Natural disasters (floods, hurricanes, earthquakes)</li>
                            <li><span class="check-icon">+</span> Events that could not have been anticipated or prevented</li>
                            <li><span class="check-icon">+</span> Circumstances outside the control of all parties</li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Information Initially Relied On Was Inaccurate or Changed</h3>
                        <ul class="step-list">
                            <li><strong>Example 1:</strong> When the appraiser visited the subject property, there is actually a separate structure, so the appraisal fee increased</li>
                            <li><strong>Example 2:</strong> Purchase price estimated at $250,000 at Initial LE but once the purchase contract was received, it was $300,000, which caused the transfer taxes to increase</li>
                            <li><span class="check-icon">+</span> Any situation where disclosed information later proves different from reality</li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>New Information is Obtained</h3>
                        <ul class="step-list">
                            <li><strong>Example 1:</strong> A lien on title that no one was aware of until the prelim was received that causes title fees to increase</li>
                            <li><strong>Example 2:</strong> A general lender credit was added (credit NOT for interest rate chosen)</li>
                            <li><span class="check-icon">+</span> Information discovered during processing that wasn't known at initial disclosure</li>
                        </ul>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Sub-Category</th>
                                <th>Description</th>
                                <th>Common Examples</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Extraordinary Event</strong></td>
                                <td>Events beyond anyone's control</td>
                                <td>Natural disaster, pandemic impacts</td>
                            </tr>
                            <tr>
                                <td><strong>Inaccurate Information</strong></td>
                                <td>Initial info was incorrect or changed</td>
                                <td>Purchase price change, property features</td>
                            </tr>
                            <tr>
                                <td><strong>New Information</strong></td>
                                <td>Previously unknown info discovered</td>
                                <td>Title liens, lender credits added</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Section 2: Eligibility -->
            <section id="section-2" class="section">
                <div class="section-header">
                    <div class="section-number">2</div>
                    <div class="section-title"><h2>Eligibility</h2><span>Used mostly for Loan Program changes</span></div>
                </div>
                <div class="section-content">
                    <div class="warning-box">
                        <h4>Note Required</h4>
                        <p>This COC reason <strong>requires a note</strong> to be added for the reason of the change.</p>
                    </div>

                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Program Issue</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Borrower Ineligible?</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Change Program</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Select Eligibility</div>
                        </div>
                    </div>

                    <div class="info-box">
                        <h4>When to Use Eligibility</h4>
                        <p><strong>Example:</strong> Borrower is ineligible for a conventional loan, so the program changes to FHA which increases costs.</p>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Scenario</th>
                                <th>Original Program</th>
                                <th>New Program</th>
                                <th>Cost Impact</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Credit score dropped</td>
                                <td>Conventional</td>
                                <td>FHA</td>
                                <td><span class="badge required-badge">Increases</span></td>
                            </tr>
                            <tr>
                                <td>DTI too high for Conv</td>
                                <td>Conventional</td>
                                <td>FHA</td>
                                <td><span class="badge required-badge">Increases</span></td>
                            </tr>
                            <tr>
                                <td>LTV requirements not met</td>
                                <td>Program A</td>
                                <td>Program B</td>
                                <td><span class="badge optional-badge">Varies</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Section 3: Consumer Request -->
            <section id="section-3" class="section">
                <div class="section-header">
                    <div class="section-number">3</div>
                    <div class="section-title"><h2>Consumer Request</h2><span>Changes requested by the borrower</span></div>
                </div>
                <div class="section-content">
                    <div class="warning-box">
                        <h4>Note Required</h4>
                        <p>This COC reason <strong>requires a note</strong> to be added for the reason of the change.</p>
                    </div>

                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Borrower Request</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Document Request</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Select Consumer Request</div>
                        </div>
                    </div>

                    <div class="tip-box">
                        <h4>Common Use Cases</h4>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>Loan amount change requested by borrower</li>
                            <li>Title fees from Title Co that the borrower has selected (unless another reason applies)</li>
                            <li>Changes to loan terms at borrower's request</li>
                        </ul>
                    </div>

                    <div class="info-box">
                        <h4>Processor/Closer Note</h4>
                        <p>This may be used by Closers/Processors when updating title fees from the Title Co that the borrower has selected, unless one of the other reasons applies.</p>
                    </div>
                </div>
            </section>

            <!-- Section 4: New Rate Lock and Relock -->
            <section id="section-4" class="section">
                <div class="section-header">
                    <div class="section-number">4</div>
                    <div class="section-title"><h2>New Rate Lock and Relock</h2><span>Initial locks and relocks (expiration, rate/point changes)</span></div>
                </div>
                <div class="section-content">
                    <div class="tip-box">
                        <h4>Automatic Date Entry</h4>
                        <p>Choosing this will <strong>automatically enter the date of the change</strong> as the rate lock date and will choose the appropriate fees.</p>
                    </div>

                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Lock Event</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Lock Type?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">Initial Lock</span>
                                <div class="flow-node action">New Rate Lock</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">Lock Expired</span>
                                <div class="flow-node action">Relock</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">Rate/Point Change</span>
                                <div class="flow-node action">Relock</div>
                            </div>
                        </div>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Scenario</th>
                                <th>Use This Reason</th>
                                <th>Auto-Populated</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Initial rate lock</td>
                                <td>New Rate Lock and Relock</td>
                                <td><span class="badge calculated-badge">Date + Fees</span></td>
                            </tr>
                            <tr>
                                <td>Lock expiration relock</td>
                                <td>New Rate Lock and Relock</td>
                                <td><span class="badge calculated-badge">Date + Fees</span></td>
                            </tr>
                            <tr>
                                <td>Rate/point changes</td>
                                <td>New Rate Lock and Relock</td>
                                <td><span class="badge calculated-badge">Date + Fees</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Section 5: Expiration of LE -->
            <section id="section-5" class="section">
                <div class="section-header">
                    <div class="section-number">5</div>
                    <div class="section-title"><h2>Expiration of LE</h2><span>Rarely used - Fees Expiration exceeded without intent to proceed</span></div>
                </div>
                <div class="section-content">
                    <div class="exception-box">
                        <h4>Typically Not Used</h4>
                        <p>We normally do not run into this situation. If you encounter this, please reach out to <strong>Donnie Howlett</strong> for more guidance.</p>
                    </div>

                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">LE Issued</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">10 Days Pass</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Intent to Proceed?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">YES (within 10 days)</span>
                                <div class="flow-node output">Normal Processing</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">NO (after 10 days)</span>
                                <div class="flow-node exception">Expiration of LE</div>
                            </div>
                        </div>
                    </div>

                    <div class="info-box">
                        <h4>When This Applies</h4>
                        <p>This situation occurs when we have passed the <strong>Fees Expiration date on Page 1 of the LE</strong> and the borrower has not signed their intent to proceed within those 10 days.</p>
                    </div>
                </div>
            </section>

            <!-- Section 6: New Construction -->
            <section id="section-6" class="section">
                <div class="section-header">
                    <div class="section-number">6</div>
                    <div class="section-title"><h2>New Construction</h2><span>Settlement expected more than 60 days after initial LE</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">New Construction Loan</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Settlement > 60 Days?</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Changes During Construction</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Revised Disclosures</div>
                        </div>
                    </div>

                    <div class="info-box">
                        <h4>Regulation Requirements</h4>
                        <p>In transactions involving new construction, where CMG reasonably expects that settlement will occur <strong>more than 60 days</strong> after the loan estimate was provided, CMG may provide revised disclosures with a valid COC to the consumer.</p>
                    </div>

                    <div class="tip-box">
                        <h4>CMG LE Language</h4>
                        <p>CMG's Loan Estimates <strong>DO include the necessary language</strong> to allow redisclosure to the borrower for any changes that have happened during the construction phase.</p>
                    </div>

                    <div class="exception-box">
                        <h4>Important Condition</h4>
                        <p>A revised loan estimate may only be provided if the original disclosures stated clearly and conspicuously that at any time prior to 60 days before consummation, CMG may issue revised disclosures. If no such statement is provided, CMG may not issue revised disclosures.</p>
                    </div>
                </div>
            </section>

            <!-- Section 7: Not a Valid CoC-Cure -->
            <section id="section-7" class="section">
                <div class="section-header">
                    <div class="section-number">7</div>
                    <div class="section-title"><h2>Not a Valid CoC-Cure</h2><span>Only used when COC requires a cure</span></div>
                </div>
                <div class="section-content">
                    <div class="exception-box">
                        <h4>Cure Situations Only</h4>
                        <p>This reason is <strong>ONLY</strong> used when the COC requires a cure for fees that were not properly disclosed.</p>
                    </div>

                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Fee Not Disclosed</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Within 3 Days?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">YES</span>
                                <div class="flow-node output">Valid COC</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">NO</span>
                                <div class="flow-node exception">Not Valid CoC-Cure</div>
                            </div>
                        </div>
                    </div>

                    <div class="decision-tree">
                        <h3>Examples of Cure Situations</h3>
                        <ul class="step-list">
                            <li><strong>Example 1:</strong> The appraisal re-inspection fee was not disclosed within 3 days of the UW's condition</li>
                            <li><strong>Example 2:</strong> The admin fee wasn't disclosed on the initial LE</li>
                            <li><strong>Example 3:</strong> The increased discount point amount was not disclosed within 3 days of the lock extension</li>
                        </ul>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Situation</th>
                                <th>Disclosure Timing</th>
                                <th>Result</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Re-inspection fee</td>
                                <td>Not within 3 days of UW condition</td>
                                <td><span class="badge required-badge">Cure Required</span></td>
                            </tr>
                            <tr>
                                <td>Admin fee</td>
                                <td>Missing from initial LE</td>
                                <td><span class="badge required-badge">Cure Required</span></td>
                            </tr>
                            <tr>
                                <td>Discount points</td>
                                <td>Not within 3 days of lock extension</td>
                                <td><span class="badge required-badge">Cure Required</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Section 8: Typographical Correction -->
            <section id="section-8" class="section">
                <div class="section-header">
                    <div class="section-number">8</div>
                    <div class="section-title"><h2>Typographical Correction</h2><span>Correcting misspellings and typos on the LE</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Error Found</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Type of Error?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">Name Misspelled</span>
                                <div class="flow-node action">Use Typo Correction</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">SSN Mistyped</span>
                                <div class="flow-node action">Use Typo Correction</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">Address</span>
                                <div class="flow-node exception">Get Approval First</div>
                            </div>
                        </div>
                    </div>

                    <div class="info-box">
                        <h4>Valid Uses</h4>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>Misspelled borrower's name</li>
                            <li>Mistyped borrower's SSN</li>
                        </ul>
                    </div>

                    <div class="exception-box">
                        <h4>Address Corrections - Approval Required</h4>
                        <p>This reason can be used for an address correction, but you must <strong>reach out to your team lead or manager for approval</strong> before sending out a revised LE for correcting the address.</p>
                    </div>
                </div>
            </section>

            <!-- Section 9: PrePaid Items -->
            <section id="section-9" class="section">
                <div class="section-header">
                    <div class="section-number">9</div>
                    <div class="section-title"><h2>PrePaid Items</h2><span>Section F and G reconciliation</span></div>
                </div>
                <div class="section-content">
                    <div class="info-box">
                        <h4>Sections F and G Only</h4>
                        <p>This is used <strong>only for items in Section F and G</strong> of the Loan Estimate. These should be reconciled with every redisclosure to follow TRID rules of giving the borrower the most accurate info at the time of disclosure.</p>
                    </div>

                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Redisclosure</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Reconcile Section F & G</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Most Accurate Info Disclosed</div>
                        </div>
                    </div>

                    <div class="tip-box">
                        <h4>Underwriter Updates</h4>
                        <p>If the file has been underwritten, the Underwriter has updated these but not reconciled them. These need to be reconciled so they are disclosed accurately.</p>
                    </div>

                    <div class="info-box">
                        <h4>COC Letter Note</h4>
                        <p>You are <strong>not required</strong> to include that these have been updated on the CoC letter, but there is nothing wrong if you do.</p>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Section</th>
                                <th>Contents</th>
                                <th>Action Required</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Section F</strong></td>
                                <td>Prepaids (Interest, Insurance, Taxes)</td>
                                <td><span class="badge calculated-badge">Reconcile</span></td>
                            </tr>
                            <tr>
                                <td><strong>Section G</strong></td>
                                <td>Initial Escrow at Closing</td>
                                <td><span class="badge calculated-badge">Reconcile</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Section 10: Lock Related Changes -->
            <section id="section-10" class="section">
                <div class="section-header">
                    <div class="section-number">10</div>
                    <div class="section-title"><h2>Lock Related Changes</h2><span>Rate lock extensions only</span></div>
                </div>
                <div class="section-content">
                    <div class="tip-box">
                        <h4>Automatic Fee Selection</h4>
                        <p>Choosing this will <strong>automatically choose the appropriate fees</strong>.</p>
                    </div>

                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Lock Extension Needed</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Select Lock Related Changes</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Fees Auto-Selected</div>
                        </div>
                    </div>

                    <div class="info-box">
                        <h4>Difference from New Rate Lock</h4>
                        <p><strong>Lock Related Changes</strong> = Extensions only<br>
                        <strong>New Rate Lock and Relock</strong> = Initial locks, relocks due to expiration, rate/point changes</p>
                    </div>
                </div>
            </section>

            <!-- Quick Reference -->
            <div id="quick-ref" class="quick-ref">
                <h3>COC Reason Quick Reference</h3>
                <pre>
CHANGE OF CIRCUMSTANCE REASONS - QUICK GUIDE
=============================================

REASON                  | NOTE REQ? | AUTO-DATE? | WHEN TO USE
------------------------|-----------|------------|------------------------------------------
Settlement              | YES       | NO         | Most common - info changed, new info,
                        |           |            | extraordinary events
Eligibility             | YES       | NO         | Program changes (Conv -> FHA, etc.)
Consumer Request        | YES       | NO         | Borrower-requested changes
New Rate Lock/Relock    | NO        | YES        | Initial locks, relocks, rate changes
Expiration of LE        | NO        | NO         | RARE - Fees expired without intent
New Construction        | NO        | NO         | Settlement >60 days, construction changes
Not Valid CoC-Cure      | NO        | NO         | Fee not disclosed within 3 days
Typographical Correction| NO        | NO         | Name/SSN typos (address needs approval)
PrePaid Items           | OPTIONAL  | NO         | Section F & G reconciliation
Lock Related Changes    | NO        | YES        | Lock extensions only

SETTLEMENT SUB-CATEGORIES
=========================
1. Extraordinary Event - Natural disaster, uncontrollable events
2. Inaccurate Info      - Initial info proved wrong (price, property)
3. New Information      - Discovered during processing (liens, credits)

KEY CONTACTS
============
- Expiration of LE situations: Contact Donnie Howlett
- Address corrections: Get team lead/manager approval first

TRID COMPLIANCE REMINDERS
=========================
- Always add notes when required
- Reconcile Section F & G with every redisclosure
- Disclose fees within 3 days of trigger event
- Reference TRID COC Matrix in SharePoint for complete guidance
                </pre>
            </div>
        </div>

        <!-- ==================== AI AGENTS TAB ==================== -->
        <div id="agents-panel" class="tab-panel">
            <!-- Agent Header -->
            <div class="agent-header">
                <h1>AI Agent Opportunities</h1>
                <p class="subtitle">Automation opportunities identified for the Change of Circumstance process</p>
            </div>

            <!-- Summary Stats -->
            <div class="agent-summary" id="agent-summary">
                <div class="agent-summary-card">
                    <div class="agent-summary-value">4</div>
                    <div class="agent-summary-label">Agent Opportunities</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">68%</div>
                    <div class="agent-summary-label">Automation Potential</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">12 min</div>
                    <div class="agent-summary-label">Est. Time Saved</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">High</div>
                    <div class="agent-summary-label">Compliance Impact</div>
                </div>
            </div>

            <!-- Heat Map Legend -->
            <div class="heat-legend">
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #ef4444, #f97316);"></div>
                    <span>Critical Priority (9-10)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #f97316, #eab308);"></div>
                    <span>High Priority (7-8)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #eab308, #22c55e);"></div>
                    <span>Medium Priority (5-6)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #22c55e, #14b8a6);"></div>
                    <span>Low Priority (1-4)</span>
                </div>
            </div>

            <!-- Heat Map Grid -->
            <div class="heat-map-container" id="agent-heatmap">
                <div class="heat-map-title">Priority Heat Map</div>
                <div class="heat-map-grid">
                    <div class="heat-item critical" onclick="scrollToAgent('agent-cocclassifier')">
                        <div class="heat-score">9.4</div>
                        <div class="heat-name">COC Classifier Agent</div>
                        <div class="heat-desc">Auto-classify change type and suggest correct COC reason</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>5 min</span></div>
                            <div class="heat-metric">Complexity: <span>Medium</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-tolerancemonitor')">
                        <div class="heat-score">8.2</div>
                        <div class="heat-name">Tolerance Monitor</div>
                        <div class="heat-desc">Track fee changes against TRID tolerance limits</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>3 min</span></div>
                            <div class="heat-metric">Complexity: <span>Medium</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-notedrafter')">
                        <div class="heat-score">7.8</div>
                        <div class="heat-name">Note Drafter Agent</div>
                        <div class="heat-desc">Auto-generate compliant COC explanation notes</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>2 min</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                    <div class="heat-item medium" onclick="scrollToAgent('agent-prepaidreconciler')">
                        <div class="heat-score">6.5</div>
                        <div class="heat-name">Prepaid Reconciler</div>
                        <div class="heat-desc">Auto-reconcile Section F & G on redisclosures</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>2 min</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agent Details -->
            <div id="agent-details">
                <h2 style="color: var(--text-primary); margin-bottom: 25px; font-size: 1.5rem;">Agent Details</h2>
                <div class="agent-grid">
                    <!-- COC Classifier Agent -->
                    <div class="agent-card" id="agent-cocclassifier">
                        <div class="agent-card-header">
                            <div class="agent-icon">C</div>
                            <div class="agent-info">
                                <div class="agent-name">COC Classifier Agent</div>
                                <div class="agent-type">Classification / Decision Support</div>
                            </div>
                            <span class="agent-priority critical">Critical</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Analyzes the nature of fee or loan changes and automatically recommends the correct COC reason based on TRID regulations. Reduces errors from incorrect COC selection and ensures compliance with disclosure timing requirements.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Detect Change</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Analyze Type</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Match COC Rule</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Recommend</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">5 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">96%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Med</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('cocclassifier')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Tolerance Monitor Agent -->
                    <div class="agent-card" id="agent-tolerancemonitor">
                        <div class="agent-card-header">
                            <div class="agent-icon">T</div>
                            <div class="agent-info">
                                <div class="agent-name">Tolerance Monitor</div>
                                <div class="agent-type">Compliance / Monitoring</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Continuously monitors fee changes against TRID tolerance buckets (0%, 10%, unlimited). Alerts when changes approach or exceed tolerance limits, preventing costly cures at closing.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Fee Change</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Check Bucket</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Calculate Delta</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Alert if Needed</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">3 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">99%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Med</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('tolerancemonitor')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Note Drafter Agent -->
                    <div class="agent-card" id="agent-notedrafter">
                        <div class="agent-card-header">
                            <div class="agent-icon">N</div>
                            <div class="agent-info">
                                <div class="agent-name">Note Drafter Agent</div>
                                <div class="agent-type">Content Generation</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Automatically generates compliant, professional COC explanation notes based on the change type, fee involved, and circumstances. Ensures consistent documentation across all processors.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">COC Selected</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Gather Context</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Generate Note</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Review/Edit</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">2 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">92%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('notedrafter')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Prepaid Reconciler Agent -->
                    <div class="agent-card" id="agent-prepaidreconciler">
                        <div class="agent-card-header">
                            <div class="agent-icon">P</div>
                            <div class="agent-info">
                                <div class="agent-name">Prepaid Reconciler</div>
                                <div class="agent-type">Data Processing</div>
                            </div>
                            <span class="agent-priority medium">Medium</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Automatically reconciles Section F (Prepaids) and Section G (Initial Escrow) when a redisclosure is triggered, ensuring borrowers receive the most accurate information per TRID requirements.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Redisclosure</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Pull Current Data</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Reconcile F & G</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Update LE</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">2 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">98%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('prepaidreconciler')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Documentation Modal -->
    <div class="modal-overlay" id="docModal">
        <div class="modal">
            <div class="modal-header">
                <h3>COC Definitions Workflow Documentation</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyToClipboard()">Copy</button>
                    <button class="modal-btn close" onclick="closeDocModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <pre id="docContent"># Change of Circumstance Definitions - CMG Financial

## Overview
This document provides guidance for setting the Change of Circumstance (COC) reason when issuing revised Loan Estimates under TRID regulations. For complete details, reference the TRID COC Matrix in SharePoint.

## COC Reasons

### 1. Settlement (Most Common)
- Requires note explaining the change
- Sub-categories:
  - Extraordinary event beyond anyone's control (natural disasters)
  - Information relied on was inaccurate or changed (price, property features)
  - New information obtained (title liens, lender credits)

### 2. Eligibility
- Used for loan program changes
- Example: Conv to FHA due to eligibility issues
- Requires note

### 3. Consumer Request
- Changes requested by borrower
- Examples: Loan amount change, borrower-selected title company
- Requires note

### 4. New Rate Lock and Relock
- Initial locks, relocks (expiration/rate changes)
- Auto-populates date and fees

### 5. Expiration of LE
- Rarely used
- When 10-day intent to proceed expires
- Contact Donnie Howlett for guidance

### 6. New Construction
- Settlement > 60 days from initial LE
- CMG LEs include required language

### 7. Not a Valid CoC-Cure
- Fees not disclosed within 3 days
- Examples: Re-inspection fees, admin fees, lock extension costs

### 8. Typographical Correction
- Name/SSN typos
- Address corrections need manager approval

### 9. PrePaid Items
- Section F & G reconciliation
- Reconcile with every redisclosure

### 10. Lock Related Changes
- Lock extensions only
- Auto-selects appropriate fees</pre>
            </div>
        </div>
    </div>

    <!-- AI Prompt Modal -->
    <div class="modal-overlay prompt-modal" id="promptModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="promptModalTitle">AI Agent Build Prompt</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyPromptToClipboard()">Copy Prompt</button>
                    <button class="modal-btn close" onclick="closePromptModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="prompt-tags" id="promptTags"></div>
                <div class="prompt-section">
                    <h4>Agent Purpose</h4>
                    <div class="prompt-box" id="promptPurpose"></div>
                </div>
                <div class="prompt-section">
                    <h4>Full Build Prompt</h4>
                    <div class="prompt-box" id="promptContent"></div>
                </div>
                <div class="prompt-section">
                    <h4>Integration Points</h4>
                    <div class="prompt-box" id="promptIntegration"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="copy-success" id="copySuccess">Copied to clipboard!</div>

    <script>
        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));

            if (tab === 'workflow') {
                document.querySelector('.sidebar-tab:not(.agent-tab)').classList.add('active');
                document.getElementById('workflow-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'block';
                document.getElementById('agents-nav').style.display = 'none';
            } else {
                document.querySelector('.sidebar-tab.agent-tab').classList.add('active');
                document.getElementById('agents-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'none';
                document.getElementById('agents-nav').style.display = 'block';
            }

            window.scrollTo(0, 0);
        }

        // Scroll spy with isScrolling flag and 1000ms timeout
        const sections = document.querySelectorAll('.section, .quick-ref');
        const navItems = document.querySelectorAll('#workflow-nav .nav-item');
        let isScrolling = false;
        let scrollTimeout;

        function updateActiveNav() {
            if (isScrolling) return;

            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                if (window.scrollY >= sectionTop) current = section.getAttribute('id');
            });
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + current) item.classList.add('active');
            });
        }

        // Handle nav click to temporarily disable scroll spy
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                isScrolling = true;
                clearTimeout(scrollTimeout);

                // Remove active from all, add to clicked
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');

                // Re-enable scroll spy after 1000ms
                scrollTimeout = setTimeout(() => {
                    isScrolling = false;
                }, 1000);
            });
        });

        window.addEventListener('scroll', updateActiveNav);

        // Modal
        function openDocModal() {
            document.getElementById('docModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeDocModal() {
            document.getElementById('docModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyToClipboard() {
            try {
                await navigator.clipboard.writeText(document.getElementById('docContent').textContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeDocModal(); closePromptModal(); } });
        document.getElementById('docModal').addEventListener('click', (e) => { if (e.target.id === 'docModal') closeDocModal(); });

        document.addEventListener('DOMContentLoaded', () => { updateActiveNav(); });

        // Scroll to agent card and highlight
        function scrollToAgent(agentId) {
            const agentCard = document.getElementById(agentId);
            if (agentCard) {
                document.querySelectorAll('.agent-card.highlight').forEach(card => {
                    card.classList.remove('highlight');
                });

                agentCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

                setTimeout(() => {
                    agentCard.classList.add('highlight');
                }, 300);

                setTimeout(() => {
                    agentCard.classList.remove('highlight');
                }, 2500);
            }
        }

        // Agent Prompt System
        const agentPrompts = {
            cocclassifier: {
                name: 'COC Classifier Agent',
                tags: ['Classification', 'Decision Support', 'TRID Compliance', 'Critical Priority'],
                purpose: `This agent analyzes fee and loan changes to automatically recommend the correct Change of Circumstance reason based on TRID regulations. It reduces selection errors and ensures proper compliance documentation.`,
                prompt: `You are building a Classification Agent for CMG Financial's COC selection process.

AGENT NAME: COC Classifier Agent
TYPE: Classification / Decision Support

OBJECTIVE:
Create an agent that analyzes changes in loan fees or terms and recommends the appropriate COC reason based on TRID regulations and CMG policies.

INPUT DATA:
- Change type (fee, loan amount, program, etc.)
- Original value
- New value
- Change trigger (borrower request, new info, error, etc.)
- Loan program type
- Days since last LE

CLASSIFICATION RULES:
1. Settlement:
   - New information discovered (title liens, property features)
   - Initial info proved inaccurate (purchase price changed)
   - Extraordinary events (natural disasters)

2. Eligibility:
   - Loan program change (Conv to FHA)
   - Borrower no longer qualifies for original program

3. Consumer Request:
   - Borrower explicitly requested change
   - Borrower selected different service provider

4. New Rate Lock/Relock:
   - Initial rate lock
   - Lock expiration and relock
   - Rate or point changes

5. Lock Related Changes:
   - Lock extensions only

6. PrePaid Items:
   - Changes only to Section F or G
   - Reconciliation adjustments

7. Not Valid CoC-Cure:
   - Fee not disclosed within 3 days of trigger
   - Missing fees on initial LE

OUTPUT:
{
  "recommended_coc": "Settlement",
  "sub_category": "New Information Obtained",
  "confidence": 0.94,
  "note_required": true,
  "suggested_note": "Title search revealed existing lien...",
  "alternative_cocs": ["Consumer Request"],
  "compliance_flags": []
}`,
                integration: `INTEGRATION POINTS:
1. LOS System
   - Monitor fee and term changes
   - Access loan history and timeline
   - Write selected COC reason

2. TRID Rule Engine
   - Tolerance bucket mapping
   - 3-day disclosure timing rules
   - Valid COC event triggers

3. Document Generation
   - Pre-populate COC letter
   - Include recommended explanation

DEPLOYMENT:
- Triggered on any fee or term change
- Real-time classification
- Human review for low-confidence results`
            },
            tolerancemonitor: {
                name: 'Tolerance Monitor Agent',
                tags: ['Compliance', 'Monitoring', 'TRID', 'High Priority'],
                purpose: `This agent continuously monitors fee changes against TRID tolerance limits (0%, 10%, unlimited buckets). It alerts processors when changes approach or exceed limits to prevent costly cures.`,
                prompt: `You are building a Compliance Monitoring Agent for TRID tolerance tracking.

AGENT NAME: Tolerance Monitor Agent
TYPE: Compliance / Real-time Monitoring

OBJECTIVE:
Track all fee changes against TRID tolerance buckets and alert when limits are approached or exceeded.

TRID TOLERANCE BUCKETS:
1. Zero Tolerance (0%):
   - Transfer taxes
   - Fees paid to creditor
   - Fees for required services by creditor-selected provider

2. 10% Cumulative Tolerance:
   - Recording fees
   - Fees for third-party services borrower can shop for

3. Unlimited Tolerance:
   - Prepaid interest
   - Property insurance premiums
   - Services borrower shops for from non-list provider

MONITORING LOGIC:
{
  "loan_number": "2026-001234",
  "fee_category": "title_insurance",
  "bucket": "10_percent",
  "initial_le_amount": 1500.00,
  "current_amount": 1620.00,
  "change_amount": 120.00,
  "change_percent": 8.0,
  "cumulative_bucket_change": 145.00,
  "cumulative_bucket_percent": 9.67,
  "remaining_tolerance": 5.00,
  "alert_level": "WARNING",
  "valid_coc_exists": true
}

ALERT THRESHOLDS:
- Info: 75% of tolerance used
- Warning: 90% of tolerance used
- Critical: 100%+ (cure required)

CURE CALCULATION:
If exceeded, calculate cure amount = excess over tolerance`,
                integration: `INTEGRATION POINTS:
1. LOS Fee Tracking
   - Real-time fee change detection
   - Historical fee comparison
   - Bucket assignment

2. Alert System
   - Email notifications
   - Dashboard warnings
   - Cure amount display

3. Reporting
   - Daily tolerance report
   - At-risk loan queue
   - Cure forecast

DEPLOYMENT:
- Background monitoring service
- Check on every fee update
- Daily batch review for all active loans`
            },
            notedrafter: {
                name: 'Note Drafter Agent',
                tags: ['Content Generation', 'Documentation', 'Low Complexity', 'High Priority'],
                purpose: `This agent automatically generates compliant, professional COC explanation notes based on the selected reason and change context. Ensures consistent documentation standards.`,
                prompt: `You are building a Content Generation Agent for COC note creation.

AGENT NAME: Note Drafter Agent
TYPE: Content Generation / Documentation

OBJECTIVE:
Generate clear, compliant COC explanation notes that document the reason for redisclosure.

INPUT DATA:
- Selected COC reason
- Fee/term that changed
- Original value
- New value
- Change trigger event
- Date of change/discovery
- Loan context

NOTE TEMPLATES BY COC TYPE:

SETTLEMENT (New Information):
"Upon receipt of [document type] on [date], it was discovered that [specific finding]. This resulted in [fee name] changing from $[original] to $[new], an increase/decrease of $[delta]."

SETTLEMENT (Inaccurate Info):
"The [data point] initially disclosed as [original value] was confirmed as [new value] upon receipt of [verification document] on [date]. This change impacts [affected fees/terms]."

ELIGIBILITY:
"Due to [reason - credit, DTI, LTV], the loan program has been changed from [original program] to [new program]. This program change results in [fee/term changes]."

CONSUMER REQUEST:
"Per borrower request received on [date], [change description]. The borrower has been informed of the impact on [affected items]."

OUTPUT:
{
  "draft_note": "Full note text...",
  "key_facts_included": ["date", "amount", "reason"],
  "compliance_check": "PASS",
  "edit_suggestions": []
}`,
                integration: `INTEGRATION POINTS:
1. LOS Integration
   - Pull change details automatically
   - Insert note into COC record
   - Attach to loan timeline

2. Template Library
   - COC-specific templates
   - Regulatory language database
   - Custom phrases per CMG policy

3. Review Workflow
   - Draft for processor review
   - Edit capability
   - Approval tracking

DEPLOYMENT:
- Triggered when COC reason selected
- Pre-populated in note field
- One-click accept or edit`
            },
            prepaidreconciler: {
                name: 'Prepaid Reconciler Agent',
                tags: ['Data Processing', 'Automation', 'TRID', 'Medium Priority'],
                purpose: `This agent automatically reconciles Section F (Prepaids) and Section G (Initial Escrow) amounts when any redisclosure is triggered, ensuring borrowers receive the most current accurate information.`,
                prompt: `You are building a Data Processing Agent for LE Section F & G reconciliation.

AGENT NAME: Prepaid Reconciler Agent
TYPE: Data Processing / Automation

OBJECTIVE:
Automatically update Sections F and G of the Loan Estimate with the most accurate current information whenever a redisclosure occurs.

SECTION F - PREPAIDS:
- Homeowner's Insurance Premium
- Mortgage Insurance Premium
- Prepaid Interest (per diem x days)
- Property Taxes

SECTION G - INITIAL ESCROW:
- Homeowner's Insurance (months)
- Mortgage Insurance (months)
- Property Taxes (months)

RECONCILIATION LOGIC:
1. Trigger: Any COC redisclosure event
2. Pull current data:
   - Closing date (for prepaid interest calc)
   - Insurance quotes
   - Tax amounts from county records
   - MI rates based on current LTV
3. Calculate accurate amounts
4. Compare to current LE values
5. Update if different

CALCULATION FORMULAS:
Prepaid Interest = (Loan Amount x Rate / 365) x Days
HOI Escrow = Monthly Premium x Cushion Months
Tax Escrow = Annual Tax / 12 x Collection Months

OUTPUT:
{
  "section_f_changes": [
    {"item": "Prepaid Interest", "old": 456.00, "new": 478.50}
  ],
  "section_g_changes": [
    {"item": "Property Taxes", "old": 2400.00, "new": 2520.00}
  ],
  "total_change": 142.50,
  "reconciliation_date": "2026-01-27"
}`,
                integration: `INTEGRATION POINTS:
1. LOS Data Sources
   - Closing date field
   - Loan amount/rate
   - Insurance quotes
   - Tax records

2. Calculation Engine
   - Per diem calculator
   - Escrow month counter
   - Cushion rules by state

3. LE Update
   - Write to Section F/G
   - Flag changes for review
   - Optional COC letter note

DEPLOYMENT:
- Auto-triggered on any redisclosure
- Background calculation
- Updates applied before LE generation`
            }
        };

        function showAgentPrompt(agentKey) {
            const agent = agentPrompts[agentKey];
            if (!agent) return;

            document.getElementById('promptModalTitle').textContent = agent.name + ' - Build Prompt';
            document.getElementById('promptTags').innerHTML = agent.tags.map(t => `<span class="prompt-tag">${t}</span>`).join('');
            document.getElementById('promptPurpose').textContent = agent.purpose;
            document.getElementById('promptContent').textContent = agent.prompt;
            document.getElementById('promptIntegration').textContent = agent.integration;

            document.getElementById('promptModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closePromptModal() {
            document.getElementById('promptModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyPromptToClipboard() {
            const content = document.getElementById('promptContent').textContent;
            try {
                await navigator.clipboard.writeText(content);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.getElementById('promptModal').addEventListener('click', (e) => { if (e.target.id === 'promptModal') closePromptModal(); });
    </script>
</body>
</html>
