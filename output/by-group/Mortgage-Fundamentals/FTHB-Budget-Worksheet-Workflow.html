<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>First-Time Homebuyer Budget Worksheet - Process Workflow</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: #111827;
            --bg-card: #1a2234;
            --accent-blue: #3b82f6;
            --accent-teal: #14b8a6;
            --accent-amber: #f59e0b;
            --accent-rose: #f43f5e;
            --accent-green: #22c55e;
            --accent-purple: #8b5cf6;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-subtle: rgba(255,255,255,0.08);
            --sidebar-width: 280px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Breadcrumb */
        .breadcrumb {
            background: linear-gradient(90deg, #0d1525 0%, #1a2234 100%);
            padding: 14px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
            border-bottom: 1px solid var(--border-subtle);
        }

        .breadcrumb a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            transition: all 0.2s;
            border: 1px solid var(--border-subtle);
        }

        .breadcrumb a:hover {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .breadcrumb .separator { color: var(--text-muted); font-size: 1.2rem; }
        .breadcrumb .current { color: var(--accent-amber); font-weight: 600; padding: 8px 16px; }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 54px;
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - 54px);
            background: var(--bg-secondary);
            overflow-y: auto;
            z-index: 1000;
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 25px 20px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-header h2 { color: var(--text-primary); font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
        .sidebar-header p { color: var(--text-muted); font-size: 0.85rem; }

        /* Tab Switch */
        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-tab {
            flex: 1;
            padding: 14px 10px;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            background: none;
            border-left: none;
            border-right: none;
            border-top: none;
        }

        .sidebar-tab:hover { background: rgba(255,255,255,0.03); color: var(--text-secondary); }
        .sidebar-tab.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); background: rgba(59, 130, 246, 0.08); }
        .sidebar-tab.agent-tab.active { color: var(--accent-purple); border-bottom-color: var(--accent-purple); background: rgba(139, 92, 246, 0.08); }

        .sidebar-nav { padding: 15px 0; flex: 1; overflow-y: auto; }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .nav-item:hover { background: rgba(255,255,255,0.03); color: var(--text-primary); }
        .nav-item.active { background: rgba(59, 130, 246, 0.1); border-left-color: var(--accent-blue); color: var(--text-primary); }

        .nav-number {
            background: rgba(255,255,255,0.1);
            color: var(--text-secondary);
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .nav-item.active .nav-number { background: var(--accent-blue); color: white; }
        .nav-label { font-size: 0.95rem; font-weight: 500; }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-subtle);
            background: rgba(0,0,0,0.2);
        }

        .doc-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px 20px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .doc-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3); }

        /* Main Content */
        .main-content { margin-left: var(--sidebar-width); padding: 80px 40px 40px 40px; }

        /* Tab Panels */
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        .header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(20, 184, 166, 0.08) 0%, transparent 50%);
            pointer-events: none;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        .header .meta { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; position: relative; }

        .header .meta-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-subtle);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); }
        .legend-color { width: 18px; height: 18px; border-radius: 4px; }

        /* Sections */
        .section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            margin-bottom: 25px;
            overflow: hidden;
            scroll-margin-top: 75px;
        }

        .section-header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(59, 130, 246, 0.1) 100%);
            border-bottom: 1px solid var(--border-subtle);
            padding: 22px 25px;
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .section-number {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .section-title h2 { font-size: 1.35rem; font-weight: 700; margin-bottom: 4px; color: var(--text-primary); }
        .section-title span { font-size: 0.9rem; color: var(--text-muted); }
        .section-content { padding: 28px; }

        /* Workflow Diagrams */
        .workflow-diagram {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 28px;
            margin-bottom: 22px;
        }

        .flow-row { display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 12px; margin: 15px 0; }

        .flow-node {
            padding: 14px 22px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            min-width: 150px;
            border: 1px solid var(--border-subtle);
        }

        .flow-node.start { background: linear-gradient(135deg, var(--accent-green) 0%, #16a34a 100%); color: white; border-radius: 25px; border: none; }
        .flow-node.action { background: linear-gradient(135deg, var(--accent-blue) 0%, #2563eb 100%); color: white; border: none; }
        .flow-node.decision { background: linear-gradient(135deg, var(--accent-amber) 0%, #d97706 100%); color: var(--bg-primary); border: none; }
        .flow-node.input { background: var(--bg-secondary); border: 2px solid var(--accent-blue); color: var(--text-primary); }
        .flow-node.output { background: linear-gradient(135deg, var(--accent-teal) 0%, #0d9488 100%); color: white; border: none; }
        .flow-node.exception { background: linear-gradient(135deg, var(--accent-rose) 0%, #dc2626 100%); color: white; border: none; }

        .flow-arrow { color: var(--accent-blue); font-size: 1.5rem; }
        .flow-arrow.down { transform: rotate(90deg); }

        .decision-branch { display: flex; gap: 40px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
        .branch { display: flex; flex-direction: column; align-items: center; gap: 10px; }

        .branch-label {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        /* Tables */
        .field-table { width: 100%; border-collapse: collapse; margin: 18px 0; }

        .field-table th {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            padding: 14px 18px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border-subtle);
        }

        .field-table td { padding: 14px 18px; border-bottom: 1px solid var(--border-subtle); color: var(--text-secondary); }
        .field-table tr:hover { background: rgba(255,255,255,0.02); }

        .badge { display: inline-block; padding: 4px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge.required-badge { background: rgba(244, 63, 94, 0.15); color: var(--accent-rose); }
        .badge.optional-badge { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .badge.calculated-badge { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }

        /* Info Boxes */
        .exception-box, .tip-box, .info-box {
            padding: 18px 22px;
            margin: 18px 0;
            border-radius: 0 10px 10px 0;
            border-left-width: 4px;
            border-left-style: solid;
        }

        .exception-box { background: rgba(244, 63, 94, 0.08); border-color: var(--accent-rose); border: 1px solid rgba(244, 63, 94, 0.2); border-left: 4px solid var(--accent-rose); }
        .exception-box h4 { color: var(--accent-rose); margin-bottom: 10px; font-size: 1rem; }
        .exception-box p, .exception-box li { color: var(--text-secondary); }

        .tip-box { background: rgba(34, 197, 94, 0.08); border-color: var(--accent-green); border: 1px solid rgba(34, 197, 94, 0.2); border-left: 4px solid var(--accent-green); }
        .tip-box h4 { color: var(--accent-green); margin-bottom: 10px; font-size: 1rem; }
        .tip-box p, .tip-box li { color: var(--text-secondary); }

        .info-box { background: rgba(59, 130, 246, 0.08); border-color: var(--accent-blue); border: 1px solid rgba(59, 130, 246, 0.2); border-left: 4px solid var(--accent-blue); }
        .info-box h4 { color: var(--accent-blue); margin-bottom: 10px; font-size: 1rem; }
        .info-box p, .info-box li { color: var(--text-secondary); }

        /* Decision Tree */
        .decision-tree {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 22px;
            margin: 22px 0;
        }

        .decision-tree h3 { color: var(--accent-blue); margin-bottom: 18px; padding-bottom: 12px; border-bottom: 1px solid var(--border-subtle); font-size: 1.1rem; }

        .tree-node { margin-left: 20px; padding: 12px; border-left: 2px solid var(--accent-teal); position: relative; color: var(--text-secondary); }
        .tree-node::before { content: ''; position: absolute; left: -2px; top: 22px; width: 15px; height: 2px; background: var(--accent-teal); }
        .tree-node.level-1 { margin-left: 0; border-left: none; }
        .tree-node.level-1::before { display: none; }

        .tree-label { background: var(--accent-amber); color: var(--bg-primary); padding: 6px 14px; border-radius: 6px; font-weight: 700; display: inline-block; margin-bottom: 6px; font-size: 0.9rem; }

        /* Summary Grid */
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 18px; margin: 22px 0; }

        .summary-card { background: rgba(0,0,0,0.3); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 22px; text-align: center; }
        .summary-card h4 { color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9rem; }
        .summary-card .value {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .summary-card .label { font-size: 0.85rem; color: var(--text-muted); margin-top: 8px; }

        /* Budget Category Cards */
        .budget-category { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 22px 0; }

        .budget-card { background: rgba(0,0,0,0.2); border: 1px solid var(--border-subtle); border-radius: 12px; overflow: hidden; }
        .budget-card-header { background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%); color: white; padding: 18px; text-align: center; }
        .budget-card-header h4 { font-size: 1.05rem; }
        .budget-card-body { padding: 22px; }
        .budget-card ul { list-style: none; padding: 0; }
        .budget-card li { padding: 10px 0; border-bottom: 1px solid var(--border-subtle); display: flex; align-items: center; gap: 12px; color: var(--text-secondary); font-size: 0.95rem; }
        .budget-card li:last-child { border-bottom: none; }
        .check-icon { color: var(--accent-green); font-weight: bold; }
        .dollar-icon { color: var(--accent-amber); font-weight: bold; }

        /* Quick Reference */
        .quick-ref {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
            border: 1px solid var(--border-subtle);
            padding: 28px;
            border-radius: 16px;
            margin-top: 30px;
            font-family: 'JetBrains Mono', monospace;
            scroll-margin-top: 75px;
        }

        .quick-ref h3 { color: var(--accent-amber); margin-bottom: 18px; font-family: 'Plus Jakarta Sans', sans-serif; }
        .quick-ref pre { background: rgba(0,0,0,0.4); border: 1px solid var(--border-subtle); padding: 20px; border-radius: 10px; overflow-x: auto; font-size: 0.85rem; line-height: 1.7; color: var(--text-secondary); }

        /* ====== AGENT OPPORTUNITIES STYLES ====== */
        .agent-header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .agent-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(139, 92, 246, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .agent-header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        /* Heat Map */
        .heat-map-container { margin-bottom: 35px; }
        .heat-map-title { font-size: 1.3rem; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }

        .heat-map-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .heat-item {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .heat-item:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .heat-item:active { transform: scale(0.98); }

        .heat-item::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 4px;
        }

        .heat-item.critical::before { background: linear-gradient(90deg, #ef4444, #f97316); }
        .heat-item.high::before { background: linear-gradient(90deg, #f97316, #eab308); }
        .heat-item.medium::before { background: linear-gradient(90deg, #eab308, #22c55e); }
        .heat-item.low::before { background: linear-gradient(90deg, #22c55e, #14b8a6); }

        .heat-score {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.8rem;
            font-weight: 800;
        }

        .heat-item.critical .heat-score { color: #ef4444; }
        .heat-item.high .heat-score { color: #f97316; }
        .heat-item.medium .heat-score { color: #eab308; }
        .heat-item.low .heat-score { color: #22c55e; }

        .heat-name { font-size: 1rem; font-weight: 700; color: var(--text-primary); margin-bottom: 6px; padding-right: 50px; }
        .heat-desc { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; }

        .heat-metrics { display: flex; gap: 15px; margin-top: 12px; }
        .heat-metric { font-size: 0.75rem; color: var(--text-muted); }
        .heat-metric span { color: var(--text-secondary); font-weight: 600; }

        /* Agent Cards */
        .agent-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 25px; margin-bottom: 35px; }

        .agent-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .agent-card:hover { transform: translateY(-5px); box-shadow: 0 15px 50px rgba(0,0,0,0.3); }

        .agent-card.highlight {
            animation: highlightPulse 2s ease;
            box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.4);
        }

        @keyframes highlightPulse {
            0% { box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.6); }
            50% { box-shadow: 0 0 0 6px rgba(139, 92, 246, 0.5), 0 15px 50px rgba(139, 92, 246, 0.3); }
            100% { box-shadow: 0 0 0 0px transparent, 0 15px 50px rgba(0,0,0,0.3); }
        }

        .agent-card-header {
            padding: 22px;
            display: flex;
            align-items: flex-start;
            gap: 18px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .agent-icon {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            flex-shrink: 0;
        }

        .agent-info { flex: 1; }
        .agent-name { font-size: 1.15rem; font-weight: 700; color: var(--text-primary); margin-bottom: 5px; }
        .agent-type { font-size: 0.8rem; color: var(--accent-purple); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-priority {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .agent-priority.critical { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .agent-priority.high { background: rgba(249, 115, 22, 0.15); color: #f97316; }
        .agent-priority.medium { background: rgba(234, 179, 8, 0.15); color: #eab308; }
        .agent-priority.low { background: rgba(34, 197, 94, 0.15); color: #22c55e; }

        .agent-card-body { padding: 22px; }
        .agent-description { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; }

        .agent-flow {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 20px;
        }

        .agent-flow-title { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-flow-diagram { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; justify-content: center; }

        .agent-step {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .agent-arrow { color: var(--accent-purple); font-size: 1.2rem; }

        .agent-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }

        .agent-stat {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .agent-stat-value {
            font-size: 1.3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-top: 4px; }

        /* View Prompt Button */
        .agent-prompt-btn {
            width: 100%;
            margin-top: 18px;
            padding: 14px 20px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 10px;
            color: var(--accent-purple);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .agent-prompt-btn:hover {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(59, 130, 246, 0.3) 100%);
            border-color: var(--accent-purple);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.25);
        }

        /* Summary Stats */
        .agent-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .agent-summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            padding: 25px;
            text-align: center;
        }

        .agent-summary-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-summary-label { font-size: 0.9rem; color: var(--text-muted); margin-top: 8px; }

        /* Heat Map Legend */
        .heat-legend {
            display: flex;
            gap: 25px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .heat-legend-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; color: var(--text-secondary); }
        .heat-legend-color { width: 24px; height: 24px; border-radius: 6px; }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(10, 15, 26, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.show { display: flex; }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            width: 100%;
            max-width: 950px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 80px rgba(0,0,0,0.5);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            padding: 22px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 16px 16px 0 0;
        }

        .modal-header h3 { font-size: 1.25rem; font-weight: 700; }
        .modal-actions { display: flex; gap: 12px; }

        .modal-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: transform 0.2s;
            font-size: 0.9rem;
        }

        .modal-btn:hover { transform: scale(1.05); }
        .modal-btn.copy { background: white; color: var(--accent-blue); }
        .modal-btn.close { background: rgba(255,255,255,0.2); color: white; }

        .modal-body { padding: 28px; overflow-y: auto; flex: 1; }

        .modal-body pre {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            padding: 22px;
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.7;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--text-secondary);
        }

        .copy-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--accent-green);
            color: white;
            padding: 18px 35px;
            border-radius: 10px;
            font-weight: 700;
            z-index: 3000;
            display: none;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut { 0%, 100% { opacity: 0; } 10%, 90% { opacity: 1; } }

        /* Prompt Modal */
        .prompt-modal .modal { max-width: 800px; }
        .prompt-modal .modal-header { background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%); }

        .prompt-section { margin-bottom: 25px; }
        .prompt-section h4 { color: var(--accent-purple); font-size: 1rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }

        .prompt-box {
            background: rgba(0,0,0,0.4);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.7;
            color: var(--text-secondary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .prompt-tags { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .prompt-tag { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }

        .copy-prompt-btn {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 15px;
        }

        .copy-prompt-btn:hover { transform: scale(1.05); box-shadow: 0 5px 20px rgba(139, 92, 246, 0.3); }

        /* Step List */
        .step-list { list-style: none; padding: 0; margin: 18px 0; }
        .step-list li {
            padding: 14px 18px;
            border-left: 3px solid var(--accent-blue);
            background: rgba(0,0,0,0.2);
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
        }
        .step-list li strong { color: var(--text-primary); }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 75px 20px 30px 20px; }
            .agent-grid { grid-template-columns: 1fr; }
        }
            .breadcrumb-logo-link { display: flex; align-items: center; padding: 4px 8px; background: rgba(255,255,255,0.08); border-radius: 8px; border: 1px solid rgba(255,255,255,0.12); transition: all 0.2s; }
        .breadcrumb-logo-link:hover { background: rgba(255,255,255,0.15); }
        .breadcrumb-logo { height: 28px; width: auto; }
    </style>
</head>
<body>
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <a href="../../index.html" class="breadcrumb-logo-link"><img src="../../images/clear-ai-logo.png" alt="Clear AI" class="breadcrumb-logo"></a>
        <a href="../../index.html">Portal Home</a>
        <span class="separator">></span>
        <a href="./index.html">Mortgage Fundamentals</a>
        <span class="separator">></span>
        <span class="current">First-Time Homebuyer Budget Worksheet</span>
    </nav>

    <!-- Fixed Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>FTHB Budget Worksheet</h2>
            <p>Interactive Workflow Guide</p>
        </div>

        <!-- Tab Switcher -->
        <div class="sidebar-tabs">
            <button class="sidebar-tab active" onclick="switchTab('workflow')">Workflow</button>
            <button class="sidebar-tab agent-tab" onclick="switchTab('agents')">AI Agents</button>
        </div>

        <!-- Workflow Navigation -->
        <nav class="sidebar-nav" id="workflow-nav">
            <a href="#section-1" class="nav-item active">
                <span class="nav-number">1</span>
                <span class="nav-label">Overview & Purpose</span>
            </a>
            <a href="#section-2" class="nav-item">
                <span class="nav-number">2</span>
                <span class="nav-label">Income Categories</span>
            </a>
            <a href="#section-3" class="nav-item">
                <span class="nav-number">3</span>
                <span class="nav-label">Housing Expenses</span>
            </a>
            <a href="#section-4" class="nav-item">
                <span class="nav-number">4</span>
                <span class="nav-label">Living Expenses</span>
            </a>
            <a href="#section-5" class="nav-item">
                <span class="nav-number">5</span>
                <span class="nav-label">Debt Payments</span>
            </a>
            <a href="#section-6" class="nav-item">
                <span class="nav-number">6</span>
                <span class="nav-label">Calculate Results</span>
            </a>
            <a href="#section-7" class="nav-item">
                <span class="nav-number">7</span>
                <span class="nav-label">Mortgage Insurance</span>
            </a>
            <a href="#quick-ref" class="nav-item">
                <span class="nav-number">*</span>
                <span class="nav-label">Quick Reference</span>
            </a>
        </nav>

        <!-- Agent Navigation -->
        <nav class="sidebar-nav" id="agents-nav" style="display: none;">
            <a href="#agent-summary" class="nav-item active">
                <span class="nav-number">S</span>
                <span class="nav-label">Summary</span>
            </a>
            <a href="#agent-heatmap" class="nav-item">
                <span class="nav-number">H</span>
                <span class="nav-label">Heat Map</span>
            </a>
            <a href="#agent-details" class="nav-item">
                <span class="nav-number">A</span>
                <span class="nav-label">Agent Details</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="doc-btn" onclick="openDocModal()">
                View Worksheet Guide
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

        <!-- ==================== WORKFLOW TAB ==================== -->
        <div id="workflow-panel" class="tab-panel active">
            <!-- Header -->
            <div class="header">
                <h1>First-Time Homebuyer Budget Worksheet</h1>
                <p class="subtitle">Comprehensive budgeting tool to help first-time homebuyers understand their monthly finances and prepare for homeownership</p>
                <div class="meta">
                    <span class="meta-item">Source: Enact Mortgage Insurance</span>
                    <span class="meta-item">Audience: First-Time Homebuyers</span>
                    <span class="meta-item">Document: 01566.CB.1222</span>
                    <span class="meta-item">Duration: 15-30 min to complete</span>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #22c55e, #16a34a);"></div><span>Income Items</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></div><span>Housing Costs</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></div><span>Living Expenses</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f43f5e, #dc2626);"></div><span>Debt Payments</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #14b8a6, #0d9488);"></div><span>Savings/Results</span></div>
            </div>

            <!-- Section 1: Overview & Purpose -->
            <section id="section-1" class="section">
                <div class="section-header">
                    <div class="section-number">1</div>
                    <div class="section-title"><h2>Overview & Purpose</h2><span>Understanding the First-Time Homebuyer Budget Worksheet</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Start Budget Planning</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Gather Financial Info</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Complete Each Category</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Calculate Savings/Shortage</div>
                        </div>
                    </div>
                    <div class="info-box">
                        <h4>Purpose of the Budget Worksheet</h4>
                        <p>This worksheet helps first-time homebuyers create a comprehensive monthly budget by tracking all income sources and expenses. By comparing budgeted amounts to actual spending, borrowers can identify areas to reduce expenses and increase savings for a down payment.</p>
                    </div>

                    <div class="summary-grid">
                        <div class="summary-card">
                            <h4>Total Categories</h4>
                            <div class="value">10</div>
                            <div class="label">Expense Groups</div>
                        </div>
                        <div class="summary-card">
                            <h4>Income Sources</h4>
                            <div class="value">3</div>
                            <div class="label">Types Tracked</div>
                        </div>
                        <div class="summary-card">
                            <h4>Expense Items</h4>
                            <div class="value">25+</div>
                            <div class="label">Line Items</div>
                        </div>
                        <div class="summary-card">
                            <h4>Columns</h4>
                            <div class="value">3</div>
                            <div class="label">Budget/Actual/Diff</div>
                        </div>
                    </div>

                    <div class="tip-box">
                        <h4>Worksheet Structure</h4>
                        <p>The worksheet has three columns for each line item:</p>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li><strong>Monthly Budget Amount:</strong> What you plan to spend</li>
                            <li><strong>Monthly Actual Amount:</strong> What you actually spent</li>
                            <li><strong>Difference:</strong> Budget minus Actual (positive = under budget)</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 2: Income Categories -->
            <section id="section-2" class="section">
                <div class="section-header">
                    <div class="section-number">2</div>
                    <div class="section-title"><h2>Income Categories</h2><span>Document all sources of monthly income</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Salary/Wages</div>
                            <span class="flow-arrow">+</span>
                            <div class="flow-node action">Support/Benefits</div>
                            <span class="flow-arrow">+</span>
                            <div class="flow-node action">Other Income</div>
                            <span class="flow-arrow">=</span>
                            <div class="flow-node output">Total Monthly Income</div>
                        </div>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Income Source</th>
                                <th>Description</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Salary/Wages (after taxes)</strong></td>
                                <td>Net pay from employment after all deductions</td>
                                <td><span class="badge required-badge">Primary</span></td>
                            </tr>
                            <tr>
                                <td><strong>Alimony, Child Support, VA Benefits</strong></td>
                                <td>Court-ordered support payments or government benefits</td>
                                <td><span class="badge optional-badge">If Applicable</span></td>
                            </tr>
                            <tr>
                                <td><strong>Other Income</strong></td>
                                <td>Side jobs, rental income, investments, etc.</td>
                                <td><span class="badge optional-badge">If Applicable</span></td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="info-box">
                        <h4>Income Documentation Tips</h4>
                        <p>When completing the income section:</p>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>Use <strong>after-tax</strong> income (net pay, not gross)</li>
                            <li>Include only <strong>regular, recurring</strong> income sources</li>
                            <li>For variable income, use a <strong>conservative average</strong> of the last 3-6 months</li>
                            <li>Alimony and child support can only be counted if you choose to disclose it</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 3: Housing Expenses -->
            <section id="section-3" class="section">
                <div class="section-header">
                    <div class="section-number">3</div>
                    <div class="section-title"><h2>Housing Expenses</h2><span>Current housing costs and related utilities</span></div>
                </div>
                <div class="section-content">
                    <div class="budget-category">
                        <div class="budget-card">
                            <div class="budget-card-header">
                                <h4>Housing Costs</h4>
                            </div>
                            <div class="budget-card-body">
                                <ul>
                                    <li><span class="dollar-icon">$</span> Rent</li>
                                    <li><span class="dollar-icon">$</span> Renters Insurance</li>
                                    <li><span class="dollar-icon">$</span> Electricity/Gas/Oil</li>
                                    <li><span class="dollar-icon">$</span> Water/Sewer/Garbage</li>
                                    <li><span class="dollar-icon">$</span> Cable/Internet</li>
                                    <li><span class="dollar-icon">$</span> Telephone (Land Line, Cell)</li>
                                </ul>
                            </div>
                        </div>
                        <div class="budget-card">
                            <div class="budget-card-header">
                                <h4>Savings & Investments</h4>
                            </div>
                            <div class="budget-card-body">
                                <ul>
                                    <li><span class="check-icon">+</span> Savings Accounts</li>
                                    <li><span class="check-icon">+</span> Investment Contributions</li>
                                    <li><span class="check-icon">+</span> Retirement Accounts (401k, IRA)</li>
                                    <li><span class="check-icon">+</span> Emergency Fund</li>
                                    <li><span class="check-icon">+</span> Down Payment Savings</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Housing Item</th>
                                <th>Typical Range</th>
                                <th>Budget Tip</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Rent</strong></td>
                                <td>25-30% of gross income</td>
                                <td>Compare to projected mortgage payment</td>
                            </tr>
                            <tr>
                                <td><strong>Renters Insurance</strong></td>
                                <td>$15-30/month</td>
                                <td>Will convert to homeowners insurance</td>
                            </tr>
                            <tr>
                                <td><strong>Utilities</strong></td>
                                <td>$150-300/month</td>
                                <td>May increase with larger home</td>
                            </tr>
                            <tr>
                                <td><strong>Cable/Internet/Phone</strong></td>
                                <td>$100-200/month</td>
                                <td>Review for potential savings</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="tip-box">
                        <h4>Planning Ahead</h4>
                        <p>When transitioning to homeownership, these housing costs will change. Your rent will become a mortgage payment (principal, interest, taxes, insurance), and you may have additional costs like HOA fees, maintenance, and higher utility bills for a larger space.</p>
                    </div>
                </div>
            </section>

            <!-- Section 4: Living Expenses -->
            <section id="section-4" class="section">
                <div class="section-header">
                    <div class="section-number">4</div>
                    <div class="section-title"><h2>Living Expenses</h2><span>Daily living costs, family obligations, and discretionary spending</span></div>
                </div>
                <div class="section-content">
                    <div class="budget-category">
                        <div class="budget-card">
                            <div class="budget-card-header" style="background: linear-gradient(135deg, var(--accent-amber) 0%, #d97706 100%);">
                                <h4>Food</h4>
                            </div>
                            <div class="budget-card-body">
                                <ul>
                                    <li><span class="dollar-icon">$</span> Groceries</li>
                                    <li><span class="dollar-icon">$</span> Dining Out</li>
                                </ul>
                            </div>
                        </div>
                        <div class="budget-card">
                            <div class="budget-card-header" style="background: linear-gradient(135deg, var(--accent-amber) 0%, #d97706 100%);">
                                <h4>Family Obligations</h4>
                            </div>
                            <div class="budget-card-body">
                                <ul>
                                    <li><span class="dollar-icon">$</span> Childcare</li>
                                    <li><span class="dollar-icon">$</span> Child Support/Alimony</li>
                                </ul>
                            </div>
                        </div>
                        <div class="budget-card">
                            <div class="budget-card-header" style="background: linear-gradient(135deg, var(--accent-amber) 0%, #d97706 100%);">
                                <h4>Health & Medical</h4>
                            </div>
                            <div class="budget-card-body">
                                <ul>
                                    <li><span class="dollar-icon">$</span> Insurance (medical, life, long term care)</li>
                                    <li><span class="dollar-icon">$</span> Unreimbursed Medical Expenses, Copays</li>
                                </ul>
                            </div>
                        </div>
                        <div class="budget-card">
                            <div class="budget-card-header" style="background: linear-gradient(135deg, var(--accent-amber) 0%, #d97706 100%);">
                                <h4>Transportation</h4>
                            </div>
                            <div class="budget-card-body">
                                <ul>
                                    <li><span class="dollar-icon">$</span> Gas/Maintenance/Repairs/Insurance</li>
                                    <li><span class="dollar-icon">$</span> Other Transportation</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="decision-tree">
                        <h3>Other Expenses Category</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 15px;">Track discretionary and lifestyle spending:</p>
                        <ul class="step-list">
                            <li><strong>Clothing:</strong> Apparel, shoes, accessories for all family members</li>
                            <li><strong>Church/Charity:</strong> Tithing, donations, charitable contributions</li>
                            <li><strong>Education:</strong> Tuition, books, school supplies, training courses</li>
                            <li><strong>Hobbies/Subscriptions/Dues:</strong> Streaming services, gym memberships, club dues</li>
                            <li><strong>Recreation/Vacation/Entertainment:</strong> Movies, concerts, travel, dining experiences</li>
                            <li><strong>Pets:</strong> Food, veterinary care, supplies, grooming</li>
                        </ul>
                    </div>

                    <div class="exception-box">
                        <h4>Areas to Review for Savings</h4>
                        <p>These "Other Expenses" categories often contain the most opportunity for reducing spending. Consider:</p>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>Canceling unused subscriptions</li>
                            <li>Reducing dining out frequency</li>
                            <li>Planning staycations instead of expensive trips</li>
                            <li>Shopping sales for clothing needs</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 5: Debt Payments -->
            <section id="section-5" class="section">
                <div class="section-header">
                    <div class="section-number">5</div>
                    <div class="section-title"><h2>Debt Payments</h2><span>Track all recurring debt obligations</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node exception">Credit Cards</div>
                            <span class="flow-arrow">+</span>
                            <div class="flow-node exception">Student Loans</div>
                            <span class="flow-arrow">+</span>
                            <div class="flow-node exception">Car Loan</div>
                            <span class="flow-arrow">+</span>
                            <div class="flow-node exception">Other Loans</div>
                        </div>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Debt Type</th>
                                <th>Description</th>
                                <th>DTI Impact</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Credit Cards</strong></td>
                                <td>Monthly minimum payments on all credit cards</td>
                                <td><span class="badge required-badge">High Impact</span></td>
                            </tr>
                            <tr>
                                <td><strong>Student Loans</strong></td>
                                <td>Federal and private student loan payments</td>
                                <td><span class="badge required-badge">High Impact</span></td>
                            </tr>
                            <tr>
                                <td><strong>Car Loan</strong></td>
                                <td>Auto loan or lease payments</td>
                                <td><span class="badge required-badge">High Impact</span></td>
                            </tr>
                            <tr>
                                <td><strong>Other Loans</strong></td>
                                <td>Personal loans, 401k loans, HELOC, etc.</td>
                                <td><span class="badge required-badge">High Impact</span></td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="info-box">
                        <h4>Understanding DTI (Debt-to-Income Ratio)</h4>
                        <p>Your debt payments directly affect your mortgage qualification. Lenders calculate your DTI by dividing your monthly debt payments by your gross monthly income. Most conventional loans require:</p>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li><strong>Front-end DTI:</strong> Housing costs should be 28% or less of gross income</li>
                            <li><strong>Back-end DTI:</strong> Total debts should be 43-50% or less of gross income</li>
                        </ul>
                    </div>

                    <div class="tip-box">
                        <h4>Debt Reduction Strategies</h4>
                        <p>To improve your mortgage qualification:</p>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>Pay down credit card balances below 30% of limits</li>
                            <li>Avoid taking on new debt before applying</li>
                            <li>Consider paying off small loans entirely</li>
                            <li>Do not close old credit accounts (affects credit history)</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 6: Calculate Results -->
            <section id="section-6" class="section">
                <div class="section-header">
                    <div class="section-number">6</div>
                    <div class="section-title"><h2>Calculate Results</h2><span>Determine monthly savings or shortage</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Total Income</div>
                            <span class="flow-arrow">-</span>
                            <div class="flow-node action">Total Expenses</div>
                            <span class="flow-arrow">=</span>
                            <div class="flow-node decision">Result?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">POSITIVE</span>
                                <div class="flow-node output">Monthly Savings</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">NEGATIVE</span>
                                <div class="flow-node exception">Monthly Shortage</div>
                            </div>
                        </div>
                    </div>

                    <div class="decision-tree">
                        <h3>Calculation Formula</h3>
                        <ul class="step-list">
                            <li><strong>Step 1:</strong> Sum all Income items = <strong>Total Monthly Income</strong></li>
                            <li><strong>Step 2:</strong> Sum all Expense categories = <strong>Total Monthly Expenses</strong></li>
                            <li><strong>Step 3:</strong> Total Income - Total Expenses = <strong>Savings or Shortage</strong></li>
                            <li><strong>Step 4:</strong> Compare Budget column to Actual column for each line item</li>
                            <li><strong>Step 5:</strong> Calculate Difference (Budget - Actual) to identify overspending areas</li>
                        </ul>
                    </div>

                    <div class="summary-grid">
                        <div class="summary-card">
                            <h4>Target Savings</h4>
                            <div class="value">20%</div>
                            <div class="label">Of Income for Down Payment</div>
                        </div>
                        <div class="summary-card">
                            <h4>Emergency Fund</h4>
                            <div class="value">3-6</div>
                            <div class="label">Months of Expenses</div>
                        </div>
                        <div class="summary-card">
                            <h4>Closing Costs</h4>
                            <div class="value">2-5%</div>
                            <div class="label">Of Purchase Price</div>
                        </div>
                    </div>

                    <div class="tip-box">
                        <h4>If You Have a Shortage</h4>
                        <p>A negative result means you are spending more than you earn. To prepare for homeownership:</p>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>Review the Difference column to find overspending categories</li>
                            <li>Cut discretionary expenses (dining out, subscriptions, entertainment)</li>
                            <li>Look for ways to increase income (side job, raise, overtime)</li>
                            <li>Create a realistic budget and track spending weekly</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 7: Mortgage Insurance -->
            <section id="section-7" class="section">
                <div class="section-header">
                    <div class="section-number">7</div>
                    <div class="section-title"><h2>Private Mortgage Insurance (PMI)</h2><span>How PMI helps first-time homebuyers achieve homeownership faster</span></div>
                </div>
                <div class="section-content">
                    <div class="info-box">
                        <h4>About Enact Mortgage Insurance</h4>
                        <p>This worksheet is provided by Enact (formerly Genworth Mortgage Insurance). Enact mortgage insurers include Enact Mortgage Insurance Corporation and Enact Mortgage Insurance Corporation of North Carolina.</p>
                    </div>

                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node decision">Down Payment < 20%?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">YES</span>
                                <div class="flow-node action">PMI Required</div>
                                <span class="flow-arrow" style="transform: rotate(90deg);">-></span>
                                <div class="flow-node output">Buy Home Sooner!</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">NO</span>
                                <div class="flow-node output">No PMI Needed</div>
                            </div>
                        </div>
                    </div>

                    <div class="decision-tree">
                        <h3>Benefits of Private Mortgage Insurance</h3>
                        <ul class="step-list">
                            <li><strong>Lower Down Payment:</strong> Buy a home with as little as 3-5% down instead of 20%</li>
                            <li><strong>Faster Homeownership:</strong> Stop paying rent and start building equity sooner</li>
                            <li><strong>Temporary Cost:</strong> PMI can be removed once you reach 20% equity</li>
                            <li><strong>Tax Benefits:</strong> PMI premiums may be tax-deductible (consult tax advisor)</li>
                            <li><strong>Investment Returns:</strong> Home appreciation may outpace PMI costs</li>
                        </ul>
                    </div>

                    <div class="tip-box">
                        <h4>Talk to Your Loan Officer</h4>
                        <p>"Homeownership doesn't have to be a dream. Private mortgage insurance can get you into a house faster with less than a 20% down payment. Talk to your loan officer to learn more about the value of mortgage insurance from Enact."</p>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>PMI Factor</th>
                                <th>Typical Range</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Monthly PMI Cost</strong></td>
                                <td>0.5% - 1% of loan annually</td>
                                <td>Divided into monthly payments</td>
                            </tr>
                            <tr>
                                <td><strong>Minimum Down Payment</strong></td>
                                <td>3% - 5%</td>
                                <td>Varies by loan program</td>
                            </tr>
                            <tr>
                                <td><strong>PMI Cancellation</strong></td>
                                <td>At 80% LTV</td>
                                <td>Request when you reach 20% equity</td>
                            </tr>
                            <tr>
                                <td><strong>Automatic Termination</strong></td>
                                <td>At 78% LTV</td>
                                <td>Lender must remove automatically</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Quick Reference -->
            <div id="quick-ref" class="quick-ref">
                <h3>Budget Worksheet Quick Reference</h3>
                <pre>
FIRST-TIME HOMEBUYER BUDGET WORKSHEET
=====================================

INCOME CATEGORIES
-----------------
[ ] Salary/Wages (after taxes)
[ ] Alimony, Child Support, VA Benefits
[ ] Other Income
    -------------------------
    = TOTAL MONTHLY INCOME

EXPENSE CATEGORIES
------------------

HOUSING:
[ ] Rent
[ ] Renters Insurance
[ ] Electricity/Gas/Oil
[ ] Water/Sewer/Garbage
[ ] Cable/Internet
[ ] Telephone (Land Line, Cell)

SAVINGS & INVESTMENTS:
[ ] Savings & Investments

FOOD:
[ ] Groceries
[ ] Dining Out

FAMILY OBLIGATIONS:
[ ] Childcare
[ ] Child Support/Alimony

HEALTH & MEDICAL:
[ ] Insurance (medical, life, long term care)
[ ] Unreimbursed Medical Expenses, Copays

TRANSPORTATION:
[ ] Gas/Maintenance/Repairs/Insurance
[ ] Other Transportation

DEBT PAYMENTS:
[ ] Credit Cards
[ ] Student Loans
[ ] Car Loan
[ ] Other Loans

OTHER EXPENSES:
[ ] Clothing
[ ] Church/Charity
[ ] Education
[ ] Hobbies/Subscriptions/Dues
[ ] Recreation/Vacation/Entertainment
[ ] Pets
    -------------------------
    = TOTAL MONTHLY EXPENSES

CALCULATION
-----------
Total Income - Total Expenses = SAVINGS OR SHORTAGE

KEY RATIOS FOR MORTGAGE QUALIFICATION
=====================================
Front-end DTI:  Housing costs / Gross Income <= 28%
Back-end DTI:   All debts / Gross Income <= 43-50%
Down Payment:   Ideally 20%, but PMI allows 3-5%
Emergency Fund: 3-6 months of expenses
Closing Costs:  2-5% of purchase price

TIPS FOR FIRST-TIME HOMEBUYERS
==============================
1. Track spending for 2-3 months before completing
2. Use actual numbers, not estimates
3. Include ALL expenses, even small ones
4. Review subscriptions and cancel unused services
5. Pay down debt to improve DTI
6. Talk to a loan officer about PMI options
7. Start saving for down payment and closing costs

Source: Enact Mortgage Insurance (01566.CB.1222)
                </pre>
            </div>
        </div>

        <!-- ==================== AI AGENTS TAB ==================== -->
        <div id="agents-panel" class="tab-panel">
            <!-- Agent Header -->
            <div class="agent-header">
                <h1>AI Agent Opportunities</h1>
                <p class="subtitle">Automation opportunities identified for the First-Time Homebuyer Budget Worksheet process</p>
            </div>

            <!-- Summary Stats -->
            <div class="agent-summary" id="agent-summary">
                <div class="agent-summary-card">
                    <div class="agent-summary-value">4</div>
                    <div class="agent-summary-label">Agent Opportunities</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">85%</div>
                    <div class="agent-summary-label">Automation Potential</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">20 min</div>
                    <div class="agent-summary-label">Est. Time Saved</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">High</div>
                    <div class="agent-summary-label">Borrower Experience</div>
                </div>
            </div>

            <!-- Heat Map Legend -->
            <div class="heat-legend">
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #ef4444, #f97316);"></div>
                    <span>Critical Priority (9-10)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #f97316, #eab308);"></div>
                    <span>High Priority (7-8)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #eab308, #22c55e);"></div>
                    <span>Medium Priority (5-6)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #22c55e, #14b8a6);"></div>
                    <span>Low Priority (1-4)</span>
                </div>
            </div>

            <!-- Heat Map Grid -->
            <div class="heat-map-container" id="agent-heatmap">
                <div class="heat-map-title">Priority Heat Map</div>
                <div class="heat-map-grid">
                    <div class="heat-item critical" onclick="scrollToAgent('agent-autobudget')">
                        <div class="heat-score">9.5</div>
                        <div class="heat-name">Auto-Budget Agent</div>
                        <div class="heat-desc">Auto-populate budget from bank transaction data</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>15 min</span></div>
                            <div class="heat-metric">Complexity: <span>Medium</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-dticalc')">
                        <div class="heat-score">8.3</div>
                        <div class="heat-name">DTI Calculator Agent</div>
                        <div class="heat-desc">Real-time DTI calculation and mortgage readiness</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>5 min</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-savings')">
                        <div class="heat-score">7.8</div>
                        <div class="heat-name">Savings Coach Agent</div>
                        <div class="heat-desc">Personalized expense reduction recommendations</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>N/A</span></div>
                            <div class="heat-metric">Complexity: <span>Medium</span></div>
                        </div>
                    </div>
                    <div class="heat-item medium" onclick="scrollToAgent('agent-pmi')">
                        <div class="heat-score">6.5</div>
                        <div class="heat-name">PMI Comparison Agent</div>
                        <div class="heat-desc">Compare PMI vs. saving for 20% down payment</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>3 min</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agent Details -->
            <div id="agent-details">
                <h2 style="color: var(--text-primary); margin-bottom: 25px; font-size: 1.5rem;">Agent Details</h2>
                <div class="agent-grid">
                    <!-- Auto-Budget Agent -->
                    <div class="agent-card" id="agent-autobudget">
                        <div class="agent-card-header">
                            <div class="agent-icon">B</div>
                            <div class="agent-info">
                                <div class="agent-name">Auto-Budget Agent</div>
                                <div class="agent-type">Data Integration / Financial API</div>
                            </div>
                            <span class="agent-priority critical">Critical</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Connects to borrower's bank accounts via Plaid or similar API to automatically categorize transactions and populate the budget worksheet with actual spending data. Eliminates manual entry and provides accurate historical averages.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Connect Bank</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Pull Transactions</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Categorize</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Populate Worksheet</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">15 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">98%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Med</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('autobudget')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- DTI Calculator Agent -->
                    <div class="agent-card" id="agent-dticalc">
                        <div class="agent-card-header">
                            <div class="agent-icon">D</div>
                            <div class="agent-info">
                                <div class="agent-name">DTI Calculator Agent</div>
                                <div class="agent-type">Financial Analysis / Calculation</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Automatically calculates front-end and back-end DTI ratios based on budget worksheet data. Provides real-time mortgage qualification assessment and shows how much home the borrower can afford at current debt levels.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Read Budget</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Calculate DTI</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Assess Readiness</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Show Affordability</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">5 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">99%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('dticalc')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Savings Coach Agent -->
                    <div class="agent-card" id="agent-savings">
                        <div class="agent-card-header">
                            <div class="agent-icon">S</div>
                            <div class="agent-info">
                                <div class="agent-name">Savings Coach Agent</div>
                                <div class="agent-type">AI Analysis / Recommendations</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Analyzes the completed budget worksheet and provides personalized recommendations to reduce expenses and increase savings. Identifies subscriptions to cancel, spending patterns to adjust, and creates a customized savings plan for the down payment goal.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Analyze Budget</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Find Opportunities</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Create Plan</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Track Progress</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">N/A</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">85%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Med</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('savings')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- PMI Comparison Agent -->
                    <div class="agent-card" id="agent-pmi">
                        <div class="agent-card-header">
                            <div class="agent-icon">P</div>
                            <div class="agent-info">
                                <div class="agent-name">PMI Comparison Agent</div>
                                <div class="agent-type">Financial Modeling / Comparison</div>
                            </div>
                            <span class="agent-priority medium">Medium</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Compares the total cost of buying now with PMI versus waiting to save a 20% down payment. Factors in home price appreciation, rent costs during waiting period, and PMI costs to provide a clear financial comparison.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Input Scenario</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Model Both Options</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Calculate Costs</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Show Comparison</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">3 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">95%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('pmi')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Documentation Modal -->
    <div class="modal-overlay" id="docModal">
        <div class="modal">
            <div class="modal-header">
                <h3>FTHB Budget Worksheet Documentation</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyToClipboard()">Copy</button>
                    <button class="modal-btn close" onclick="closeDocModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <pre id="docContent"># First-Time Homebuyer Budget Worksheet

## Overview
A comprehensive monthly budgeting tool from Enact Mortgage Insurance to help first-time homebuyers understand their finances and prepare for homeownership.

## Income Categories
- Salary/Wages (after taxes)
- Alimony, Child Support, VA Benefits
- Other Income

## Expense Categories

### Housing
- Rent, Renters Insurance
- Utilities (Electric, Gas, Water)
- Cable/Internet/Phone

### Savings & Investments
- Savings contributions
- Investment accounts

### Food
- Groceries
- Dining Out

### Family Obligations
- Childcare
- Child Support/Alimony

### Health & Medical
- Insurance premiums
- Copays and unreimbursed expenses

### Transportation
- Gas, Maintenance, Insurance
- Other transportation costs

### Debt Payments
- Credit Cards
- Student Loans
- Car Loan
- Other Loans

### Other Expenses
- Clothing, Church/Charity, Education
- Hobbies, Entertainment, Pets

## Calculation
Total Income - Total Expenses = Savings or Shortage

## PMI Benefits
Private mortgage insurance allows homeownership with less than 20% down payment, getting borrowers into homes faster.

Source: Enact Mortgage Insurance (01566.CB.1222)</pre>
            </div>
        </div>
    </div>

    <!-- AI Prompt Modal -->
    <div class="modal-overlay prompt-modal" id="promptModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="promptModalTitle">AI Agent Build Prompt</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyPromptToClipboard()">Copy Prompt</button>
                    <button class="modal-btn close" onclick="closePromptModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="prompt-tags" id="promptTags"></div>
                <div class="prompt-section">
                    <h4>Agent Purpose</h4>
                    <div class="prompt-box" id="promptPurpose"></div>
                </div>
                <div class="prompt-section">
                    <h4>Full Build Prompt</h4>
                    <div class="prompt-box" id="promptContent"></div>
                </div>
                <div class="prompt-section">
                    <h4>Integration Points</h4>
                    <div class="prompt-box" id="promptIntegration"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="copy-success" id="copySuccess">Copied to clipboard!</div>

    <script>
        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));

            if (tab === 'workflow') {
                document.querySelector('.sidebar-tab:not(.agent-tab)').classList.add('active');
                document.getElementById('workflow-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'block';
                document.getElementById('agents-nav').style.display = 'none';
            } else {
                document.querySelector('.sidebar-tab.agent-tab').classList.add('active');
                document.getElementById('agents-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'none';
                document.getElementById('agents-nav').style.display = 'block';
            }

            window.scrollTo(0, 0);
        }

        // Scroll spy with isScrolling flag and 1000ms timeout
        const sections = document.querySelectorAll('.section, .quick-ref');
        const navItems = document.querySelectorAll('#workflow-nav .nav-item');
        let isScrolling = false;
        let scrollTimeout;

        function updateActiveNav() {
            if (isScrolling) return;

            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                if (window.scrollY >= sectionTop) current = section.getAttribute('id');
            });
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + current) item.classList.add('active');
            });
        }

        // Handle nav click to temporarily disable scroll spy
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                isScrolling = true;
                clearTimeout(scrollTimeout);

                // Remove active from all, add to clicked
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');

                // Re-enable scroll spy after 1000ms
                scrollTimeout = setTimeout(() => {
                    isScrolling = false;
                }, 1000);
            });
        });

        window.addEventListener('scroll', updateActiveNav);

        // Modal
        function openDocModal() {
            document.getElementById('docModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeDocModal() {
            document.getElementById('docModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyToClipboard() {
            try {
                await navigator.clipboard.writeText(document.getElementById('docContent').textContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeDocModal(); closePromptModal(); } });
        document.getElementById('docModal').addEventListener('click', (e) => { if (e.target.id === 'docModal') closeDocModal(); });

        document.addEventListener('DOMContentLoaded', () => { updateActiveNav(); });

        // Scroll to agent card and highlight
        function scrollToAgent(agentId) {
            const agentCard = document.getElementById(agentId);
            if (agentCard) {
                document.querySelectorAll('.agent-card.highlight').forEach(card => {
                    card.classList.remove('highlight');
                });

                agentCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

                setTimeout(() => {
                    agentCard.classList.add('highlight');
                }, 300);

                setTimeout(() => {
                    agentCard.classList.remove('highlight');
                }, 2500);
            }
        }

        // Agent Prompt System
        const agentPrompts = {
            autobudget: {
                name: 'Auto-Budget Agent',
                tags: ['Data Integration', 'Financial API', 'Medium Complexity', 'Critical Priority'],
                purpose: `This agent automatically connects to borrower bank accounts via Plaid or similar financial APIs to retrieve transaction history, categorize expenses, and populate the budget worksheet with accurate actual spending data. This eliminates manual entry errors and provides a true picture of the borrower's financial situation.`,
                prompt: `You are building a Data Integration Agent for the First-Time Homebuyer Budget Worksheet.

AGENT NAME: Auto-Budget Agent
TYPE: Data Integration / Financial API

OBJECTIVE:
Create an agent that connects to borrower bank accounts, retrieves transaction history, automatically categorizes expenses, and populates the budget worksheet with accurate monthly averages.

INPUT DATA:
- Borrower consent token
- Bank account credentials (via Plaid Link)
- Date range (typically 3-6 months)

API INTEGRATION:
1. Plaid API
   - Endpoint: /transactions/get
   - Auth: OAuth 2.0
   - Categories: Auto-mapped to worksheet categories

2. Alternative: Yodlee, Finicity, or MX APIs

CATEGORY MAPPING:
{
  "plaid_category": "worksheet_category",
  "Food and Drink > Restaurants": "Dining Out",
  "Food and Drink > Groceries": "Groceries",
  "Payment > Rent": "Rent",
  "Utilities > Electric": "Electricity/Gas/Oil",
  "Transfer > Credit Card Payment": "Credit Cards",
  "Service > Insurance": "Insurance"
}

CALCULATION LOGIC:
1. Retrieve 3-6 months of transactions
2. Categorize each transaction
3. Calculate monthly average per category
4. Round to nearest dollar
5. Populate "Monthly Actual Amount" column

OUTPUT FORMAT:
{
  "category": "Groceries",
  "monthly_average": 425,
  "transaction_count": 24,
  "confidence": 0.95,
  "sample_merchants": ["Kroger", "Walmart", "Trader Joes"]
}

ERROR HANDLING:
- Missing category: Flag for manual review
- Unusual spending: Alert borrower to confirm
- API timeout: Retry with exponential backoff`,
                integration: `INTEGRATION POINTS:
1. Plaid Link (Frontend)
   - Secure bank connection modal
   - Multi-account support
   - OAuth flow handling

2. Transaction Processing (Backend)
   - Batch processing for large histories
   - Category confidence scoring
   - Deduplication for transfers

3. Worksheet Population
   - Real-time field updates
   - Visual confirmation of auto-fill
   - Override capability for borrower

4. Data Security
   - PCI DSS compliance
   - Token-based authentication
   - No storage of credentials

DEPLOYMENT:
- Triggered by borrower consent
- Background processing (30-60 seconds)
- Progress indicator during sync`
            },
            dticalc: {
                name: 'DTI Calculator Agent',
                tags: ['Financial Analysis', 'Calculation', 'Low Complexity', 'High Priority'],
                purpose: `This agent automatically calculates front-end and back-end debt-to-income ratios based on the completed budget worksheet. It provides real-time mortgage qualification assessment and shows the borrower exactly how much home they can afford at their current debt levels.`,
                prompt: `You are building a Financial Analysis Agent for the First-Time Homebuyer Budget Worksheet.

AGENT NAME: DTI Calculator Agent
TYPE: Financial Analysis / Calculation

OBJECTIVE:
Calculate DTI ratios in real-time as the budget worksheet is completed, providing instant feedback on mortgage qualification readiness.

INPUT DATA (from worksheet):
- Gross Monthly Income (before taxes)
- Net Monthly Income (after taxes)
- All debt payments (Credit Cards, Student Loans, Car Loan, Other)
- Current housing costs (Rent)

DTI CALCULATIONS:

1. Front-End DTI (Housing Ratio):
   Formula: (Proposed Housing Payment) / Gross Monthly Income
   Target: <= 28%

   Proposed Housing = Principal + Interest + Taxes + Insurance + PMI + HOA

2. Back-End DTI (Total Debt Ratio):
   Formula: (Total Monthly Debts) / Gross Monthly Income
   Target: <= 43% (Conventional), <= 50% (FHA)

   Total Debts = Housing + Credit Cards + Student Loans + Car + Other

AFFORDABILITY CALCULATION:
{
  "max_monthly_payment": "Gross Income * 0.28",
  "max_home_price": "Based on current rates + taxes + insurance",
  "current_front_end_dti": "Current Rent / Gross Income",
  "current_back_end_dti": "All Debts / Gross Income",
  "qualification_status": "QUALIFIED | NEAR_QUALIFIED | NEEDS_WORK"
}

REAL-TIME FEEDBACK:
- Green: DTI below 28%/43% - Ready to buy
- Yellow: DTI 28-35%/43-50% - Qualified with conditions
- Red: DTI above 35%/50% - Needs debt reduction

MORTGAGE SCENARIOS:
Calculate home affordability at:
- 3% down (with PMI)
- 5% down (with PMI)
- 10% down (with PMI)
- 20% down (no PMI)`,
                integration: `INTEGRATION POINTS:
1. Worksheet Data
   - Real-time calculation on field change
   - Gross income estimation from net
   - Debt payment validation

2. Rate API
   - Current mortgage rate lookup
   - Daily rate updates
   - Rate lock scenarios

3. Tax/Insurance Estimates
   - Property tax by ZIP code
   - Insurance rate averages
   - HOA fee estimates

4. User Interface
   - Visual DTI gauge/meter
   - Color-coded qualification status
   - Interactive affordability slider

DEPLOYMENT:
- JavaScript-based calculation
- No server round-trip needed
- Updates within 100ms of input change`
            },
            savings: {
                name: 'Savings Coach Agent',
                tags: ['AI Analysis', 'Recommendations', 'Medium Complexity', 'High Priority'],
                purpose: `This agent analyzes the completed budget worksheet using AI to identify personalized opportunities to reduce expenses and increase savings. It provides actionable recommendations ranked by impact and creates a customized savings plan to reach the down payment goal.`,
                prompt: `You are building an AI Analysis Agent for the First-Time Homebuyer Budget Worksheet.

AGENT NAME: Savings Coach Agent
TYPE: AI Analysis / Personalized Recommendations

OBJECTIVE:
Analyze budget data to identify expense reduction opportunities and create a personalized savings plan to reach the borrower's down payment goal.

INPUT DATA:
- Complete budget worksheet (all categories)
- Target home price
- Target down payment percentage
- Current savings balance
- Timeline to purchase

ANALYSIS CATEGORIES:

1. Subscription Audit
   - Identify streaming services, memberships
   - Compare to average spending
   - Calculate annual savings if canceled

2. Dining Out Analysis
   - Restaurant spending vs groceries ratio
   - Industry benchmarks (12-15% of food budget)
   - Meal planning suggestions

3. Transportation Review
   - Gas costs vs location
   - Insurance comparison options
   - Public transit alternatives

4. Discretionary Spending
   - Entertainment patterns
   - Shopping habits
   - Hobby costs

RECOMMENDATION FORMAT:
{
  "category": "Dining Out",
  "current_spend": 450,
  "recommended_spend": 200,
  "monthly_savings": 250,
  "difficulty": "MEDIUM",
  "action_items": [
    "Limit restaurant meals to 2x per week",
    "Use meal planning app",
    "Pack lunch for work"
  ],
  "annual_impact": 3000
}

SAVINGS PLAN OUTPUT:
{
  "goal": "20% down on $350,000 home = $70,000",
  "current_savings": 15000,
  "gap": 55000,
  "current_monthly_savings": 200,
  "recommended_monthly_savings": 850,
  "time_to_goal_current": "23 years",
  "time_to_goal_recommended": "5.4 years",
  "priority_actions": [
    { "action": "Cancel unused subscriptions", "impact": 75 },
    { "action": "Reduce dining out by 50%", "impact": 250 },
    { "action": "Switch to cheaper phone plan", "impact": 50 }
  ]
}`,
                integration: `INTEGRATION POINTS:
1. Budget Data Processing
   - Pattern recognition across categories
   - Benchmark comparison database
   - Historical trend analysis

2. AI/ML Model
   - Recommendation engine
   - Priority scoring algorithm
   - Natural language generation for tips

3. Goal Tracking
   - Progress visualization
   - Milestone celebrations
   - Trend charts

4. Notifications
   - Weekly progress updates
   - Spending alerts
   - Goal achievement notifications

DEPLOYMENT:
- Initial analysis on worksheet completion
- Weekly re-analysis with updated data
- Push notifications for milestones`
            },
            pmi: {
                name: 'PMI Comparison Agent',
                tags: ['Financial Modeling', 'Comparison', 'Low Complexity', 'Medium Priority'],
                purpose: `This agent compares the total cost of buying a home now with PMI versus waiting to save a 20% down payment. It factors in home price appreciation, rent costs during the waiting period, opportunity cost of equity building, and PMI costs to provide a clear financial comparison.`,
                prompt: `You are building a Financial Modeling Agent for the First-Time Homebuyer Budget Worksheet.

AGENT NAME: PMI Comparison Agent
TYPE: Financial Modeling / Scenario Comparison

OBJECTIVE:
Compare the total financial impact of buying now with PMI vs. waiting to save 20% down payment, accounting for all relevant factors.

INPUT DATA:
- Target home price: $350,000
- Current savings: $17,500 (5%)
- Monthly savings capacity: $500
- Current monthly rent: $1,800
- Local appreciation rate: 4%/year
- Mortgage rate: 6.5%
- PMI rate: 0.8%/year

SCENARIO A: BUY NOW WITH PMI
{
  "down_payment": "$17,500 (5%)",
  "loan_amount": "$332,500",
  "monthly_pmi": "$222",
  "pmi_duration_months": 72,
  "total_pmi_cost": "$15,984",
  "equity_built_5yr": "$52,000",
  "home_value_5yr": "$425,835",
  "wealth_position_5yr": "Own $93,835 equity"
}

SCENARIO B: WAIT FOR 20% DOWN
{
  "months_to_save": 90,
  "rent_paid_waiting": "$162,000",
  "home_price_at_purchase": "$460,000",
  "down_payment_needed": "$92,000",
  "equity_at_purchase": "$92,000",
  "missed_appreciation": "$110,000",
  "wealth_position_5yr": "Rent longer, bigger loan"
}

COMPARISON OUTPUT:
{
  "winner": "BUY NOW",
  "5_year_advantage": "$48,000",
  "key_factors": [
    "Rent paid while saving: -$162,000",
    "Appreciation captured: +$75,835",
    "PMI cost: -$15,984",
    "Earlier equity building: +$52,000"
  ],
  "breakeven_appreciation_rate": "1.5%",
  "recommendation": "Buy now if home prices appreciate > 1.5%/year"
}

VISUALIZATION:
- Side-by-side wealth trajectory chart
- PMI payoff timeline
- Rent vs. own crossover point`,
                integration: `INTEGRATION POINTS:
1. Market Data
   - Local appreciation rates (Zillow API)
   - Current mortgage rates
   - PMI rate lookup tables

2. Calculator Engine
   - Amortization schedules
   - PMI payoff projections
   - Compound appreciation

3. Visualization
   - Interactive charts (Chart.js)
   - Scenario sliders
   - PDF export for loan officer

4. Integration with Worksheet
   - Auto-pull current savings
   - Use savings rate from budget
   - Incorporate rent from housing section

DEPLOYMENT:
- Interactive web calculator
- Instant recalculation on input change
- Shareable results URL`
            }
        };

        // Show agent prompt modal
        let currentPromptContent = '';

        function showAgentPrompt(agentKey) {
            const agent = agentPrompts[agentKey];
            if (!agent) return;

            document.getElementById('promptModalTitle').textContent = agent.name + ' - Build Prompt';

            const tagsHtml = agent.tags.map(tag => '<span class="prompt-tag">' + tag + '</span>').join('');
            document.getElementById('promptTags').innerHTML = tagsHtml;

            document.getElementById('promptPurpose').textContent = agent.purpose;
            document.getElementById('promptContent').textContent = agent.prompt;
            document.getElementById('promptIntegration').textContent = agent.integration;

            currentPromptContent = '# ' + agent.name + '\n\n## Purpose\n' + agent.purpose + '\n\n## Build Prompt\n' + agent.prompt + '\n\n## Integration Points\n' + agent.integration;

            document.getElementById('promptModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closePromptModal() {
            document.getElementById('promptModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyPromptToClipboard() {
            try {
                await navigator.clipboard.writeText(currentPromptContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) {
                alert('Failed to copy prompt.');
            }
        }

        document.getElementById('promptModal').addEventListener('click', (e) => {
            if (e.target.id === 'promptModal') closePromptModal();
        });
    </script>
</body>
</html>
