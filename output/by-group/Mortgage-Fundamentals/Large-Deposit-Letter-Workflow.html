<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Large Deposit Letter - Process Workflow</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: #111827;
            --bg-card: #1a2234;
            --accent-blue: #3b82f6;
            --accent-teal: #14b8a6;
            --accent-amber: #f59e0b;
            --accent-rose: #f43f5e;
            --accent-green: #22c55e;
            --accent-purple: #8b5cf6;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-subtle: rgba(255,255,255,0.08);
            --sidebar-width: 280px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Breadcrumb */
        .breadcrumb {
            background: linear-gradient(90deg, #0d1525 0%, #1a2234 100%);
            padding: 14px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
            border-bottom: 1px solid var(--border-subtle);
        }

        .breadcrumb a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            transition: all 0.2s;
            border: 1px solid var(--border-subtle);
        }

        .breadcrumb a:hover {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .breadcrumb .separator { color: var(--text-muted); font-size: 1.2rem; }
        .breadcrumb .current { color: var(--accent-amber); font-weight: 600; padding: 8px 16px; }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 54px;
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - 54px);
            background: var(--bg-secondary);
            overflow-y: auto;
            z-index: 1000;
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 25px 20px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-header h2 { color: var(--text-primary); font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
        .sidebar-header p { color: var(--text-muted); font-size: 0.85rem; }

        /* Tab Switch */
        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-tab {
            flex: 1;
            padding: 14px 10px;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            background: none;
            border-left: none;
            border-right: none;
            border-top: none;
        }

        .sidebar-tab:hover { background: rgba(255,255,255,0.03); color: var(--text-secondary); }
        .sidebar-tab.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); background: rgba(59, 130, 246, 0.08); }
        .sidebar-tab.agent-tab.active { color: var(--accent-purple); border-bottom-color: var(--accent-purple); background: rgba(139, 92, 246, 0.08); }

        .sidebar-nav { padding: 15px 0; flex: 1; overflow-y: auto; }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .nav-item:hover { background: rgba(255,255,255,0.03); color: var(--text-primary); }
        .nav-item.active { background: rgba(59, 130, 246, 0.1); border-left-color: var(--accent-blue); color: var(--text-primary); }

        .nav-number {
            background: rgba(255,255,255,0.1);
            color: var(--text-secondary);
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .nav-item.active .nav-number { background: var(--accent-blue); color: white; }
        .nav-label { font-size: 0.95rem; font-weight: 500; }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-subtle);
            background: rgba(0,0,0,0.2);
        }

        .doc-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px 20px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .doc-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3); }

        /* Main Content */
        .main-content { margin-left: var(--sidebar-width); padding: 80px 40px 40px 40px; }

        /* Tab Panels */
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        .header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(20, 184, 166, 0.08) 0%, transparent 50%);
            pointer-events: none;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        .header .meta { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; position: relative; }

        .header .meta-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-subtle);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); }
        .legend-color { width: 18px; height: 18px; border-radius: 4px; }

        /* Sections */
        .section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            margin-bottom: 25px;
            overflow: hidden;
            scroll-margin-top: 75px;
        }

        .section-header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(59, 130, 246, 0.1) 100%);
            border-bottom: 1px solid var(--border-subtle);
            padding: 22px 25px;
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .section-number {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .section-title h2 { font-size: 1.35rem; font-weight: 700; margin-bottom: 4px; color: var(--text-primary); }
        .section-title span { font-size: 0.9rem; color: var(--text-muted); }
        .section-content { padding: 28px; }

        /* Workflow Diagrams */
        .workflow-diagram {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 28px;
            margin-bottom: 22px;
        }

        .flow-row { display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 12px; margin: 15px 0; }

        .flow-node {
            padding: 14px 22px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            min-width: 150px;
            border: 1px solid var(--border-subtle);
        }

        .flow-node.start { background: linear-gradient(135deg, var(--accent-green) 0%, #16a34a 100%); color: white; border-radius: 25px; border: none; }
        .flow-node.action { background: linear-gradient(135deg, var(--accent-blue) 0%, #2563eb 100%); color: white; border: none; }
        .flow-node.decision { background: linear-gradient(135deg, var(--accent-amber) 0%, #d97706 100%); color: var(--bg-primary); border: none; }
        .flow-node.input { background: var(--bg-secondary); border: 2px solid var(--accent-blue); color: var(--text-primary); }
        .flow-node.output { background: linear-gradient(135deg, var(--accent-teal) 0%, #0d9488 100%); color: white; border: none; }
        .flow-node.exception { background: linear-gradient(135deg, var(--accent-rose) 0%, #dc2626 100%); color: white; border: none; }

        .flow-arrow { color: var(--accent-blue); font-size: 1.5rem; }
        .flow-arrow.down { transform: rotate(90deg); }

        .decision-branch { display: flex; gap: 40px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
        .branch { display: flex; flex-direction: column; align-items: center; gap: 10px; }

        .branch-label {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        /* Tables */
        .field-table { width: 100%; border-collapse: collapse; margin: 18px 0; }

        .field-table th {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            padding: 14px 18px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border-subtle);
        }

        .field-table td { padding: 14px 18px; border-bottom: 1px solid var(--border-subtle); color: var(--text-secondary); }
        .field-table tr:hover { background: rgba(255,255,255,0.02); }

        .badge { display: inline-block; padding: 4px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge.required-badge { background: rgba(244, 63, 94, 0.15); color: var(--accent-rose); }
        .badge.optional-badge { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .badge.calculated-badge { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }

        /* Info Boxes */
        .exception-box, .tip-box, .info-box, .warning-box {
            padding: 18px 22px;
            margin: 18px 0;
            border-radius: 0 10px 10px 0;
            border-left-width: 4px;
            border-left-style: solid;
        }

        .exception-box { background: rgba(244, 63, 94, 0.08); border-color: var(--accent-rose); border: 1px solid rgba(244, 63, 94, 0.2); border-left: 4px solid var(--accent-rose); }
        .exception-box h4 { color: var(--accent-rose); margin-bottom: 10px; font-size: 1rem; }
        .exception-box p, .exception-box li { color: var(--text-secondary); }

        .tip-box { background: rgba(34, 197, 94, 0.08); border-color: var(--accent-green); border: 1px solid rgba(34, 197, 94, 0.2); border-left: 4px solid var(--accent-green); }
        .tip-box h4 { color: var(--accent-green); margin-bottom: 10px; font-size: 1rem; }
        .tip-box p, .tip-box li { color: var(--text-secondary); }

        .info-box { background: rgba(59, 130, 246, 0.08); border-color: var(--accent-blue); border: 1px solid rgba(59, 130, 246, 0.2); border-left: 4px solid var(--accent-blue); }
        .info-box h4 { color: var(--accent-blue); margin-bottom: 10px; font-size: 1rem; }
        .info-box p, .info-box li { color: var(--text-secondary); }

        .warning-box { background: rgba(245, 158, 11, 0.08); border-color: var(--accent-amber); border: 1px solid rgba(245, 158, 11, 0.2); border-left: 4px solid var(--accent-amber); }
        .warning-box h4 { color: var(--accent-amber); margin-bottom: 10px; font-size: 1rem; }
        .warning-box p, .warning-box li { color: var(--text-secondary); }

        /* Decision Tree */
        .decision-tree {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 22px;
            margin: 22px 0;
        }

        .decision-tree h3 { color: var(--accent-blue); margin-bottom: 18px; padding-bottom: 12px; border-bottom: 1px solid var(--border-subtle); font-size: 1.1rem; }

        .tree-node { margin-left: 20px; padding: 12px; border-left: 2px solid var(--accent-teal); position: relative; color: var(--text-secondary); }
        .tree-node::before { content: ''; position: absolute; left: -2px; top: 22px; width: 15px; height: 2px; background: var(--accent-teal); }
        .tree-node.level-1 { margin-left: 0; border-left: none; }
        .tree-node.level-1::before { display: none; }

        .tree-label { background: var(--accent-amber); color: var(--bg-primary); padding: 6px 14px; border-radius: 6px; font-weight: 700; display: inline-block; margin-bottom: 6px; font-size: 0.9rem; }

        /* Summary Grid */
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 18px; margin: 22px 0; }

        .summary-card { background: rgba(0,0,0,0.3); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 22px; text-align: center; }
        .summary-card h4 { color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9rem; }
        .summary-card .value {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .summary-card .label { font-size: 0.85rem; color: var(--text-muted); margin-top: 8px; }

        /* Form Preview */
        .form-preview {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 22px;
            margin: 22px 0;
        }

        .form-preview h3 { color: var(--accent-teal); margin-bottom: 18px; font-size: 1.1rem; }

        .form-field {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            padding: 14px 18px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .form-field-label { color: var(--text-primary); font-weight: 600; }
        .form-field-value { color: var(--text-muted); font-style: italic; }

        /* Quick Reference */
        .quick-ref {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
            border: 1px solid var(--border-subtle);
            padding: 28px;
            border-radius: 16px;
            margin-top: 30px;
            font-family: 'JetBrains Mono', monospace;
            scroll-margin-top: 75px;
        }

        .quick-ref h3 { color: var(--accent-amber); margin-bottom: 18px; font-family: 'Plus Jakarta Sans', sans-serif; }
        .quick-ref pre { background: rgba(0,0,0,0.4); border: 1px solid var(--border-subtle); padding: 20px; border-radius: 10px; overflow-x: auto; font-size: 0.85rem; line-height: 1.7; color: var(--text-secondary); }

        /* ====== AGENT OPPORTUNITIES STYLES ====== */
        .agent-header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .agent-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(139, 92, 246, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .agent-header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        /* Heat Map */
        .heat-map-container { margin-bottom: 35px; }
        .heat-map-title { font-size: 1.3rem; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }

        .heat-map-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .heat-item {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .heat-item:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .heat-item:active { transform: scale(0.98); }

        .heat-item::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 4px;
        }

        .heat-item.critical::before { background: linear-gradient(90deg, #ef4444, #f97316); }
        .heat-item.high::before { background: linear-gradient(90deg, #f97316, #eab308); }
        .heat-item.medium::before { background: linear-gradient(90deg, #eab308, #22c55e); }
        .heat-item.low::before { background: linear-gradient(90deg, #22c55e, #14b8a6); }

        .heat-score {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.8rem;
            font-weight: 800;
        }

        .heat-item.critical .heat-score { color: #ef4444; }
        .heat-item.high .heat-score { color: #f97316; }
        .heat-item.medium .heat-score { color: #eab308; }
        .heat-item.low .heat-score { color: #22c55e; }

        .heat-name { font-size: 1rem; font-weight: 700; color: var(--text-primary); margin-bottom: 6px; padding-right: 50px; }
        .heat-desc { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; }

        .heat-metrics { display: flex; gap: 15px; margin-top: 12px; }
        .heat-metric { font-size: 0.75rem; color: var(--text-muted); }
        .heat-metric span { color: var(--text-secondary); font-weight: 600; }

        /* Agent Cards */
        .agent-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 25px; margin-bottom: 35px; }

        .agent-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .agent-card:hover { transform: translateY(-5px); box-shadow: 0 15px 50px rgba(0,0,0,0.3); }

        .agent-card.highlight {
            animation: highlightPulse 2s ease;
            box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.4);
        }

        @keyframes highlightPulse {
            0% { box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.6); }
            50% { box-shadow: 0 0 0 6px rgba(139, 92, 246, 0.5), 0 15px 50px rgba(139, 92, 246, 0.3); }
            100% { box-shadow: 0 0 0 0px transparent, 0 15px 50px rgba(0,0,0,0.3); }
        }

        .agent-card-header {
            padding: 22px;
            display: flex;
            align-items: flex-start;
            gap: 18px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .agent-icon {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            flex-shrink: 0;
        }

        .agent-info { flex: 1; }
        .agent-name { font-size: 1.15rem; font-weight: 700; color: var(--text-primary); margin-bottom: 5px; }
        .agent-type { font-size: 0.8rem; color: var(--accent-purple); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-priority {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .agent-priority.critical { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .agent-priority.high { background: rgba(249, 115, 22, 0.15); color: #f97316; }
        .agent-priority.medium { background: rgba(234, 179, 8, 0.15); color: #eab308; }
        .agent-priority.low { background: rgba(34, 197, 94, 0.15); color: #22c55e; }

        .agent-card-body { padding: 22px; }
        .agent-description { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; }

        .agent-flow {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 20px;
        }

        .agent-flow-title { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-flow-diagram { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; justify-content: center; }

        .agent-step {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .agent-arrow { color: var(--accent-purple); font-size: 1.2rem; }

        .agent-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }

        .agent-stat {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .agent-stat-value {
            font-size: 1.3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-top: 4px; }

        /* View Prompt Button */
        .agent-prompt-btn {
            width: 100%;
            margin-top: 18px;
            padding: 14px 20px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 10px;
            color: var(--accent-purple);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .agent-prompt-btn:hover {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(59, 130, 246, 0.3) 100%);
            border-color: var(--accent-purple);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.25);
        }

        /* Summary Stats */
        .agent-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .agent-summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            padding: 25px;
            text-align: center;
        }

        .agent-summary-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-summary-label { font-size: 0.9rem; color: var(--text-muted); margin-top: 8px; }

        /* Heat Map Legend */
        .heat-legend {
            display: flex;
            gap: 25px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .heat-legend-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; color: var(--text-secondary); }
        .heat-legend-color { width: 24px; height: 24px; border-radius: 6px; }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(10, 15, 26, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.show { display: flex; }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            width: 100%;
            max-width: 950px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 80px rgba(0,0,0,0.5);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            padding: 22px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 16px 16px 0 0;
        }

        .modal-header h3 { font-size: 1.25rem; font-weight: 700; }
        .modal-actions { display: flex; gap: 12px; }

        .modal-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: transform 0.2s;
            font-size: 0.9rem;
        }

        .modal-btn:hover { transform: scale(1.05); }
        .modal-btn.copy { background: white; color: var(--accent-blue); }
        .modal-btn.close { background: rgba(255,255,255,0.2); color: white; }

        .modal-body { padding: 28px; overflow-y: auto; flex: 1; }

        .modal-body pre {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            padding: 22px;
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.7;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--text-secondary);
        }

        .copy-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--accent-green);
            color: white;
            padding: 18px 35px;
            border-radius: 10px;
            font-weight: 700;
            z-index: 3000;
            display: none;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut { 0%, 100% { opacity: 0; } 10%, 90% { opacity: 1; } }

        /* Prompt Modal */
        .prompt-modal .modal { max-width: 800px; }
        .prompt-modal .modal-header { background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%); }

        .prompt-section { margin-bottom: 25px; }
        .prompt-section h4 { color: var(--accent-purple); font-size: 1rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }

        .prompt-box {
            background: rgba(0,0,0,0.4);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.7;
            color: var(--text-secondary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .prompt-tags { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .prompt-tag { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }

        .copy-prompt-btn {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 15px;
        }

        .copy-prompt-btn:hover { transform: scale(1.05); box-shadow: 0 5px 20px rgba(139, 92, 246, 0.3); }

        /* Step List */
        .step-list { list-style: none; padding: 0; margin: 18px 0; }
        .step-list li {
            padding: 14px 18px;
            border-left: 3px solid var(--accent-blue);
            background: rgba(0,0,0,0.2);
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
        }
        .step-list li strong { color: var(--text-primary); }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 75px 20px 30px 20px; }
            .agent-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <a href="../../index.html">Portal Home</a>
        <span class="separator">></span>
        <a href="./index.html">Mortgage Fundamentals</a>
        <span class="separator">></span>
        <span class="current">Large Deposit Letter</span>
    </nav>

    <!-- Fixed Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>Large Deposit Letter</h2>
            <p>Interactive Workflow Guide</p>
        </div>

        <!-- Tab Switcher -->
        <div class="sidebar-tabs">
            <button class="sidebar-tab active" onclick="switchTab('workflow')">Workflow</button>
            <button class="sidebar-tab agent-tab" onclick="switchTab('agents')">AI Agents</button>
        </div>

        <!-- Workflow Navigation -->
        <nav class="sidebar-nav" id="workflow-nav">
            <a href="#section-1" class="nav-item active">
                <span class="nav-number">1</span>
                <span class="nav-label">Overview & Purpose</span>
            </a>
            <a href="#section-2" class="nav-item">
                <span class="nav-number">2</span>
                <span class="nav-label">When Required</span>
            </a>
            <a href="#section-3" class="nav-item">
                <span class="nav-number">3</span>
                <span class="nav-label">Form Fields</span>
            </a>
            <a href="#section-4" class="nav-item">
                <span class="nav-number">4</span>
                <span class="nav-label">Completion Process</span>
            </a>
            <a href="#section-5" class="nav-item">
                <span class="nav-number">5</span>
                <span class="nav-label">Acceptable Explanations</span>
            </a>
            <a href="#section-6" class="nav-item">
                <span class="nav-number">6</span>
                <span class="nav-label">Supporting Documentation</span>
            </a>
            <a href="#section-7" class="nav-item">
                <span class="nav-number">7</span>
                <span class="nav-label">Investor Guidelines</span>
            </a>
            <a href="#quick-ref" class="nav-item">
                <span class="nav-number">*</span>
                <span class="nav-label">Quick Reference</span>
            </a>
        </nav>

        <!-- Agent Navigation -->
        <nav class="sidebar-nav" id="agents-nav" style="display: none;">
            <a href="#agent-summary" class="nav-item active">
                <span class="nav-number">S</span>
                <span class="nav-label">Summary</span>
            </a>
            <a href="#agent-heatmap" class="nav-item">
                <span class="nav-number">H</span>
                <span class="nav-label">Heat Map</span>
            </a>
            <a href="#agent-details" class="nav-item">
                <span class="nav-number">A</span>
                <span class="nav-label">Agent Details</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="doc-btn" onclick="openDocModal()">
                View Workflow Markdown
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

        <!-- ==================== WORKFLOW TAB ==================== -->
        <div id="workflow-panel" class="tab-panel active">
            <!-- Header -->
            <div class="header">
                <h1>Large Deposit Letter</h1>
                <p class="subtitle">Complete guide for documenting and explaining large deposits on borrower bank statements per investor guidelines</p>
                <div class="meta">
                    <span class="meta-item">Document: CMG Financial Form</span>
                    <span class="meta-item">Role: Processor / LO</span>
                    <span class="meta-item">Updated: Dec 16, 2022</span>
                    <span class="meta-item">Duration: 5-15 min per deposit</span>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #22c55e, #16a34a);"></div><span>Start/End</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></div><span>Action Step</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></div><span>Decision Point</span></div>
                <div class="legend-item"><div class="legend-color" style="background: #111827; border: 2px solid #3b82f6;"></div><span>User Input</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f43f5e, #dc2626);"></div><span>Exception</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #14b8a6, #0d9488);"></div><span>Output</span></div>
            </div>

            <!-- Section 1: Overview & Purpose -->
            <section id="section-1" class="section">
                <div class="section-header">
                    <div class="section-number">1</div>
                    <div class="section-title"><h2>Overview & Purpose</h2><span>Understanding what large deposits are and why they must be documented</span></div>
                </div>
                <div class="section-content">
                    <div class="info-box">
                        <h4>What is a Large Deposit?</h4>
                        <p>A large deposit is any deposit appearing on bank statements that exceeds thresholds defined by investor guidelines. When bank statements (typically covering the most recent two months) are used to verify assets, lenders must evaluate all large deposits to ensure funds are from acceptable sources and are not borrowed funds that would affect the borrower's debt-to-income ratio.</p>
                    </div>

                    <div class="summary-grid">
                        <div class="summary-card">
                            <h4>Primary Purpose</h4>
                            <div class="value">Source</div>
                            <div class="label">Verify Fund Origins</div>
                        </div>
                        <div class="summary-card">
                            <h4>Compliance</h4>
                            <div class="value">100%</div>
                            <div class="label">Required Documentation</div>
                        </div>
                        <div class="summary-card">
                            <h4>Statement Period</h4>
                            <div class="value">2 Mo</div>
                            <div class="label">Typical Review Period</div>
                        </div>
                        <div class="summary-card">
                            <h4>Form Capacity</h4>
                            <div class="value">4</div>
                            <div class="label">Deposits Per Form</div>
                        </div>
                    </div>

                    <div class="tip-box">
                        <h4>Key Requirements</h4>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>Requirements for evaluating large deposits vary based on transaction type</li>
                            <li>Thresholds differ by investor (Fannie Mae, Freddie Mac, FHA, VA, etc.)</li>
                            <li>Borrower must provide written explanation AND supporting documentation</li>
                            <li>All borrowers on the loan must sign the letter</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 2: When Required -->
            <section id="section-2" class="section">
                <div class="section-header">
                    <div class="section-number">2</div>
                    <div class="section-title"><h2>When Large Deposit Letter is Required</h2><span>Understanding investor thresholds and transaction types</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Review Bank Statements</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Identify Deposits</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Exceeds Threshold?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">YES</span>
                                <div class="flow-node action">Request Large Deposit Letter</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">NO</span>
                                <div class="flow-node output">No Letter Required</div>
                            </div>
                        </div>
                    </div>

                    <div class="decision-tree">
                        <h3>Common Investor Thresholds</h3>
                        <div class="tree-node level-1">
                            <span class="tree-label">Fannie Mae / Freddie Mac (Conventional)</span>
                            Deposits exceeding 50% of qualifying monthly income must be documented
                        </div>
                        <div class="tree-node">
                            <span class="tree-label">FHA</span>
                            Deposits exceeding 1% of purchase price OR $1,000 (whichever is greater) require explanation
                        </div>
                        <div class="tree-node">
                            <span class="tree-label">VA</span>
                            Any large or unusual deposit not consistent with borrower's income profile
                        </div>
                        <div class="tree-node">
                            <span class="tree-label">USDA</span>
                            Deposits exceeding $500 that are not from employment income
                        </div>
                    </div>

                    <div class="warning-box">
                        <h4>Important: Transaction Type Matters</h4>
                        <p>Requirements for evaluating large deposits vary based on the transaction type. Always verify the specific investor guidelines for your loan program before determining what deposits need documentation.</p>
                    </div>
                </div>
            </section>

            <!-- Section 3: Form Fields -->
            <section id="section-3" class="section">
                <div class="section-header">
                    <div class="section-number">3</div>
                    <div class="section-title"><h2>Form Fields</h2><span>Required information for each large deposit entry</span></div>
                </div>
                <div class="section-content">
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">The Large Deposit Letter form accommodates up to four (4) deposit entries. Each entry requires the following fields to be completed:</p>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Field</th>
                                <th>Description</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Deposit Date</strong></td>
                                <td>The exact date the deposit was made as shown on the bank statement</td>
                                <td><span class="badge required-badge">Required</span></td>
                            </tr>
                            <tr>
                                <td><strong>Account Number</strong></td>
                                <td>The bank account number where the deposit was made (partial masking acceptable)</td>
                                <td><span class="badge required-badge">Required</span></td>
                            </tr>
                            <tr>
                                <td><strong>Amount</strong></td>
                                <td>The exact dollar amount of the deposit</td>
                                <td><span class="badge required-badge">Required</span></td>
                            </tr>
                            <tr>
                                <td><strong>Large Deposit Explanation</strong></td>
                                <td>Detailed written explanation of the source of funds</td>
                                <td><span class="badge required-badge">Required</span></td>
                            </tr>
                            <tr>
                                <td><strong>Borrower Signature(s)</strong></td>
                                <td>Signature of all borrowers on the loan application</td>
                                <td><span class="badge required-badge">Required</span></td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="form-preview">
                        <h3>Form Layout Preview</h3>
                        <div class="form-field">
                            <span class="form-field-label">Deposit Date:</span>
                            <span class="form-field-value">[MM/DD/YYYY]</span>
                        </div>
                        <div class="form-field">
                            <span class="form-field-label">Account Number:</span>
                            <span class="form-field-value">[XXXX-XXXX-1234]</span>
                        </div>
                        <div class="form-field">
                            <span class="form-field-label">Amount:</span>
                            <span class="form-field-value">[$X,XXX.XX]</span>
                        </div>
                        <div class="form-field">
                            <span class="form-field-label">Large Deposit Explanation:</span>
                            <span class="form-field-value">[Detailed explanation of fund source]</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 4: Completion Process -->
            <section id="section-4" class="section">
                <div class="section-header">
                    <div class="section-number">4</div>
                    <div class="section-title"><h2>Completion Process</h2><span>Step-by-step workflow for completing the Large Deposit Letter</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Start</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Print Form</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">Complete Information</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Borrower Signs</div>
                        </div>
                        <div class="flow-row">
                            <div class="flow-node action">Collect Documentation</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Return to CMG Rep</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Store in Loan File</div>
                        </div>
                    </div>

                    <ul class="step-list">
                        <li><strong>Step 1: Print the Form</strong> - Print the Large Deposit Letter page from the CMG Financial system or PDF</li>
                        <li><strong>Step 2: Complete Deposit Information</strong> - Fill in all required fields for each large deposit identified (up to 4 per form)</li>
                        <li><strong>Step 3: Write Explanation</strong> - Provide a detailed, clear explanation of the source of each deposit</li>
                        <li><strong>Step 4: Obtain Signatures</strong> - All borrowers on the loan application must sign and date the form</li>
                        <li><strong>Step 5: Gather Supporting Docs</strong> - Collect all supporting documentation that verifies the explanation</li>
                        <li><strong>Step 6: Return to CMG</strong> - Submit the completed letter and documentation to your CMG Financial Representative</li>
                    </ul>

                    <div class="tip-box">
                        <h4>Pro Tip: Multiple Deposits</h4>
                        <p>If you have more than 4 large deposits to explain, print additional copies of the form. Each form can document up to 4 deposits. Ensure all forms are signed by all borrowers.</p>
                    </div>
                </div>
            </section>

            <!-- Section 5: Acceptable Explanations -->
            <section id="section-5" class="section">
                <div class="section-header">
                    <div class="section-number">5</div>
                    <div class="section-title"><h2>Acceptable Explanations</h2><span>Common acceptable sources of large deposits</span></div>
                </div>
                <div class="section-content">
                    <div class="decision-tree">
                        <h3>Commonly Accepted Deposit Sources</h3>
                        <div class="tree-node level-1">
                            <span class="tree-label">Tax Refund</span>
                            IRS refund or state tax refund - requires copy of tax return showing refund amount
                        </div>
                        <div class="tree-node">
                            <span class="tree-label">Gift Funds</span>
                            Gift from family member - requires signed gift letter and donor bank statements showing ability to give
                        </div>
                        <div class="tree-node">
                            <span class="tree-label">Sale of Asset</span>
                            Sale of vehicle, stocks, property - requires bill of sale or sale documentation
                        </div>
                        <div class="tree-node">
                            <span class="tree-label">Bonus / Commission</span>
                            Employment bonus or commission - requires pay stub or employer letter
                        </div>
                        <div class="tree-node">
                            <span class="tree-label">Insurance Settlement</span>
                            Insurance payout - requires settlement letter from insurance company
                        </div>
                        <div class="tree-node">
                            <span class="tree-label">Inheritance</span>
                            Inherited funds - requires estate documentation or letter from executor
                        </div>
                        <div class="tree-node">
                            <span class="tree-label">Transfer Between Own Accounts</span>
                            Moving funds between accounts - requires statements from both accounts showing transfer
                        </div>
                        <div class="tree-node">
                            <span class="tree-label">Cash Accumulation</span>
                            Accumulated cash deposits - may require additional documentation; often scrutinized closely
                        </div>
                    </div>

                    <div class="exception-box">
                        <h4>Unacceptable Deposit Sources</h4>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>Borrowed funds that create additional debt (unless disclosed and included in DTI)</li>
                            <li>Undocumented cash deposits without clear paper trail</li>
                            <li>Funds from unknown or anonymous sources</li>
                            <li>Deposits that cannot be verified with documentation</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 6: Supporting Documentation -->
            <section id="section-6" class="section">
                <div class="section-header">
                    <div class="section-number">6</div>
                    <div class="section-title"><h2>Supporting Documentation</h2><span>Required documentation by deposit type</span></div>
                </div>
                <div class="section-content">
                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Deposit Source</th>
                                <th>Required Documentation</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Tax Refund</strong></td>
                                <td>Copy of tax return showing refund amount; IRS transcript if available</td>
                            </tr>
                            <tr>
                                <td><strong>Gift Funds</strong></td>
                                <td>Signed Gift Letter; Donor's bank statement showing withdrawal; Evidence of transfer</td>
                            </tr>
                            <tr>
                                <td><strong>Sale of Vehicle</strong></td>
                                <td>Bill of Sale; Copy of title transfer; Kelley Blue Book value if applicable</td>
                            </tr>
                            <tr>
                                <td><strong>Sale of Stocks/Investments</strong></td>
                                <td>Brokerage statement showing sale; 1099-B if available</td>
                            </tr>
                            <tr>
                                <td><strong>Employment Bonus</strong></td>
                                <td>Pay stub showing bonus payment; Employer letter confirming bonus</td>
                            </tr>
                            <tr>
                                <td><strong>Insurance Settlement</strong></td>
                                <td>Settlement letter from insurance company; Claim documentation</td>
                            </tr>
                            <tr>
                                <td><strong>Inheritance</strong></td>
                                <td>Estate documentation; Letter from executor; Probate documents</td>
                            </tr>
                            <tr>
                                <td><strong>Account Transfer</strong></td>
                                <td>Bank statements from BOTH accounts showing the transfer (matching dates and amounts)</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="info-box">
                        <h4>Paper Trail Requirement</h4>
                        <p>All deposits must have a clear paper trail. This means documentation must show funds leaving one source and arriving at the destination account with matching dates and amounts. Gaps in the paper trail may result in the deposit being deemed unacceptable.</p>
                    </div>
                </div>
            </section>

            <!-- Section 7: Investor Guidelines -->
            <section id="section-7" class="section">
                <div class="section-header">
                    <div class="section-number">7</div>
                    <div class="section-title"><h2>Investor Guidelines</h2><span>Specific requirements by loan program</span></div>
                </div>
                <div class="section-content">
                    <div class="warning-box">
                        <h4>Always Verify Current Guidelines</h4>
                        <p>Investor guidelines change frequently. The information below is general guidance - always verify the specific requirements for your loan program with your CMG Financial Representative and current investor overlays.</p>
                    </div>

                    <div class="decision-tree">
                        <h3>Investor-Specific Requirements</h3>
                        <div class="tree-node level-1">
                            <span class="tree-label">Conventional (Fannie Mae/Freddie Mac)</span>
                            Large deposits exceeding 50% of total monthly qualifying income must be explained. Business deposits may have different rules.
                        </div>
                        <div class="tree-node">
                            <span class="tree-label">FHA</span>
                            Explanation required for deposits exceeding 1% of sales price OR $1,000, whichever is greater. More stringent documentation requirements.
                        </div>
                        <div class="tree-node">
                            <span class="tree-label">VA</span>
                            Any unusual deposit that is inconsistent with borrower's income or savings pattern should be explained.
                        </div>
                        <div class="tree-node">
                            <span class="tree-label">USDA</span>
                            Deposits over $500 from non-employment sources require explanation and documentation.
                        </div>
                        <div class="tree-node">
                            <span class="tree-label">Jumbo / Non-QM</span>
                            Requirements vary by investor - typically more stringent. Consult specific program guidelines.
                        </div>
                    </div>

                    <div class="tip-box">
                        <h4>CMG Financial Contact</h4>
                        <p>For questions about specific investor requirements or to verify documentation needs, contact your CMG Financial Representative. The company website is available at www.cmgfi.com and licensing information can be verified at www.nmlsconsumeraccess.org (NMLS# 1820).</p>
                    </div>
                </div>
            </section>

            <!-- Quick Reference -->
            <div id="quick-ref" class="quick-ref">
                <h3>Large Deposit Letter Quick Reference</h3>
                <pre>
LARGE DEPOSIT LETTER - CMG FINANCIAL
=====================================

FORM PURPOSE:
Document and explain large deposits on bank statements per investor guidelines

FORM FIELDS (per deposit - up to 4 per form):
- Deposit Date
- Account Number
- Amount
- Large Deposit Explanation
- Borrower Signature(s) - ALL borrowers must sign

COMMON THRESHOLDS BY INVESTOR:
-----------------------------
Conventional (FNMA/FHLMC): > 50% of monthly qualifying income
FHA:                       > 1% of sales price OR $1,000
VA:                        Any unusual deposit
USDA:                      > $500 from non-employment sources

ACCEPTABLE DEPOSIT SOURCES:
---------------------------
[X] Tax refund (with tax return copy)
[X] Gift funds (with gift letter + donor statement)
[X] Sale of asset (with bill of sale)
[X] Employment bonus (with pay stub)
[X] Insurance settlement (with settlement letter)
[X] Inheritance (with estate documents)
[X] Transfer between own accounts (with both statements)

UNACCEPTABLE SOURCES:
--------------------
[ ] Borrowed funds (unless disclosed in DTI)
[ ] Undocumented cash
[ ] Unknown/anonymous sources
[ ] Unverifiable deposits

COMPLETION CHECKLIST:
--------------------
[ ] Print Large Deposit Letter form
[ ] Complete all fields for each deposit
[ ] Write detailed explanation
[ ] Gather supporting documentation
[ ] All borrowers sign and date
[ ] Return to CMG Financial Representative
[ ] Store in loan file

COMPANY INFORMATION:
-------------------
CMG Financial (CMG Mortgage, Inc.)
NMLS# 1820
www.cmgfi.com
www.nmlsconsumeraccess.org

Form Date: 12/16/2022
                </pre>
            </div>
        </div>

        <!-- ==================== AI AGENTS TAB ==================== -->
        <div id="agents-panel" class="tab-panel">
            <!-- Agent Header -->
            <div class="agent-header">
                <h1>AI Agent Opportunities</h1>
                <p class="subtitle">Automation opportunities identified for the Large Deposit Letter process</p>
            </div>

            <!-- Summary Stats -->
            <div class="agent-summary" id="agent-summary">
                <div class="agent-summary-card">
                    <div class="agent-summary-value">4</div>
                    <div class="agent-summary-label">Agent Opportunities</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">65%</div>
                    <div class="agent-summary-label">Automation Potential</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">12 min</div>
                    <div class="agent-summary-label">Est. Time Saved</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">High</div>
                    <div class="agent-summary-label">Compliance Impact</div>
                </div>
            </div>

            <!-- Heat Map Legend -->
            <div class="heat-legend">
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #ef4444, #f97316);"></div>
                    <span>Critical Priority (9-10)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #f97316, #eab308);"></div>
                    <span>High Priority (7-8)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #eab308, #22c55e);"></div>
                    <span>Medium Priority (5-6)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #22c55e, #14b8a6);"></div>
                    <span>Low Priority (1-4)</span>
                </div>
            </div>

            <!-- Heat Map Grid -->
            <div class="heat-map-container" id="agent-heatmap">
                <div class="heat-map-title">Priority Heat Map</div>
                <div class="heat-map-grid">
                    <div class="heat-item critical" onclick="scrollToAgent('agent-deposit-scanner')">
                        <div class="heat-score">9.0</div>
                        <div class="heat-name">Deposit Scanner Agent</div>
                        <div class="heat-desc">Auto-scan bank statements and flag large deposits exceeding thresholds</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>5 min</span></div>
                            <div class="heat-metric">Complexity: <span>Medium</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-threshold-checker')">
                        <div class="heat-score">8.2</div>
                        <div class="heat-name">Threshold Checker</div>
                        <div class="heat-desc">Auto-determine investor thresholds based on loan program</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>2 min</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-form-prefill')">
                        <div class="heat-score">7.8</div>
                        <div class="heat-name">Form Pre-Fill Agent</div>
                        <div class="heat-desc">Auto-populate Large Deposit Letter with extracted data</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>3 min</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                    <div class="heat-item medium" onclick="scrollToAgent('agent-doc-matcher')">
                        <div class="heat-score">6.5</div>
                        <div class="heat-name">Doc Matcher Agent</div>
                        <div class="heat-desc">Match supporting docs to deposit explanations</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>2 min</span></div>
                            <div class="heat-metric">Complexity: <span>Medium</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agent Details -->
            <div id="agent-details">
                <h2 style="color: var(--text-primary); margin-bottom: 25px; font-size: 1.5rem;">Agent Details</h2>
                <div class="agent-grid">
                    <!-- Deposit Scanner Agent -->
                    <div class="agent-card" id="agent-deposit-scanner">
                        <div class="agent-card-header">
                            <div class="agent-icon">D</div>
                            <div class="agent-info">
                                <div class="agent-name">Deposit Scanner Agent</div>
                                <div class="agent-type">Document Analysis / OCR</div>
                            </div>
                            <span class="agent-priority critical">Critical</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Automatically scans bank statements using OCR, identifies all deposits, calculates if they exceed the investor threshold, and flags deposits requiring Large Deposit Letters. Extracts date, amount, and account information automatically.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Bank Statement</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">OCR Extract</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Parse Deposits</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Flag Large</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">5 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">95%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Med</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('depositscanner')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Threshold Checker Agent -->
                    <div class="agent-card" id="agent-threshold-checker">
                        <div class="agent-card-header">
                            <div class="agent-icon">T</div>
                            <div class="agent-info">
                                <div class="agent-name">Threshold Checker</div>
                                <div class="agent-type">Rules Engine / Logic</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Automatically determines the correct large deposit threshold based on loan program (Conventional, FHA, VA, USDA), purchase price, and borrower income. Applies correct investor overlays and flags deposits accordingly.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Loan Type</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Get Rules</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Calc Threshold</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Apply</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">2 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">99%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('thresholdchecker')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Form Pre-Fill Agent -->
                    <div class="agent-card" id="agent-form-prefill">
                        <div class="agent-card-header">
                            <div class="agent-icon">F</div>
                            <div class="agent-info">
                                <div class="agent-name">Form Pre-Fill Agent</div>
                                <div class="agent-type">Document Generation</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Automatically pre-fills the Large Deposit Letter form with extracted deposit data (date, account number, amount). Generates the form ready for borrower to add explanation and sign, reducing manual data entry.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Flagged Deposits</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Map Fields</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Generate PDF</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Send to Borrower</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">3 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">98%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('formprefill')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Doc Matcher Agent -->
                    <div class="agent-card" id="agent-doc-matcher">
                        <div class="agent-card-header">
                            <div class="agent-icon">M</div>
                            <div class="agent-info">
                                <div class="agent-name">Doc Matcher Agent</div>
                                <div class="agent-type">Document Classification</div>
                            </div>
                            <span class="agent-priority medium">Medium</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Analyzes supporting documentation provided by borrower and matches it to the deposit explanation. Validates that paper trail is complete (amounts match, dates align) and flags any gaps for processor review.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Upload Docs</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Classify</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Match to Deposit</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Validate</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">2 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">90%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Med</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('docmatcher')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Documentation Modal -->
    <div class="modal-overlay" id="docModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Large Deposit Letter Workflow Documentation</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyToClipboard()">Copy</button>
                    <button class="modal-btn close" onclick="closeDocModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <pre id="docContent"># Large Deposit Letter - CMG Financial

## Overview
When bank statements (typically covering the most recent two months) are used to verify assets, lenders must evaluate large deposits, which are defined per investor guidelines. Requirements for evaluating large deposits vary based on the transaction type.

## When Required
Large deposit letters are required when deposits exceed investor thresholds:
- Conventional: 50% of monthly qualifying income
- FHA: 1% of purchase price or $1,000 (greater)
- VA: Any unusual deposit
- USDA: Deposits over $500 from non-employment sources

## Form Fields
Each deposit entry requires:
- Deposit Date
- Account Number
- Amount
- Large Deposit Explanation
- Borrower Signature(s)

## Acceptable Sources
- Tax refunds
- Gift funds (with gift letter)
- Sale of assets
- Employment bonus/commission
- Insurance settlements
- Inheritance
- Transfer between own accounts

## Documentation Requirements
All deposits must have a clear paper trail with supporting documentation that matches dates and amounts.

## Completion Process
1. Print the Large Deposit Letter form
2. Complete information for each deposit
3. Write detailed explanation
4. Obtain signatures from all borrowers
5. Gather supporting documentation
6. Return to CMG Financial Representative

## Company Information
CMG Financial (CMG Mortgage, Inc.)
NMLS# 1820
www.cmgfi.com</pre>
            </div>
        </div>
    </div>

    <!-- AI Prompt Modal -->
    <div class="modal-overlay prompt-modal" id="promptModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="promptModalTitle">AI Agent Build Prompt</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyPromptToClipboard()">Copy Prompt</button>
                    <button class="modal-btn close" onclick="closePromptModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="prompt-tags" id="promptTags"></div>
                <div class="prompt-section">
                    <h4>Agent Purpose</h4>
                    <div class="prompt-box" id="promptPurpose"></div>
                </div>
                <div class="prompt-section">
                    <h4>Full Build Prompt</h4>
                    <div class="prompt-box" id="promptContent"></div>
                </div>
                <div class="prompt-section">
                    <h4>Integration Points</h4>
                    <div class="prompt-box" id="promptIntegration"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="copy-success" id="copySuccess">Copied to clipboard!</div>

    <script>
        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));

            if (tab === 'workflow') {
                document.querySelector('.sidebar-tab:not(.agent-tab)').classList.add('active');
                document.getElementById('workflow-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'block';
                document.getElementById('agents-nav').style.display = 'none';
            } else {
                document.querySelector('.sidebar-tab.agent-tab').classList.add('active');
                document.getElementById('agents-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'none';
                document.getElementById('agents-nav').style.display = 'block';
            }

            window.scrollTo(0, 0);
        }

        // Scroll spy with isScrolling flag and 1000ms timeout
        const sections = document.querySelectorAll('.section, .quick-ref');
        const navItems = document.querySelectorAll('#workflow-nav .nav-item');
        let isScrolling = false;
        let scrollTimeout;

        function updateActiveNav() {
            if (isScrolling) return;

            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                if (window.scrollY >= sectionTop) current = section.getAttribute('id');
            });
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + current) item.classList.add('active');
            });
        }

        // Handle nav click to temporarily disable scroll spy
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                isScrolling = true;
                clearTimeout(scrollTimeout);

                // Remove active from all, add to clicked
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');

                // Re-enable scroll spy after 1000ms
                scrollTimeout = setTimeout(() => {
                    isScrolling = false;
                }, 1000);
            });
        });

        window.addEventListener('scroll', updateActiveNav);

        // Modal
        function openDocModal() {
            document.getElementById('docModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeDocModal() {
            document.getElementById('docModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyToClipboard() {
            try {
                await navigator.clipboard.writeText(document.getElementById('docContent').textContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeDocModal(); closePromptModal(); } });
        document.getElementById('docModal').addEventListener('click', (e) => { if (e.target.id === 'docModal') closeDocModal(); });

        document.addEventListener('DOMContentLoaded', () => { updateActiveNav(); });

        // Scroll to agent card and highlight
        function scrollToAgent(agentId) {
            const agentCard = document.getElementById(agentId);
            if (agentCard) {
                document.querySelectorAll('.agent-card.highlight').forEach(card => {
                    card.classList.remove('highlight');
                });

                agentCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

                setTimeout(() => {
                    agentCard.classList.add('highlight');
                }, 300);

                setTimeout(() => {
                    agentCard.classList.remove('highlight');
                }, 2500);
            }
        }

        // Agent Prompt System
        const agentPrompts = {
            depositscanner: {
                name: 'Deposit Scanner Agent',
                tags: ['Document Analysis', 'OCR', 'Medium Complexity', 'Critical Priority'],
                purpose: `This agent automatically scans bank statements using OCR technology, identifies all deposits, extracts key data (date, amount, account), and flags deposits that exceed investor thresholds. This eliminates manual statement review and ensures no large deposits are missed.`,
                prompt: `You are building a Document Analysis Agent for CMG Financial's Large Deposit Letter process.

AGENT NAME: Deposit Scanner Agent
TYPE: Document Analysis / OCR

OBJECTIVE:
Automatically scan bank statements, extract all deposit transactions, and flag those exceeding large deposit thresholds for documentation.

INPUT DATA:
- Bank statement PDF/image files
- Loan program type (Conventional, FHA, VA, USDA)
- Borrower monthly qualifying income
- Purchase price (for FHA threshold calculation)

OCR PROCESSING:
1. Extract text from bank statement
2. Identify transaction table/section
3. Parse each deposit row:
   - Date
   - Description
   - Amount
   - Running Balance

DEPOSIT EXTRACTION:
{
  "statement_period": "01/01/2026 - 01/31/2026",
  "account_number": "XXXX-1234",
  "deposits": [
    {
      "date": "01/15/2026",
      "description": "Mobile Deposit",
      "amount": 5000.00,
      "exceeds_threshold": true,
      "threshold_type": "conventional_50pct"
    }
  ]
}

THRESHOLD CALCULATION:
- Conventional: amount > (monthly_income * 0.50)
- FHA: amount > MAX(purchase_price * 0.01, 1000)
- VA: Flag if unusual pattern detected
- USDA: amount > 500 AND not payroll

OUTPUT:
- List of flagged deposits
- Pre-populated form data
- Confidence score for each extraction`,
                integration: `INTEGRATION POINTS:
1. Document Storage
   - Read from Byte/LOS document storage
   - Process multiple statement pages
   - Handle various bank formats

2. OCR Service
   - AWS Textract or Google Vision
   - Table extraction capability
   - Confidence scoring

3. LOS Integration
   - Pull borrower income data
   - Pull loan program details
   - Push flagged deposits to task list

4. Workflow Trigger
   - Auto-generate Large Deposit Letter
   - Create condition in loan file
   - Notify processor of findings

DEPLOYMENT:
- Triggered on bank statement upload
- Batch processing capability
- Human review queue for low-confidence extractions`
            },
            thresholdchecker: {
                name: 'Threshold Checker Agent',
                tags: ['Rules Engine', 'Logic', 'Low Complexity', 'High Priority'],
                purpose: `This agent automatically determines the correct large deposit threshold based on the loan program, purchase price, and borrower income. It applies the correct investor rules and CMG overlays to ensure accurate threshold calculation.`,
                prompt: `You are building a Rules Engine Agent for CMG Financial's Large Deposit Letter process.

AGENT NAME: Threshold Checker Agent
TYPE: Rules Engine / Business Logic

OBJECTIVE:
Automatically determine the correct large deposit threshold based on loan program and borrower data, applying all investor guidelines and CMG overlays.

INPUT DATA:
- Loan program (FNMA, FHLMC, FHA, VA, USDA, Jumbo)
- Purchase price
- Borrower monthly qualifying income
- Property type
- Transaction type (purchase, refinance)

RULES ENGINE:

function calculateThreshold(loanData) {
  switch(loanData.program) {
    case 'FNMA':
    case 'FHLMC':
      return loanData.monthlyIncome * 0.50;

    case 'FHA':
      return Math.max(loanData.purchasePrice * 0.01, 1000);

    case 'VA':
      // Flag deposits inconsistent with income pattern
      return loanData.monthlyIncome * 0.25; // Conservative threshold

    case 'USDA':
      return 500; // Any non-payroll deposit over $500

    case 'JUMBO':
      // Check specific investor overlay
      return getJumboOverlay(loanData.investor);
  }
}

OUTPUT:
{
  "loan_number": "2026-001234",
  "program": "FHA",
  "threshold_amount": 3500.00,
  "calculation_method": "1% of purchase price",
  "purchase_price": 350000,
  "monthly_income": 6500,
  "notes": "FHA requires explanation for deposits > $3,500 OR $1,000 (greater)"
}

ERROR HANDLING:
- Unknown program: Default to most conservative threshold
- Missing data: Flag for processor review
- Override capability for manual threshold adjustment`,
                integration: `INTEGRATION POINTS:
1. LOS Data Pull
   - Loan program from 1003
   - Purchase price from contract
   - Income from URLA

2. Investor Guidelines Database
   - Maintain current thresholds
   - Track guideline updates
   - Apply CMG overlays

3. Deposit Scanner Integration
   - Provide threshold to scanner
   - Receive flagged deposits
   - Cross-validate results

4. Audit Trail
   - Log all threshold calculations
   - Store rule version used
   - Compliance documentation

MAINTENANCE:
- Quarterly guideline review
- Automatic overlay updates
- Version control for rule changes`
            },
            formprefill: {
                name: 'Form Pre-Fill Agent',
                tags: ['Document Generation', 'Automation', 'Low Complexity', 'High Priority'],
                purpose: `This agent automatically pre-fills the Large Deposit Letter form with extracted deposit data, reducing manual data entry errors and speeding up the documentation process.`,
                prompt: `You are building a Document Generation Agent for CMG Financial's Large Deposit Letter process.

AGENT NAME: Form Pre-Fill Agent
TYPE: Document Generation / PDF Manipulation

OBJECTIVE:
Automatically populate the CMG Large Deposit Letter template with flagged deposit data and borrower information, generating a ready-to-sign document.

INPUT DATA:
- Flagged deposits from Deposit Scanner
- Borrower names (all borrowers on loan)
- Account numbers
- Loan file metadata

FORM FIELD MAPPING:
{
  "deposits": [
    {
      "deposit_date_field": "Deposit Date",
      "account_number_field": "Account Number",
      "amount_field": "Amount",
      "explanation_field": "Large Deposit Explanation"
    }
  ],
  "signatures": [
    {
      "borrower_name": "Borrower",
      "signature_field": "Signature"
    }
  ]
}

PDF GENERATION:
1. Load CMG Large Deposit Letter template
2. For each flagged deposit (up to 4 per form):
   - Fill Deposit Date
   - Fill Account Number (masked: XXXX-1234)
   - Fill Amount ($X,XXX.XX format)
   - Leave Explanation blank for borrower
3. Pre-fill borrower names in signature blocks
4. Leave signature fields blank
5. Generate fillable PDF

OUTPUT:
{
  "pdf_path": "/docs/Large_Deposit_Letter_2026001234.pdf",
  "deposits_included": 3,
  "requires_additional_form": false,
  "borrowers": ["John Smith", "Jane Smith"],
  "ready_for_signature": true
}

MULTIPLE FORM HANDLING:
- If > 4 deposits, generate multiple forms
- Link forms together in document set
- Track which deposits on which form`,
                integration: `INTEGRATION POINTS:
1. PDF Library
   - PDFBox or iText for Java
   - pdf-lib for JavaScript
   - Fillable form field detection

2. Document Storage
   - Save to Byte Stored Docs
   - Set document type: Large Deposit Letter
   - Link to condition

3. Borrower Portal
   - Send to borrower for completion
   - eSign integration (DocuSign/similar)
   - Track completion status

4. Workflow Integration
   - Update task status
   - Notify processor when signed
   - Flag if not returned in X days

DELIVERY OPTIONS:
- Email to borrower with instructions
- Post to borrower portal
- Print for in-person signing`
            },
            docmatcher: {
                name: 'Doc Matcher Agent',
                tags: ['Document Classification', 'Validation', 'Medium Complexity', 'Medium Priority'],
                purpose: `This agent analyzes supporting documentation provided by borrowers and validates it against deposit explanations. It ensures the paper trail is complete with matching amounts and dates, flagging any discrepancies.`,
                prompt: `You are building a Document Classification Agent for CMG Financial's Large Deposit Letter process.

AGENT NAME: Doc Matcher Agent
TYPE: Document Classification / Validation

OBJECTIVE:
Analyze supporting documentation uploaded by borrowers, classify document types, match them to specific deposits, and validate the paper trail is complete.

INPUT DATA:
- Uploaded supporting documents (PDFs, images)
- Large Deposit Letter with explanations
- Expected document types based on explanation

DOCUMENT CLASSIFICATION:
{
  "tax_return": ["1040", "IRS", "refund", "tax year"],
  "gift_letter": ["gift", "donor", "relationship"],
  "bill_of_sale": ["sold", "vehicle", "VIN", "buyer", "seller"],
  "pay_stub": ["earnings", "YTD", "pay period", "employer"],
  "bank_statement": ["account", "balance", "deposit", "withdrawal"],
  "insurance_settlement": ["settlement", "claim", "policy", "insurance"],
  "estate_document": ["estate", "executor", "probate", "deceased"]
}

VALIDATION LOGIC:
1. Extract key data from supporting doc:
   - Amount
   - Date
   - Source/Recipient

2. Compare to deposit:
   - Amount match (within $1)
   - Date alignment (within 5 business days)
   - Source matches explanation

3. Paper trail check:
   - Funds leaving source account
   - Funds arriving at borrower account
   - Dates sequential

MATCH RESULT:
{
  "deposit_id": "dep_001",
  "deposit_amount": 5000.00,
  "deposit_date": "2026-01-15",
  "explanation": "Tax refund",
  "supporting_docs": [
    {
      "doc_type": "tax_return",
      "extracted_amount": 5000.00,
      "match_confidence": 0.98,
      "paper_trail_complete": true
    }
  ],
  "validation_status": "PASSED",
  "flags": []
}

FLAG CONDITIONS:
- Amount mismatch > $10
- Date gap > 10 days
- Missing source documentation
- Document type doesn't match explanation`,
                integration: `INTEGRATION POINTS:
1. OCR Service
   - Extract text from all doc types
   - Handle various formats
   - Confidence scoring

2. ML Classification
   - Train on historical documents
   - Improve over time
   - Human feedback loop

3. Validation Rules
   - Configurable thresholds
   - Investor-specific rules
   - CMG overlays

4. Workflow Integration
   - Auto-approve if all pass
   - Route to processor if flags
   - Create audit trail

5. Byte LOS
   - Attach validated docs
   - Update condition status
   - Link docs to deposit letter

HUMAN REVIEW:
- Queue for low-confidence matches
- Processor override capability
- Learning from corrections`
            }
        };

        function showAgentPrompt(agentKey) {
            const agent = agentPrompts[agentKey];
            if (!agent) return;

            document.getElementById('promptModalTitle').textContent = agent.name + ' - Build Prompt';
            document.getElementById('promptTags').innerHTML = agent.tags.map(tag => `<span class="prompt-tag">${tag}</span>`).join('');
            document.getElementById('promptPurpose').textContent = agent.purpose;
            document.getElementById('promptContent').textContent = agent.prompt;
            document.getElementById('promptIntegration').textContent = agent.integration;

            document.getElementById('promptModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closePromptModal() {
            document.getElementById('promptModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyPromptToClipboard() {
            const purpose = document.getElementById('promptPurpose').textContent;
            const prompt = document.getElementById('promptContent').textContent;
            const integration = document.getElementById('promptIntegration').textContent;
            const fullText = `PURPOSE:\n${purpose}\n\nPROMPT:\n${prompt}\n\nINTEGRATION:\n${integration}`;

            try {
                await navigator.clipboard.writeText(fullText);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.getElementById('promptModal').addEventListener('click', (e) => { if (e.target.id === 'promptModal') closePromptModal(); });
    </script>
</body>
</html>
