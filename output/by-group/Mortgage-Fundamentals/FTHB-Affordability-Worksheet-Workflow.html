<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>First-Time Homebuyer Affordability Worksheet - Process Workflow</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: #111827;
            --bg-card: #1a2234;
            --accent-blue: #3b82f6;
            --accent-teal: #14b8a6;
            --accent-amber: #f59e0b;
            --accent-rose: #f43f5e;
            --accent-green: #22c55e;
            --accent-purple: #8b5cf6;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-subtle: rgba(255,255,255,0.08);
            --sidebar-width: 280px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Breadcrumb */
        .breadcrumb {
            background: linear-gradient(90deg, #0d1525 0%, #1a2234 100%);
            padding: 14px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
            border-bottom: 1px solid var(--border-subtle);
        }

        .breadcrumb a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            transition: all 0.2s;
            border: 1px solid var(--border-subtle);
        }

        .breadcrumb a:hover {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .breadcrumb .separator { color: var(--text-muted); font-size: 1.2rem; }
        .breadcrumb .current { color: var(--accent-amber); font-weight: 600; padding: 8px 16px; }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 54px;
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - 54px);
            background: var(--bg-secondary);
            overflow-y: auto;
            z-index: 1000;
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 25px 20px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-header h2 { color: var(--text-primary); font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
        .sidebar-header p { color: var(--text-muted); font-size: 0.85rem; }

        /* Tab Switch */
        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-tab {
            flex: 1;
            padding: 14px 10px;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            background: none;
            border-left: none;
            border-right: none;
            border-top: none;
        }

        .sidebar-tab:hover { background: rgba(255,255,255,0.03); color: var(--text-secondary); }
        .sidebar-tab.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); background: rgba(59, 130, 246, 0.08); }
        .sidebar-tab.agent-tab.active { color: var(--accent-purple); border-bottom-color: var(--accent-purple); background: rgba(139, 92, 246, 0.08); }

        .sidebar-nav { padding: 15px 0; flex: 1; overflow-y: auto; }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .nav-item:hover { background: rgba(255,255,255,0.03); color: var(--text-primary); }
        .nav-item.active { background: rgba(59, 130, 246, 0.1); border-left-color: var(--accent-blue); color: var(--text-primary); }

        .nav-number {
            background: rgba(255,255,255,0.1);
            color: var(--text-secondary);
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .nav-item.active .nav-number { background: var(--accent-blue); color: white; }
        .nav-label { font-size: 0.95rem; font-weight: 500; }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-subtle);
            background: rgba(0,0,0,0.2);
        }

        .doc-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px 20px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .doc-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3); }

        /* Main Content */
        .main-content { margin-left: var(--sidebar-width); padding: 80px 40px 40px 40px; }

        /* Tab Panels */
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        .header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(20, 184, 166, 0.08) 0%, transparent 50%);
            pointer-events: none;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        .header .meta { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; position: relative; }

        .header .meta-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-subtle);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); }
        .legend-color { width: 18px; height: 18px; border-radius: 4px; }

        /* Sections */
        .section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            margin-bottom: 25px;
            overflow: hidden;
            scroll-margin-top: 75px;
        }

        .section-header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(59, 130, 246, 0.1) 100%);
            border-bottom: 1px solid var(--border-subtle);
            padding: 22px 25px;
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .section-number {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .section-title h2 { font-size: 1.35rem; font-weight: 700; margin-bottom: 4px; color: var(--text-primary); }
        .section-title span { font-size: 0.9rem; color: var(--text-muted); }
        .section-content { padding: 28px; }

        /* Workflow Diagrams */
        .workflow-diagram {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 28px;
            margin-bottom: 22px;
        }

        .flow-row { display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 12px; margin: 15px 0; }

        .flow-node {
            padding: 14px 22px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            min-width: 150px;
            border: 1px solid var(--border-subtle);
        }

        .flow-node.start { background: linear-gradient(135deg, var(--accent-green) 0%, #16a34a 100%); color: white; border-radius: 25px; border: none; }
        .flow-node.action { background: linear-gradient(135deg, var(--accent-blue) 0%, #2563eb 100%); color: white; border: none; }
        .flow-node.decision { background: linear-gradient(135deg, var(--accent-amber) 0%, #d97706 100%); color: var(--bg-primary); border: none; }
        .flow-node.input { background: var(--bg-secondary); border: 2px solid var(--accent-blue); color: var(--text-primary); }
        .flow-node.output { background: linear-gradient(135deg, var(--accent-teal) 0%, #0d9488 100%); color: white; border: none; }
        .flow-node.exception { background: linear-gradient(135deg, var(--accent-rose) 0%, #dc2626 100%); color: white; border: none; }

        .flow-arrow { color: var(--accent-blue); font-size: 1.5rem; }
        .flow-arrow.down { transform: rotate(90deg); }

        .decision-branch { display: flex; gap: 40px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
        .branch { display: flex; flex-direction: column; align-items: center; gap: 10px; }

        .branch-label {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        /* Tables */
        .field-table { width: 100%; border-collapse: collapse; margin: 18px 0; }

        .field-table th {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            padding: 14px 18px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border-subtle);
        }

        .field-table td { padding: 14px 18px; border-bottom: 1px solid var(--border-subtle); color: var(--text-secondary); }
        .field-table tr:hover { background: rgba(255,255,255,0.02); }

        .badge { display: inline-block; padding: 4px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge.required-badge { background: rgba(244, 63, 94, 0.15); color: var(--accent-rose); }
        .badge.optional-badge { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .badge.calculated-badge { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }

        /* Info Boxes */
        .exception-box, .tip-box, .info-box {
            padding: 18px 22px;
            margin: 18px 0;
            border-radius: 0 10px 10px 0;
            border-left-width: 4px;
            border-left-style: solid;
        }

        .exception-box { background: rgba(244, 63, 94, 0.08); border-color: var(--accent-rose); border: 1px solid rgba(244, 63, 94, 0.2); border-left: 4px solid var(--accent-rose); }
        .exception-box h4 { color: var(--accent-rose); margin-bottom: 10px; font-size: 1rem; }
        .exception-box p, .exception-box li { color: var(--text-secondary); }

        .tip-box { background: rgba(34, 197, 94, 0.08); border-color: var(--accent-green); border: 1px solid rgba(34, 197, 94, 0.2); border-left: 4px solid var(--accent-green); }
        .tip-box h4 { color: var(--accent-green); margin-bottom: 10px; font-size: 1rem; }
        .tip-box p, .tip-box li { color: var(--text-secondary); }

        .info-box { background: rgba(59, 130, 246, 0.08); border-color: var(--accent-blue); border: 1px solid rgba(59, 130, 246, 0.2); border-left: 4px solid var(--accent-blue); }
        .info-box h4 { color: var(--accent-blue); margin-bottom: 10px; font-size: 1rem; }
        .info-box p, .info-box li { color: var(--text-secondary); }

        /* Decision Tree */
        .decision-tree {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 22px;
            margin: 22px 0;
        }

        .decision-tree h3 { color: var(--accent-blue); margin-bottom: 18px; padding-bottom: 12px; border-bottom: 1px solid var(--border-subtle); font-size: 1.1rem; }

        .tree-node { margin-left: 20px; padding: 12px; border-left: 2px solid var(--accent-teal); position: relative; color: var(--text-secondary); }
        .tree-node::before { content: ''; position: absolute; left: -2px; top: 22px; width: 15px; height: 2px; background: var(--accent-teal); }
        .tree-node.level-1 { margin-left: 0; border-left: none; }
        .tree-node.level-1::before { display: none; }

        .tree-label { background: var(--accent-amber); color: var(--bg-primary); padding: 6px 14px; border-radius: 6px; font-weight: 700; display: inline-block; margin-bottom: 6px; font-size: 0.9rem; }

        /* Summary Grid */
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 18px; margin: 22px 0; }

        .summary-card { background: rgba(0,0,0,0.3); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 22px; text-align: center; }
        .summary-card h4 { color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9rem; }
        .summary-card .value {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .summary-card .label { font-size: 0.85rem; color: var(--text-muted); margin-top: 8px; }

        /* Calculator Card */
        .calculator-card {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            overflow: hidden;
            margin: 22px 0;
        }

        .calculator-header {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            padding: 18px;
            text-align: center;
        }

        .calculator-header h4 { font-size: 1.05rem; }
        .calculator-body { padding: 22px; }

        /* Quick Reference */
        .quick-ref {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
            border: 1px solid var(--border-subtle);
            padding: 28px;
            border-radius: 16px;
            margin-top: 30px;
            font-family: 'JetBrains Mono', monospace;
            scroll-margin-top: 75px;
        }

        .quick-ref h3 { color: var(--accent-amber); margin-bottom: 18px; font-family: 'Plus Jakarta Sans', sans-serif; }
        .quick-ref pre { background: rgba(0,0,0,0.4); border: 1px solid var(--border-subtle); padding: 20px; border-radius: 10px; overflow-x: auto; font-size: 0.85rem; line-height: 1.7; color: var(--text-secondary); }

        /* ====== AGENT OPPORTUNITIES STYLES ====== */
        .agent-header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .agent-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(139, 92, 246, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .agent-header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        /* Heat Map */
        .heat-map-container { margin-bottom: 35px; }
        .heat-map-title { font-size: 1.3rem; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }

        .heat-map-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .heat-item {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .heat-item:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .heat-item:active { transform: scale(0.98); }

        .heat-item::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 4px;
        }

        .heat-item.critical::before { background: linear-gradient(90deg, #ef4444, #f97316); }
        .heat-item.high::before { background: linear-gradient(90deg, #f97316, #eab308); }
        .heat-item.medium::before { background: linear-gradient(90deg, #eab308, #22c55e); }
        .heat-item.low::before { background: linear-gradient(90deg, #22c55e, #14b8a6); }

        .heat-score {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.8rem;
            font-weight: 800;
        }

        .heat-item.critical .heat-score { color: #ef4444; }
        .heat-item.high .heat-score { color: #f97316; }
        .heat-item.medium .heat-score { color: #eab308; }
        .heat-item.low .heat-score { color: #22c55e; }

        .heat-name { font-size: 1rem; font-weight: 700; color: var(--text-primary); margin-bottom: 6px; padding-right: 50px; }
        .heat-desc { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; }

        .heat-metrics { display: flex; gap: 15px; margin-top: 12px; }
        .heat-metric { font-size: 0.75rem; color: var(--text-muted); }
        .heat-metric span { color: var(--text-secondary); font-weight: 600; }

        /* Agent Cards */
        .agent-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 25px; margin-bottom: 35px; }

        .agent-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .agent-card:hover { transform: translateY(-5px); box-shadow: 0 15px 50px rgba(0,0,0,0.3); }

        .agent-card.highlight {
            animation: highlightPulse 2s ease;
            box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.4);
        }

        @keyframes highlightPulse {
            0% { box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.6); }
            50% { box-shadow: 0 0 0 6px rgba(139, 92, 246, 0.5), 0 15px 50px rgba(139, 92, 246, 0.3); }
            100% { box-shadow: 0 0 0 0px transparent, 0 15px 50px rgba(0,0,0,0.3); }
        }

        .agent-card-header {
            padding: 22px;
            display: flex;
            align-items: flex-start;
            gap: 18px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .agent-icon {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            flex-shrink: 0;
        }

        .agent-info { flex: 1; }
        .agent-name { font-size: 1.15rem; font-weight: 700; color: var(--text-primary); margin-bottom: 5px; }
        .agent-type { font-size: 0.8rem; color: var(--accent-purple); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-priority {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .agent-priority.critical { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .agent-priority.high { background: rgba(249, 115, 22, 0.15); color: #f97316; }
        .agent-priority.medium { background: rgba(234, 179, 8, 0.15); color: #eab308; }
        .agent-priority.low { background: rgba(34, 197, 94, 0.15); color: #22c55e; }

        .agent-card-body { padding: 22px; }
        .agent-description { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; }

        .agent-flow {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 20px;
        }

        .agent-flow-title { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-flow-diagram { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; justify-content: center; }

        .agent-step {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .agent-arrow { color: var(--accent-purple); font-size: 1.2rem; }

        .agent-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }

        .agent-stat {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .agent-stat-value {
            font-size: 1.3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-top: 4px; }

        /* View Prompt Button */
        .agent-prompt-btn {
            width: 100%;
            margin-top: 18px;
            padding: 14px 20px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 10px;
            color: var(--accent-purple);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .agent-prompt-btn:hover {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(59, 130, 246, 0.3) 100%);
            border-color: var(--accent-purple);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.25);
        }

        /* Summary Stats */
        .agent-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .agent-summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            padding: 25px;
            text-align: center;
        }

        .agent-summary-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-summary-label { font-size: 0.9rem; color: var(--text-muted); margin-top: 8px; }

        /* Heat Map Legend */
        .heat-legend {
            display: flex;
            gap: 25px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .heat-legend-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; color: var(--text-secondary); }
        .heat-legend-color { width: 24px; height: 24px; border-radius: 6px; }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(10, 15, 26, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.show { display: flex; }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            width: 100%;
            max-width: 950px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 80px rgba(0,0,0,0.5);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            padding: 22px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 16px 16px 0 0;
        }

        .modal-header h3 { font-size: 1.25rem; font-weight: 700; }
        .modal-actions { display: flex; gap: 12px; }

        .modal-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: transform 0.2s;
            font-size: 0.9rem;
        }

        .modal-btn:hover { transform: scale(1.05); }
        .modal-btn.copy { background: white; color: var(--accent-blue); }
        .modal-btn.close { background: rgba(255,255,255,0.2); color: white; }

        .modal-body { padding: 28px; overflow-y: auto; flex: 1; }

        .modal-body pre {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            padding: 22px;
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.7;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--text-secondary);
        }

        .copy-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--accent-green);
            color: white;
            padding: 18px 35px;
            border-radius: 10px;
            font-weight: 700;
            z-index: 3000;
            display: none;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut { 0%, 100% { opacity: 0; } 10%, 90% { opacity: 1; } }

        /* Prompt Modal */
        .prompt-modal .modal { max-width: 800px; }
        .prompt-modal .modal-header { background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%); }

        .prompt-section { margin-bottom: 25px; }
        .prompt-section h4 { color: var(--accent-purple); font-size: 1rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }

        .prompt-box {
            background: rgba(0,0,0,0.4);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.7;
            color: var(--text-secondary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .prompt-tags { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .prompt-tag { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }

        .copy-prompt-btn {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 15px;
        }

        .copy-prompt-btn:hover { transform: scale(1.05); box-shadow: 0 5px 20px rgba(139, 92, 246, 0.3); }

        /* Step List */
        .step-list { list-style: none; padding: 0; margin: 18px 0; }
        .step-list li {
            padding: 14px 18px;
            border-left: 3px solid var(--accent-blue);
            background: rgba(0,0,0,0.2);
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
        }
        .step-list li strong { color: var(--text-primary); }

        /* Formula Display */
        .formula-display {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(20, 184, 166, 0.1) 100%);
            border: 2px solid var(--accent-blue);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            margin: 22px 0;
        }

        .formula-display .formula {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--accent-blue);
            margin-bottom: 12px;
        }

        .formula-display .explanation {
            font-size: 0.95rem;
            color: var(--text-secondary);
        }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 75px 20px 30px 20px; }
            .agent-grid { grid-template-columns: 1fr; }
        }
            .breadcrumb-logo-link { display: flex; align-items: center; padding: 4px 8px; background: rgba(255,255,255,0.08); border-radius: 8px; border: 1px solid rgba(255,255,255,0.12); transition: all 0.2s; }
        .breadcrumb-logo-link:hover { background: rgba(255,255,255,0.15); }
        .breadcrumb-logo { height: 28px; width: auto; }
    </style>
</head>
<body>
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <a href="../../index.html" class="breadcrumb-logo-link"><img src="../../images/clear-ai-logo.png" alt="Clear AI" class="breadcrumb-logo"></a>
        <a href="../../index.html">Portal Home</a>
        <span class="separator">></span>
        <a href="./index.html">Mortgage Fundamentals</a>
        <span class="separator">></span>
        <span class="current">First-Time Homebuyer Affordability Worksheet</span>
    </nav>

    <!-- Fixed Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>FTHB Affordability</h2>
            <p>Interactive Workflow Guide</p>
        </div>

        <!-- Tab Switcher -->
        <div class="sidebar-tabs">
            <button class="sidebar-tab active" onclick="switchTab('workflow')">Workflow</button>
            <button class="sidebar-tab agent-tab" onclick="switchTab('agents')">AI Agents</button>
        </div>

        <!-- Workflow Navigation -->
        <nav class="sidebar-nav" id="workflow-nav">
            <a href="#section-1" class="nav-item active">
                <span class="nav-number">1</span>
                <span class="nav-label">Understanding DTI</span>
            </a>
            <a href="#section-2" class="nav-item">
                <span class="nav-number">2</span>
                <span class="nav-label">Calculate Gross Income</span>
            </a>
            <a href="#section-3" class="nav-item">
                <span class="nav-number">3</span>
                <span class="nav-label">Calculate Maximum Debt</span>
            </a>
            <a href="#section-4" class="nav-item">
                <span class="nav-number">4</span>
                <span class="nav-label">Inventory Current Debts</span>
            </a>
            <a href="#section-5" class="nav-item">
                <span class="nav-number">5</span>
                <span class="nav-label">Calculate Max Mortgage</span>
            </a>
            <a href="#section-6" class="nav-item">
                <span class="nav-number">6</span>
                <span class="nav-label">Mortgage Insurance</span>
            </a>
            <a href="#quick-ref" class="nav-item">
                <span class="nav-number">*</span>
                <span class="nav-label">Quick Reference</span>
            </a>
        </nav>

        <!-- Agent Navigation -->
        <nav class="sidebar-nav" id="agents-nav" style="display: none;">
            <a href="#agent-summary" class="nav-item active">
                <span class="nav-number">S</span>
                <span class="nav-label">Summary</span>
            </a>
            <a href="#agent-heatmap" class="nav-item">
                <span class="nav-number">H</span>
                <span class="nav-label">Heat Map</span>
            </a>
            <a href="#agent-details" class="nav-item">
                <span class="nav-number">A</span>
                <span class="nav-label">Agent Details</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="doc-btn" onclick="openDocModal()">
                View Worksheet Guide
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

        <!-- ==================== WORKFLOW TAB ==================== -->
        <div id="workflow-panel" class="tab-panel active">
            <!-- Header -->
            <div class="header">
                <h1>First-Time Homebuyer Affordability Worksheet</h1>
                <p class="subtitle">Guide to calculating maximum monthly mortgage payment using the 36% DTI rule</p>
                <div class="meta">
                    <span class="meta-item">Source: Enact MI</span>
                    <span class="meta-item">Role: Loan Officer / Borrower</span>
                    <span class="meta-item">Doc ID: 01565.E.CB.0224</span>
                    <span class="meta-item">Duration: 5-10 min</span>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #22c55e, #16a34a);"></div><span>Start/End</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></div><span>Calculation Step</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></div><span>Decision Point</span></div>
                <div class="legend-item"><div class="legend-color" style="background: #111827; border: 2px solid #3b82f6;"></div><span>User Input</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #14b8a6, #0d9488);"></div><span>Output/Result</span></div>
            </div>

            <!-- Section 1: Understanding DTI -->
            <section id="section-1" class="section">
                <div class="section-header">
                    <div class="section-number">1</div>
                    <div class="section-title"><h2>Understanding the 36% Rule (DTI)</h2><span>Debt-to-Income Ratio fundamentals for mortgage affordability</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Start</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Understand DTI Concept</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Apply 36% Rule</div>
                        </div>
                    </div>

                    <div class="info-box">
                        <h4>What is Debt-to-Income Ratio (DTI)?</h4>
                        <p>The Debt-to-Income Ratio is a financial measure that compares your monthly debt payments to your gross monthly income. Lenders use this ratio to assess your ability to manage monthly payments and repay debts.</p>
                    </div>

                    <div class="formula-display">
                        <div class="formula">Total Monthly Debt / Gross Monthly Income = DTI Ratio</div>
                        <div class="explanation">Keep your DTI below 36% for optimal affordability</div>
                    </div>

                    <div class="tip-box">
                        <h4>The 36% Rule Guideline</h4>
                        <p>Your <strong>total monthly debt should stay below 36%</strong> of your gross income. This is a general guideline - your lender may permit a different ratio based on your specific financial situation, credit history, and loan program.</p>
                    </div>

                    <div class="summary-grid">
                        <div class="summary-card">
                            <h4>Recommended DTI</h4>
                            <div class="value">36%</div>
                            <div class="label">Maximum Threshold</div>
                        </div>
                        <div class="summary-card">
                            <h4>Key Inputs Needed</h4>
                            <div class="value">2</div>
                            <div class="label">Maximum & Current Debt</div>
                        </div>
                        <div class="summary-card">
                            <h4>Calculation Steps</h4>
                            <div class="value">2</div>
                            <div class="label">Income + Debts</div>
                        </div>
                    </div>

                    <div class="exception-box">
                        <h4>Important Disclaimer</h4>
                        <p>This worksheet is for <strong>illustrative purposes only</strong>. Please consult your financial advisor regarding your own financial situation. Your lender may permit a different ratio than the 36% estimate used in this worksheet.</p>
                    </div>
                </div>
            </section>

            <!-- Section 2: Calculate Gross Income -->
            <section id="section-2" class="section">
                <div class="section-header">
                    <div class="section-number">2</div>
                    <div class="section-title"><h2>Step 1: Calculate Gross Income</h2><span>Determine your total annual and monthly gross income</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Gather Income Sources</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">Enter Annual Amounts</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Sum All Income</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Calculate Monthly</div>
                        </div>
                    </div>

                    <h3 style="color: var(--text-primary); margin-bottom: 18px;">Income Categories (Rows 1-6)</h3>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Row</th>
                                <th>Income Source</th>
                                <th>Type</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>1</strong></td>
                                <td>Annual Base Income</td>
                                <td><span class="badge required-badge">Required</span></td>
                                <td>Regular salary or hourly wages (annual total)</td>
                            </tr>
                            <tr>
                                <td><strong>2</strong></td>
                                <td>Annual Bonus, Commission and Overtime</td>
                                <td><span class="badge optional-badge">Optional</span></td>
                                <td>Variable income components</td>
                            </tr>
                            <tr>
                                <td><strong>3</strong></td>
                                <td>Annual Military Entitlements</td>
                                <td><span class="badge optional-badge">Optional</span></td>
                                <td>BAH, BAS, and other military allowances</td>
                            </tr>
                            <tr>
                                <td><strong>4</strong></td>
                                <td>Other Annual Income</td>
                                <td><span class="badge optional-badge">Optional</span></td>
                                <td>Child support, alimony, rental income, etc.</td>
                            </tr>
                            <tr>
                                <td><strong>5</strong></td>
                                <td>GROSS ANNUAL INCOME</td>
                                <td><span class="badge calculated-badge">Calculated</span></td>
                                <td>Sum of Rows 1 + 2 + 3 + 4</td>
                            </tr>
                            <tr>
                                <td><strong>6</strong></td>
                                <td>GROSS MONTHLY INCOME</td>
                                <td><span class="badge calculated-badge">Calculated</span></td>
                                <td>Row 5 divided by 12</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="formula-display">
                        <div class="formula">Gross Annual Income (Row 5) = Row 1 + Row 2 + Row 3 + Row 4</div>
                        <div class="explanation">Add all annual income sources together</div>
                    </div>

                    <div class="formula-display">
                        <div class="formula">Gross Monthly Income (Row 6) = Row 5 / 12</div>
                        <div class="explanation">Divide annual income by 12 months</div>
                    </div>

                    <div class="tip-box">
                        <h4>Income Documentation Tips</h4>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>Use gross income (before taxes and deductions)</li>
                            <li>For variable income, use a 2-year average if available</li>
                            <li>Military entitlements can significantly boost qualifying income</li>
                            <li>Child support/alimony must have documentation and remaining term requirements</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 3: Calculate Maximum Debt -->
            <section id="section-3" class="section">
                <div class="section-header">
                    <div class="section-number">3</div>
                    <div class="section-title"><h2>Calculate Maximum Monthly Debt</h2><span>Apply the 36% DTI ratio to determine debt capacity</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node input">Gross Monthly Income</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Multiply by 0.36</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Maximum Monthly Debt</div>
                        </div>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Row</th>
                                <th>Description</th>
                                <th>Formula</th>
                                <th>Type</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>6</strong></td>
                                <td>Gross Monthly Income</td>
                                <td>From Step 1</td>
                                <td><span class="badge calculated-badge">Input</span></td>
                            </tr>
                            <tr>
                                <td><strong>7</strong></td>
                                <td>MAXIMUM MONTHLY DEBT</td>
                                <td>Row 6 x 0.36</td>
                                <td><span class="badge calculated-badge">Calculated</span></td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="formula-display">
                        <div class="formula">Maximum Monthly Debt (Row 7) = Gross Monthly Income (Row 6) x 0.36</div>
                        <div class="explanation">This is the maximum total debt you should carry each month</div>
                    </div>

                    <div class="calculator-card">
                        <div class="calculator-header">
                            <h4>Example Calculation</h4>
                        </div>
                        <div class="calculator-body">
                            <table class="field-table">
                                <tbody>
                                    <tr>
                                        <td>Annual Base Income</td>
                                        <td style="text-align: right;"><strong>$75,000</strong></td>
                                    </tr>
                                    <tr>
                                        <td>Annual Bonus/Commission</td>
                                        <td style="text-align: right;"><strong>$5,000</strong></td>
                                    </tr>
                                    <tr>
                                        <td>Gross Annual Income</td>
                                        <td style="text-align: right;"><strong>$80,000</strong></td>
                                    </tr>
                                    <tr>
                                        <td>Gross Monthly Income</td>
                                        <td style="text-align: right;"><strong>$6,666.67</strong></td>
                                    </tr>
                                    <tr style="background: rgba(59, 130, 246, 0.1);">
                                        <td><strong>Maximum Monthly Debt (x 0.36)</strong></td>
                                        <td style="text-align: right;"><strong style="color: var(--accent-blue);">$2,400.00</strong></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="info-box">
                        <h4>What's Included in Maximum Monthly Debt?</h4>
                        <p>This maximum includes ALL monthly debt obligations:</p>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>Future mortgage payment (PITI)</li>
                            <li>Credit card minimum payments</li>
                            <li>Auto loans</li>
                            <li>Student loans</li>
                            <li>Personal loans</li>
                            <li>Any other recurring debt payments</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 4: Inventory Current Debts -->
            <section id="section-4" class="section">
                <div class="section-header">
                    <div class="section-number">4</div>
                    <div class="section-title"><h2>Step 2: Inventory Current Monthly Debts</h2><span>List all existing monthly debt obligations</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Gather Debt Info</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node input">Enter Monthly Amounts</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Sum All Debts</div>
                        </div>
                    </div>

                    <h3 style="color: var(--text-primary); margin-bottom: 18px;">Debt Categories (Rows 8-13)</h3>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Row</th>
                                <th>Debt Type</th>
                                <th>Type</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>8</strong></td>
                                <td>Total Monthly Minimum Credit Card Payments</td>
                                <td><span class="badge required-badge">Required</span></td>
                                <td>Sum of all credit card minimum payments</td>
                            </tr>
                            <tr>
                                <td><strong>9</strong></td>
                                <td>Total Monthly Car Payments</td>
                                <td><span class="badge optional-badge">If Applicable</span></td>
                                <td>Auto loans, leases</td>
                            </tr>
                            <tr>
                                <td><strong>10</strong></td>
                                <td>Total Monthly Personal Loan Payments</td>
                                <td><span class="badge optional-badge">If Applicable</span></td>
                                <td>Unsecured personal loans</td>
                            </tr>
                            <tr>
                                <td><strong>11</strong></td>
                                <td>Total Monthly Student Loan Payments</td>
                                <td><span class="badge optional-badge">If Applicable</span></td>
                                <td>Federal and private student loans</td>
                            </tr>
                            <tr>
                                <td><strong>12</strong></td>
                                <td>Total Other Monthly Debts</td>
                                <td><span class="badge optional-badge">If Applicable</span></td>
                                <td>Child support, alimony, other obligations</td>
                            </tr>
                            <tr>
                                <td><strong>13</strong></td>
                                <td>CURRENT MONTHLY DEBT</td>
                                <td><span class="badge calculated-badge">Calculated</span></td>
                                <td>Sum of Rows 8 + 9 + 10 + 11 + 12</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="formula-display">
                        <div class="formula">Current Monthly Debt (Row 13) = Row 8 + Row 9 + Row 10 + Row 11 + Row 12</div>
                        <div class="explanation">Add all existing monthly debt payments</div>
                    </div>

                    <div class="exception-box">
                        <h4>What NOT to Include</h4>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>Utilities (electric, gas, water, phone, internet)</li>
                            <li>Insurance premiums (unless part of auto/other loan)</li>
                            <li>Food and groceries</li>
                            <li>Entertainment subscriptions</li>
                            <li>Other living expenses</li>
                        </ul>
                        <p style="margin-top: 10px;">Only include debts that appear on your credit report or legal obligations.</p>
                    </div>

                    <div class="tip-box">
                        <h4>Credit Card Payment Tip</h4>
                        <p>Use the <strong>minimum payment</strong> shown on your statement, not your full balance or what you typically pay. Lenders use minimum payments for DTI calculations.</p>
                    </div>
                </div>
            </section>

            <!-- Section 5: Calculate Max Mortgage -->
            <section id="section-5" class="section">
                <div class="section-header">
                    <div class="section-number">5</div>
                    <div class="section-title"><h2>Calculate Maximum Monthly Mortgage Payment</h2><span>Subtract current debts from maximum debt capacity</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node input">Maximum Monthly Debt</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Subtract Current Debts</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Max Mortgage Payment</div>
                        </div>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Row</th>
                                <th>Description</th>
                                <th>Formula</th>
                                <th>Type</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>7</strong></td>
                                <td>Maximum Monthly Debt</td>
                                <td>From Step 1</td>
                                <td><span class="badge calculated-badge">Input</span></td>
                            </tr>
                            <tr>
                                <td><strong>13</strong></td>
                                <td>Current Monthly Debt</td>
                                <td>From Step 2</td>
                                <td><span class="badge calculated-badge">Input</span></td>
                            </tr>
                            <tr>
                                <td><strong>14</strong></td>
                                <td>MAXIMUM MONTHLY MORTGAGE PAYMENT</td>
                                <td>Row 7 - Row 13</td>
                                <td><span class="badge calculated-badge">Result</span></td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="formula-display">
                        <div class="formula">Maximum Mortgage Payment (Row 14) = Maximum Debt (Row 7) - Current Debt (Row 13)</div>
                        <div class="explanation">This is the maximum total monthly mortgage payment (PITI) you can afford</div>
                    </div>

                    <div class="calculator-card">
                        <div class="calculator-header">
                            <h4>Complete Example</h4>
                        </div>
                        <div class="calculator-body">
                            <table class="field-table">
                                <tbody>
                                    <tr>
                                        <td colspan="2" style="background: rgba(59, 130, 246, 0.05);"><strong>GROSS INCOME</strong></td>
                                    </tr>
                                    <tr>
                                        <td>Annual Base Income</td>
                                        <td style="text-align: right;">$75,000</td>
                                    </tr>
                                    <tr>
                                        <td>Annual Bonus/Commission</td>
                                        <td style="text-align: right;">$5,000</td>
                                    </tr>
                                    <tr>
                                        <td>Gross Annual Income</td>
                                        <td style="text-align: right;"><strong>$80,000</strong></td>
                                    </tr>
                                    <tr>
                                        <td>Gross Monthly Income</td>
                                        <td style="text-align: right;"><strong>$6,666.67</strong></td>
                                    </tr>
                                    <tr>
                                        <td>Maximum Monthly Debt (x 0.36)</td>
                                        <td style="text-align: right;"><strong>$2,400.00</strong></td>
                                    </tr>
                                    <tr>
                                        <td colspan="2" style="background: rgba(244, 63, 94, 0.05);"><strong>DEBTS</strong></td>
                                    </tr>
                                    <tr>
                                        <td>Credit Card Minimums</td>
                                        <td style="text-align: right;">$150</td>
                                    </tr>
                                    <tr>
                                        <td>Car Payment</td>
                                        <td style="text-align: right;">$350</td>
                                    </tr>
                                    <tr>
                                        <td>Student Loans</td>
                                        <td style="text-align: right;">$200</td>
                                    </tr>
                                    <tr>
                                        <td>Current Monthly Debt</td>
                                        <td style="text-align: right;"><strong>$700</strong></td>
                                    </tr>
                                    <tr style="background: rgba(34, 197, 94, 0.1);">
                                        <td><strong>MAXIMUM MONTHLY MORTGAGE PAYMENT</strong></td>
                                        <td style="text-align: right;"><strong style="color: var(--accent-green); font-size: 1.2rem;">$1,700.00</strong></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="info-box">
                        <h4>What's Included in Monthly Mortgage Payment (PITI)?</h4>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li><strong>P</strong>rincipal - Amount going toward loan balance</li>
                            <li><strong>I</strong>nterest - Cost of borrowing</li>
                            <li><strong>T</strong>axes - Property taxes (often escrowed)</li>
                            <li><strong>I</strong>nsurance - Homeowners insurance + PMI if applicable</li>
                        </ul>
                    </div>

                    <div class="tip-box">
                        <h4>Next Steps</h4>
                        <p>Once you know your maximum monthly mortgage payment, work with your loan officer to determine how much home you can purchase based on current interest rates, property taxes in your area, and insurance costs.</p>
                    </div>
                </div>
            </section>

            <!-- Section 6: Mortgage Insurance -->
            <section id="section-6" class="section">
                <div class="section-header">
                    <div class="section-number">6</div>
                    <div class="section-title"><h2>Private Mortgage Insurance (PMI)</h2><span>How PMI helps first-time homebuyers with less than 20% down</span></div>
                </div>
                <div class="section-content">
                    <div class="info-box">
                        <h4>Homeownership with Less Than 20% Down</h4>
                        <p><strong>Homeownership doesn't have to be a dream.</strong> Private mortgage insurance can get you into a house faster with less than a 20% down payment. Talk to your loan officer to learn more about the value of mortgage insurance from Enact.</p>
                    </div>

                    <div class="summary-grid">
                        <div class="summary-card">
                            <h4>Traditional Down Payment</h4>
                            <div class="value">20%</div>
                            <div class="label">No PMI Required</div>
                        </div>
                        <div class="summary-card">
                            <h4>With PMI</h4>
                            <div class="value">3-5%</div>
                            <div class="label">Lower Down Payment Options</div>
                        </div>
                        <div class="summary-card">
                            <h4>PMI Removal</h4>
                            <div class="value">80%</div>
                            <div class="label">LTV Threshold</div>
                        </div>
                    </div>

                    <h3 style="color: var(--text-primary); margin-bottom: 18px; margin-top: 25px;">Benefits of Private Mortgage Insurance</h3>

                    <ul class="step-list">
                        <li><strong>Lower Down Payment:</strong> Get into a home with as little as 3-5% down instead of 20%</li>
                        <li><strong>Faster Homeownership:</strong> Don't wait years to save for a 20% down payment</li>
                        <li><strong>Build Equity Sooner:</strong> Start building wealth through home equity while you would otherwise be renting</li>
                        <li><strong>Temporary Cost:</strong> PMI can be removed once you reach 80% LTV (20% equity)</li>
                        <li><strong>Tax Deductible:</strong> PMI premiums may be tax deductible (consult tax advisor)</li>
                    </ul>

                    <div class="decision-tree">
                        <h3>Do I Need PMI?</h3>
                        <div class="tree-node level-1">
                            <span class="tree-label">Down Payment Amount?</span>
                        </div>
                        <div class="tree-node">
                            <strong>20% or more:</strong> No PMI required - conventional financing
                        </div>
                        <div class="tree-node">
                            <strong>Less than 20%:</strong> PMI typically required for conventional loans
                        </div>
                        <div class="tree-node">
                            <strong>Government Loans (FHA/VA):</strong> Different mortgage insurance rules apply
                        </div>
                    </div>

                    <div class="tip-box">
                        <h4>About Enact Mortgage Insurance</h4>
                        <p>Enact mortgage insurers include Enact Mortgage Insurance Corporation and Enact Mortgage Insurance Corporation of North Carolina. They provide private mortgage insurance solutions that help borrowers achieve homeownership with lower down payments.</p>
                    </div>
                </div>
            </section>

            <!-- Quick Reference -->
            <div id="quick-ref" class="quick-ref">
                <h3>FTHB Affordability Quick Reference</h3>
                <pre>
AFFORDABILITY WORKSHEET SUMMARY
===============================

THE 36% DTI RULE
----------------
Total Monthly Debt / Gross Monthly Income <= 36%
(Your lender may permit a different ratio)

STEP 1: CALCULATE GROSS INCOME (Rows 1-7)
=========================================
Row 1: Annual Base Income              $_______
Row 2: Annual Bonus/Commission/OT      $_______
Row 3: Annual Military Entitlements    $_______
Row 4: Other Annual Income             $_______
       ----------------------------------
Row 5: GROSS ANNUAL INCOME             $_______ (Sum of Rows 1-4)
Row 6: GROSS MONTHLY INCOME            $_______ (Row 5 / 12)
Row 7: MAXIMUM MONTHLY DEBT            $_______ (Row 6 x 0.36)

STEP 2: CALCULATE CURRENT DEBTS (Rows 8-13)
===========================================
Row 8:  Credit Card Minimums           $_______
Row 9:  Car Payments                   $_______
Row 10: Personal Loan Payments         $_______
Row 11: Student Loan Payments          $_______
Row 12: Other Monthly Debts            $_______
        ----------------------------------
Row 13: CURRENT MONTHLY DEBT           $_______ (Sum of Rows 8-12)

FINAL CALCULATION (Row 14)
==========================
Row 14: MAXIMUM MONTHLY MORTGAGE PAYMENT
        = Maximum Debt (Row 7) - Current Debt (Row 13)
        = $_______ - $_______ = $_______

WHAT'S INCLUDED IN MORTGAGE PAYMENT (PITI)
==========================================
P = Principal (loan balance reduction)
I = Interest (cost of borrowing)
T = Taxes (property taxes)
I = Insurance (homeowners + PMI if applicable)

PRIVATE MORTGAGE INSURANCE (PMI)
================================
- Required when down payment < 20%
- Allows 3-5% down payment options
- Removed at 80% LTV (20% equity)
- May be tax deductible

HELPFUL TIPS
============
- Use GROSS income (before taxes)
- Use MINIMUM credit card payments
- Variable income: use 2-year average
- Consult your financial advisor
- Lender may permit different DTI ratios

DOCUMENT SOURCE
===============
Enact Mortgage Insurance
Document ID: 01565.E.CB.0224
Copyright 2024 Enact Holdings, Inc.
                </pre>
            </div>
        </div>

        <!-- ==================== AI AGENTS TAB ==================== -->
        <div id="agents-panel" class="tab-panel">
            <!-- Agent Header -->
            <div class="agent-header">
                <h1>AI Agent Opportunities</h1>
                <p class="subtitle">Automation opportunities identified for the FTHB Affordability Worksheet process</p>
            </div>

            <!-- Summary Stats -->
            <div class="agent-summary" id="agent-summary">
                <div class="agent-summary-card">
                    <div class="agent-summary-value">4</div>
                    <div class="agent-summary-label">Agent Opportunities</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">85%</div>
                    <div class="agent-summary-label">Automation Potential</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">15 min</div>
                    <div class="agent-summary-label">Est. Time Saved</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">High</div>
                    <div class="agent-summary-label">Borrower Experience</div>
                </div>
            </div>

            <!-- Heat Map Legend -->
            <div class="heat-legend">
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #ef4444, #f97316);"></div>
                    <span>Critical Priority (9-10)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #f97316, #eab308);"></div>
                    <span>High Priority (7-8)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #eab308, #22c55e);"></div>
                    <span>Medium Priority (5-6)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #22c55e, #14b8a6);"></div>
                    <span>Low Priority (1-4)</span>
                </div>
            </div>

            <!-- Heat Map Grid -->
            <div class="heat-map-container" id="agent-heatmap">
                <div class="heat-map-title">Priority Heat Map</div>
                <div class="heat-map-grid">
                    <div class="heat-item critical" onclick="scrollToAgent('agent-calculator')">
                        <div class="heat-score">9.5</div>
                        <div class="heat-name">Smart Calculator Agent</div>
                        <div class="heat-desc">Auto-calculate DTI and max mortgage from borrower inputs</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>10 min</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-income')">
                        <div class="heat-score">8.2</div>
                        <div class="heat-name">Income Analyzer Agent</div>
                        <div class="heat-desc">Extract and validate income from paystubs and tax docs</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>5 min</span></div>
                            <div class="heat-metric">Complexity: <span>Medium</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-debt')">
                        <div class="heat-score">7.8</div>
                        <div class="heat-name">Credit Debt Parser</div>
                        <div class="heat-desc">Auto-populate debts from credit report data</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>3 min</span></div>
                            <div class="heat-metric">Complexity: <span>Medium</span></div>
                        </div>
                    </div>
                    <div class="heat-item medium" onclick="scrollToAgent('agent-pmi')">
                        <div class="heat-score">6.5</div>
                        <div class="heat-name">PMI Advisor Agent</div>
                        <div class="heat-desc">Calculate PMI scenarios and break-even analysis</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>2 min</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agent Details -->
            <div id="agent-details">
                <h2 style="color: var(--text-primary); margin-bottom: 25px; font-size: 1.5rem;">Agent Details</h2>
                <div class="agent-grid">
                    <!-- Smart Calculator Agent -->
                    <div class="agent-card" id="agent-calculator">
                        <div class="agent-card-header">
                            <div class="agent-icon">C</div>
                            <div class="agent-info">
                                <div class="agent-name">Smart Calculator Agent</div>
                                <div class="agent-type">Calculation / User Interface</div>
                            </div>
                            <span class="agent-priority critical">Critical</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Interactive affordability calculator that auto-calculates DTI ratios and maximum mortgage payments in real-time as borrowers enter their income and debt information. Provides instant feedback and scenario comparisons.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">User Input</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Real-time Calc</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">DTI Analysis</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Max Payment</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">10 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">100%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('calculator')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Income Analyzer Agent -->
                    <div class="agent-card" id="agent-income">
                        <div class="agent-card-header">
                            <div class="agent-icon">I</div>
                            <div class="agent-info">
                                <div class="agent-name">Income Analyzer Agent</div>
                                <div class="agent-type">Document Processing / OCR</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Automatically extracts and validates income information from uploaded paystubs, W-2s, and tax returns. Calculates annual totals, identifies variable income patterns, and pre-populates the worksheet with verified figures.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Upload Docs</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">OCR Extract</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Validate Data</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Auto-Populate</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">5 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">95%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Med</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('income')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Credit Debt Parser Agent -->
                    <div class="agent-card" id="agent-debt">
                        <div class="agent-card-header">
                            <div class="agent-icon">D</div>
                            <div class="agent-info">
                                <div class="agent-name">Credit Debt Parser</div>
                                <div class="agent-type">Data Integration / Credit</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Integrates with credit bureau data to automatically identify and categorize all monthly debt obligations. Calculates minimum payments, identifies tradelines, and populates Rows 8-12 without manual entry.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Pull Credit</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Parse Debts</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Categorize</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Auto-Fill</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">3 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">99%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Med</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('debt')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- PMI Advisor Agent -->
                    <div class="agent-card" id="agent-pmi">
                        <div class="agent-card-header">
                            <div class="agent-icon">P</div>
                            <div class="agent-info">
                                <div class="agent-name">PMI Advisor Agent</div>
                                <div class="agent-type">Analysis / Advisory</div>
                            </div>
                            <span class="agent-priority medium">Medium</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Calculates PMI scenarios based on different down payment amounts, provides break-even analysis for PMI vs. larger down payment, and helps borrowers understand the true cost of various financing options.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Input Scenarios</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Calculate PMI</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Compare Options</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Recommend</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">2 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">100%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('pmi')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Document Modal -->
    <div class="modal-overlay" id="docModal">
        <div class="modal">
            <div class="modal-header">
                <h3>FTHB Affordability Worksheet Guide</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyToClipboard()">Copy</button>
                    <button class="modal-btn close" onclick="closeDocModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <pre id="docContent">
FIRST-TIME HOMEBUYER AFFORDABILITY WORKSHEET
============================================

What Monthly Payment Can You Afford?

There are many online calculators available to help you determine how much of a
total monthly mortgage payment you may be able to afford. An easy guideline to
follow is the 36% rule; your total monthly debt should stay below 36% of your
gross income (Debt-to-Income Ratio or DTI).

To do a quick estimate of what you could potentially afford, you need two basic
numbers: Maximum Monthly Debt and Current Monthly Debt. Your lender may permit
a different ratio than the estimate below.

STEP 1: GROSS INCOME
--------------------
Calculate your maximum debt based on your desired DTI ratio.

Row 1: Annual Base Income                          $________
Row 2: Annual Bonus, Commission and Overtime       $________
Row 3: Annual Military Entitlements                $________
Row 4: Other Annual Income (Child Support/Alimony) $________
Row 5: GROSS ANNUAL INCOME (Rows 1+2+3+4)          $________
Row 6: GROSS MONTHLY INCOME (Row 5 / 12)           $________ x 0.36
Row 7: MAXIMUM MONTHLY DEBT                        $________

STEP 2: DEBTS
-------------
Subtract your monthly debt from your maximum debt to calculate your
max monthly mortgage payment.

Row 8:  Total Monthly Minimum Credit Card Payments $________
Row 9:  Total Monthly Car Payments                 $________
Row 10: Total Monthly Personal Loan Payments       $________
Row 11: Total Monthly Student Loan Payments        $________
Row 12: Total Other Monthly Debts                  $________
Row 13: CURRENT MONTHLY DEBT (Rows 8+9+10+11+12)   $________

FINAL CALCULATION
-----------------
Row 14: MAXIMUM MONTHLY MORTGAGE PAYMENT
        Maximum Debt (Row 7) - Current Debt (Row 13) = $________

MORTGAGE INSURANCE NOTE
-----------------------
Homeownership doesn't have to be a dream. Private mortgage insurance can get
you into a house faster with less than a 20% down payment. Talk to your loan
officer to learn more about the value of mortgage insurance from Enact.

DISCLAIMER
----------
For illustrative purposes only; please consult your financial advisor regarding
your own financial situation.

Document: 01565.E.CB.0224
Enact mortgage insurers include Enact Mortgage Insurance Corporation and
Enact Mortgage Insurance Corporation of North Carolina.
Copyright 2024 Enact Holdings, Inc. All rights reserved.
                </pre>
            </div>
        </div>
    </div>

    <!-- Prompt Modal -->
    <div class="modal-overlay prompt-modal" id="promptModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="promptTitle">Agent Build Prompt</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyPrompt()">Copy All</button>
                    <button class="modal-btn close" onclick="closePromptModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="prompt-tags" id="promptTags"></div>
                <div class="prompt-section">
                    <h4>Purpose</h4>
                    <div class="prompt-box" id="promptPurpose"></div>
                </div>
                <div class="prompt-section">
                    <h4>Build Prompt</h4>
                    <div class="prompt-box" id="promptContent"></div>
                </div>
                <div class="prompt-section">
                    <h4>Integration Points</h4>
                    <div class="prompt-box" id="promptIntegration"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="copy-success" id="copySuccess">Copied to clipboard!</div>

    <script>
        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));

            if (tab === 'workflow') {
                document.querySelector('.sidebar-tab:not(.agent-tab)').classList.add('active');
                document.getElementById('workflow-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'block';
                document.getElementById('agents-nav').style.display = 'none';
            } else {
                document.querySelector('.sidebar-tab.agent-tab').classList.add('active');
                document.getElementById('agents-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'none';
                document.getElementById('agents-nav').style.display = 'block';
            }

            window.scrollTo(0, 0);
        }

        // Scroll spy with isScrolling flag and 1000ms timeout
        const sections = document.querySelectorAll('.section, .quick-ref');
        const navItems = document.querySelectorAll('#workflow-nav .nav-item');
        let isScrolling = false;
        let scrollTimeout;

        function updateActiveNav() {
            if (isScrolling) return;

            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                if (window.scrollY >= sectionTop) current = section.getAttribute('id');
            });
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + current) item.classList.add('active');
            });
        }

        // Handle nav click to temporarily disable scroll spy
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                isScrolling = true;
                clearTimeout(scrollTimeout);

                // Remove active from all, add to clicked
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');

                // Re-enable scroll spy after 1000ms
                scrollTimeout = setTimeout(() => {
                    isScrolling = false;
                }, 1000);
            });
        });

        window.addEventListener('scroll', updateActiveNav);

        // Modal
        function openDocModal() {
            document.getElementById('docModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeDocModal() {
            document.getElementById('docModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyToClipboard() {
            try {
                await navigator.clipboard.writeText(document.getElementById('docContent').textContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeDocModal(); closePromptModal(); } });
        document.getElementById('docModal').addEventListener('click', (e) => { if (e.target.id === 'docModal') closeDocModal(); });

        document.addEventListener('DOMContentLoaded', () => { updateActiveNav(); });

        // Scroll to agent card and highlight
        function scrollToAgent(agentId) {
            const agentCard = document.getElementById(agentId);
            if (agentCard) {
                document.querySelectorAll('.agent-card.highlight').forEach(card => {
                    card.classList.remove('highlight');
                });

                agentCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

                setTimeout(() => {
                    agentCard.classList.add('highlight');
                }, 300);

                setTimeout(() => {
                    agentCard.classList.remove('highlight');
                }, 2500);
            }
        }

        // Agent Prompt System
        const agentPrompts = {
            calculator: {
                name: 'Smart Calculator Agent',
                tags: ['Calculation', 'User Interface', 'Low Complexity', 'Critical Priority'],
                purpose: `This agent provides an interactive, real-time affordability calculator that instantly computes DTI ratios and maximum mortgage payments as borrowers enter their income and debt information. It eliminates manual calculations and provides immediate feedback on affordability.`,
                prompt: `You are building a Smart Calculator Agent for the FTHB Affordability Worksheet.

AGENT NAME: Smart Calculator Agent
TYPE: Calculation / User Interface

OBJECTIVE:
Create an interactive web-based calculator that implements the 36% DTI rule for first-time homebuyers, providing real-time calculations and visual feedback.

INPUT FIELDS:
GROSS INCOME (Step 1):
- Row 1: Annual Base Income (required, currency)
- Row 2: Annual Bonus/Commission/OT (optional, currency)
- Row 3: Annual Military Entitlements (optional, currency)
- Row 4: Other Annual Income (optional, currency)

DEBTS (Step 2):
- Row 8: Credit Card Minimums (currency)
- Row 9: Car Payments (currency)
- Row 10: Personal Loans (currency)
- Row 11: Student Loans (currency)
- Row 12: Other Debts (currency)

CALCULATIONS:
1. Gross Annual Income = Sum(Rows 1-4)
2. Gross Monthly Income = Gross Annual / 12
3. Maximum Monthly Debt = Monthly Income x 0.36
4. Current Monthly Debt = Sum(Rows 8-12)
5. Max Mortgage Payment = Max Debt - Current Debt

REAL-TIME FEATURES:
- Update calculations on every input change
- Show DTI percentage with color coding:
  - Green: < 30%
  - Yellow: 30-36%
  - Red: > 36%
- Display affordability gauge/meter
- Show breakdown of remaining capacity

VALIDATION:
- All currency inputs must be >= 0
- Warn if DTI exceeds 36%
- Suggest debt reduction if over threshold`,
                integration: `INTEGRATION POINTS:
1. Frontend Framework
   - React or Vue.js for reactive UI
   - Real-time state management
   - Input masking for currency fields

2. Calculation Engine
   - Pure JavaScript calculations
   - No backend required for basic calc
   - Optional: Save scenarios to user profile

3. Visual Components
   - Progress bars for DTI visualization
   - Pie charts for debt breakdown
   - Comparison tables for scenarios

4. Export Options
   - PDF generation of completed worksheet
   - Email results to borrower/LO
   - Save to loan file in LOS`
            },
            income: {
                name: 'Income Analyzer Agent',
                tags: ['Document Processing', 'OCR', 'Medium Complexity', 'High Priority'],
                purpose: `This agent automatically extracts income information from uploaded documents (paystubs, W-2s, tax returns) using OCR technology. It validates the extracted data, calculates annual totals, and pre-populates the worksheet fields to eliminate manual data entry errors.`,
                prompt: `You are building an Income Analyzer Agent for the FTHB Affordability Worksheet.

AGENT NAME: Income Analyzer Agent
TYPE: Document Processing / OCR

OBJECTIVE:
Automatically extract and validate income data from borrower documents to pre-populate the affordability worksheet with accurate income figures.

SUPPORTED DOCUMENTS:
1. Paystubs (most common)
   - Extract: Gross pay, YTD earnings, pay frequency
   - Calculate: Annual income projection

2. W-2 Forms
   - Extract: Box 1 (Wages), Box 3 (SS wages)
   - Validate: Compare to paystub YTD

3. Tax Returns (1040)
   - Extract: Line 1 (Wages), Schedule C (self-emp)
   - Calculate: 2-year average if variable

OCR EXTRACTION FIELDS:
{
  "document_type": "paystub | w2 | 1040",
  "employer_name": "string",
  "pay_period": { "start": "date", "end": "date" },
  "gross_pay": {
    "current": "number",
    "ytd": "number"
  },
  "deductions": {
    "federal_tax": "number",
    "state_tax": "number",
    "fica": "number"
  },
  "pay_frequency": "weekly | biweekly | semimonthly | monthly",
  "bonus_commission": "number",
  "overtime": "number"
}

INCOME CALCULATION LOGIC:
1. Paystub: YTD / months elapsed x 12
2. W-2: Use actual annual figure
3. Variable income: 2-year average
4. OT/Bonus: Only if 2-year history

WORKSHEET MAPPING:
- Base salary -> Row 1
- Bonus/Commission/OT -> Row 2
- Military (if detected) -> Row 3

VALIDATION RULES:
- Cross-reference multiple docs
- Flag discrepancies > 10%
- Require explanation for variable income`,
                integration: `INTEGRATION POINTS:
1. OCR Service
   - AWS Textract for document analysis
   - Google Document AI alternative
   - Custom models for paystub formats

2. Document Upload
   - Drag-and-drop interface
   - Support PDF, JPG, PNG
   - Multi-page document handling

3. Data Validation
   - Cross-reference between documents
   - Flag anomalies for review
   - Confidence scores on extraction

4. LOS Integration
   - Push validated income to Byte/Encompass
   - Link source documents
   - Audit trail for compliance`
            },
            debt: {
                name: 'Credit Debt Parser',
                tags: ['Data Integration', 'Credit', 'Medium Complexity', 'High Priority'],
                purpose: `This agent integrates with credit bureau data to automatically identify, categorize, and populate all monthly debt obligations in the worksheet. It parses tradelines, calculates minimum payments, and ensures accurate DTI calculations without manual entry.`,
                prompt: `You are building a Credit Debt Parser Agent for the FTHB Affordability Worksheet.

AGENT NAME: Credit Debt Parser
TYPE: Data Integration / Credit Bureau

OBJECTIVE:
Automatically extract debt information from credit reports to pre-populate Rows 8-12 of the affordability worksheet with accurate monthly payment obligations.

CREDIT REPORT PARSING:
1. Tradeline Categories:
   - Revolving (credit cards) -> Row 8
   - Installment (auto loans) -> Row 9
   - Personal/Signature loans -> Row 10
   - Student loans -> Row 11
   - Other (collections, judgments) -> Row 12

2. Payment Extraction:
   - Use minimum payment for revolving
   - Use scheduled payment for installment
   - Calculate 0.5% of balance if no payment shown

DATA STRUCTURE:
{
  "tradelines": [
    {
      "creditor": "string",
      "account_type": "revolving | installment | mortgage | student",
      "balance": "number",
      "monthly_payment": "number",
      "status": "current | delinquent | closed",
      "include_in_dti": "boolean"
    }
  ],
  "summary": {
    "total_revolving_payment": "number",
    "total_installment_payment": "number",
    "total_student_loan": "number",
    "total_other_debt": "number"
  }
}

CATEGORIZATION RULES:
- Credit Cards/Lines of Credit -> Row 8
- Auto Loans/Leases -> Row 9
- Personal/Unsecured Loans -> Row 10
- Student Loans (federal & private) -> Row 11
- Child Support/Alimony/Other -> Row 12

EXCLUSIONS:
- Mortgage on subject property (if refi)
- Accounts to be paid off at closing
- Authorized user accounts (optional)
- Business debt (if separated)

WORKSHEET POPULATION:
Map parsed totals to Rows 8-12
Calculate Row 13 automatically`,
                integration: `INTEGRATION POINTS:
1. Credit Bureau APIs
   - Equifax, Experian, TransUnion
   - Soft pull for pre-qualification
   - Hard pull for full application

2. Credit Report Formats
   - Parse MISMO XML format
   - Support tri-merge reports
   - Handle multiple report sources

3. LOS Integration
   - Push debts to Byte/Encompass
   - Link to credit report document
   - Support liability updates

4. User Interface
   - Display categorized debts
   - Allow manual overrides
   - Show inclusion/exclusion toggles`
            },
            pmi: {
                name: 'PMI Advisor Agent',
                tags: ['Analysis', 'Advisory', 'Low Complexity', 'Medium Priority'],
                purpose: `This agent helps borrowers understand PMI scenarios by calculating costs at different down payment levels, performing break-even analysis, and providing clear recommendations on the most cost-effective path to homeownership.`,
                prompt: `You are building a PMI Advisor Agent for the FTHB Affordability Worksheet.

AGENT NAME: PMI Advisor Agent
TYPE: Analysis / Advisory

OBJECTIVE:
Help first-time homebuyers understand private mortgage insurance options by calculating PMI costs, comparing scenarios, and providing actionable recommendations.

PMI CALCULATION INPUTS:
- Home purchase price
- Down payment amount/percentage
- Loan amount
- Credit score range
- Loan term
- Interest rate

PMI RATE FACTORS:
Credit Score | LTV 95% | LTV 90% | LTV 85%
750+         | 0.30%   | 0.25%   | 0.20%
700-749      | 0.50%   | 0.40%   | 0.30%
650-699      | 0.80%   | 0.65%   | 0.50%
620-649      | 1.10%   | 0.90%   | 0.70%

SCENARIO ANALYSIS:
Generate comparison table:
{
  "scenarios": [
    {
      "down_payment_pct": 5,
      "down_payment_amt": "number",
      "loan_amount": "number",
      "monthly_pmi": "number",
      "total_monthly_payment": "number",
      "months_until_80_ltv": "number",
      "total_pmi_cost": "number"
    }
  ]
}

BREAK-EVEN ANALYSIS:
- Compare: Save for 20% vs. buy now with PMI
- Factor in: Home appreciation, rent savings, tax benefits
- Calculate: Months to break-even

OUTPUT:
1. Monthly PMI cost at each scenario
2. Total PMI cost until 80% LTV
3. Break-even timeline
4. Recommendation with rationale

RECOMMENDATION LOGIC:
- If break-even < 36 months: "Buy now with PMI"
- If break-even > 60 months: "Consider larger down payment"
- If credit score low: "Improve credit first to reduce PMI"`,
                integration: `INTEGRATION POINTS:
1. PMI Rate Database
   - Enact MI rate cards
   - MGIC, Radian, Essent rates
   - Update quarterly

2. Calculation Engine
   - Amortization calculations
   - Home appreciation projections
   - Tax benefit estimates

3. Visualization
   - Side-by-side scenario comparison
   - Timeline charts for equity building
   - Cost breakdown pie charts

4. Report Generation
   - PDF summary for borrower
   - Include in pre-approval package
   - Share with loan officer`
            }
        };

        function showAgentPrompt(agentKey) {
            const agent = agentPrompts[agentKey];
            if (!agent) return;

            document.getElementById('promptTitle').textContent = agent.name + ' - Build Prompt';
            document.getElementById('promptTags').innerHTML = agent.tags.map(tag => `<span class="prompt-tag">${tag}</span>`).join('');
            document.getElementById('promptPurpose').textContent = agent.purpose;
            document.getElementById('promptContent').textContent = agent.prompt;
            document.getElementById('promptIntegration').textContent = agent.integration;

            document.getElementById('promptModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closePromptModal() {
            document.getElementById('promptModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyPrompt() {
            const agent = document.getElementById('promptTitle').textContent.replace(' - Build Prompt', '');
            const purpose = document.getElementById('promptPurpose').textContent;
            const prompt = document.getElementById('promptContent').textContent;
            const integration = document.getElementById('promptIntegration').textContent;

            const fullText = `${agent}\n\nPURPOSE:\n${purpose}\n\nBUILD PROMPT:\n${prompt}\n\nINTEGRATION:\n${integration}`;

            try {
                await navigator.clipboard.writeText(fullText);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.getElementById('promptModal').addEventListener('click', (e) => { if (e.target.id === 'promptModal') closePromptModal(); });
    </script>
</body>
</html>
