<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assets & Source of Funds - Process Workflow</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: #111827;
            --bg-card: #1a2234;
            --accent-blue: #3b82f6;
            --accent-teal: #14b8a6;
            --accent-amber: #f59e0b;
            --accent-rose: #f43f5e;
            --accent-green: #22c55e;
            --accent-purple: #8b5cf6;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-subtle: rgba(255,255,255,0.08);
            --sidebar-width: 280px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Breadcrumb */
        .breadcrumb {
            background: linear-gradient(90deg, #0d1525 0%, #1a2234 100%);
            padding: 14px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
            border-bottom: 1px solid var(--border-subtle);
        }

        .breadcrumb a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            transition: all 0.2s;
            border: 1px solid var(--border-subtle);
        }

        .breadcrumb a:hover {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .breadcrumb .separator { color: var(--text-muted); font-size: 1.2rem; }
        .breadcrumb .current { color: var(--accent-amber); font-weight: 600; padding: 8px 16px; }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 54px;
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - 54px);
            background: var(--bg-secondary);
            overflow-y: auto;
            z-index: 1000;
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 25px 20px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-header h2 { color: var(--text-primary); font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
        .sidebar-header p { color: var(--text-muted); font-size: 0.85rem; }

        /* Tab Switch */
        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-tab {
            flex: 1;
            padding: 14px 10px;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            background: none;
            border-left: none;
            border-right: none;
            border-top: none;
        }

        .sidebar-tab:hover { background: rgba(255,255,255,0.03); color: var(--text-secondary); }
        .sidebar-tab.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); background: rgba(59, 130, 246, 0.08); }
        .sidebar-tab.agent-tab.active { color: var(--accent-purple); border-bottom-color: var(--accent-purple); background: rgba(139, 92, 246, 0.08); }

        .sidebar-nav { padding: 15px 0; flex: 1; overflow-y: auto; }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .nav-item:hover { background: rgba(255,255,255,0.03); color: var(--text-primary); }
        .nav-item.active { background: rgba(59, 130, 246, 0.1); border-left-color: var(--accent-blue); color: var(--text-primary); }

        .nav-number {
            background: rgba(255,255,255,0.1);
            color: var(--text-secondary);
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .nav-item.active .nav-number { background: var(--accent-blue); color: white; }
        .nav-label { font-size: 0.95rem; font-weight: 500; }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-subtle);
            background: rgba(0,0,0,0.2);
        }

        .doc-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px 20px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .doc-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3); }

        /* Main Content */
        .main-content { margin-left: var(--sidebar-width); padding: 80px 40px 40px 40px; }

        /* Tab Panels */
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        .header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(20, 184, 166, 0.08) 0%, transparent 50%);
            pointer-events: none;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        .header .meta { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; position: relative; }

        .header .meta-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-subtle);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); }
        .legend-color { width: 18px; height: 18px; border-radius: 4px; }

        /* Sections */
        .section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            margin-bottom: 25px;
            overflow: hidden;
            scroll-margin-top: 75px;
        }

        .section-header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(59, 130, 246, 0.1) 100%);
            border-bottom: 1px solid var(--border-subtle);
            padding: 22px 25px;
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .section-number {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .section-title h2 { font-size: 1.35rem; font-weight: 700; margin-bottom: 4px; color: var(--text-primary); }
        .section-title span { font-size: 0.9rem; color: var(--text-muted); }
        .section-content { padding: 28px; }

        /* Workflow Diagrams */
        .workflow-diagram {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 28px;
            margin-bottom: 22px;
        }

        .flow-row { display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 12px; margin: 15px 0; }

        .flow-node {
            padding: 14px 22px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            min-width: 150px;
            border: 1px solid var(--border-subtle);
        }

        .flow-node.start { background: linear-gradient(135deg, var(--accent-green) 0%, #16a34a 100%); color: white; border-radius: 25px; border: none; }
        .flow-node.action { background: linear-gradient(135deg, var(--accent-blue) 0%, #2563eb 100%); color: white; border: none; }
        .flow-node.decision { background: linear-gradient(135deg, var(--accent-amber) 0%, #d97706 100%); color: var(--bg-primary); border: none; }
        .flow-node.input { background: var(--bg-secondary); border: 2px solid var(--accent-blue); color: var(--text-primary); }
        .flow-node.output { background: linear-gradient(135deg, var(--accent-teal) 0%, #0d9488 100%); color: white; border: none; }
        .flow-node.exception { background: linear-gradient(135deg, var(--accent-rose) 0%, #dc2626 100%); color: white; border: none; }

        .flow-arrow { color: var(--accent-blue); font-size: 1.5rem; }
        .flow-arrow.down { transform: rotate(90deg); }

        .decision-branch { display: flex; gap: 40px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
        .branch { display: flex; flex-direction: column; align-items: center; gap: 10px; }

        .branch-label {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        /* Tables */
        .field-table { width: 100%; border-collapse: collapse; margin: 18px 0; }

        .field-table th {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            padding: 14px 18px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border-subtle);
        }

        .field-table td { padding: 14px 18px; border-bottom: 1px solid var(--border-subtle); color: var(--text-secondary); }
        .field-table tr:hover { background: rgba(255,255,255,0.02); }

        .badge { display: inline-block; padding: 4px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge.required-badge { background: rgba(244, 63, 94, 0.15); color: var(--accent-rose); }
        .badge.optional-badge { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .badge.calculated-badge { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }
        .badge.conv-badge { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }
        .badge.govt-badge { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); }
        .badge.fha-badge { background: rgba(20, 184, 166, 0.15); color: var(--accent-teal); }
        .badge.va-badge { background: rgba(245, 158, 11, 0.15); color: var(--accent-amber); }

        /* Info Boxes */
        .exception-box, .tip-box, .info-box, .warning-box {
            padding: 18px 22px;
            margin: 18px 0;
            border-radius: 0 10px 10px 0;
            border-left-width: 4px;
            border-left-style: solid;
        }

        .exception-box { background: rgba(244, 63, 94, 0.08); border-color: var(--accent-rose); border: 1px solid rgba(244, 63, 94, 0.2); border-left: 4px solid var(--accent-rose); }
        .exception-box h4 { color: var(--accent-rose); margin-bottom: 10px; font-size: 1rem; }
        .exception-box p, .exception-box li { color: var(--text-secondary); }

        .tip-box { background: rgba(34, 197, 94, 0.08); border-color: var(--accent-green); border: 1px solid rgba(34, 197, 94, 0.2); border-left: 4px solid var(--accent-green); }
        .tip-box h4 { color: var(--accent-green); margin-bottom: 10px; font-size: 1rem; }
        .tip-box p, .tip-box li { color: var(--text-secondary); }

        .info-box { background: rgba(59, 130, 246, 0.08); border-color: var(--accent-blue); border: 1px solid rgba(59, 130, 246, 0.2); border-left: 4px solid var(--accent-blue); }
        .info-box h4 { color: var(--accent-blue); margin-bottom: 10px; font-size: 1rem; }
        .info-box p, .info-box li { color: var(--text-secondary); }

        .warning-box { background: rgba(245, 158, 11, 0.08); border-color: var(--accent-amber); border: 1px solid rgba(245, 158, 11, 0.2); border-left: 4px solid var(--accent-amber); }
        .warning-box h4 { color: var(--accent-amber); margin-bottom: 10px; font-size: 1rem; }
        .warning-box p, .warning-box li { color: var(--text-secondary); }

        /* Decision Tree */
        .decision-tree {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 22px;
            margin: 22px 0;
        }

        .decision-tree h3 { color: var(--accent-blue); margin-bottom: 18px; padding-bottom: 12px; border-bottom: 1px solid var(--border-subtle); font-size: 1.1rem; }

        .tree-node { margin-left: 20px; padding: 12px; border-left: 2px solid var(--accent-teal); position: relative; color: var(--text-secondary); }
        .tree-node::before { content: ''; position: absolute; left: -2px; top: 22px; width: 15px; height: 2px; background: var(--accent-teal); }
        .tree-node.level-1 { margin-left: 0; border-left: none; }
        .tree-node.level-1::before { display: none; }

        .tree-label { background: var(--accent-amber); color: var(--bg-primary); padding: 6px 14px; border-radius: 6px; font-weight: 700; display: inline-block; margin-bottom: 6px; font-size: 0.9rem; }

        /* Summary Grid */
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 18px; margin: 22px 0; }

        .summary-card { background: rgba(0,0,0,0.3); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 22px; text-align: center; }
        .summary-card h4 { color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9rem; }
        .summary-card .value {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .summary-card .label { font-size: 0.85rem; color: var(--text-muted); margin-top: 8px; }

        /* MI Comparison Cards */
        .mi-comparison { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 22px 0; }

        .mi-card { background: rgba(0,0,0,0.2); border: 1px solid var(--border-subtle); border-radius: 12px; overflow: hidden; }
        .mi-card-header { background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%); color: white; padding: 18px; text-align: center; }
        .mi-card-header.govt { background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%); }
        .mi-card-header.fha { background: linear-gradient(135deg, var(--accent-teal) 0%, var(--accent-green) 100%); }
        .mi-card-header.va { background: linear-gradient(135deg, var(--accent-amber) 0%, var(--accent-rose) 100%); }
        .mi-card-header h4 { font-size: 1.05rem; }
        .mi-card-body { padding: 22px; }
        .mi-card ul { list-style: none; padding: 0; }
        .mi-card li { padding: 10px 0; border-bottom: 1px solid var(--border-subtle); display: flex; align-items: center; gap: 12px; color: var(--text-secondary); font-size: 0.95rem; }
        .mi-card li:last-child { border-bottom: none; }
        .check-icon { color: var(--accent-green); font-weight: bold; }
        .x-icon { color: var(--accent-rose); font-weight: bold; }

        /* Quick Reference */
        .quick-ref {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
            border: 1px solid var(--border-subtle);
            padding: 28px;
            border-radius: 16px;
            margin-top: 30px;
            font-family: 'JetBrains Mono', monospace;
            scroll-margin-top: 75px;
        }

        .quick-ref h3 { color: var(--accent-amber); margin-bottom: 18px; font-family: 'Plus Jakarta Sans', sans-serif; }
        .quick-ref pre { background: rgba(0,0,0,0.4); border: 1px solid var(--border-subtle); padding: 20px; border-radius: 10px; overflow-x: auto; font-size: 0.85rem; line-height: 1.7; color: var(--text-secondary); }

        /* ====== AGENT OPPORTUNITIES STYLES ====== */
        .agent-header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .agent-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(139, 92, 246, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .agent-header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        /* Heat Map */
        .heat-map-container { margin-bottom: 35px; }
        .heat-map-title { font-size: 1.3rem; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }

        .heat-map-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .heat-item {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .heat-item:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .heat-item:active { transform: scale(0.98); }

        .heat-item::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 4px;
        }

        .heat-item.critical::before { background: linear-gradient(90deg, #ef4444, #f97316); }
        .heat-item.high::before { background: linear-gradient(90deg, #f97316, #eab308); }
        .heat-item.medium::before { background: linear-gradient(90deg, #eab308, #22c55e); }
        .heat-item.low::before { background: linear-gradient(90deg, #22c55e, #14b8a6); }

        .heat-score {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.8rem;
            font-weight: 800;
        }

        .heat-item.critical .heat-score { color: #ef4444; }
        .heat-item.high .heat-score { color: #f97316; }
        .heat-item.medium .heat-score { color: #eab308; }
        .heat-item.low .heat-score { color: #22c55e; }

        .heat-name { font-size: 1rem; font-weight: 700; color: var(--text-primary); margin-bottom: 6px; padding-right: 50px; }
        .heat-desc { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; }

        .heat-metrics { display: flex; gap: 15px; margin-top: 12px; }
        .heat-metric { font-size: 0.75rem; color: var(--text-muted); }
        .heat-metric span { color: var(--text-secondary); font-weight: 600; }

        /* Agent Cards */
        .agent-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 25px; margin-bottom: 35px; }

        .agent-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .agent-card:hover { transform: translateY(-5px); box-shadow: 0 15px 50px rgba(0,0,0,0.3); }

        .agent-card.highlight {
            animation: highlightPulse 2s ease;
            box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.4);
        }

        @keyframes highlightPulse {
            0% { box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.6); }
            50% { box-shadow: 0 0 0 6px rgba(139, 92, 246, 0.5), 0 15px 50px rgba(139, 92, 246, 0.3); }
            100% { box-shadow: 0 0 0 0px transparent, 0 15px 50px rgba(0,0,0,0.3); }
        }

        .agent-card-header {
            padding: 22px;
            display: flex;
            align-items: flex-start;
            gap: 18px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .agent-icon {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            flex-shrink: 0;
        }

        .agent-info { flex: 1; }
        .agent-name { font-size: 1.15rem; font-weight: 700; color: var(--text-primary); margin-bottom: 5px; }
        .agent-type { font-size: 0.8rem; color: var(--accent-purple); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-priority {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .agent-priority.critical { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .agent-priority.high { background: rgba(249, 115, 22, 0.15); color: #f97316; }
        .agent-priority.medium { background: rgba(234, 179, 8, 0.15); color: #eab308; }
        .agent-priority.low { background: rgba(34, 197, 94, 0.15); color: #22c55e; }

        .agent-card-body { padding: 22px; }
        .agent-description { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; }

        .agent-flow {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 20px;
        }

        .agent-flow-title { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-flow-diagram { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; justify-content: center; }

        .agent-step {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .agent-arrow { color: var(--accent-purple); font-size: 1.2rem; }

        .agent-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }

        .agent-stat {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .agent-stat-value {
            font-size: 1.3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-top: 4px; }

        /* View Prompt Button */
        .agent-prompt-btn {
            width: 100%;
            margin-top: 18px;
            padding: 14px 20px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 10px;
            color: var(--accent-purple);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .agent-prompt-btn:hover {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(59, 130, 246, 0.3) 100%);
            border-color: var(--accent-purple);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.25);
        }

        /* Summary Stats */
        .agent-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .agent-summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            padding: 25px;
            text-align: center;
        }

        .agent-summary-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-summary-label { font-size: 0.9rem; color: var(--text-muted); margin-top: 8px; }

        /* Heat Map Legend */
        .heat-legend {
            display: flex;
            gap: 25px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .heat-legend-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; color: var(--text-secondary); }
        .heat-legend-color { width: 24px; height: 24px; border-radius: 6px; }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(10, 15, 26, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.show { display: flex; }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            width: 100%;
            max-width: 950px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 80px rgba(0,0,0,0.5);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            padding: 22px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 16px 16px 0 0;
        }

        .modal-header h3 { font-size: 1.25rem; font-weight: 700; }
        .modal-actions { display: flex; gap: 12px; }

        .modal-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: transform 0.2s;
            font-size: 0.9rem;
        }

        .modal-btn:hover { transform: scale(1.05); }
        .modal-btn.copy { background: white; color: var(--accent-blue); }
        .modal-btn.close { background: rgba(255,255,255,0.2); color: white; }

        .modal-body { padding: 28px; overflow-y: auto; flex: 1; }

        .modal-body pre {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            padding: 22px;
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.7;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--text-secondary);
        }

        .copy-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--accent-green);
            color: white;
            padding: 18px 35px;
            border-radius: 10px;
            font-weight: 700;
            z-index: 3000;
            display: none;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut { 0%, 100% { opacity: 0; } 10%, 90% { opacity: 1; } }

        /* Prompt Modal */
        .prompt-modal .modal { max-width: 800px; }
        .prompt-modal .modal-header { background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%); }

        .prompt-section { margin-bottom: 25px; }
        .prompt-section h4 { color: var(--accent-purple); font-size: 1rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }

        .prompt-box {
            background: rgba(0,0,0,0.4);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.7;
            color: var(--text-secondary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .prompt-tags { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .prompt-tag { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }

        /* Step List */
        .step-list { list-style: none; padding: 0; margin: 18px 0; }
        .step-list li {
            padding: 14px 18px;
            border-left: 3px solid var(--accent-blue);
            background: rgba(0,0,0,0.2);
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
        }
        .step-list li strong { color: var(--text-primary); }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 75px 20px 30px 20px; }
            .agent-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <a href="../../index.html">Portal Home</a>
        <span class="separator">></span>
        <a href="./index.html">Mortgage Fundamentals</a>
        <span class="separator">></span>
        <span class="current">Assets & Source of Funds Cheat Sheet</span>
    </nav>

    <!-- Fixed Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>Assets & Source of Funds</h2>
            <p>Interactive Workflow Guide</p>
        </div>

        <!-- Tab Switcher -->
        <div class="sidebar-tabs">
            <button class="sidebar-tab active" onclick="switchTab('workflow')">Workflow</button>
            <button class="sidebar-tab agent-tab" onclick="switchTab('agents')">AI Agents</button>
        </div>

        <!-- Workflow Navigation -->
        <nav class="sidebar-nav" id="workflow-nav">
            <a href="#section-1" class="nav-item active">
                <span class="nav-number">1</span>
                <span class="nav-label">Large Deposits</span>
            </a>
            <a href="#section-2" class="nav-item">
                <span class="nav-number">2</span>
                <span class="nav-label">Payment Reserves</span>
            </a>
            <a href="#section-3" class="nav-item">
                <span class="nav-number">3</span>
                <span class="nav-label">Money In Accounts</span>
            </a>
            <a href="#section-4" class="nav-item">
                <span class="nav-number">4</span>
                <span class="nav-label">Gift Funds</span>
            </a>
            <a href="#section-5" class="nav-item">
                <span class="nav-number">5</span>
                <span class="nav-label">Gift of Equity</span>
            </a>
            <a href="#section-6" class="nav-item">
                <span class="nav-number">6</span>
                <span class="nav-label">Collateralized Loans</span>
            </a>
            <a href="#section-7" class="nav-item">
                <span class="nav-number">7</span>
                <span class="nav-label">Sale of Item</span>
            </a>
            <a href="#quick-ref" class="nav-item">
                <span class="nav-number">*</span>
                <span class="nav-label">Quick Reference</span>
            </a>
        </nav>

        <!-- Agent Navigation -->
        <nav class="sidebar-nav" id="agents-nav" style="display: none;">
            <a href="#agent-summary" class="nav-item active">
                <span class="nav-number">S</span>
                <span class="nav-label">Summary</span>
            </a>
            <a href="#agent-heatmap" class="nav-item">
                <span class="nav-number">H</span>
                <span class="nav-label">Heat Map</span>
            </a>
            <a href="#agent-details" class="nav-item">
                <span class="nav-number">A</span>
                <span class="nav-label">Agent Details</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="doc-btn" onclick="openDocModal()">
                View Workflow Markdown
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

        <!-- ==================== WORKFLOW TAB ==================== -->
        <div id="workflow-panel" class="tab-panel active">
            <!-- Header -->
            <div class="header">
                <h1>Assets & Source of Funds Cheat Sheet</h1>
                <p class="subtitle">Complete guide for verifying assets, sourcing deposits, and documenting funds for mortgage loan origination</p>
                <div class="meta">
                    <span class="meta-item">Category: Mortgage Fundamentals</span>
                    <span class="meta-item">Role: Processor / Loan Officer</span>
                    <span class="meta-item">Updated: Oct 12, 2023</span>
                    <span class="meta-item">Applies To: All Loan Types</span>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #22c55e, #16a34a);"></div><span>Start/End</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></div><span>Action Step</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></div><span>Decision Point</span></div>
                <div class="legend-item"><div class="legend-color" style="background: #111827; border: 2px solid #3b82f6;"></div><span>User Input</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f43f5e, #dc2626);"></div><span>Exception</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #14b8a6, #0d9488);"></div><span>Output</span></div>
            </div>

            <!-- Section 1: Large Deposits -->
            <section id="section-1" class="section">
                <div class="section-header">
                    <div class="section-number">1</div>
                    <div class="section-title"><h2>Large Deposits</h2><span>Identify and source large deposits based on loan type</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Review Bank Statement</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Large Deposit?</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Determine Threshold</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">CONVENTIONAL</span>
                                <div class="flow-node input">>50% Monthly Qualifying Income</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">GOVERNMENT</span>
                                <div class="flow-node input">>1% Purchase Price/Appraised Value</div>
                            </div>
                        </div>
                        <div class="flow-row">
                            <div class="flow-node action">Obtain LOX + Documentation</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Verify Source</div>
                        </div>
                    </div>

                    <div class="mi-comparison">
                        <div class="mi-card">
                            <div class="mi-card-header">
                                <h4>Conventional Loans</h4>
                            </div>
                            <div class="mi-card-body">
                                <ul>
                                    <li><span class="check-icon">></span> Single deposit exceeds 50% of total monthly qualifying income</li>
                                    <li><span class="check-icon">></span> Need borrower LOX (Letter of Explanation)</li>
                                    <li><span class="check-icon">></span> Supporting documentation required</li>
                                    <li><span class="check-icon">></span> UW may deduct if not needed for funds to close</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mi-card">
                            <div class="mi-card-header govt">
                                <h4>Government Loans (FHA/VA/USDA)</h4>
                            </div>
                            <div class="mi-card-body">
                                <ul>
                                    <li><span class="check-icon">></span> Anything over 1% of purchase price/appraised value</li>
                                    <li><span class="check-icon">></span> Multiple smaller deposits in one period may need verification</li>
                                    <li><span class="check-icon">></span> Out-of-character deposits require LOE</li>
                                    <li><span class="check-icon">></span> Fixed income with sudden deposits = red flag</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="tip-box">
                        <h4>Direct Deposit Exception</h4>
                        <p>If the source of a large deposit is readily identifiable on the account statement (such as direct deposits where the source is printed on the statement), the lender does not need to obtain further explanation or documentation.</p>
                    </div>

                    <div class="exception-box">
                        <h4>Critical Requirements</h4>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>LOX from borrower is ALWAYS required for both purchase and refi</li>
                            <li>Must ensure large deposit is not a new loan</li>
                            <li>Investigate accounts opened within 60 days of application</li>
                            <li>Review balances considerably greater than average on VOD</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 2: Payment Reserves -->
            <section id="section-2" class="section">
                <div class="section-header">
                    <div class="section-number">2</div>
                    <div class="section-title"><h2>Payment Reserves</h2><span>Acceptable reserve accounts and valuation rules</span></div>
                </div>
                <div class="section-content">
                    <h3 style="color: var(--accent-blue); margin-bottom: 15px;">Acceptable Reserve Accounts</h3>
                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Account Type</th>
                                <th>Conventional Value</th>
                                <th>Government Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Checking or Savings Accounts</td>
                                <td><span class="badge conv-badge">100%</span></td>
                                <td><span class="badge govt-badge">100%</span></td>
                            </tr>
                            <tr>
                                <td>Stocks, Bonds, Mutual Funds</td>
                                <td><span class="badge conv-badge">100%</span></td>
                                <td><span class="badge govt-badge">60%</span></td>
                            </tr>
                            <tr>
                                <td>Certificates of Deposit (CD)</td>
                                <td><span class="badge conv-badge">100%</span></td>
                                <td><span class="badge govt-badge">60%</span></td>
                            </tr>
                            <tr>
                                <td>Money Market Funds</td>
                                <td><span class="badge conv-badge">100%</span></td>
                                <td><span class="badge govt-badge">60%</span></td>
                            </tr>
                            <tr>
                                <td>Trust Accounts</td>
                                <td><span class="badge conv-badge">100%</span></td>
                                <td><span class="badge govt-badge">60%</span></td>
                            </tr>
                            <tr>
                                <td>Cash Value of Life Insurance</td>
                                <td><span class="badge conv-badge">100%</span></td>
                                <td><span class="badge govt-badge">60%</span></td>
                            </tr>
                            <tr>
                                <td>Vested Retirement Account Balance</td>
                                <td><span class="badge conv-badge">100%</span></td>
                                <td><span class="badge govt-badge">60%</span></td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="info-box">
                        <h4>401k Loan Calculation</h4>
                        <p>If the borrower intends to use an asset to satisfy financial reserve requirements and the asset has a loan against it, reduce the asset value by the loan proceeds and related fees.</p>
                    </div>

                    <div class="decision-tree">
                        <h3>401k Loan Example Calculation</h3>
                        <div class="tree-node level-1">
                            <span class="tree-label">Scenario</span>
                            401k is 100% vested at $10,000 with a $3,000 loan outstanding
                        </div>
                        <div class="tree-node">
                            <span class="tree-label">Step 1</span>
                            Subtract loan from vested balance: $10,000 - $3,000 = $7,000
                        </div>
                        <div class="tree-node">
                            <span class="tree-label">Conventional</span>
                            Use 100% of remaining balance = <strong>$7,000</strong>
                        </div>
                        <div class="tree-node">
                            <span class="tree-label">Government</span>
                            Use 60% of remaining balance: $7,000 x 60% = <strong>$4,200</strong>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 3: Money In Accounts -->
            <section id="section-3" class="section">
                <div class="section-header">
                    <div class="section-number">3</div>
                    <div class="section-title"><h2>Money In Accounts</h2><span>Source of funds verification for closing</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Pre-Qualification</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Verify Fund Source</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Account Type?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">EXISTING ACCOUNT</span>
                                <div class="flow-node input">2 Months Statements</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">NEW ACCOUNT</span>
                                <div class="flow-node input">2 Months Previous Bank History</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">CD / IRA</span>
                                <div class="flow-node input">Statement + Transfer Proof</div>
                            </div>
                        </div>
                        <div class="flow-row">
                            <div class="flow-node output">Funds Verified in Borrower Account Prior to Closing</div>
                        </div>
                    </div>

                    <h3 style="color: var(--accent-blue); margin-bottom: 15px; margin-top: 25px;">Documentation Requirements by Account Type</h3>
                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Account Type</th>
                                <th>Required Documentation</th>
                                <th>Ownership Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Existing Account</strong></td>
                                <td>Minimum 2 months bank statements (all pages)<br>Watch for large deposits</td>
                                <td><span class="badge optional-badge">Borrower's Own Money</span> if sourced/seasoned</td>
                            </tr>
                            <tr>
                                <td><strong>New Account</strong></td>
                                <td>Last 2 months history from previous bank<br>Documentation showing where money came from</td>
                                <td><span class="badge required-badge">Additional Documentation Required</span></td>
                            </tr>
                            <tr>
                                <td><strong>CD / IRA</strong></td>
                                <td>Statement showing funds are sourced/seasoned<br>Copy of check or transfer into liquid account<br>Deposit slip or bank statement</td>
                                <td><span class="badge optional-badge">Borrower's Own Money</span> if sourced/seasoned</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="warning-box">
                        <h4>Important Reminder</h4>
                        <p>The money must be verified in the borrower's account prior to closing. It is particularly important during pre-qualification to check where the money needed is coming from.</p>
                    </div>
                </div>
            </section>

            <!-- Section 4: Gift Funds -->
            <section id="section-4" class="section">
                <div class="section-header">
                    <div class="section-number">4</div>
                    <div class="section-title"><h2>Gift Funds</h2><span>Gift fund eligibility and documentation requirements</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Gift Fund Received</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Property Type?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">PRIMARY / 2ND HOME</span>
                                <div class="flow-node output">Gifts Allowed</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">INVESTMENT</span>
                                <div class="flow-node exception">Gifts NEVER Allowed</div>
                            </div>
                        </div>
                    </div>

                    <div class="mi-comparison">
                        <div class="mi-card">
                            <div class="mi-card-header">
                                <h4>Conventional Loans</h4>
                            </div>
                            <div class="mi-card-body">
                                <ul>
                                    <li><span class="check-icon">+</span> FNMA: Down payment, cash reserves, closing costs, prepaids</li>
                                    <li><span class="check-icon">+</span> FHLMC: Additional down payment, cash reserves, closing costs, prepaids</li>
                                    <li><span class="check-icon">+</span> All money can be gifted if gift is 20% or more (owner-occupied)</li>
                                    <li><span class="x-icon">X</span> Employers cannot gift on Conventional loans</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mi-card">
                            <div class="mi-card-header fha">
                                <h4>FHA Loans</h4>
                            </div>
                            <div class="mi-card-body">
                                <ul>
                                    <li><span class="check-icon">+</span> Down payment, closing costs, prepaids</li>
                                    <li><span class="x-icon">X</span> Gifts CANNOT be used for required payment reserves</li>
                                    <li><span class="check-icon">+</span> Reserves must be borrower's own sourced/seasoned funds</li>
                                    <li><span class="check-icon">+</span> Employer gifts ARE allowed on FHA</li>
                                    <li><span class="check-icon">+</span> Close friend with documented interest allowed</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mi-card">
                            <div class="mi-card-header va">
                                <h4>VA & USDA Loans</h4>
                            </div>
                            <div class="mi-card-body">
                                <ul>
                                    <li><span class="check-icon">+</span> Down payment, closing costs, prepaids</li>
                                    <li><span class="check-icon">+</span> Standard gift documentation required</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <h3 style="color: var(--accent-blue); margin-bottom: 15px; margin-top: 25px;">Acceptable Gift Sources</h3>
                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Source Type</th>
                                <th>Eligible Donors</th>
                                <th>Special Requirements</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Family Members</strong></td>
                                <td>Spouse, child, blood relative, adoptive relative, guardian, fiance, domestic partner, stepparent, stepsiblings</td>
                                <td>Standard documentation</td>
                            </tr>
                            <tr>
                                <td><strong>Organizations</strong></td>
                                <td>Church, municipality, non-profit organization</td>
                                <td>Must have established gift program for low/moderate income or first-time buyers</td>
                            </tr>
                            <tr>
                                <td><strong>Employer</strong></td>
                                <td>Borrower's employer</td>
                                <td><span class="badge fha-badge">FHA Only</span> - Not allowed on Conventional</td>
                            </tr>
                            <tr>
                                <td><strong>Seller</strong></td>
                                <td>Seller who is acceptable donor and not affiliated with interested party</td>
                                <td>Donor of gift of equity is not considered interested party</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="exception-box">
                        <h4>FHA Special Rules</h4>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>FHA allows gifts from close friend with clearly defined and documented interest in borrower</li>
                            <li>Must document familial-type relationship with letter from borrower and donor</li>
                            <li><strong>Cousins are NOT considered family members and cannot gift</strong></li>
                            <li>Acceptable documentation: Facebook relationship proof, yearbook photos, photos over time</li>
                        </ul>
                    </div>

                    <h3 style="color: var(--accent-blue); margin-bottom: 15px; margin-top: 25px;">Gift Paper Trail Requirements</h3>
                    <ul class="step-list">
                        <li><strong>Gift Affidavit Form:</strong> Signed by donor stating borrower does not have to repay. Given at application/pre-qual, must be completed and signed by donor.</li>
                        <li><strong>Copy of Gift Check:</strong> Must be cashier's check or money order. Personal check requires donor's bank verification that it cleared.</li>
                        <li><strong>FHA Additional Requirement:</strong> Donor must verify money coming out of their accounts.</li>
                        <li><strong>Deposit Documentation:</strong> Copy of deposit slip when borrower deposits the money, OR gifts can be wired to Title Company/Attorney at closing.</li>
                    </ul>

                    <div class="info-box">
                        <h4>Gift Funds Classification</h4>
                        <p>Gift funds are <strong>NOT</strong> considered the borrower's own money.</p>
                    </div>
                </div>
            </section>

            <!-- Section 5: Gift of Equity -->
            <section id="section-5" class="section">
                <div class="section-header">
                    <div class="section-number">5</div>
                    <div class="section-title"><h2>Gift of Equity</h2><span>Family member property purchase equity gift requirements</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Family Member Sale</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Property Type?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">PRIMARY / 2ND HOME</span>
                                <div class="flow-node output">Gift of Equity Permitted</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">INVESTMENT</span>
                                <div class="flow-node exception">Not Allowed</div>
                            </div>
                        </div>
                        <div class="flow-row">
                            <div class="flow-node action">Disclose in Offer to Purchase</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Gift Letter Required</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Credit on Closing Disclosure</div>
                        </div>
                    </div>

                    <h3 style="color: var(--accent-blue); margin-bottom: 15px;">Gift of Equity Requirements</h3>
                    <ul class="step-list">
                        <li><strong>Property Type:</strong> Permitted for primary residences (owner-occupied) or 2nd homes only. NOT allowed with investment property.</li>
                        <li><strong>Sales Price:</strong> Must be at an acceptable market price.</li>
                        <li><strong>Offer to Purchase:</strong> Must state there is a gift of equity and disclose the relationship between borrower and seller. Example: "Buyer is daughter of the Seller, Seller to gift 20% in equity to the buyer at closing"</li>
                        <li><strong>Relative Restrictions:</strong> The relative may NOT be, or have affiliation with, the builder, developer, real estate agent, or other interested party to the loan.</li>
                        <li><strong>Gift Letter:</strong> Underwriter requires Gift Letter stating relationship and amount of gift of equity.</li>
                        <li><strong>At Closing:</strong> Gift of equity is completed at closing with a credit from Seller to Buyer on the Closing Disclosure.</li>
                    </ul>

                    <div class="exception-box">
                        <h4>Separate Gift Letters Required</h4>
                        <p>If the seller is also paying closing costs, that requires a <strong>separate Gift Letter</strong> from the one for Gift of Equity. They cannot be combined.</p>
                        <p style="margin-top: 10px;"><strong>Example:</strong> Gift of equity for X amount or %, AND seller to pay closing costs of X amount.</p>
                    </div>

                    <div class="warning-box">
                        <h4>VA Loan Restriction</h4>
                        <p><strong>Gift of Equity is NOT allowed on VA Loans.</strong></p>
                    </div>

                    <div class="info-box">
                        <h4>Gift of Equity Classification</h4>
                        <p>Gift of equity funds are <strong>NOT</strong> considered the borrower's own money.</p>
                    </div>
                </div>
            </section>

            <!-- Section 6: Collateralized Loans -->
            <section id="section-6" class="section">
                <div class="section-header">
                    <div class="section-number">6</div>
                    <div class="section-title"><h2>Collateralized Loans</h2><span>Using secured loans as source of funds</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Borrower Takes Secured Loan</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Collateral Type?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">PREFERRED</span>
                                <div class="flow-node output">Car, Motorcycle, Boat</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">NOT PREFERRED</span>
                                <div class="flow-node exception">Personal Property</div>
                            </div>
                        </div>
                        <div class="flow-row">
                            <div class="flow-node action">Document Paper Trail</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Add Debt to Liabilities</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Verify Collateral Value</div>
                        </div>
                    </div>

                    <h3 style="color: var(--accent-blue); margin-bottom: 15px;">Paper Trail Requirements</h3>
                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Document</th>
                                <th>Purpose</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Copy of Loan Papers</td>
                                <td>Shows loan amount, monthly payment, and collateral</td>
                                <td><span class="badge required-badge">Required</span></td>
                            </tr>
                            <tr>
                                <td>Add Debt to Liabilities</td>
                                <td>Include new loan payment in DTI calculation</td>
                                <td><span class="badge required-badge">Required</span></td>
                            </tr>
                            <tr>
                                <td>Copy of Check/Deposit</td>
                                <td>Proof of funds into borrower's account</td>
                                <td><span class="badge required-badge">Required</span></td>
                            </tr>
                            <tr>
                                <td>Deposit Slip</td>
                                <td>Proof of loan proceeds deposited</td>
                                <td><span class="badge required-badge">Required</span></td>
                            </tr>
                            <tr>
                                <td>Collateral Valuation</td>
                                <td>Blue book value (vehicle) or written appraisal (other items)</td>
                                <td><span class="badge required-badge">Required</span></td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="tip-box">
                        <h4>Collateralized Loan Classification</h4>
                        <p>This CAN be considered the borrower's own money <strong>if the collateral is adequate</strong> to secure the loan amount.</p>
                    </div>

                    <div class="info-box">
                        <h4>Valuation Methods</h4>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>Vehicles:</strong> Blue book value acceptable</li>
                            <li><strong>Other Personal Items:</strong> May need written appraisal</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 7: Sale of Item -->
            <section id="section-7" class="section">
                <div class="section-header">
                    <div class="section-number">7</div>
                    <div class="section-title"><h2>Sale of Item</h2><span>Documenting proceeds from personal property sales</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Borrower Sells Item</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Item Type?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">TITLED ITEM (Car, etc.)</span>
                                <div class="flow-node input">Title Transfer + Blue Book/Appraisal</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">NON-TITLED ITEM (Jewelry, etc.)</span>
                                <div class="flow-node input">Separate Appraisal Required</div>
                            </div>
                        </div>
                        <div class="flow-row">
                            <div class="flow-node output">Document Value of Item Sold</div>
                        </div>
                    </div>

                    <h3 style="color: var(--accent-blue); margin-bottom: 15px;">Documentation Requirements</h3>
                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Item Sold</th>
                                <th>Required Documentation</th>
                                <th>Valuation Method</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Car or Titled Item</strong></td>
                                <td>Copy of title transfer</td>
                                <td>Blue book value or appraisal</td>
                            </tr>
                            <tr>
                                <td><strong>Non-Titled Item</strong> (e.g., jewelry)</td>
                                <td>Proof of sale</td>
                                <td>Separate appraisal required (cannot be looked up online)</td>
                            </tr>
                            <tr>
                                <td><strong>Any Item</strong></td>
                                <td>Document the value of item sold</td>
                                <td>Must support the amount deposited</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="tip-box">
                        <h4>Key Point</h4>
                        <p>If selling something that cannot be looked up online for value, a separate appraisal will be needed for the item to document the proceeds as acceptable source of funds.</p>
                    </div>
                </div>
            </section>

            <!-- Quick Reference -->
            <div id="quick-ref" class="quick-ref">
                <h3>Assets & Source of Funds Quick Reference</h3>
                <pre>
LARGE DEPOSIT THRESHOLDS
========================
LOAN TYPE        | THRESHOLD                           | DOCUMENTATION
-----------------|-------------------------------------|----------------------------------
Conventional     | >50% monthly qualifying income      | LOX + supporting docs
Government       | >1% purchase price/appraised value  | LOX + source verification
All Types        | Multiple deposits in short period   | May need verification
Direct Deposit   | Source printed on statement         | No additional docs needed

RESERVE ACCOUNT VALUES
======================
ACCOUNT TYPE                    | CONVENTIONAL | GOVERNMENT
--------------------------------|--------------|------------
Checking/Savings                | 100%         | 100%
Stocks, Bonds, Mutual Funds     | 100%         | 60%
CDs, Money Market               | 100%         | 60%
Life Insurance Cash Value       | 100%         | 60%
Vested Retirement (401k/IRA)    | 100%         | 60%

401K LOAN CALCULATION: Vested Balance - Loan Amount = Usable Balance
                       Then apply percentage (100% Conv / 60% Govt)

GIFT FUND ELIGIBILITY BY LOAN TYPE
==================================
USE FOR              | CONVENTIONAL | FHA  | VA/USDA
---------------------|--------------|------|--------
Down Payment         | Yes          | Yes  | Yes
Closing Costs        | Yes          | Yes  | Yes
Prepaids            | Yes          | Yes  | Yes
Cash Reserves       | Yes          | NO   | N/A
All Money (20%+ gift)| Yes (O/O)    | N/A  | N/A

ACCEPTABLE GIFT SOURCES
=======================
- Spouse, child, blood/adoptive relative, guardian
- Fiance, domestic partner, stepparent, stepsiblings
- Church, municipality, non-profit (with established program)
- Employer: FHA ONLY (not Conventional)
- Close friend: FHA ONLY (must document relationship)
- Cousins: NOT ALLOWED

GIFT PAPER TRAIL CHECKLIST
==========================
[ ] Gift Affidavit Form (signed by donor)
[ ] Copy of gift check (cashier's check/money order preferred)
[ ] If personal check: donor's bank verification
[ ] FHA: donor must verify money leaving their account
[ ] Deposit slip OR wire to Title Company

GIFT OF EQUITY RULES
====================
- Permitted: Primary residence, 2nd home
- NOT Permitted: Investment property, VA loans
- Must disclose in Offer to Purchase
- Separate Gift Letters for equity AND closing costs
- Sales price must be at market value

SOURCE OF FUNDS OWNERSHIP STATUS
================================
SOURCE                  | BORROWER'S OWN MONEY?
------------------------|----------------------
Sourced/Seasoned Funds  | YES
Gift Funds              | NO
Gift of Equity          | NO
Collateralized Loan     | YES (if adequate collateral)
Sale of Item            | YES (with proper documentation)
                </pre>
            </div>
        </div>

        <!-- ==================== AI AGENTS TAB ==================== -->
        <div id="agents-panel" class="tab-panel">
            <!-- Agent Header -->
            <div class="agent-header">
                <h1>AI Agent Opportunities</h1>
                <p class="subtitle">Automation opportunities identified for the Assets & Source of Funds verification process</p>
            </div>

            <!-- Summary Stats -->
            <div class="agent-summary" id="agent-summary">
                <div class="agent-summary-card">
                    <div class="agent-summary-value">4</div>
                    <div class="agent-summary-label">Agent Opportunities</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">68%</div>
                    <div class="agent-summary-label">Automation Potential</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">12 min</div>
                    <div class="agent-summary-label">Est. Time Saved</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">High</div>
                    <div class="agent-summary-label">Compliance Impact</div>
                </div>
            </div>

            <!-- Heat Map Legend -->
            <div class="heat-legend">
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #ef4444, #f97316);"></div>
                    <span>Critical Priority (9-10)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #f97316, #eab308);"></div>
                    <span>High Priority (7-8)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #eab308, #22c55e);"></div>
                    <span>Medium Priority (5-6)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #22c55e, #14b8a6);"></div>
                    <span>Low Priority (1-4)</span>
                </div>
            </div>

            <!-- Heat Map Grid -->
            <div class="heat-map-container" id="agent-heatmap">
                <div class="heat-map-title">Priority Heat Map</div>
                <div class="heat-map-grid">
                    <div class="heat-item critical" onclick="scrollToAgent('agent-deposit-scanner')">
                        <div class="heat-score">9.4</div>
                        <div class="heat-name">Large Deposit Scanner</div>
                        <div class="heat-desc">Auto-detect large deposits and flag for sourcing</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>5 min</span></div>
                            <div class="heat-metric">Complexity: <span>Medium</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-gift-validator')">
                        <div class="heat-score">8.2</div>
                        <div class="heat-name">Gift Fund Validator</div>
                        <div class="heat-desc">Validate gift eligibility by loan type and donor</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>4 min</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-reserve-calc')">
                        <div class="heat-score">7.8</div>
                        <div class="heat-name">Reserve Calculator</div>
                        <div class="heat-desc">Auto-calculate reserve values by loan type</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>2 min</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                    <div class="heat-item medium" onclick="scrollToAgent('agent-paper-trail')">
                        <div class="heat-score">6.5</div>
                        <div class="heat-name">Paper Trail Checker</div>
                        <div class="heat-desc">Verify all required documentation is present</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>3 min</span></div>
                            <div class="heat-metric">Complexity: <span>Medium</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agent Details -->
            <div id="agent-details">
                <h2 style="color: var(--text-primary); margin-bottom: 25px; font-size: 1.5rem;">Agent Details</h2>
                <div class="agent-grid">
                    <!-- Large Deposit Scanner Agent -->
                    <div class="agent-card" id="agent-deposit-scanner">
                        <div class="agent-card-header">
                            <div class="agent-icon">D</div>
                            <div class="agent-info">
                                <div class="agent-name">Large Deposit Scanner</div>
                                <div class="agent-type">Document Analysis / AI</div>
                            </div>
                            <span class="agent-priority critical">Critical</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Automatically scans bank statements to identify large deposits based on loan type thresholds (50% for Conventional, 1% for Government). Flags deposits requiring sourcing and generates LOX request templates.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Upload Statement</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Parse Deposits</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Apply Threshold</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Flag & Alert</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">5 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">98%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Med</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('depositscanner')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Gift Fund Validator Agent -->
                    <div class="agent-card" id="agent-gift-validator">
                        <div class="agent-card-header">
                            <div class="agent-icon">G</div>
                            <div class="agent-info">
                                <div class="agent-name">Gift Fund Validator</div>
                                <div class="agent-type">Rules Engine / Validation</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Validates gift fund eligibility based on loan type, property type, donor relationship, and intended use. Generates checklist of required documentation and flags compliance issues automatically.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Input Gift Details</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Check Eligibility</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Generate Checklist</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Flag Issues</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">4 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">99%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('giftvalidator')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Reserve Calculator Agent -->
                    <div class="agent-card" id="agent-reserve-calc">
                        <div class="agent-card-header">
                            <div class="agent-icon">R</div>
                            <div class="agent-info">
                                <div class="agent-name">Reserve Calculator</div>
                                <div class="agent-type">Calculation Engine</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Automatically calculates usable reserve amounts based on loan type (100% Conventional vs 60% Government), handles 401k loan deductions, and verifies reserve requirements are met.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Input Assets</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Apply Percentages</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Deduct Loans</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Output Total</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">2 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">100%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('reservecalc')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Paper Trail Checker Agent -->
                    <div class="agent-card" id="agent-paper-trail">
                        <div class="agent-card-header">
                            <div class="agent-icon">P</div>
                            <div class="agent-info">
                                <div class="agent-name">Paper Trail Checker</div>
                                <div class="agent-type">Document Verification</div>
                            </div>
                            <span class="agent-priority medium">Medium</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Verifies all required documentation is present for each funding source type - gift affidavits, deposit slips, title transfers, appraisals, etc. Generates missing document alerts and conditions.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Identify Source Type</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Check Requirements</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Scan File</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Report Missing</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">3 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">95%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Med</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('papertrail')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Documentation Modal -->
    <div class="modal-overlay" id="docModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Assets & Source of Funds Documentation</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyToClipboard()">Copy</button>
                    <button class="modal-btn close" onclick="closeDocModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <pre id="docContent"># Assets & Source of Funds Cheat Sheet

## Overview
Complete guide for verifying assets, sourcing deposits, and documenting funds for mortgage loan origination. Updated: 10/12/23

## Large Deposits

### Conventional Loans
- Threshold: Single deposit exceeds 50% of total monthly qualifying income
- Need borrower LOX and supporting documentation
- UW may deduct if not needed for funds to close

### Government Loans (FHA/VA/USDA)
- Threshold: Anything over 1% of purchase price/appraised value
- Multiple smaller deposits in one period may need verification
- Out-of-character deposits require LOE

### Key Rules
- LOX always required for both purchase and refi
- Must ensure large deposit is not a new loan
- Investigate accounts opened within 60 days of application
- Direct deposits with source printed on statement = no additional docs needed

## Payment Reserves

### Conventional Loans: 100% of asset value
### Government Loans: 60% of asset value

### Acceptable Reserve Accounts
- Checking/Savings
- Stocks, bonds, mutual funds
- CDs, money market funds
- Trust accounts
- Cash value of life insurance
- Vested retirement account balance

### 401k Loan Calculation
Subtract loan from vested balance, then apply percentage

## Gift Funds

### Eligibility by Property Type
- Primary residence: Allowed
- Second home: Allowed
- Investment: NEVER allowed

### Conventional Gifts
- Down payment, reserves, closing costs, prepaids
- All money can be gifted if 20%+ (owner-occupied)
- Employers CANNOT gift

### FHA Gifts
- Down payment, closing costs, prepaids
- CANNOT use for required reserves
- Employers CAN gift
- Close friend with documented relationship allowed

### Acceptable Donors
- Family members (spouse, child, blood/adoptive relatives)
- Guardian, fiance, domestic partner
- Church, municipality, non-profit (with established program)
- Cousins are NOT allowed

### Paper Trail
- Gift Affidavit Form (signed by donor)
- Copy of gift check (cashier's check preferred)
- Deposit slip or wire confirmation
- FHA: donor must verify funds leaving account

## Gift of Equity
- Family member "gifts" equity in property sale
- Primary residence and 2nd home only
- NOT allowed on investment property or VA loans
- Must disclose in Offer to Purchase
- Separate Gift Letters required for equity AND closing costs

## Collateralized Loans
- Preferred collateral: car, motorcycle, boat
- Document: loan papers, deposit, collateral valuation
- Add new payment to liabilities
- Considered borrower's own money if adequate collateral

## Sale of Item
- Document value of item sold
- Titled items: copy of title transfer + blue book
- Non-titled items: separate appraisal required</pre>
            </div>
        </div>
    </div>

    <!-- AI Prompt Modal -->
    <div class="modal-overlay prompt-modal" id="promptModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="promptModalTitle">AI Agent Build Prompt</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyPromptToClipboard()">Copy Prompt</button>
                    <button class="modal-btn close" onclick="closePromptModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="prompt-tags" id="promptTags"></div>
                <div class="prompt-section">
                    <h4>Agent Purpose</h4>
                    <div class="prompt-box" id="promptPurpose"></div>
                </div>
                <div class="prompt-section">
                    <h4>Full Build Prompt</h4>
                    <div class="prompt-box" id="promptContent"></div>
                </div>
                <div class="prompt-section">
                    <h4>Integration Points</h4>
                    <div class="prompt-box" id="promptIntegration"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="copy-success" id="copySuccess">Copied to clipboard!</div>

    <script>
        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));

            if (tab === 'workflow') {
                document.querySelector('.sidebar-tab:not(.agent-tab)').classList.add('active');
                document.getElementById('workflow-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'block';
                document.getElementById('agents-nav').style.display = 'none';
            } else {
                document.querySelector('.sidebar-tab.agent-tab').classList.add('active');
                document.getElementById('agents-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'none';
                document.getElementById('agents-nav').style.display = 'block';
            }

            window.scrollTo(0, 0);
        }

        // Scroll spy with isScrolling flag and 1000ms timeout
        const sections = document.querySelectorAll('.section, .quick-ref');
        const navItems = document.querySelectorAll('#workflow-nav .nav-item');
        let isScrolling = false;
        let scrollTimeout;

        function updateActiveNav() {
            if (isScrolling) return;

            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                if (window.scrollY >= sectionTop) current = section.getAttribute('id');
            });
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + current) item.classList.add('active');
            });
        }

        // Handle nav click to temporarily disable scroll spy
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                isScrolling = true;
                clearTimeout(scrollTimeout);

                // Remove active from all, add to clicked
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');

                // Re-enable scroll spy after 1000ms
                scrollTimeout = setTimeout(() => {
                    isScrolling = false;
                }, 1000);
            });
        });

        window.addEventListener('scroll', updateActiveNav);

        // Modal
        function openDocModal() {
            document.getElementById('docModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeDocModal() {
            document.getElementById('docModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyToClipboard() {
            try {
                await navigator.clipboard.writeText(document.getElementById('docContent').textContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeDocModal(); closePromptModal(); } });
        document.getElementById('docModal').addEventListener('click', (e) => { if (e.target.id === 'docModal') closeDocModal(); });

        document.addEventListener('DOMContentLoaded', () => { updateActiveNav(); });

        // Scroll to agent card and highlight
        function scrollToAgent(agentId) {
            const agentCard = document.getElementById(agentId);
            if (agentCard) {
                document.querySelectorAll('.agent-card.highlight').forEach(card => {
                    card.classList.remove('highlight');
                });

                agentCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

                setTimeout(() => {
                    agentCard.classList.add('highlight');
                }, 300);

                setTimeout(() => {
                    agentCard.classList.remove('highlight');
                }, 2500);
            }
        }

        // Agent Prompt System
        const agentPrompts = {
            depositscanner: {
                name: 'Large Deposit Scanner',
                tags: ['Document Analysis', 'AI/ML', 'Medium Complexity', 'Critical Priority'],
                purpose: `This agent automatically scans bank statements to identify large deposits based on loan type thresholds. For Conventional loans, it flags deposits exceeding 50% of monthly qualifying income. For Government loans, it flags deposits over 1% of purchase price/appraised value. It also detects patterns of multiple smaller deposits that may require sourcing.`,
                prompt: `You are building a Document Analysis Agent for CMG Financial's loan origination process.

AGENT NAME: Large Deposit Scanner
TYPE: Document Analysis / AI

OBJECTIVE:
Create an agent that automatically analyzes bank statements to identify deposits requiring sourcing based on loan program thresholds.

INPUT DATA:
- Bank statement PDF/images
- Loan type (Conventional/FHA/VA/USDA)
- Monthly qualifying income (for Conventional)
- Purchase price or appraised value (for Government)

THRESHOLD LOGIC:
1. CONVENTIONAL:
   - Flag if single deposit > 50% of monthly qualifying income
   - Calculate: deposit_amount > (monthly_income * 0.50)

2. GOVERNMENT (FHA/VA/USDA):
   - Flag if single deposit > 1% of purchase price/appraised value
   - Calculate: deposit_amount > (purchase_price * 0.01)
   - Also flag: multiple deposits in same day/week period
   - Also flag: deposits out of character for account pattern

PATTERN DETECTION:
- Identify recurring deposits (payroll, regular transfers)
- Mark as "readily identifiable" if source printed on statement
- Flag irregular/one-time large deposits
- Detect deposit splitting (multiple smaller deposits same period)

OUTPUT:
{
  "flagged_deposits": [
    {
      "date": "2026-01-15",
      "amount": 5000.00,
      "threshold_type": "conventional_50pct",
      "source_identified": false,
      "requires_lox": true,
      "suggested_source": "Unknown - requires documentation"
    }
  ],
  "readily_identifiable": [
    {
      "date": "2026-01-01",
      "amount": 3500.00,
      "source": "ACME CORP PAYROLL",
      "no_additional_docs": true
    }
  ],
  "pattern_alerts": [
    "Multiple deposits totaling $4,500 on 01/10-01/12 may require sourcing"
  ]
}`,
                integration: `INTEGRATION POINTS:
1. Document OCR/AI
   - Extract transactions from bank statements
   - Parse deposit amounts, dates, descriptions
   - Handle multiple statement formats

2. LOS Integration
   - Pull loan type, income, purchase price
   - Generate LOX request automatically
   - Create conditions for missing documentation

3. Workflow Automation
   - Flag loans in queue requiring deposit sourcing
   - Generate borrower communication templates
   - Track sourcing documentation received`
            },
            giftvalidator: {
                name: 'Gift Fund Validator',
                tags: ['Rules Engine', 'Validation', 'Low Complexity', 'High Priority'],
                purpose: `This agent validates gift fund eligibility based on loan type, property type, donor relationship, and intended use of funds. It ensures FHA restrictions on reserves are enforced, verifies acceptable donor relationships, and generates the complete documentation checklist for the specific gift scenario.`,
                prompt: `You are building a Rules Engine Agent for CMG Financial's loan origination process.

AGENT NAME: Gift Fund Validator
TYPE: Rules Engine / Validation

OBJECTIVE:
Validate gift fund eligibility and generate documentation requirements based on loan program rules.

INPUT DATA:
- Loan type (Conventional/FHA/VA/USDA)
- Property type (Primary/Second Home/Investment)
- Gift amount
- Intended use (down payment/closing costs/reserves)
- Donor relationship to borrower

VALIDATION RULES:

1. PROPERTY TYPE CHECK:
   - Primary Residence: ALLOWED
   - Second Home: ALLOWED
   - Investment Property: NEVER ALLOWED (reject immediately)

2. LOAN TYPE RULES:

   CONVENTIONAL:
   - Allowed for: down payment, reserves, closing costs, prepaids
   - If gift >= 20% and owner-occupied: all funds can be gifted
   - Employers CANNOT be donors

   FHA:
   - Allowed for: down payment, closing costs, prepaids
   - NOT ALLOWED for: required payment reserves
   - Employers CAN be donors
   - Close friends allowed with relationship documentation

   VA/USDA:
   - Allowed for: down payment, closing costs, prepaids

3. DONOR RELATIONSHIP VALIDATION:
   ALWAYS ACCEPTABLE:
   - Spouse, child, parent
   - Blood relative, adoptive relative
   - Guardian (of or for borrower)
   - Fiance, domestic partner
   - Stepparent, stepsiblings

   CONDITIONAL:
   - Church, municipality, non-profit: requires established gift program
   - Employer: FHA ONLY
   - Close friend: FHA ONLY, requires relationship documentation

   NOT ACCEPTABLE:
   - Cousins (explicitly excluded)
   - Interested parties to transaction

OUTPUT:
{
  "eligible": true/false,
  "rejection_reason": "string if not eligible",
  "documentation_required": [
    "Gift Affidavit Form - signed by donor",
    "Copy of gift check (cashier's check preferred)",
    "Deposit slip or wire confirmation"
  ],
  "special_requirements": [
    "FHA: Donor must provide proof of funds leaving account"
  ],
  "warnings": [
    "Gift cannot be used for reserves on FHA loan"
  ]
}`,
                integration: `INTEGRATION POINTS:
1. LOS Data
   - Pull loan type, property type from file
   - Validate against program guidelines

2. Document Checklist
   - Generate dynamic checklist based on scenario
   - Track received vs. outstanding items

3. Compliance Flags
   - Auto-generate conditions for missing items
   - Alert processor to eligibility issues
   - Block progression if investment property gift detected`
            },
            reservecalc: {
                name: 'Reserve Calculator',
                tags: ['Calculation Engine', 'Low Complexity', 'High Priority'],
                purpose: `This agent automatically calculates usable reserve amounts based on loan type percentages (100% for Conventional, 60% for Government loans). It handles 401k loan deductions, aggregates multiple asset accounts, and verifies if reserve requirements are met based on loan program guidelines.`,
                prompt: `You are building a Calculation Engine for CMG Financial's loan origination process.

AGENT NAME: Reserve Calculator
TYPE: Calculation Engine

OBJECTIVE:
Calculate total usable reserves based on loan type and asset accounts, applying correct percentages and deductions.

INPUT DATA:
- Loan type (Conventional vs Government)
- Asset accounts with balances and types
- 401k/retirement account loan amounts
- Reserve requirement (months of PITI)

CALCULATION RULES:

1. PERCENTAGE BY LOAN TYPE:
   CONVENTIONAL: 100% of eligible asset value
   GOVERNMENT (FHA/VA/USDA): 60% of eligible asset value

   Exception: Checking/Savings = 100% for all loan types

2. ELIGIBLE ASSET TYPES:
   - Checking accounts: 100%
   - Savings accounts: 100%
   - Stocks, bonds, mutual funds: Loan type %
   - CDs: Loan type %
   - Money market funds: Loan type %
   - Trust accounts: Loan type %
   - Cash value life insurance: Loan type %
   - Vested retirement (401k/IRA): Loan type %

3. 401K LOAN DEDUCTION:
   If retirement account has outstanding loan:
   - Subtract loan balance from vested amount
   - Then apply loan type percentage

   Example: $10,000 vested - $3,000 loan = $7,000
   - Conventional: $7,000 x 100% = $7,000
   - Government: $7,000 x 60% = $4,200

4. AGGREGATE CALCULATION:
   Sum all adjusted asset values for total reserves

OUTPUT:
{
  "loan_type": "Conventional",
  "asset_breakdown": [
    {"type": "Checking", "balance": 5000, "usable": 5000, "rate": "100%"},
    {"type": "401k", "balance": 10000, "loan": 3000, "net": 7000, "usable": 7000, "rate": "100%"},
    {"type": "Stocks", "balance": 8000, "usable": 8000, "rate": "100%"}
  ],
  "total_usable_reserves": 20000,
  "monthly_piti": 2500,
  "months_of_reserves": 8,
  "requirement_met": true,
  "requirement_months": 6
}`,
                integration: `INTEGRATION POINTS:
1. Asset Data Import
   - Pull verified asset accounts from LOS
   - Import VOD data automatically

2. Loan Program Rules
   - Determine reserve requirements by program
   - Factor in property type (3-4 unit = more reserves)

3. Reporting
   - Generate reserve calculation worksheet
   - Flag if requirements not met
   - Suggest additional assets needed`
            },
            papertrail: {
                name: 'Paper Trail Checker',
                tags: ['Document Verification', 'Medium Complexity', 'Medium Priority'],
                purpose: `This agent verifies all required documentation is present for each type of funding source. It checks for gift affidavits, deposit slips, title transfers, appraisals, and other required items based on the source of funds type, then generates missing document alerts and loan conditions.`,
                prompt: `You are building a Document Verification Agent for CMG Financial's loan origination process.

AGENT NAME: Paper Trail Checker
TYPE: Document Verification

OBJECTIVE:
Verify all required documentation is present based on the source of funds type and generate conditions for missing items.

INPUT DATA:
- Source of funds type(s) identified in file
- Documents currently in loan file
- Loan type and property type

DOCUMENTATION REQUIREMENTS BY SOURCE:

1. GIFT FUNDS:
   Required:
   [ ] Gift Affidavit Form (signed by donor)
   [ ] Copy of gift check (cashier's check or money order preferred)
   [ ] Deposit slip showing gift deposited to borrower account
   OR [ ] Wire confirmation to Title Company

   If personal check used:
   [ ] Donor's bank statement showing check cleared

   If FHA loan:
   [ ] Donor's bank statement showing funds leaving account

2. GIFT OF EQUITY:
   Required:
   [ ] Gift Letter stating relationship and amount
   [ ] Offer to Purchase disclosing gift of equity
   [ ] Relationship disclosure in contract

   If seller also paying closing costs:
   [ ] Separate Gift Letter for closing costs

3. COLLATERALIZED LOAN:
   Required:
   [ ] Copy of loan papers (amount, payment, collateral)
   [ ] Copy of check or deposit into borrower account
   [ ] Deposit slip for loan proceeds
   [ ] Collateral valuation (blue book or appraisal)

   Also required:
   [ ] New debt added to liabilities in LOS

4. SALE OF ITEM:
   If titled item (car, etc.):
   [ ] Copy of title transfer
   [ ] Blue book value or appraisal

   If non-titled item (jewelry, etc.):
   [ ] Separate written appraisal
   [ ] Proof of sale/receipt

5. NEW ACCOUNT:
   Required:
   [ ] 2 months statements from previous bank
   [ ] Documentation of source for opening deposit

6. CD/IRA LIQUIDATION:
   Required:
   [ ] Statement showing funds sourced/seasoned
   [ ] Copy of check or transfer to liquid account
   [ ] Deposit slip or bank statement showing receipt

OUTPUT:
{
  "source_types_identified": ["gift_funds", "401k"],
  "documentation_status": {
    "gift_funds": {
      "complete": false,
      "received": ["Gift Affidavit Form", "Gift check copy"],
      "missing": ["Deposit slip showing gift deposited"],
      "conditions_needed": ["SOF-001: Provide deposit slip for gift funds"]
    }
  },
  "overall_complete": false,
  "conditions_to_generate": [
    {
      "code": "SOF-001",
      "description": "Provide deposit slip showing gift funds deposited to borrower account",
      "category": "Assets"
    }
  ]
}`,
                integration: `INTEGRATION POINTS:
1. Document Classification
   - Scan stored docs for document types
   - Match to requirements checklist

2. Condition Generation
   - Auto-create conditions in LOS
   - Set appropriate due dates

3. Borrower Communication
   - Generate itemized request lists
   - Template emails for missing items

4. Workflow Tracking
   - Dashboard showing SOF documentation status
   - Aging report for outstanding items`
            }
        };

        function showAgentPrompt(agentKey) {
            const agent = agentPrompts[agentKey];
            if (!agent) return;

            document.getElementById('promptModalTitle').textContent = agent.name + ' - Build Prompt';
            document.getElementById('promptTags').innerHTML = agent.tags.map(t => `<span class="prompt-tag">${t}</span>`).join('');
            document.getElementById('promptPurpose').textContent = agent.purpose;
            document.getElementById('promptContent').textContent = agent.prompt;
            document.getElementById('promptIntegration').textContent = agent.integration;

            document.getElementById('promptModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closePromptModal() {
            document.getElementById('promptModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyPromptToClipboard() {
            const content = document.getElementById('promptContent').textContent;
            try {
                await navigator.clipboard.writeText(content);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.getElementById('promptModal').addEventListener('click', (e) => { if (e.target.id === 'promptModal') closePromptModal(); });
    </script>
</body>
</html>
