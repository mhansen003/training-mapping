<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preliminary Title Review Checklist - Process Workflow</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: #111827;
            --bg-card: #1a2234;
            --accent-blue: #3b82f6;
            --accent-teal: #14b8a6;
            --accent-amber: #f59e0b;
            --accent-rose: #f43f5e;
            --accent-green: #22c55e;
            --accent-purple: #8b5cf6;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-subtle: rgba(255,255,255,0.08);
            --sidebar-width: 280px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Breadcrumb */
        .breadcrumb {
            background: linear-gradient(90deg, #0d1525 0%, #1a2234 100%);
            padding: 14px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
            border-bottom: 1px solid var(--border-subtle);
        }

        .breadcrumb a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            transition: all 0.2s;
            border: 1px solid var(--border-subtle);
        }

        .breadcrumb a:hover {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .breadcrumb .separator { color: var(--text-muted); font-size: 1.2rem; }
        .breadcrumb .current { color: var(--accent-amber); font-weight: 600; padding: 8px 16px; }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 54px;
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - 54px);
            background: var(--bg-secondary);
            overflow-y: auto;
            z-index: 1000;
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 25px 20px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-header h2 { color: var(--text-primary); font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
        .sidebar-header p { color: var(--text-muted); font-size: 0.85rem; }

        /* Tab Switch */
        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-tab {
            flex: 1;
            padding: 14px 10px;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            background: none;
            border-left: none;
            border-right: none;
            border-top: none;
        }

        .sidebar-tab:hover { background: rgba(255,255,255,0.03); color: var(--text-secondary); }
        .sidebar-tab.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); background: rgba(59, 130, 246, 0.08); }
        .sidebar-tab.agent-tab.active { color: var(--accent-purple); border-bottom-color: var(--accent-purple); background: rgba(139, 92, 246, 0.08); }

        .sidebar-nav { padding: 15px 0; flex: 1; overflow-y: auto; }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .nav-item:hover { background: rgba(255,255,255,0.03); color: var(--text-primary); }
        .nav-item.active { background: rgba(59, 130, 246, 0.1); border-left-color: var(--accent-blue); color: var(--text-primary); }

        .nav-number {
            background: rgba(255,255,255,0.1);
            color: var(--text-secondary);
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .nav-item.active .nav-number { background: var(--accent-blue); color: white; }
        .nav-label { font-size: 0.95rem; font-weight: 500; }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-subtle);
            background: rgba(0,0,0,0.2);
        }

        .doc-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px 20px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .doc-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3); }

        /* Main Content */
        .main-content { margin-left: var(--sidebar-width); padding: 80px 40px 40px 40px; }

        /* Tab Panels */
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        .header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(20, 184, 166, 0.08) 0%, transparent 50%);
            pointer-events: none;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        .header .meta { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; position: relative; }

        .header .meta-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-subtle);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); }
        .legend-color { width: 18px; height: 18px; border-radius: 4px; }

        /* Sections */
        .section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            margin-bottom: 25px;
            overflow: hidden;
            scroll-margin-top: 75px;
        }

        .section-header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(59, 130, 246, 0.1) 100%);
            border-bottom: 1px solid var(--border-subtle);
            padding: 22px 25px;
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .section-number {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .section-title h2 { font-size: 1.35rem; font-weight: 700; margin-bottom: 4px; color: var(--text-primary); }
        .section-title span { font-size: 0.9rem; color: var(--text-muted); }
        .section-content { padding: 28px; }

        /* Workflow Diagrams */
        .workflow-diagram {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 28px;
            margin-bottom: 22px;
        }

        .flow-row { display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 12px; margin: 15px 0; }

        .flow-node {
            padding: 14px 22px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            min-width: 150px;
            border: 1px solid var(--border-subtle);
        }

        .flow-node.start { background: linear-gradient(135deg, var(--accent-green) 0%, #16a34a 100%); color: white; border-radius: 25px; border: none; }
        .flow-node.action { background: linear-gradient(135deg, var(--accent-blue) 0%, #2563eb 100%); color: white; border: none; }
        .flow-node.decision { background: linear-gradient(135deg, var(--accent-amber) 0%, #d97706 100%); color: var(--bg-primary); border: none; }
        .flow-node.input { background: var(--bg-secondary); border: 2px solid var(--accent-blue); color: var(--text-primary); }
        .flow-node.output { background: linear-gradient(135deg, var(--accent-teal) 0%, #0d9488 100%); color: white; border: none; }
        .flow-node.exception { background: linear-gradient(135deg, var(--accent-rose) 0%, #dc2626 100%); color: white; border: none; }

        .flow-arrow { color: var(--accent-blue); font-size: 1.5rem; }
        .flow-arrow.down { transform: rotate(90deg); }

        .decision-branch { display: flex; gap: 40px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
        .branch { display: flex; flex-direction: column; align-items: center; gap: 10px; }

        .branch-label {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        /* Tables */
        .field-table { width: 100%; border-collapse: collapse; margin: 18px 0; }

        .field-table th {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            padding: 14px 18px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border-subtle);
        }

        .field-table td { padding: 14px 18px; border-bottom: 1px solid var(--border-subtle); color: var(--text-secondary); }
        .field-table tr:hover { background: rgba(255,255,255,0.02); }

        .badge { display: inline-block; padding: 4px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge.required-badge { background: rgba(244, 63, 94, 0.15); color: var(--accent-rose); }
        .badge.optional-badge { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .badge.calculated-badge { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }
        .badge.stop-badge { background: rgba(244, 63, 94, 0.25); color: var(--accent-rose); }
        .badge.purchase-badge { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); }
        .badge.refi-badge { background: rgba(20, 184, 166, 0.15); color: var(--accent-teal); }

        /* Info Boxes */
        .exception-box, .tip-box, .info-box, .warning-box {
            padding: 18px 22px;
            margin: 18px 0;
            border-radius: 0 10px 10px 0;
            border-left-width: 4px;
            border-left-style: solid;
        }

        .exception-box { background: rgba(244, 63, 94, 0.08); border-color: var(--accent-rose); border: 1px solid rgba(244, 63, 94, 0.2); border-left: 4px solid var(--accent-rose); }
        .exception-box h4 { color: var(--accent-rose); margin-bottom: 10px; font-size: 1rem; }
        .exception-box p, .exception-box li { color: var(--text-secondary); }

        .tip-box { background: rgba(34, 197, 94, 0.08); border-color: var(--accent-green); border: 1px solid rgba(34, 197, 94, 0.2); border-left: 4px solid var(--accent-green); }
        .tip-box h4 { color: var(--accent-green); margin-bottom: 10px; font-size: 1rem; }
        .tip-box p, .tip-box li { color: var(--text-secondary); }

        .info-box { background: rgba(59, 130, 246, 0.08); border-color: var(--accent-blue); border: 1px solid rgba(59, 130, 246, 0.2); border-left: 4px solid var(--accent-blue); }
        .info-box h4 { color: var(--accent-blue); margin-bottom: 10px; font-size: 1rem; }
        .info-box p, .info-box li { color: var(--text-secondary); }

        .warning-box { background: rgba(245, 158, 11, 0.08); border-color: var(--accent-amber); border: 1px solid rgba(245, 158, 11, 0.2); border-left: 4px solid var(--accent-amber); }
        .warning-box h4 { color: var(--accent-amber); margin-bottom: 10px; font-size: 1rem; }
        .warning-box p, .warning-box li { color: var(--text-secondary); }

        /* Checklist Items */
        .checklist { list-style: none; padding: 0; margin: 18px 0; }
        .checklist li {
            padding: 14px 18px;
            border-left: 3px solid var(--accent-blue);
            background: rgba(0,0,0,0.2);
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
        }
        .checklist li strong { color: var(--text-primary); }
        .checklist li.conditional { border-left-color: var(--accent-amber); }
        .checklist li.critical { border-left-color: var(--accent-rose); }

        /* Sub-checklist */
        .sub-checklist { list-style: disc; margin: 12px 0 0 24px; }
        .sub-checklist li {
            padding: 8px 0;
            border-left: none;
            background: none;
            margin-bottom: 0;
            border-radius: 0;
        }

        /* Decision Tree */
        .decision-tree {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 22px;
            margin: 22px 0;
        }

        .decision-tree h3 { color: var(--accent-blue); margin-bottom: 18px; padding-bottom: 12px; border-bottom: 1px solid var(--border-subtle); font-size: 1.1rem; }

        .tree-node { margin-left: 20px; padding: 12px; border-left: 2px solid var(--accent-teal); position: relative; color: var(--text-secondary); }
        .tree-node::before { content: ''; position: absolute; left: -2px; top: 22px; width: 15px; height: 2px; background: var(--accent-teal); }
        .tree-node.level-1 { margin-left: 0; border-left: none; }
        .tree-node.level-1::before { display: none; }

        .tree-label { background: var(--accent-amber); color: var(--bg-primary); padding: 6px 14px; border-radius: 6px; font-weight: 700; display: inline-block; margin-bottom: 6px; font-size: 0.9rem; }

        /* Summary Grid */
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 18px; margin: 22px 0; }

        .summary-card { background: rgba(0,0,0,0.3); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 22px; text-align: center; }
        .summary-card h4 { color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9rem; }
        .summary-card .value {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .summary-card .label { font-size: 0.85rem; color: var(--text-muted); margin-top: 8px; }

        /* Quick Reference */
        .quick-ref {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
            border: 1px solid var(--border-subtle);
            padding: 28px;
            border-radius: 16px;
            margin-top: 30px;
            font-family: 'JetBrains Mono', monospace;
            scroll-margin-top: 75px;
        }

        .quick-ref h3 { color: var(--accent-amber); margin-bottom: 18px; font-family: 'Plus Jakarta Sans', sans-serif; }
        .quick-ref pre { background: rgba(0,0,0,0.4); border: 1px solid var(--border-subtle); padding: 20px; border-radius: 10px; overflow-x: auto; font-size: 0.85rem; line-height: 1.7; color: var(--text-secondary); }

        /* ====== AGENT OPPORTUNITIES STYLES ====== */
        .agent-header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .agent-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(139, 92, 246, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .agent-header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        /* Heat Map */
        .heat-map-container { margin-bottom: 35px; }
        .heat-map-title { font-size: 1.3rem; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }

        .heat-map-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .heat-item {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .heat-item:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .heat-item:active { transform: scale(0.98); }

        .heat-item::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 4px;
        }

        .heat-item.critical::before { background: linear-gradient(90deg, #ef4444, #f97316); }
        .heat-item.high::before { background: linear-gradient(90deg, #f97316, #eab308); }
        .heat-item.medium::before { background: linear-gradient(90deg, #eab308, #22c55e); }
        .heat-item.low::before { background: linear-gradient(90deg, #22c55e, #14b8a6); }

        .heat-score {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.8rem;
            font-weight: 800;
        }

        .heat-item.critical .heat-score { color: #ef4444; }
        .heat-item.high .heat-score { color: #f97316; }
        .heat-item.medium .heat-score { color: #eab308; }
        .heat-item.low .heat-score { color: #22c55e; }

        .heat-name { font-size: 1rem; font-weight: 700; color: var(--text-primary); margin-bottom: 6px; padding-right: 50px; }
        .heat-desc { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; }

        .heat-metrics { display: flex; gap: 15px; margin-top: 12px; }
        .heat-metric { font-size: 0.75rem; color: var(--text-muted); }
        .heat-metric span { color: var(--text-secondary); font-weight: 600; }

        /* Agent Cards */
        .agent-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 25px; margin-bottom: 35px; }

        .agent-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .agent-card:hover { transform: translateY(-5px); box-shadow: 0 15px 50px rgba(0,0,0,0.3); }

        .agent-card.highlight {
            animation: highlightPulse 2s ease;
            box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.4);
        }

        @keyframes highlightPulse {
            0% { box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.6); }
            50% { box-shadow: 0 0 0 6px rgba(139, 92, 246, 0.5), 0 15px 50px rgba(139, 92, 246, 0.3); }
            100% { box-shadow: 0 0 0 0px transparent, 0 15px 50px rgba(0,0,0,0.3); }
        }

        .agent-card-header {
            padding: 22px;
            display: flex;
            align-items: flex-start;
            gap: 18px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .agent-icon {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            flex-shrink: 0;
        }

        .agent-info { flex: 1; }
        .agent-name { font-size: 1.15rem; font-weight: 700; color: var(--text-primary); margin-bottom: 5px; }
        .agent-type { font-size: 0.8rem; color: var(--accent-purple); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-priority {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .agent-priority.critical { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .agent-priority.high { background: rgba(249, 115, 22, 0.15); color: #f97316; }
        .agent-priority.medium { background: rgba(234, 179, 8, 0.15); color: #eab308; }
        .agent-priority.low { background: rgba(34, 197, 94, 0.15); color: #22c55e; }

        .agent-card-body { padding: 22px; }
        .agent-description { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; }

        .agent-flow {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 20px;
        }

        .agent-flow-title { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-flow-diagram { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; justify-content: center; }

        .agent-step {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .agent-arrow { color: var(--accent-purple); font-size: 1.2rem; }

        .agent-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }

        .agent-stat {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .agent-stat-value {
            font-size: 1.3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-top: 4px; }

        /* View Prompt Button */
        .agent-prompt-btn {
            width: 100%;
            margin-top: 18px;
            padding: 14px 20px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 10px;
            color: var(--accent-purple);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .agent-prompt-btn:hover {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(59, 130, 246, 0.3) 100%);
            border-color: var(--accent-purple);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.25);
        }

        /* Summary Stats */
        .agent-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .agent-summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            padding: 25px;
            text-align: center;
        }

        .agent-summary-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-summary-label { font-size: 0.9rem; color: var(--text-muted); margin-top: 8px; }

        /* Heat Map Legend */
        .heat-legend {
            display: flex;
            gap: 25px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .heat-legend-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; color: var(--text-secondary); }
        .heat-legend-color { width: 24px; height: 24px; border-radius: 6px; }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(10, 15, 26, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.show { display: flex; }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            width: 100%;
            max-width: 950px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 80px rgba(0,0,0,0.5);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            padding: 22px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 16px 16px 0 0;
        }

        .modal-header h3 { font-size: 1.25rem; font-weight: 700; }
        .modal-actions { display: flex; gap: 12px; }

        .modal-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: transform 0.2s;
            font-size: 0.9rem;
        }

        .modal-btn:hover { transform: scale(1.05); }
        .modal-btn.copy { background: white; color: var(--accent-blue); }
        .modal-btn.close { background: rgba(255,255,255,0.2); color: white; }

        .modal-body { padding: 28px; overflow-y: auto; flex: 1; }

        .modal-body pre {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            padding: 22px;
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.7;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--text-secondary);
        }

        .copy-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--accent-green);
            color: white;
            padding: 18px 35px;
            border-radius: 10px;
            font-weight: 700;
            z-index: 3000;
            display: none;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut { 0%, 100% { opacity: 0; } 10%, 90% { opacity: 1; } }

        /* Prompt Modal */
        .prompt-modal .modal { max-width: 800px; }
        .prompt-modal .modal-header { background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%); }

        .prompt-section { margin-bottom: 25px; }
        .prompt-section h4 { color: var(--accent-purple); font-size: 1rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }

        .prompt-box {
            background: rgba(0,0,0,0.4);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.7;
            color: var(--text-secondary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .prompt-tags { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .prompt-tag { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }

        .copy-prompt-btn {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 15px;
        }

        .copy-prompt-btn:hover { transform: scale(1.05); box-shadow: 0 5px 20px rgba(139, 92, 246, 0.3); }

        /* Step List */
        .step-list { list-style: none; padding: 0; margin: 18px 0; }
        .step-list li {
            padding: 14px 18px;
            border-left: 3px solid var(--accent-blue);
            background: rgba(0,0,0,0.2);
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
        }
        .step-list li strong { color: var(--text-primary); }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 75px 20px 30px 20px; }
            .agent-grid { grid-template-columns: 1fr; }
        }
            .breadcrumb-logo-link { display: flex; align-items: center; padding: 4px 8px; background: rgba(255,255,255,0.08); border-radius: 8px; border: 1px solid rgba(255,255,255,0.12); transition: all 0.2s; }
        .breadcrumb-logo-link:hover { background: rgba(255,255,255,0.15); }
        .breadcrumb-logo { height: 28px; width: auto; }
    </style>
</head>
<body>
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <a href="../../index.html" class="breadcrumb-logo-link"><img src="../../images/clear-ai-logo.png" alt="Clear AI" class="breadcrumb-logo"></a>
        <a href="../../index.html">Portal Home</a>
        <span class="separator">></span>
        <a href="./index.html">Mortgage Fundamentals</a>
        <span class="separator">></span>
        <span class="current">Preliminary Title Review Checklist</span>
    </nav>

    <!-- Fixed Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>Prelim Title Review</h2>
            <p>Interactive Workflow Guide</p>
        </div>

        <!-- Tab Switcher -->
        <div class="sidebar-tabs">
            <button class="sidebar-tab active" onclick="switchTab('workflow')">Workflow</button>
            <button class="sidebar-tab agent-tab" onclick="switchTab('agents')">AI Agents</button>
        </div>

        <!-- Workflow Navigation -->
        <nav class="sidebar-nav" id="workflow-nav">
            <a href="#section-1" class="nav-item active">
                <span class="nav-number">1</span>
                <span class="nav-label">Schedule A: Basic Info</span>
            </a>
            <a href="#section-2" class="nav-item">
                <span class="nav-number">2</span>
                <span class="nav-label">Legal Description</span>
            </a>
            <a href="#section-3" class="nav-item">
                <span class="nav-number">3</span>
                <span class="nav-label">Vesting Review</span>
            </a>
            <a href="#section-4" class="nav-item">
                <span class="nav-number">4</span>
                <span class="nav-label">Liens & Encumbrances</span>
            </a>
            <a href="#section-5" class="nav-item">
                <span class="nav-number">5</span>
                <span class="nav-label">Hard Stops</span>
            </a>
            <a href="#section-6" class="nav-item">
                <span class="nav-number">6</span>
                <span class="nav-label">Schedule B Review</span>
            </a>
            <a href="#section-7" class="nav-item">
                <span class="nav-number">7</span>
                <span class="nav-label">Exceptions & Agreements</span>
            </a>
            <a href="#quick-ref" class="nav-item">
                <span class="nav-number">*</span>
                <span class="nav-label">Quick Reference</span>
            </a>
        </nav>

        <!-- Agent Navigation -->
        <nav class="sidebar-nav" id="agents-nav" style="display: none;">
            <a href="#agent-summary" class="nav-item active">
                <span class="nav-number">S</span>
                <span class="nav-label">Summary</span>
            </a>
            <a href="#agent-heatmap" class="nav-item">
                <span class="nav-number">H</span>
                <span class="nav-label">Heat Map</span>
            </a>
            <a href="#agent-details" class="nav-item">
                <span class="nav-number">A</span>
                <span class="nav-label">Agent Details</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="doc-btn" onclick="openDocModal()">
                View Workflow Markdown
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

        <!-- ==================== WORKFLOW TAB ==================== -->
        <div id="workflow-panel" class="tab-panel active">
            <!-- Header -->
            <div class="header">
                <h1>Preliminary Title Review Checklist</h1>
                <p class="subtitle">Complete guide for reviewing Preliminary Title Reports for purchase and refinance loans</p>
                <div class="meta">
                    <span class="meta-item">System: Byte LOS</span>
                    <span class="meta-item">Doc: RET280/32521</span>
                    <span class="meta-item">Role: Processor</span>
                    <span class="meta-item">Reference: Prelim Title, CPL & Wire Instructions Manual</span>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #22c55e, #16a34a);"></div><span>Start/End</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></div><span>Action Step</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></div><span>Decision Point</span></div>
                <div class="legend-item"><div class="legend-color" style="background: #111827; border: 2px solid #3b82f6;"></div><span>User Input</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f43f5e, #dc2626);"></div><span>Hard Stop</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #14b8a6, #0d9488);"></div><span>Output</span></div>
            </div>

            <!-- Section 1: Schedule A Basic Info -->
            <section id="section-1" class="section">
                <div class="section-header">
                    <div class="section-number">1</div>
                    <div class="section-title"><h2>First Page / Schedule A: Basic Information</h2><span>Enter escrow, title, and property information into Byte</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Receive Prelim Title</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Enter Escrow/Title Info</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Verify Subject Property</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Update Byte Screens</div>
                        </div>
                    </div>

                    <ul class="checklist">
                        <li><strong>Escrow/Title & Attorney Information:</strong> Enter into the Parties screen in Byte (if applicable)</li>
                        <li><strong>Subject Property Verification:</strong> Verify that the Subject Property matches Byte and corresponding loan documents</li>
                        <li><strong>Date Issued & Expiration:</strong> Verify date issued and enter Expiration date into Stored Documents in Byte under 'Title Commitment'</li>
                        <li><strong>Title & Escrow Company Info:</strong> Enter including Title Report Date and Title Report Number into the 'Doc Prep' Screen in Byte</li>
                    </ul>

                    <div class="info-box">
                        <h4>Type of Estate</h4>
                        <p>Most common is <strong>Fee Simple</strong>. If you see that a refinance is in a <strong>Life Estate</strong>, please escalate to Credit Policy for requirements.</p>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Field</th>
                                <th>Byte Location</th>
                                <th>Action Required</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Escrow/Title Info</td>
                                <td>Parties Screen</td>
                                <td>Enter company and attorney information</td>
                            </tr>
                            <tr>
                                <td>Expiration Date</td>
                                <td>Stored Documents > Title Commitment</td>
                                <td>Enter from title report</td>
                            </tr>
                            <tr>
                                <td>Title Report Date/Number</td>
                                <td>Doc Prep Screen</td>
                                <td>Enter report details</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Section 2: Legal Description -->
            <section id="section-2" class="section">
                <div class="section-header">
                    <div class="section-number">2</div>
                    <div class="section-title"><h2>Legal Description Review</h2><span>Verify address, APN, and condo status</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Review Legal Description</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Address Match?</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">APN Match Appraisal?</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Is Condo?</div>
                        </div>
                    </div>

                    <ul class="checklist">
                        <li><strong>Address Verification:</strong> Make sure the address matches Byte and the loan documents</li>
                        <li><strong>APN Verification:</strong> The APN # should match the Assessors Parcel Number (APN) on the appraisal</li>
                        <li class="conditional"><strong>Condo Property:</strong> If property is a condo, legal description will reflect "unit". Refer to the 'Condo Review Submission Procedure' checklist</li>
                    </ul>

                    <div class="tip-box">
                        <h4>Condo Review Required</h4>
                        <p>If the legal description reflects "unit", you must use the <strong>Condo Review Submission Procedure</strong> checklist to ensure you have everything needed to submit to the Condo Review Department.</p>
                    </div>

                    <div class="decision-tree">
                        <h3>Legal Description Verification Steps</h3>
                        <div class="tree-node level-1">
                            <span class="tree-label">Step 1</span>
                            Compare property address on title to Byte
                        </div>
                        <div class="tree-node">
                            <span class="tree-label">Step 2</span>
                            Match APN # to appraisal Assessors Parcel Number
                        </div>
                        <div class="tree-node">
                            <span class="tree-label">Step 3</span>
                            Check for "unit" in description = Condo
                        </div>
                        <div class="tree-node">
                            <span class="tree-label">If Condo</span>
                            Complete Condo Review Submission Procedure
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 3: Vesting Review -->
            <section id="section-3" class="section">
                <div class="section-header">
                    <div class="section-number">3</div>
                    <div class="section-title"><h2>Vesting Review</h2><span>Verify ownership and title transfer requirements</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node decision">Loan Type?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">PURCHASE</span>
                                <div class="flow-node action">Match Seller Name(s)</div>
                                <span class="flow-arrow down">|</span>
                                <div class="flow-node output">Verify Purchase Contract</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">REFINANCE</span>
                                <div class="flow-node action">Match Borrower Name(s)</div>
                                <span class="flow-arrow down">|</span>
                                <div class="flow-node output">Verify Loan Documents</div>
                            </div>
                        </div>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Loan Type</th>
                                <th>Vesting Requirement</th>
                                <th>Documentation Source</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="badge purchase-badge">Purchase</span></td>
                                <td>Vesting should match Sellers name(s)</td>
                                <td>Purchase Contract</td>
                            </tr>
                            <tr>
                                <td><span class="badge refi-badge">Refinance</span></td>
                                <td>Vesting should match Borrower(s) names</td>
                                <td>Loan Documents</td>
                            </tr>
                        </tbody>
                    </table>

                    <ul class="checklist">
                        <li><strong>New Loan Title:</strong> Verify how the borrower(s) will be taking title on the new loan and input into Byte in the Title Information section of the URLA Lender Loan Info screen</li>
                        <li class="conditional"><strong>Trust Vesting:</strong> If the borrower(s) will be vesting in a Trust at closing, request a copy of the Trust Agreement. The Underwriter & Closer will complete the 'Trust Review Checklist'</li>
                    </ul>

                    <div class="warning-box">
                        <h4>Trust Vesting at Closing</h4>
                        <p>When borrowers vest in a Trust, you must obtain the Trust Agreement and coordinate with the Underwriter and Closer to complete the Trust Review Checklist.</p>
                    </div>
                </div>
            </section>

            <!-- Section 4: Liens & Encumbrances -->
            <section id="section-4" class="section">
                <div class="section-header">
                    <div class="section-number">4</div>
                    <div class="section-title"><h2>Liens & Encumbrances</h2><span>Review property taxes, deeds of trust, and special liens</span></div>
                </div>
                <div class="section-content">
                    <h3 style="color: var(--accent-blue); margin-bottom: 20px;">Property Taxes</h3>
                    <ul class="checklist">
                        <li><strong>Refinance Loans:</strong> Enter the correct amount for monthly property taxes in the 'Proposed Monthly Payment for Property' section in the URLA Lender Loan Info screen in Byte</li>
                    </ul>

                    <h3 style="color: var(--accent-blue); margin: 30px 0 20px;">Deeds of Trust</h3>
                    <ul class="checklist">
                        <li><strong>Refinances:</strong> Make sure the deed of trust(s) on the prelim match the 'Mortgages and HELOC's section on the URLA Borrower Info for the subject property</li>
                        <li class="conditional"><strong>Second Deed of Trust:</strong> If there is a second deed of trust, determine if it will be paid off or subordinated</li>
                    </ul>

                    <h3 style="color: var(--accent-amber); margin: 30px 0 20px;">Conditional Items (If Applicable)</h3>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Lien Type</th>
                                <th>Purchase Action</th>
                                <th>Refinance Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Unpaid/Delinquent Property Taxes</strong></td>
                                <td>Title responsibility to ensure seller pays PTF</td>
                                <td>Obtain proof of status. If not current, UW must add PTF condition for payoff at closing</td>
                            </tr>
                            <tr>
                                <td><strong>Texas A-6</strong></td>
                                <td>N/A</td>
                                <td>Check product guidelines for seasoning requirements</td>
                            </tr>
                            <tr>
                                <td><strong>Small Business Loans (SBA)</strong></td>
                                <td>SBA prefers payoff at closing</td>
                                <td>Pay off at closing OR add to liabilities and subordinate</td>
                            </tr>
                            <tr>
                                <td><strong>Mechanics Liens</strong></td>
                                <td>N/A</td>
                                <td>Pay off at closing OR add to liabilities and subordinate</td>
                            </tr>
                            <tr>
                                <td><strong>Federal/State Income Tax Liens</strong></td>
                                <td>Per guidelines</td>
                                <td>Obtain proof of status. May need payoff or payment plan in liabilities</td>
                            </tr>
                            <tr>
                                <td><strong>Abstract of Judgement</strong></td>
                                <td>Title ensures payoff at close</td>
                                <td>Must be paid off at close</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="info-box">
                        <h4>SBA Loan Handling</h4>
                        <p>SBA prefers to be paid off at closing rather than subordinate, but will subordinate in certain situations (such as if new lien is R/T or if the balance is paid down).</p>
                    </div>

                    <div class="warning-box">
                        <h4>First Right of Refusal</h4>
                        <p>For Purchase or Refinance: Obtain a copy of the Right of First Refusal contract or CC&Rs for a condo. Ensure the terms will not affect the marketability of the home.</p>
                    </div>

                    <div class="exception-box">
                        <h4>Solar Panel/Clean Energy Liens</h4>
                        <p>Immediately refer to the 'Solar Panel/Clean Energy Liens' section in the 'Preliminary Report, CPL & Wiring Instructions' Manual for how to proceed.</p>
                    </div>
                </div>
            </section>

            <!-- Section 5: Hard Stops -->
            <section id="section-5" class="section">
                <div class="section-header">
                    <div class="section-number">5</div>
                    <div class="section-title"><h2>Hard Stops - Cannot Proceed</h2><span>Critical issues that prevent lending</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Review Title Report</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Hard Stop Found?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">NO</span>
                                <div class="flow-node output">Continue Processing</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">YES</span>
                                <div class="flow-node exception">STOP - Cannot Lend</div>
                            </div>
                        </div>
                    </div>

                    <div class="exception-box">
                        <h4>Notice of Action</h4>
                        <p>This is a <span class="badge stop-badge">HARD STOP</span>. Cannot lend if Purchase or Refinance. This can also show up on Loansafe.</p>
                    </div>

                    <div class="exception-box">
                        <h4>Bankruptcy</h4>
                        <p>This is a <span class="badge stop-badge">HARD STOP</span>. Cannot lend if Purchase or Refinance. This can also show up on the credit report or Loansafe.</p>
                    </div>

                    <div class="summary-grid">
                        <div class="summary-card">
                            <h4>Notice of Action</h4>
                            <div class="value" style="color: var(--accent-rose);">STOP</div>
                            <div class="label">Cannot proceed - also check Loansafe</div>
                        </div>
                        <div class="summary-card">
                            <h4>Bankruptcy</h4>
                            <div class="value" style="color: var(--accent-rose);">STOP</div>
                            <div class="label">Cannot proceed - also check Credit/Loansafe</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 6: Schedule B -->
            <section id="section-6" class="section">
                <div class="section-header">
                    <div class="section-number">6</div>
                    <div class="section-title"><h2>Schedule B: Chain of Title</h2><span>Review ownership history and flip transaction rules</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Review Chain of Title</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Ownership Change in 6 months?</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Check Loan Type</div>
                        </div>
                    </div>

                    <ul class="checklist">
                        <li><strong>Chain of Title:</strong> If there has been a change in ownership in the last 6 months, refer to your product guidelines for a possible Flip Transaction</li>
                    </ul>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Loan Type</th>
                                <th>Flip Rules</th>
                                <th>Timeframe</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Conventional</strong></td>
                                <td>No flip rules at this time</td>
                                <td>N/A</td>
                            </tr>
                            <tr>
                                <td><strong>FHA</strong></td>
                                <td>Flips not allowed before 90 days</td>
                                <td>91-180 days: see guidelines for restrictions</td>
                            </tr>
                            <tr>
                                <td><strong>VA</strong></td>
                                <td>Flips not allowed before 90 days</td>
                                <td>91-180 days: see guidelines for restrictions</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="info-box">
                        <h4>Flip Transaction Detection</h4>
                        <p>When reviewing Schedule B, pay special attention to recent ownership changes. Government loans (FHA/VA) have strict anti-flip requirements that must be verified against product guidelines.</p>
                    </div>
                </div>
            </section>

            <!-- Section 7: Exceptions & Agreements -->
            <section id="section-7" class="section">
                <div class="section-header">
                    <div class="section-number">7</div>
                    <div class="section-title"><h2>Exceptions & Special Agreements</h2><span>Handle deed restrictions, encroachments, and special property situations</span></div>
                </div>
                <div class="section-content">
                    <h3 style="color: var(--accent-blue); margin-bottom: 20px;">Schedule B Exceptions (If Applicable)</h3>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Exception Type</th>
                                <th>Action Required</th>
                                <th>Responsibility</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Deed Restrictions</strong></td>
                                <td>Review appraisal for marketability (already in force)</td>
                                <td>Processor</td>
                            </tr>
                            <tr>
                                <td><strong>Encroachments</strong></td>
                                <td>Common on title - review survey and appraisal for marketability</td>
                                <td>Title reviews survey; Processor reviews appraisal</td>
                            </tr>
                            <tr>
                                <td><strong>Private Roads</strong></td>
                                <td>Request copy of Recorded Road Maintenance Agreement</td>
                                <td>Processor</td>
                            </tr>
                            <tr>
                                <td><strong>Shared Well Agreement</strong></td>
                                <td>Request copy of Well Agreement; refer to Prelim Report Manual</td>
                                <td>Processor</td>
                            </tr>
                            <tr>
                                <td><strong>Affidavit of Affixture</strong></td>
                                <td>Obtain from title for Manufactured Home (refi or purchase)</td>
                                <td>Processor</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="info-box">
                        <h4>Private Roads - PUD/HOA Properties</h4>
                        <p>If the home is in a Planned Unit Development, or HOA, and there are Covenants, Conditions, Restrictions (CC&Rs) shown on the exceptions section, request a copy from Title or Escrow. In most cases the CC&Rs will state that it is the HOA's job to maintain the road.</p>
                    </div>

                    <div class="tip-box">
                        <h4>Shared Well Agreement</h4>
                        <p>For Purchase or Refinance with a shared well, refer to the 'Shared Well Agreement' section of the Prelim Report Manual and your product guidelines for specific requirements.</p>
                    </div>

                    <div class="warning-box">
                        <h4>Manufactured Homes</h4>
                        <p>For any refinance or purchase of a Manufactured Home, you must obtain a copy of the <strong>Affidavit of Affixture</strong> from title to prove the home is permanently affixed to the land.</p>
                    </div>
                </div>
            </section>

            <!-- Quick Reference -->
            <div id="quick-ref" class="quick-ref">
                <h3>Quick Reference - Preliminary Title Review</h3>
                <pre># Preliminary Title Review Checklist - Quick Reference

## SCHEDULE A CHECKLIST
[ ] Enter Escrow/Title & Attorney Info -> Parties Screen
[ ] Verify Subject Property matches Byte
[ ] Enter Date Issued & Expiration -> Stored Docs > Title Commitment
[ ] Enter Title/Escrow Company Info -> Doc Prep Screen
[ ] Check Type of Estate (Fee Simple = normal, Life Estate = escalate)
[ ] Verify Legal Description address matches
[ ] Confirm APN matches appraisal
[ ] If Condo -> Use Condo Review Submission Procedure
[ ] Verify Vesting (Purchase = seller names, Refi = borrower names)
[ ] If Trust vesting -> Request Trust Agreement
[ ] Enter Property Taxes (Refi) -> URLA Lender Loan Info

## LIENS TO CHECK
| Lien Type              | Purchase        | Refinance                    |
|------------------------|-----------------|------------------------------|
| Unpaid Prop Taxes      | Title handles   | Obtain proof, add PTF cond   |
| Texas A-6              | N/A             | Check seasoning requirements |
| SBA Loans              | Prefer payoff   | Payoff or subordinate+DTI    |
| Mechanics Liens        | N/A             | Payoff or subordinate+DTI    |
| Tax Liens              | Per guidelines  | Payoff or payment plan       |
| Abstract of Judgement  | Title pays      | Must payoff at closing       |
| Solar/Clean Energy     | REFER TO MANUAL | REFER TO MANUAL              |

## HARD STOPS - CANNOT LEND
[ ] Notice of Action (also check Loansafe)
[ ] Bankruptcy (also check Credit Report & Loansafe)

## SCHEDULE B - CHAIN OF TITLE
| Loan Type    | Flip Rules                              |
|--------------|----------------------------------------|
| Conventional | No flip rules                          |
| FHA/VA       | No flips <90 days, 91-180 restrictions |

## EXCEPTIONS TO HANDLE
[ ] Deed Restrictions -> Review appraisal marketability
[ ] Encroachments -> Title reviews survey, check appraisal
[ ] Private Roads -> Get Road Maintenance Agreement
[ ] PUD/HOA -> Request CC&Rs from Title/Escrow
[ ] Shared Well -> Get Well Agreement, check guidelines
[ ] Manufactured Home -> Get Affidavit of Affixture

## REFERENCE DOCUMENTS
- Preliminary Title, Closing Protection Letter & Wire Instructions Manual
- Condo Review Submission Procedure
- Trust Review Checklist
- Product Guidelines for specific loan types</pre>
            </div>
        </div>

        <!-- ==================== AGENTS TAB ==================== -->
        <div id="agents-panel" class="tab-panel">
            <!-- Agent Header -->
            <div class="agent-header">
                <h1>AI Agent Opportunities</h1>
                <p class="subtitle">Automation opportunities identified for the Preliminary Title Review process</p>
            </div>

            <!-- Summary Stats -->
            <div class="agent-summary" id="agent-summary">
                <div class="agent-summary-card">
                    <div class="agent-summary-value">5</div>
                    <div class="agent-summary-label">Potential Agents</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">15+</div>
                    <div class="agent-summary-label">Min Saved Per Loan</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">2</div>
                    <div class="agent-summary-label">Critical Priority</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">85%</div>
                    <div class="agent-summary-label">Automation Potential</div>
                </div>
            </div>

            <!-- Heat Map Legend -->
            <div class="heat-legend">
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(135deg, #ef4444, #f97316);"></div>
                    <span>Critical Priority (9-10)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(135deg, #f97316, #eab308);"></div>
                    <span>High Priority (7-8)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(135deg, #eab308, #22c55e);"></div>
                    <span>Medium Priority (5-6)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(135deg, #22c55e, #14b8a6);"></div>
                    <span>Low Priority (1-4)</span>
                </div>
            </div>

            <!-- Heat Map Grid -->
            <div class="heat-map-container" id="agent-heatmap">
                <div class="heat-map-title">Priority Heat Map</div>
                <div class="heat-map-grid">
                    <div class="heat-item critical" onclick="scrollToAgent('agent-titleverify')">
                        <div class="heat-score">9.5</div>
                        <div class="heat-name">Title Data Extractor</div>
                        <div class="heat-desc">Auto-extract and validate title data against Byte fields</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>8 min</span></div>
                            <div class="heat-metric">Complexity: <span>Medium</span></div>
                        </div>
                    </div>
                    <div class="heat-item critical" onclick="scrollToAgent('agent-liendetector')">
                        <div class="heat-score">9.2</div>
                        <div class="heat-name">Lien Detection Agent</div>
                        <div class="heat-desc">Automatically identify and classify liens from title report</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>5 min</span></div>
                            <div class="heat-metric">Complexity: <span>Medium</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-flipcheck')">
                        <div class="heat-score">8.0</div>
                        <div class="heat-name">Flip Transaction Monitor</div>
                        <div class="heat-desc">Auto-detect ownership changes and apply flip rules by loan type</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>3 min</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-hardstop')">
                        <div class="heat-score">7.8</div>
                        <div class="heat-name">Hard Stop Scanner</div>
                        <div class="heat-desc">Scan for Notice of Action and Bankruptcy across title and Loansafe</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>2 min</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                    <div class="heat-item medium" onclick="scrollToAgent('agent-docrequest')">
                        <div class="heat-score">6.5</div>
                        <div class="heat-name">Document Request Agent</div>
                        <div class="heat-desc">Auto-generate requests for CC&Rs, well agreements, affidavits</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>4 min</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agent Details -->
            <div id="agent-details">
                <h2 style="color: var(--text-primary); margin-bottom: 25px; font-size: 1.5rem;">Agent Details</h2>
                <div class="agent-grid">
                    <!-- Title Data Extractor Agent -->
                    <div class="agent-card" id="agent-titleverify">
                        <div class="agent-card-header">
                            <div class="agent-icon">T</div>
                            <div class="agent-info">
                                <div class="agent-name">Title Data Extractor</div>
                                <div class="agent-type">Document Analysis / OCR</div>
                            </div>
                            <span class="agent-priority critical">Critical</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Automatically extracts key data from preliminary title reports using OCR and NLP, validates against Byte fields, flags mismatches, and populates the Parties screen, Doc Prep screen, and Stored Documents with accurate information.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Parse Title PDF</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Extract Data</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Validate vs Byte</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Populate Fields</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">8 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">95%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Med</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('titleverify')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Lien Detection Agent -->
                    <div class="agent-card" id="agent-liendetector">
                        <div class="agent-card-header">
                            <div class="agent-icon">L</div>
                            <div class="agent-info">
                                <div class="agent-name">Lien Detection Agent</div>
                                <div class="agent-type">Document Analysis / Classification</div>
                            </div>
                            <span class="agent-priority critical">Critical</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Scans Schedule A and B for all lien types (property tax, mechanics, SBA, tax liens, judgements), classifies each lien, determines required action based on loan type (purchase vs refinance), and generates recommendations for payoff or subordination.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Scan Schedules</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Classify Liens</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Apply Rules</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Generate Actions</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">5 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">98%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Med</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('liendetector')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Flip Transaction Monitor -->
                    <div class="agent-card" id="agent-flipcheck">
                        <div class="agent-card-header">
                            <div class="agent-icon">F</div>
                            <div class="agent-info">
                                <div class="agent-name">Flip Transaction Monitor</div>
                                <div class="agent-type">Chain of Title Analysis</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Analyzes Schedule B chain of title for ownership changes within the last 6 months, cross-references loan type (Conventional, FHA, VA), and automatically flags potential flip transactions with applicable restrictions based on product guidelines.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Parse Chain</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Check Dates</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Apply Rules</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Flag Issues</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">3 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">99%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('flipcheck')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Hard Stop Scanner -->
                    <div class="agent-card" id="agent-hardstop">
                        <div class="agent-card-header">
                            <div class="agent-icon">!</div>
                            <div class="agent-info">
                                <div class="agent-name">Hard Stop Scanner</div>
                                <div class="agent-type">Multi-Source Scanning</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Simultaneously scans preliminary title report, credit report, and Loansafe for Notice of Action and Bankruptcy flags. Immediately alerts processor if any hard stop condition is detected, preventing wasted processing time.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Scan Sources</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Detect Flags</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Cross-Verify</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Alert Stop</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">2 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">100%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('hardstop')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Document Request Agent -->
                    <div class="agent-card" id="agent-docrequest">
                        <div class="agent-card-header">
                            <div class="agent-icon">D</div>
                            <div class="agent-info">
                                <div class="agent-name">Document Request Agent</div>
                                <div class="agent-type">Workflow Automation</div>
                            </div>
                            <span class="agent-priority medium">Medium</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Based on title exceptions detected (private roads, shared wells, manufactured homes, PUD/HOA), automatically generates and sends document requests to title company for CC&Rs, Road Maintenance Agreements, Well Agreements, and Affidavits of Affixture.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Detect Exceptions</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Map Documents</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Generate Request</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Send to Title</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">4 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">95%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('docrequest')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Documentation Modal -->
    <div class="modal-overlay" id="docModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Preliminary Title Review Workflow Documentation</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyToClipboard()">Copy</button>
                    <button class="modal-btn close" onclick="closeDocModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <pre id="docContent"># Preliminary Title Review Checklist - Byte LOS

## Overview
Use this checklist when reviewing Preliminary Title Reports. For more in-depth information, refer to the 'Preliminary Title, Closing Protection Letter & Wire Instructions' Manual.

## Schedule A - First Page

### Basic Information Entry
1. Enter Escrow/Title & Attorney Info -> Parties Screen
2. Verify Subject Property matches Byte
3. Enter Date Issued & Expiration -> Stored Docs > Title Commitment
4. Enter Title/Escrow Company Info -> Doc Prep Screen
5. Verify Type of Estate (Fee Simple = normal)
   - Life Estate refinance = escalate to Credit Policy

### Legal Description
- Address must match Byte and loan documents
- APN must match appraisal
- If "unit" in description = Condo -> Use Condo Review Submission Procedure

### Vesting
- Purchase: Match seller name(s) on purchase contract
- Refinance: Match borrower name(s) on loan
- Trust vesting: Request Trust Agreement for Trust Review Checklist

### Property Taxes (Refinance)
- Enter monthly taxes in URLA Lender Loan Info screen

### Deeds of Trust (Refinance)
- Match prelim DOTs to URLA Borrower Info Mortgages/HELOCs
- Second DOT: determine payoff or subordination

## Liens to Handle

| Type | Purchase | Refinance |
|------|----------|-----------|
| Unpaid Prop Taxes | Title handles | Proof + PTF condition |
| Texas A-6 | N/A | Check seasoning |
| SBA | Prefer payoff | Payoff or subordinate |
| Mechanics | N/A | Payoff or subordinate |
| Tax Liens | Per guidelines | Payoff or payment plan |
| Abstract of Judgement | Title pays | Must payoff |
| Solar/Clean Energy | REFER TO MANUAL | REFER TO MANUAL |
| First Right of Refusal | Get contract | Get contract |

## HARD STOPS - CANNOT LEND
- Notice of Action (check Loansafe)
- Bankruptcy (check Credit Report & Loansafe)

## Schedule B - Chain of Title
- Check for ownership changes in last 6 months
- Conventional: No flip rules
- FHA/VA: No flips <90 days; 91-180 day restrictions

## Schedule B Exceptions
- Deed Restrictions: Review appraisal marketability
- Encroachments: Title reviews survey; check appraisal
- Private Roads: Get Road Maintenance Agreement
- PUD/HOA: Request CC&Rs
- Shared Well: Get Well Agreement
- Manufactured Home: Get Affidavit of Affixture</pre>
            </div>
        </div>
    </div>

    <!-- AI Prompt Modal -->
    <div class="modal-overlay prompt-modal" id="promptModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="promptModalTitle">AI Agent Build Prompt</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyPromptToClipboard()">Copy Prompt</button>
                    <button class="modal-btn close" onclick="closePromptModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="prompt-tags" id="promptTags"></div>
                <div class="prompt-section">
                    <h4>Agent Purpose</h4>
                    <div class="prompt-box" id="promptPurpose"></div>
                </div>
                <div class="prompt-section">
                    <h4>Full Build Prompt</h4>
                    <div class="prompt-box" id="promptContent"></div>
                </div>
                <div class="prompt-section">
                    <h4>Integration Points</h4>
                    <div class="prompt-box" id="promptIntegration"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="copy-success" id="copySuccess">Copied to clipboard!</div>

    <script>
        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));

            if (tab === 'workflow') {
                document.querySelector('.sidebar-tab:not(.agent-tab)').classList.add('active');
                document.getElementById('workflow-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'block';
                document.getElementById('agents-nav').style.display = 'none';
            } else {
                document.querySelector('.sidebar-tab.agent-tab').classList.add('active');
                document.getElementById('agents-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'none';
                document.getElementById('agents-nav').style.display = 'block';
            }

            window.scrollTo(0, 0);
        }

        // Scroll spy with isScrolling flag and 1000ms timeout
        const sections = document.querySelectorAll('.section, .quick-ref');
        const navItems = document.querySelectorAll('#workflow-nav .nav-item');
        let isScrolling = false;
        let scrollTimeout;

        function updateActiveNav() {
            if (isScrolling) return;

            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                if (window.scrollY >= sectionTop) current = section.getAttribute('id');
            });
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + current) item.classList.add('active');
            });
        }

        // Handle nav click to temporarily disable scroll spy
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                isScrolling = true;
                clearTimeout(scrollTimeout);

                // Remove active from all, add to clicked
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');

                // Re-enable scroll spy after 1000ms
                scrollTimeout = setTimeout(() => {
                    isScrolling = false;
                }, 1000);
            });
        });

        window.addEventListener('scroll', updateActiveNav);

        // Modal
        function openDocModal() {
            document.getElementById('docModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeDocModal() {
            document.getElementById('docModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyToClipboard() {
            try {
                await navigator.clipboard.writeText(document.getElementById('docContent').textContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeDocModal(); closePromptModal(); } });
        document.getElementById('docModal').addEventListener('click', (e) => { if (e.target.id === 'docModal') closeDocModal(); });

        document.addEventListener('DOMContentLoaded', () => { updateActiveNav(); });

        // Scroll to agent card and highlight
        function scrollToAgent(agentId) {
            const agentCard = document.getElementById(agentId);
            if (agentCard) {
                document.querySelectorAll('.agent-card.highlight').forEach(card => {
                    card.classList.remove('highlight');
                });

                agentCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

                setTimeout(() => {
                    agentCard.classList.add('highlight');
                }, 300);

                setTimeout(() => {
                    agentCard.classList.remove('highlight');
                }, 2500);
            }
        }

        // Agent Prompt System
        const agentPrompts = {
            titleverify: {
                name: 'Title Data Extractor',
                tags: ['Document Analysis', 'OCR', 'Medium Complexity', 'Critical Priority'],
                purpose: `This agent automatically extracts key data from preliminary title reports (PDF format) using OCR and NLP, validates extracted data against existing Byte fields, flags mismatches, and populates the Parties screen, Doc Prep screen, and Stored Documents with accurate information.`,
                prompt: `You are building a Document Analysis Agent for CMG Financial's Byte LOS Preliminary Title Review process.

AGENT NAME: Title Data Extractor
TYPE: Document Analysis / OCR / NLP

OBJECTIVE:
Create an agent that automatically parses preliminary title reports (PDF), extracts key data fields, validates against Byte, and populates relevant screens.

INPUT DATA:
- Preliminary Title Report PDF
- Loan file data from Byte (for validation)

EXTRACTION TARGETS:
1. Schedule A Data:
   - Escrow/Title Company Name, Address, Phone
   - Attorney Information (if applicable)
   - Title Report Date
   - Title Report Number
   - Expiration Date
   - Subject Property Address
   - APN (Assessors Parcel Number)
   - Type of Estate (Fee Simple, Life Estate, etc.)
   - Vesting Names

2. Legal Description:
   - Full legal description text
   - Condo indicator ("unit" keyword detection)
   - Lot/Block/Subdivision info

VALIDATION RULES:
- Subject Property Address must match Byte
- APN must match appraisal APN
- For Purchase: Vesting matches seller names
- For Refinance: Vesting matches borrower names

BYTE FIELD MAPPING:
- Parties Screen: Escrow company, title company, attorney
- Doc Prep Screen: Title Report Date, Title Report Number
- Stored Documents: Expiration date under Title Commitment
- URLA Lender Loan Info: Title Information section

OUTPUT:
{
  "extracted_data": { ... },
  "validation_results": [
    { "field": "address", "status": "MATCH" | "MISMATCH", "byte_value": "...", "title_value": "..." }
  ],
  "flags": ["Life Estate detected - escalate to Credit Policy", "Condo detected - use Condo Review Procedure"],
  "auto_populated": ["Parties Screen", "Doc Prep Screen", "Stored Documents"]
}`,
                integration: `INTEGRATION POINTS:
1. Byte LOS API
   - Read loan data for validation
   - Write to Parties Screen
   - Write to Doc Prep Screen
   - Update Stored Documents

2. Document Storage
   - Access uploaded title reports
   - Parse PDF using OCR (Tesseract/Azure Form Recognizer)

3. Alerts System
   - Flag mismatches for processor review
   - Escalation routing for Life Estate

DEPLOYMENT:
- Triggered on title report upload
- Background processing with status indicator
- Manual review queue for flagged items`
            },
            liendetector: {
                name: 'Lien Detection Agent',
                tags: ['Document Analysis', 'Classification', 'Medium Complexity', 'Critical Priority'],
                purpose: `This agent scans Schedule A and B of preliminary title reports to identify all lien types, classifies each lien by type, determines the required action based on loan type (purchase vs refinance), and generates actionable recommendations for payoff or subordination.`,
                prompt: `You are building a Lien Detection Agent for CMG Financial's Byte LOS Preliminary Title Review process.

AGENT NAME: Lien Detection Agent
TYPE: Document Analysis / NLP Classification

OBJECTIVE:
Automatically identify, classify, and generate action items for all liens found in preliminary title reports.

LIEN TYPES TO DETECT:
1. Property Tax Liens (paid/unpaid/delinquent)
2. Deeds of Trust (1st, 2nd, HELOC)
3. Texas A-6 Loans
4. Small Business Administration (SBA) Loans
5. Mechanics Liens
6. Federal/State Income Tax Liens
7. Abstract of Judgement
8. Solar Panel/Clean Energy Liens (PACE)
9. First Right of Refusal

CLASSIFICATION OUTPUT:
{
  "liens_detected": [
    {
      "type": "SBA_LOAN",
      "lien_position": "2nd",
      "amount": "$45,000",
      "holder": "SBA",
      "recording_info": "Doc #12345, 01/15/2024"
    }
  ]
}

ACTION RULES BY LOAN TYPE:
| Lien Type | Purchase | Refinance |
|-----------|----------|-----------|
| Unpaid Property Tax | Title handles PTF | Add PTF condition |
| Texas A-6 | N/A | Check seasoning |
| SBA | Prefer payoff | Payoff OR add to DTI + subordinate |
| Mechanics | N/A | Payoff OR add to DTI + subordinate |
| Tax Liens | Per guidelines | Payoff OR payment plan in DTI |
| Abstract of Judgement | Title handles | MUST payoff at closing |
| Solar/PACE | MANUAL REVIEW | MANUAL REVIEW |
| First Right of Refusal | Get contract | Get contract |

OUTPUT FORMAT:
{
  "liens": [ ... ],
  "required_actions": [
    { "lien": "SBA Loan", "action": "SUBORDINATE", "add_to_dti": true, "amount": "$45,000", "payment": "$350/mo" }
  ],
  "hard_flags": ["Solar Panel Lien - REFER TO MANUAL"],
  "conditions_to_add": ["PTF Condition for unpaid property taxes"]
}`,
                integration: `INTEGRATION POINTS:
1. Byte LOS API
   - Read loan type (Purchase/Refinance)
   - Read URLA Borrower Info for existing liens
   - Add conditions to underwriting queue
   - Update DTI calculations

2. Product Guidelines Database
   - Texas A-6 seasoning requirements
   - Solar/PACE lien handling rules

3. Workflow System
   - Route Solar liens for manual review
   - Generate subordination requests
   - Create payoff demand letters

DEPLOYMENT:
- Runs automatically after Title Data Extractor
- Produces actionable checklist for processor
- Integrates with condition management`
            },
            flipcheck: {
                name: 'Flip Transaction Monitor',
                tags: ['Chain Analysis', 'Rule Engine', 'Low Complexity', 'High Priority'],
                purpose: `This agent analyzes Schedule B chain of title data to detect ownership changes within the last 6 months, cross-references the loan type (Conventional, FHA, VA), and automatically flags potential flip transactions with applicable restrictions based on product guidelines.`,
                prompt: `You are building a Flip Transaction Monitor for CMG Financial's Byte LOS Preliminary Title Review process.

AGENT NAME: Flip Transaction Monitor
TYPE: Chain of Title Analysis / Rule Engine

OBJECTIVE:
Detect property flips by analyzing ownership history and apply loan-type-specific flip rules.

INPUT DATA:
- Schedule B Chain of Title from title report
- Loan Type from Byte (Conventional, FHA, VA, USDA)
- Current date

CHAIN OF TITLE PARSING:
Extract all ownership transfers:
{
  "transfers": [
    {
      "grantor": "Previous Owner",
      "grantee": "Current Seller",
      "recording_date": "2024-08-15",
      "document_type": "Grant Deed",
      "doc_number": "2024-123456"
    }
  ]
}

FLIP RULES BY LOAN TYPE:
{
  "CONVENTIONAL": {
    "restriction": "NONE",
    "message": "No flip rules for conventional loans"
  },
  "FHA": {
    "under_90_days": "NOT ALLOWED",
    "91_to_180_days": "RESTRICTED - See guidelines",
    "over_180_days": "ALLOWED"
  },
  "VA": {
    "under_90_days": "NOT ALLOWED",
    "91_to_180_days": "RESTRICTED - See guidelines",
    "over_180_days": "ALLOWED"
  }
}

OUTPUT FORMAT:
{
  "latest_transfer": {
    "date": "2024-08-15",
    "days_ago": 45,
    "from": "Previous Owner",
    "to": "Current Seller"
  },
  "loan_type": "FHA",
  "flip_status": "BLOCKED",
  "reason": "FHA loans do not allow property flips within 90 days of acquisition",
  "required_action": "Cannot proceed until 90 days from 2024-08-15 (eligible: 2024-11-13)",
  "guideline_reference": "FHA Handbook 4000.1 Section II.A.1.b.ii"
}`,
                integration: `INTEGRATION POINTS:
1. Byte LOS API
   - Read loan type
   - Flag loan file with flip warning
   - Add hold condition if blocked

2. Product Guidelines Database
   - FHA flip rule exceptions
   - VA flip rule details
   - 91-180 day restriction specifics

3. Alerts System
   - Notify processor of flip detection
   - Escalate blocked loans to management
   - Track eligibility dates

DEPLOYMENT:
- Runs as part of title review workflow
- Blocks loan progression for hard stops
- Calculates and displays eligibility dates`
            },
            hardstop: {
                name: 'Hard Stop Scanner',
                tags: ['Multi-Source', 'Scanning', 'Low Complexity', 'High Priority'],
                purpose: `This agent simultaneously scans preliminary title reports, credit reports, and Loansafe for Notice of Action and Bankruptcy flags. It immediately alerts the processor if any hard stop condition is detected, preventing wasted processing time on ineligible loans.`,
                prompt: `You are building a Hard Stop Scanner for CMG Financial's Byte LOS Preliminary Title Review process.

AGENT NAME: Hard Stop Scanner
TYPE: Multi-Source Document Scanning / Alert System

OBJECTIVE:
Detect deal-killing conditions (Notice of Action, Bankruptcy) across all available data sources as early as possible in the loan process.

SCAN SOURCES:
1. Preliminary Title Report (Schedule A & B)
2. Credit Report (all bureaus)
3. Loansafe Report

HARD STOP CONDITIONS:
{
  "notice_of_action": {
    "keywords": ["Notice of Action", "Lis Pendens", "NOA", "Pending Litigation"],
    "severity": "HARD_STOP",
    "message": "Cannot lend - Notice of Action detected"
  },
  "bankruptcy": {
    "keywords": ["Bankruptcy", "Chapter 7", "Chapter 11", "Chapter 13", "BK"],
    "severity": "HARD_STOP",
    "message": "Cannot lend - Active Bankruptcy detected"
  }
}

SCANNING LOGIC:
1. Parse title report text for keywords
2. Check credit report public records section
3. Query Loansafe for property/borrower flags
4. Cross-reference findings across sources

OUTPUT FORMAT:
{
  "scan_complete": true,
  "hard_stops_found": [
    {
      "type": "BANKRUPTCY",
      "source": "Credit Report - Experian",
      "details": "Chapter 7 filed 2024-03-15, Status: Active",
      "borrower": "John Smith"
    }
  ],
  "status": "BLOCKED",
  "action_required": "DECLINE - Cannot proceed with active bankruptcy",
  "verification": {
    "title_scanned": true,
    "credit_scanned": true,
    "loansafe_scanned": true
  }
}`,
                integration: `INTEGRATION POINTS:
1. Byte LOS API
   - Update loan status to BLOCKED
   - Add decline reason
   - Notify all parties

2. Credit Report Integration
   - Parse public records section
   - Check all three bureaus

3. Loansafe API
   - Query by property address
   - Query by borrower SSN

4. Alert System
   - Immediate notification to processor
   - Email to loan officer
   - Management dashboard flag

DEPLOYMENT:
- Runs FIRST in title review workflow
- Stops all downstream processing on hard stop
- Saves processing time on ineligible loans
- Audit trail for compliance`
            },
            docrequest: {
                name: 'Document Request Agent',
                tags: ['Workflow Automation', 'Email', 'Low Complexity', 'Medium Priority'],
                purpose: `Based on title exceptions detected (private roads, shared wells, manufactured homes, PUD/HOA), this agent automatically generates and sends document requests to the title company for CC&Rs, Road Maintenance Agreements, Well Agreements, and Affidavits of Affixture.`,
                prompt: `You are building a Document Request Agent for CMG Financial's Byte LOS Preliminary Title Review process.

AGENT NAME: Document Request Agent
TYPE: Workflow Automation / Email Generation

OBJECTIVE:
Automatically detect title exceptions that require additional documentation and generate requests to the title company.

EXCEPTION TRIGGERS:
{
  "private_road": {
    "keywords": ["private road", "private street", "easement for road"],
    "required_docs": ["Road Maintenance Agreement"],
    "request_to": "Title Company"
  },
  "pud_hoa": {
    "keywords": ["HOA", "homeowners association", "planned unit development", "PUD", "CC&R"],
    "required_docs": ["CC&Rs", "HOA Contact Info"],
    "request_to": "Title Company or Escrow"
  },
  "shared_well": {
    "keywords": ["shared well", "well agreement", "community well"],
    "required_docs": ["Well Agreement"],
    "request_to": "Title Company"
  },
  "manufactured_home": {
    "keywords": ["manufactured home", "mobile home", "HUD label"],
    "required_docs": ["Affidavit of Affixture"],
    "request_to": "Title Company"
  }
}

EMAIL TEMPLATE:
Subject: Document Request - [Loan Number] - [Property Address]

Dear [Title Officer Name],

During our review of the preliminary title report for the above-referenced property, we identified the following items requiring additional documentation:

[GENERATED LIST]
1. Road Maintenance Agreement (Private road noted in exceptions)
2. CC&Rs (HOA/PUD property)

Please provide these documents at your earliest convenience to avoid delays in closing.

Loan Details:
- Borrower: [Name]
- Property: [Address]
- Loan Number: [Number]
- Target Closing: [Date]

Thank you for your assistance.

Best regards,
[Processor Name]
CMG Financial

OUTPUT:
{
  "exceptions_detected": ["private_road", "pud_hoa"],
  "documents_requested": ["Road Maintenance Agreement", "CC&Rs"],
  "email_generated": true,
  "sent_to": "title@escrowcompany.com",
  "tracking_id": "REQ-2024-12345"
}`,
                integration: `INTEGRATION POINTS:
1. Byte LOS API
   - Read loan details for email
   - Read title company contact from Parties screen
   - Track outstanding document requests

2. Email System
   - Send formatted request emails
   - CC processor and loan officer
   - Track delivery/read status

3. Document Management
   - Create pending doc checklist items
   - Alert when docs received
   - Auto-attach to loan file

DEPLOYMENT:
- Triggered after exception detection
- Integrates with existing email workflow
- Updates condition tracking system
- Follow-up reminders for outstanding docs`
            }
        };

        function showAgentPrompt(agentKey) {
            const agent = agentPrompts[agentKey];
            if (!agent) return;

            document.getElementById('promptModalTitle').textContent = agent.name + ' - Build Prompt';
            document.getElementById('promptTags').innerHTML = agent.tags.map(tag => `<span class="prompt-tag">${tag}</span>`).join('');
            document.getElementById('promptPurpose').textContent = agent.purpose;
            document.getElementById('promptContent').textContent = agent.prompt;
            document.getElementById('promptIntegration').textContent = agent.integration;

            document.getElementById('promptModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closePromptModal() {
            document.getElementById('promptModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyPromptToClipboard() {
            const content = document.getElementById('promptContent').textContent;
            try {
                await navigator.clipboard.writeText(content);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) {
                alert('Failed to copy.');
            }
        }

        document.getElementById('promptModal').addEventListener('click', (e) => {
            if (e.target.id === 'promptModal') closePromptModal();
        });
    </script>
</body>
</html>
