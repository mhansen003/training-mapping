<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Processor File Flow Refi - Process Workflow</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: #111827;
            --bg-card: #1a2234;
            --accent-blue: #3b82f6;
            --accent-teal: #14b8a6;
            --accent-amber: #f59e0b;
            --accent-rose: #f43f5e;
            --accent-green: #22c55e;
            --accent-purple: #8b5cf6;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-subtle: rgba(255,255,255,0.08);
            --sidebar-width: 280px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Breadcrumb */
        .breadcrumb {
            background: linear-gradient(90deg, #0d1525 0%, #1a2234 100%);
            padding: 14px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
            border-bottom: 1px solid var(--border-subtle);
        }

        .breadcrumb a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            transition: all 0.2s;
            border: 1px solid var(--border-subtle);
        }

        .breadcrumb a:hover {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .breadcrumb .separator { color: var(--text-muted); font-size: 1.2rem; }
        .breadcrumb .current { color: var(--accent-amber); font-weight: 600; padding: 8px 16px; }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 54px;
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - 54px);
            background: var(--bg-secondary);
            overflow-y: auto;
            z-index: 1000;
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 25px 20px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-header h2 { color: var(--text-primary); font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
        .sidebar-header p { color: var(--text-muted); font-size: 0.85rem; }

        /* Tab Switch */
        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-tab {
            flex: 1;
            padding: 14px 10px;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            background: none;
            border-left: none;
            border-right: none;
            border-top: none;
        }

        .sidebar-tab:hover { background: rgba(255,255,255,0.03); color: var(--text-secondary); }
        .sidebar-tab.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); background: rgba(59, 130, 246, 0.08); }
        .sidebar-tab.agent-tab.active { color: var(--accent-purple); border-bottom-color: var(--accent-purple); background: rgba(139, 92, 246, 0.08); }

        .sidebar-nav { padding: 15px 0; flex: 1; overflow-y: auto; }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .nav-item:hover { background: rgba(255,255,255,0.03); color: var(--text-primary); }
        .nav-item.active { background: rgba(59, 130, 246, 0.1); border-left-color: var(--accent-blue); color: var(--text-primary); }

        .nav-number {
            background: rgba(255,255,255,0.1);
            color: var(--text-secondary);
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .nav-item.active .nav-number { background: var(--accent-blue); color: white; }
        .nav-label { font-size: 0.95rem; font-weight: 500; }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-subtle);
            background: rgba(0,0,0,0.2);
        }

        .doc-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px 20px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .doc-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3); }

        /* Main Content */
        .main-content { margin-left: var(--sidebar-width); padding: 80px 40px 40px 40px; }

        /* Tab Panels */
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        .header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(20, 184, 166, 0.08) 0%, transparent 50%);
            pointer-events: none;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        .header .meta { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; position: relative; }

        .header .meta-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-subtle);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); }
        .legend-color { width: 18px; height: 18px; border-radius: 4px; }

        /* Sections */
        .section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            margin-bottom: 25px;
            overflow: hidden;
            scroll-margin-top: 75px;
        }

        .section-header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(59, 130, 246, 0.1) 100%);
            border-bottom: 1px solid var(--border-subtle);
            padding: 22px 25px;
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .section-number {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .section-title h2 { font-size: 1.35rem; font-weight: 700; margin-bottom: 4px; color: var(--text-primary); }
        .section-title span { font-size: 0.9rem; color: var(--text-muted); }
        .section-content { padding: 28px; }

        /* Workflow Diagrams */
        .workflow-diagram {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 28px;
            margin-bottom: 22px;
        }

        .flow-row { display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 12px; margin: 15px 0; }

        .flow-node {
            padding: 14px 22px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            min-width: 150px;
            border: 1px solid var(--border-subtle);
        }

        .flow-node.start { background: linear-gradient(135deg, var(--accent-green) 0%, #16a34a 100%); color: white; border-radius: 25px; border: none; }
        .flow-node.action { background: linear-gradient(135deg, var(--accent-blue) 0%, #2563eb 100%); color: white; border: none; }
        .flow-node.decision { background: linear-gradient(135deg, var(--accent-amber) 0%, #d97706 100%); color: var(--bg-primary); border: none; }
        .flow-node.input { background: var(--bg-secondary); border: 2px solid var(--accent-blue); color: var(--text-primary); }
        .flow-node.output { background: linear-gradient(135deg, var(--accent-teal) 0%, #0d9488 100%); color: white; border: none; }
        .flow-node.exception { background: linear-gradient(135deg, var(--accent-rose) 0%, #dc2626 100%); color: white; border: none; }

        .flow-arrow { color: var(--accent-blue); font-size: 1.5rem; }
        .flow-arrow.down { transform: rotate(90deg); }

        .decision-branch { display: flex; gap: 40px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
        .branch { display: flex; flex-direction: column; align-items: center; gap: 10px; }

        .branch-label {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        /* Tables */
        .field-table { width: 100%; border-collapse: collapse; margin: 18px 0; }

        .field-table th {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            padding: 14px 18px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border-subtle);
        }

        .field-table td { padding: 14px 18px; border-bottom: 1px solid var(--border-subtle); color: var(--text-secondary); }
        .field-table tr:hover { background: rgba(255,255,255,0.02); }

        .badge { display: inline-block; padding: 4px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge.required-badge { background: rgba(244, 63, 94, 0.15); color: var(--accent-rose); }
        .badge.optional-badge { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .badge.calculated-badge { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }

        /* Info Boxes */
        .exception-box, .tip-box, .info-box {
            padding: 18px 22px;
            margin: 18px 0;
            border-radius: 0 10px 10px 0;
            border-left-width: 4px;
            border-left-style: solid;
        }

        .exception-box { background: rgba(244, 63, 94, 0.08); border-color: var(--accent-rose); border: 1px solid rgba(244, 63, 94, 0.2); border-left: 4px solid var(--accent-rose); }
        .exception-box h4 { color: var(--accent-rose); margin-bottom: 10px; font-size: 1rem; }
        .exception-box p, .exception-box li { color: var(--text-secondary); }

        .tip-box { background: rgba(34, 197, 94, 0.08); border-color: var(--accent-green); border: 1px solid rgba(34, 197, 94, 0.2); border-left: 4px solid var(--accent-green); }
        .tip-box h4 { color: var(--accent-green); margin-bottom: 10px; font-size: 1rem; }
        .tip-box p, .tip-box li { color: var(--text-secondary); }

        .info-box { background: rgba(59, 130, 246, 0.08); border-color: var(--accent-blue); border: 1px solid rgba(59, 130, 246, 0.2); border-left: 4px solid var(--accent-blue); }
        .info-box h4 { color: var(--accent-blue); margin-bottom: 10px; font-size: 1rem; }
        .info-box p, .info-box li { color: var(--text-secondary); }

        /* Decision Tree */
        .decision-tree {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 22px;
            margin: 22px 0;
        }

        .decision-tree h3 { color: var(--accent-blue); margin-bottom: 18px; padding-bottom: 12px; border-bottom: 1px solid var(--border-subtle); font-size: 1.1rem; }

        .tree-node { margin-left: 20px; padding: 12px; border-left: 2px solid var(--accent-teal); position: relative; color: var(--text-secondary); }
        .tree-node::before { content: ''; position: absolute; left: -2px; top: 22px; width: 15px; height: 2px; background: var(--accent-teal); }
        .tree-node.level-1 { margin-left: 0; border-left: none; }
        .tree-node.level-1::before { display: none; }

        .tree-label { background: var(--accent-amber); color: var(--bg-primary); padding: 6px 14px; border-radius: 6px; font-weight: 700; display: inline-block; margin-bottom: 6px; font-size: 0.9rem; }

        /* Summary Grid */
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 18px; margin: 22px 0; }

        .summary-card { background: rgba(0,0,0,0.3); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 22px; text-align: center; }
        .summary-card h4 { color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9rem; }
        .summary-card .value {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .summary-card .label { font-size: 0.85rem; color: var(--text-muted); margin-top: 8px; }

        /* Quick Reference */
        .quick-ref {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
            border: 1px solid var(--border-subtle);
            padding: 28px;
            border-radius: 16px;
            margin-top: 30px;
            font-family: 'JetBrains Mono', monospace;
            scroll-margin-top: 75px;
        }

        .quick-ref h3 { color: var(--accent-amber); margin-bottom: 18px; font-family: 'Plus Jakarta Sans', sans-serif; }
        .quick-ref pre { background: rgba(0,0,0,0.4); border: 1px solid var(--border-subtle); padding: 20px; border-radius: 10px; overflow-x: auto; font-size: 0.85rem; line-height: 1.7; color: var(--text-secondary); }

        /* ====== AGENT OPPORTUNITIES STYLES ====== */
        .agent-header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .agent-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(139, 92, 246, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .agent-header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        /* Heat Map */
        .heat-map-container { margin-bottom: 35px; }
        .heat-map-title { font-size: 1.3rem; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }

        .heat-map-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .heat-item {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .heat-item:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .heat-item:active { transform: scale(0.98); }

        .heat-item::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 4px;
        }

        .heat-item.critical::before { background: linear-gradient(90deg, #ef4444, #f97316); }
        .heat-item.high::before { background: linear-gradient(90deg, #f97316, #eab308); }
        .heat-item.medium::before { background: linear-gradient(90deg, #eab308, #22c55e); }
        .heat-item.low::before { background: linear-gradient(90deg, #22c55e, #14b8a6); }

        .heat-score {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.8rem;
            font-weight: 800;
        }

        .heat-item.critical .heat-score { color: #ef4444; }
        .heat-item.high .heat-score { color: #f97316; }
        .heat-item.medium .heat-score { color: #eab308; }
        .heat-item.low .heat-score { color: #22c55e; }

        .heat-name { font-size: 1rem; font-weight: 700; color: var(--text-primary); margin-bottom: 6px; padding-right: 50px; }
        .heat-desc { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; }

        .heat-metrics { display: flex; gap: 15px; margin-top: 12px; }
        .heat-metric { font-size: 0.75rem; color: var(--text-muted); }
        .heat-metric span { color: var(--text-secondary); font-weight: 600; }

        /* Agent Cards */
        .agent-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 25px; margin-bottom: 35px; }

        .agent-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .agent-card:hover { transform: translateY(-5px); box-shadow: 0 15px 50px rgba(0,0,0,0.3); }

        .agent-card.highlight {
            animation: highlightPulse 2s ease;
            box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.4);
        }

        @keyframes highlightPulse {
            0% { box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.6); }
            50% { box-shadow: 0 0 0 6px rgba(139, 92, 246, 0.5), 0 15px 50px rgba(139, 92, 246, 0.3); }
            100% { box-shadow: 0 0 0 0px transparent, 0 15px 50px rgba(0,0,0,0.3); }
        }

        .agent-card-header {
            padding: 22px;
            display: flex;
            align-items: flex-start;
            gap: 18px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .agent-icon {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            flex-shrink: 0;
        }

        .agent-info { flex: 1; }
        .agent-name { font-size: 1.15rem; font-weight: 700; color: var(--text-primary); margin-bottom: 5px; }
        .agent-type { font-size: 0.8rem; color: var(--accent-purple); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-priority {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .agent-priority.critical { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .agent-priority.high { background: rgba(249, 115, 22, 0.15); color: #f97316; }
        .agent-priority.medium { background: rgba(234, 179, 8, 0.15); color: #eab308; }
        .agent-priority.low { background: rgba(34, 197, 94, 0.15); color: #22c55e; }

        .agent-card-body { padding: 22px; }
        .agent-description { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; }

        .agent-flow {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 20px;
        }

        .agent-flow-title { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-flow-diagram { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; justify-content: center; }

        .agent-step {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .agent-arrow { color: var(--accent-purple); font-size: 1.2rem; }

        .agent-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }

        .agent-stat {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .agent-stat-value {
            font-size: 1.3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-top: 4px; }

        /* View Prompt Button */
        .agent-prompt-btn {
            width: 100%;
            margin-top: 18px;
            padding: 14px 20px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 10px;
            color: var(--accent-purple);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .agent-prompt-btn:hover {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(59, 130, 246, 0.3) 100%);
            border-color: var(--accent-purple);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.25);
        }

        /* Summary Stats */
        .agent-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .agent-summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            padding: 25px;
            text-align: center;
        }

        .agent-summary-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-summary-label { font-size: 0.9rem; color: var(--text-muted); margin-top: 8px; }

        /* Heat Map Legend */
        .heat-legend {
            display: flex;
            gap: 25px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .heat-legend-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; color: var(--text-secondary); }
        .heat-legend-color { width: 24px; height: 24px; border-radius: 6px; }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(10, 15, 26, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.show { display: flex; }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            width: 100%;
            max-width: 950px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 80px rgba(0,0,0,0.5);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            padding: 22px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 16px 16px 0 0;
        }

        .modal-header h3 { font-size: 1.25rem; font-weight: 700; }
        .modal-actions { display: flex; gap: 12px; }

        .modal-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: transform 0.2s;
            font-size: 0.9rem;
        }

        .modal-btn:hover { transform: scale(1.05); }
        .modal-btn.copy { background: white; color: var(--accent-blue); }
        .modal-btn.close { background: rgba(255,255,255,0.2); color: white; }

        .modal-body { padding: 28px; overflow-y: auto; flex: 1; }

        .modal-body pre {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            padding: 22px;
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.7;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--text-secondary);
        }

        .copy-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--accent-green);
            color: white;
            padding: 18px 35px;
            border-radius: 10px;
            font-weight: 700;
            z-index: 3000;
            display: none;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut { 0%, 100% { opacity: 0; } 10%, 90% { opacity: 1; } }

        /* Prompt Modal */
        .prompt-modal .modal { max-width: 800px; }
        .prompt-modal .modal-header { background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%); }

        .prompt-section { margin-bottom: 25px; }
        .prompt-section h4 { color: var(--accent-purple); font-size: 1rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }

        .prompt-box {
            background: rgba(0,0,0,0.4);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.7;
            color: var(--text-secondary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .prompt-tags { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .prompt-tag { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }

        .copy-prompt-btn {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 15px;
        }

        .copy-prompt-btn:hover { transform: scale(1.05); box-shadow: 0 5px 20px rgba(139, 92, 246, 0.3); }

        /* Step List */
        .step-list { list-style: none; padding: 0; margin: 18px 0; }
        .step-list li {
            padding: 14px 18px;
            border-left: 3px solid var(--accent-blue);
            background: rgba(0,0,0,0.2);
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
        }
        .step-list li strong { color: var(--text-primary); }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 75px 20px 30px 20px; }
            .agent-grid { grid-template-columns: 1fr; }
        }
            .breadcrumb-logo-link { display: flex; align-items: center; padding: 4px 8px; background: rgba(255,255,255,0.08); border-radius: 8px; border: 1px solid rgba(255,255,255,0.12); transition: all 0.2s; }
        .breadcrumb-logo-link:hover { background: rgba(255,255,255,0.15); }
        .breadcrumb-logo { height: 28px; width: auto; }
    </style>
</head>
<body>
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <a href="../../index.html" class="breadcrumb-logo-link"><img src="../../images/clear-ai-logo.png" alt="Clear AI" class="breadcrumb-logo"></a>
        <a href="../../index.html">Home</a>
        <span class="separator">></span>
        <a href="./index.html">Mortgage Fundamentals</a>
        <span class="separator">></span>
        <span class="current">Processor File Flow Refi</span>
    </nav>

    <!-- Fixed Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>Refi Processing Flow</h2>
            <p>Conventional Refinance Checklist</p>
        </div>

        <!-- Tab Switcher -->
        <div class="sidebar-tabs">
            <button class="sidebar-tab active" onclick="switchTab('workflow')">Workflow</button>
            <button class="sidebar-tab agent-tab" onclick="switchTab('agents')">AI Agents</button>
        </div>

        <!-- Workflow Navigation -->
        <nav class="sidebar-nav" id="workflow-nav">
            <a href="#section-1" class="nav-item active">
                <span class="nav-number">1</span>
                <span class="nav-label">Review Submission Notes</span>
            </a>
            <a href="#section-2" class="nav-item">
                <span class="nav-number">2</span>
                <span class="nav-label">Check Disclosures</span>
            </a>
            <a href="#section-3" class="nav-item">
                <span class="nav-number">3</span>
                <span class="nav-label">Review AUS Findings</span>
            </a>
            <a href="#section-4" class="nav-item">
                <span class="nav-number">4</span>
                <span class="nav-label">Review/Update URLA</span>
            </a>
            <a href="#section-5" class="nav-item">
                <span class="nav-number">5</span>
                <span class="nav-label">Income & Employment</span>
            </a>
            <a href="#section-6" class="nav-item">
                <span class="nav-number">6</span>
                <span class="nav-label">Assets & Liabilities</span>
            </a>
            <a href="#section-7" class="nav-item">
                <span class="nav-number">7</span>
                <span class="nav-label">Order Outs</span>
            </a>
            <a href="#section-8" class="nav-item">
                <span class="nav-number">8</span>
                <span class="nav-label">Title & Insurance Review</span>
            </a>
            <a href="#section-9" class="nav-item">
                <span class="nav-number">9</span>
                <span class="nav-label">Submit to Underwriting</span>
            </a>
            <a href="#section-10" class="nav-item">
                <span class="nav-number">10</span>
                <span class="nav-label">Approved Status</span>
            </a>
            <a href="#section-11" class="nav-item">
                <span class="nav-number">11</span>
                <span class="nav-label">Clear to Close</span>
            </a>
            <a href="#quick-ref" class="nav-item">
                <span class="nav-number">*</span>
                <span class="nav-label">Quick Reference</span>
            </a>
        </nav>

        <!-- Agent Navigation -->
        <nav class="sidebar-nav" id="agents-nav" style="display: none;">
            <a href="#agent-summary" class="nav-item active">
                <span class="nav-number">S</span>
                <span class="nav-label">Summary</span>
            </a>
            <a href="#agent-heatmap" class="nav-item">
                <span class="nav-number">H</span>
                <span class="nav-label">Heat Map</span>
            </a>
            <a href="#agent-details" class="nav-item">
                <span class="nav-number">A</span>
                <span class="nav-label">Agent Details</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="doc-btn" onclick="openDocModal()">
                View Workflow Markdown
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

        <!-- ==================== WORKFLOW TAB ==================== -->
        <div id="workflow-panel" class="tab-panel active">
            <!-- Header -->
            <div class="header">
                <h1>Processing Conventional (Refinance) Checklist</h1>
                <p class="subtitle">Complete guide for processing conventional refinance loans through the full lifecycle</p>
                <div class="meta">
                    <span class="meta-item">System: Byte LOS</span>
                    <span class="meta-item">Role: Processor</span>
                    <span class="meta-item">Loan Type: Conventional Refinance</span>
                    <span class="meta-item">Duration: Full Processing Cycle</span>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #22c55e, #16a34a);"></div><span>Start/End</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></div><span>Action Step</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></div><span>Decision Point</span></div>
                <div class="legend-item"><div class="legend-color" style="background: #111827; border: 2px solid #3b82f6;"></div><span>User Input</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f43f5e, #dc2626);"></div><span>Exception</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #14b8a6, #0d9488);"></div><span>Output</span></div>
            </div>

            <!-- Section 1: Review Submission Notes -->
            <section id="section-1" class="section">
                <div class="section-header">
                    <div class="section-number">1</div>
                    <div class="section-title"><h2>Review Submission Notes from Loan Officer</h2><span>Initial loan receipt and checklist setup</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Loan Assigned</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Add Processing Checklist</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Review LO Notes</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Document Initial Status</div>
                        </div>
                    </div>
                    <ul class="step-list">
                        <li><strong>Receive Loan:</strong> Manager will notify processor the loan is now assigned</li>
                        <li><strong>Add Checklist:</strong> Byte > Processing Log > Add Predefined Items > Other Items > Processing Checklist Conventional</li>
                        <li><strong>Review LO Provided Items:</strong> Check Conversation Log, Cover Letter screen, search for emails regarding the loan</li>
                    </ul>
                    <div class="info-box">
                        <h4>Checklist Navigation Path</h4>
                        <p>The Processing Checklist Conventional is located under: <strong>Byte > Processing Log > Add Predefined Items > Other Items > Processing Checklist Conventional</strong></p>
                    </div>
                </div>
            </section>

            <!-- Section 2: Check Disclosures -->
            <section id="section-2" class="section">
                <div class="section-header">
                    <div class="section-number">2</div>
                    <div class="section-title"><h2>Check for Signed Disclosures and Intent to Proceed</h2><span>Validate required documents before ordering services</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Check Stored Docs</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">All Docs Present?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">YES</span>
                                <div class="flow-node output">Proceed to Order Services</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">NO</span>
                                <div class="flow-node action">Pull from IDS</div>
                            </div>
                        </div>
                    </div>
                    <ul class="step-list">
                        <li><strong>Location:</strong> Stored Documents in Byte</li>
                        <li><strong>Alternative:</strong> May need to be manually pulled from IDS (see IDS Job Aids)</li>
                        <li><strong>Validate:</strong> All returned and fully executed</li>
                    </ul>
                    <div class="exception-box">
                        <h4>Required Documents to Order Services</h4>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>Intent to Proceed</li>
                            <li>Signed 4506T</li>
                            <li>Borrower's Authorization to proceed with Order Out Process</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 3: Review AUS Findings -->
            <section id="section-3" class="section">
                <div class="section-header">
                    <div class="section-number">3</div>
                    <div class="section-title"><h2>Review AUS for Needed Items</h2><span>Fannie Mae DU / Freddie Mac LP findings review</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Review AUS Findings</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Validations Available?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">YES</span>
                                <div class="flow-node output">Use Validated Data</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">NO</span>
                                <div class="flow-node action">Collect Required Docs</div>
                            </div>
                        </div>
                    </div>
                    <ul class="step-list">
                        <li><strong>Check for:</strong> Income and Asset Validations, Appraisal Waiver or Appraisal Type</li>
                    </ul>
                    <div class="info-box">
                        <h4>Items Needed if Validation Not Available</h4>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>W2</li>
                            <li>Paystub</li>
                            <li>Bank Statements</li>
                            <li>Tax Returns - Run LoanBeam for all Self-Employed (excluding Sch C)</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 4: Review/Update URLA -->
            <section id="section-4" class="section">
                <div class="section-header">
                    <div class="section-number">4</div>
                    <div class="section-title"><h2>Review/Update URLA Against Borrower Docs</h2><span>Ensure all sections are completed and match documentation</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Verify Names Match</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Verify Addresses</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Review Overview Screen</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Note Red Flags</div>
                        </div>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Verification Item</th>
                                <th>Description</th>
                                <th>Action if Mismatch</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Borrower Names</strong></td>
                                <td>URLA Borrower Info matches W2s, Paystubs, Bank Statements</td>
                                <td>Update URLA to match documents</td>
                            </tr>
                            <tr>
                                <td><strong>Addresses</strong></td>
                                <td>Document addresses match URLA Borrower Info</td>
                                <td>Add Letter of Explanation</td>
                            </tr>
                            <tr>
                                <td><strong>Overview Screen</strong></td>
                                <td>Loan Program, LTV, Lock Status</td>
                                <td>Note potential red flags</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="exception-box">
                        <h4>Red Flags to Watch For</h4>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>LTV over 90%</li>
                            <li>DTI over 40%</li>
                            <li>Property type Condo (request Condo Department on Processing Log - Additional)</li>
                            <li>Property Type Manufactured</li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Refinance Fields Review</h3>
                        <ul class="step-list">
                            <li><strong>Cash-Out:</strong> Validate if multiple items are being paid off</li>
                            <li><strong>Multiple Mortgages:</strong> Confirm if the 2nd is being subordinated</li>
                            <li><strong>Borrower Benefit:</strong> Lowering payment, Lowering term, or Cash out</li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Vesting Details</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 15px;">Review "The Manner in Which Title Will Be Held" on URLA Lender Info.</p>
                        <ul class="step-list">
                            <li><strong>If blank:</strong> Ask the Borrower/LO how title will be held</li>
                            <li><strong>Reference:</strong> Use Vesting Cheat Sheet</li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Borrower Info Checklist</h3>
                        <ul class="step-list">
                            <li><strong>Dependents:</strong> Do tax returns show any dependents? Add to URLA Borrower Info if not already input</li>
                            <li><strong>Divorce/Child Support:</strong> If dependents and not married, is there a divorce decree/child support order?</li>
                            <li><strong>Address Match:</strong> Does current residence/mailing address match paystubs and bank statements?</li>
                            <li><strong>2-Year History:</strong> Is there a 2-year history? If not, ask LO/Borrower to provide</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 5: Income & Employment -->
            <section id="section-5" class="section">
                <div class="section-header">
                    <div class="section-number">5</div>
                    <div class="section-title"><h2>Employment Info/Income Review</h2><span>Verify employment and calculate income per AUS findings</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Order VOE</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Match Employer Names</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Day 1 Certainty?</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Validate Income Calc</div>
                        </div>
                    </div>

                    <ul class="step-list">
                        <li><strong>Employer Names:</strong> Confirm names match from VOE/Paystubs and URLA. Update URLA Borrower Info to match employer's name on documents</li>
                        <li><strong>Employment History:</strong> Make sure there are 2 years of employment history on the application and back up documents per AUS findings</li>
                        <li><strong>Day 1 Certainty:</strong> Can Day 1 Certainty (DU) or AIM (LP) be obtained by updating The Work Number document?</li>
                    </ul>

                    <div class="decision-tree">
                        <h3>Document Review per AUS Findings</h3>
                        <ul class="step-list">
                            <li><strong>Pay Stubs (if needed):</strong> Reflect Borrower(s) name, company info and YTD income - check for odd deductions</li>
                            <li><strong>Written VOEs:</strong> For all Borrowers when applicable (overtime, bonus, commission, teachers, family employment)</li>
                            <li><strong>W-2 Forms (if needed):</strong> AUS Findings determine if 1 or 2 years are needed</li>
                            <li><strong>Alimony/Child Support as Income:</strong> Evidence payments received for last 3 months and receiving for 3 years. Gross up per federal/state tax bracket</li>
                            <li><strong>Tax Returns:</strong> When applicable for rental property, self-employed, family employment, bonus, grossing up non-taxable income</li>
                            <li><strong>IRS Transcripts:</strong> Only needed if using tax returns for income - check AUS findings for years needed</li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Self-Employed Documentation (if applicable)</h3>
                        <ul class="step-list">
                            <li><strong>Tax Returns:</strong> Personal for Sch C, 1120s & K-1s for S-Corp, 1120 for Corporation, 1065 & K-1s for Partnership - most recent 2 years (LP req 1yr if SE for 5+ years)</li>
                            <li><strong>Proof of Business:</strong> Google search for business, White Pages, Yellow Pages, etc. - business must be in good standing</li>
                        </ul>
                    </div>

                    <div class="tip-box">
                        <h4>Income Calculation Tools</h4>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>CMG Income Calculation Job Aid</li>
                            <li>Income Calc worksheets</li>
                            <li>Loan Beam when applicable</li>
                        </ul>
                    </div>

                    <div class="info-box">
                        <h4>Required Actions</h4>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>Leave employment and income notes for UW in Coversheet - Submission Screen</li>
                            <li>Present & Proposed Housing Payment: Mortgage Insurance if applicable - request quote in Byte home screen</li>
                            <li>Validate coverage on AUS findings (never use lower coverage)</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 6: Assets & Liabilities -->
            <section id="section-6" class="section">
                <div class="section-header">
                    <div class="section-number">6</div>
                    <div class="section-title"><h2>Assets & Liabilities/Credit Review</h2><span>Validate financial information and credit report</span></div>
                </div>
                <div class="section-content">
                    <div class="decision-tree">
                        <h3>Assets Verification</h3>
                        <ul class="step-list">
                            <li><strong>Match Bank Info:</strong> Ensure Bank Name, Account Number and Account Balance match Bank Statements</li>
                            <li><strong>Statement Count:</strong> Correct the number of statements in loan based on findings</li>
                            <li><strong>Valid Document Requirements:</strong>
                                <ul style="margin-left: 20px; margin-top: 10px;">
                                    <li>Includes Bank Name, Account Number, Account Holder Balances, Time Period, Running Balance</li>
                                    <li>Bank Print Out: Need stamp and signature from teller</li>
                                    <li>Website: Need URL showing at bottom of page</li>
                                    <li>All pages included, including blank pages</li>
                                </ul>
                            </li>
                            <li><strong>Large Deposits:</strong> Check for deposits over 50% of total qualifying income (non-payroll)</li>
                            <li><strong>Abnormal Deductions:</strong> Payments to IRS, child support, alimony not documented</li>
                            <li><strong>Retirement:</strong> Need terms of withdrawal if using for funds to close</li>
                            <li><strong>Update Byte:</strong> Match balances on asset statements</li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Liabilities/Credit Review</h3>
                        <ul class="step-list">
                            <li><strong>Credit Report Match:</strong> Double check that Credit Report in Byte is the same used to run AUS</li>
                            <li><strong>Debt Verification:</strong> All debts listed on Credit Report are on application with accurate payments/balances</li>
                            <li><strong>Student Loans:</strong> If no payment listed - Conv: get Income Based Repayment Plan docs for $0 payment; if deferred or forbearance use 1%; otherwise use 1%</li>
                            <li><strong>Derogatory Items:</strong> Late payments last 12 months, foreclosures, short sales, collections, bankruptcies - check waiting period on derogatory credit matrix</li>
                            <li><strong>Disputed Accounts:</strong> AUS will instruct if dispute is not acceptable</li>
                            <li><strong>Inquiries:</strong> Check for new debt - Borrower needs LOE (generate in Credit Plus website)</li>
                            <li><strong>Credit Supplements:</strong> Order for mortgage ratings, retained properties PITI</li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Real Estate Owned (REO)</h3>
                        <ul class="step-list">
                            <li><strong>Link Mortgages:</strong> Credit Report to Properties</li>
                            <li><strong>Validate Rental Income</strong></li>
                            <li><strong>Free and Clear:</strong> If no mortgages, need taxes, insurance docs, and amounts added to REO</li>
                            <li><strong>Validate:</strong> Properties on LoanSafe when pulled</li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Details of Transaction & Declarations</h3>
                        <ul class="step-list">
                            <li><strong>Refinance:</strong> Validate Borrower has enough funds to close</li>
                            <li><strong>Declarations A-I:</strong> Validate documentation is received or guidelines are met for any Yes answers</li>
                            <li><strong>Validate:</strong> Citizenship/Residency, Occupancy, Past home ownership</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 7: Order Outs -->
            <section id="section-7" class="section">
                <div class="section-header">
                    <div class="section-number">7</div>
                    <div class="section-title"><h2>Order Outs</h2><span>Order required services and reports</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Review Processing Log</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Run LoanSafe</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Re-Run AUS</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Order Services</div>
                        </div>
                    </div>

                    <div class="info-box">
                        <h4>Automatic Completion by ISGN/Sourcepoint</h4>
                        <p>Items marked with * will be completed automatically by ISGN/Sourcepoint. See Processing Manual - Order Outs for instructions.</p>
                    </div>

                    <ul class="step-list">
                        <li><strong>Review Processing Log:</strong> Ensure no one has completed before loan received - always track ordered and received items</li>
                        <li><strong>*Run Initial LoanSafe Report:</strong> Clear watchlist hits, check for undisclosed properties, foreclosures, bankruptcies. *Enter AKA's on URLA Borrower Info</li>
                        <li><strong>Re-Run AUS (DU or LP):</strong> For loan program after 1003 has been updated to match docs - must be Approve/Accept/Eligible (No caution or ineligible)</li>
                        <li><strong>Mark Docs Reviewed:</strong> Make sure all docs in Stored Docs are marked "Reviewed"</li>
                        <li><strong>Order Title</strong></li>
                        <li><strong>Order Appraisal</strong> (if applicable)</li>
                        <li><strong>Order Homeowners Insurance</strong></li>
                        <li><strong>*Order Flood Cert:</strong> If in Flood Zone, alert LO and send Borrower Flood Zone Notice</li>
                        <li><strong>*Run FEMA</strong></li>
                    </ul>
                </div>
            </section>

            <!-- Section 8: Title & Insurance Review -->
            <section id="section-8" class="section">
                <div class="section-header">
                    <div class="section-number">8</div>
                    <div class="section-title"><h2>Title & Insurance Review</h2><span>Verify title report and insurance requirements</span></div>
                </div>
                <div class="section-content">
                    <div class="decision-tree">
                        <h3>Title Review Checklist</h3>
                        <ul class="step-list">
                            <li><strong>12-Month Chain of Title:</strong> Update Doc Prep Screen with Title Report date and Title Account Number</li>
                            <li><strong>No Deed Restrictions</strong></li>
                            <li><strong>Update Taxes in Byte</strong></li>
                            <li><strong>CPL:</strong> Must be dated within 30 days of closing</li>
                            <li><strong>Wire Info:</strong> Complete in Title & Escrow Screen - Use Parties when available to validate company info first</li>
                            <li><strong>E&O:</strong> Has deductible and not expired</li>
                            <li><strong>Retail CD Request Screen:</strong> Update to confirm all title items complete</li>
                            <li><strong>CD Page 2 Fees:</strong> If different title company, indicate fees are shopped. If same title company, confirm fees match disclosure - alert Processing Manager if higher</li>
                            <li><strong>Prelim CD Fees:</strong> Confirm fees match what was disclosed - if not, alert processing manager or reconcile for COC</li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Homeowners Insurance Review</h3>
                        <ul class="step-list">
                            <li><strong>Borrower Names:</strong> All borrower names are on policy</li>
                            <li><strong>Property Match:</strong> Subject property same as financed property</li>
                            <li><strong>Dwelling Coverage:</strong> Equal to or greater than loan amount or Replacement Cost Estimator</li>
                            <li><strong>Effective Dates:</strong> For refinance, if within 60 days need to collect and provide an invoice</li>
                            <li><strong>Update Byte:</strong> Reflect correct premium amount</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 9: Submit to Underwriting -->
            <section id="section-9" class="section">
                <div class="section-header">
                    <div class="section-number">9</div>
                    <div class="section-title"><h2>Submit to Underwriting</h2><span>Finalize notes and change loan status</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Finalize UW Notes</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Cover Letter Screen</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Change Status: UW Received</div>
                        </div>
                    </div>

                    <ul class="step-list">
                        <li><strong>Finalize Notes:</strong> Complete all notes to UW in Cover Letter Screen in Byte</li>
                        <li><strong>Change Status:</strong> Update Loan Status to UW Received</li>
                    </ul>
                </div>
            </section>

            <!-- Section 10: Approved Status -->
            <section id="section-10" class="section">
                <div class="section-header">
                    <div class="section-number">10</div>
                    <div class="section-title"><h2>Approved Status</h2><span>Post-approval tasks and condition collection</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Review Approval Letter</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Collect Conditions</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Order MI/Payoff</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Request CD</div>
                        </div>
                    </div>

                    <ul class="step-list">
                        <li><strong>Review Approval Letter:</strong> Prepare to collect all conditions - Discuss with LO to determine which conditions the LO/PA will gather</li>
                        <li><strong>*Activate UDM:</strong> Completed by ISGN/Sourcepoint automatically</li>
                        <li><strong>Order MI (if applicable):</strong> Once DTI and assets are finalized</li>
                        <li><strong>Order Payoff:</strong> This step may be done closer to closing date to avoid Borrower poaching from current lender - Update Byte with Payoff information</li>
                    </ul>

                    <div class="info-box">
                        <h4>CD Request Requirements</h4>
                        <p>Request CD no later than 4 business days from signing/close date. Preferably 10 days from signing/close date when Retail CD Checklist is complete.</p>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>Loan must be approved</li>
                            <li>Locked and Lock Exp Date good through Funding Date</li>
                            <li>Title and appraisal in the loan</li>
                            <li>Last LE acknowledged at least 1 day prior to CD delivery</li>
                            <li>Validate and check the CD Checklist boxes</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 11: Clear to Close -->
            <section id="section-11" class="section">
                <div class="section-header">
                    <div class="section-number">11</div>
                    <div class="section-title"><h2>Submit Conditions for Clear to Close</h2><span>Final verification and closing preparation</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Verify Expirations</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Order VVOE</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Final LoanSafe</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Clear to Close</div>
                        </div>
                    </div>

                    <ul class="step-list">
                        <li><strong>Verify Expirations:</strong> Credit, Income, Assets, Appraisal are not going to expire</li>
                        <li><strong>Order VVOE:</strong> Within 10 days of closing</li>
                        <li><strong>Update UDM Report:</strong> Validate no new inquiries - if there are, request LOE from Borrower to confirm no new debt</li>
                        <li><strong>Final LoanSafe:</strong> Retrieve final report and confirm low alerts are cleared</li>
                    </ul>

                    <div class="decision-tree">
                        <h3>Clear to Close Requested</h3>
                        <ul class="step-list">
                            <li><strong>Enter Date:</strong> Clear to Close Requested Date on Conditions Screen</li>
                            <li><strong>Change Status:</strong> Loan Status to Conditions for Review</li>
                            <li><strong>Validate:</strong> No other changes need to be made to the loan</li>
                            <li><strong>Confirm:</strong> Scheduled Signing/Closing Date</li>
                            <li><strong>Confirm:</strong> Lock is still good through Funding Date</li>
                        </ul>
                    </div>

                    <div class="tip-box">
                        <h4>At Clear to Close</h4>
                        <p>Change Loan Status to <strong>Docs Ordered</strong></p>
                    </div>
                </div>
            </section>

            <!-- Quick Reference -->
            <div id="quick-ref" class="quick-ref">
                <h3>Conventional Refinance Processing Quick Reference</h3>
                <pre>
CONVENTIONAL REFINANCE PROCESSING CHECKLIST
============================================

PHASE 1: LOAN RECEIPT & SETUP
-----------------------------
[ ] Receive loan assignment notification
[ ] Add Processing Checklist Conventional to Processing Log
[ ] Review LO notes (Conversation Log, Cover Letter, emails)
[ ] Check Stored Documents for signed disclosures
[ ] Verify Intent to Proceed, 4506T, Borrower Authorization

PHASE 2: AUS & URLA REVIEW
--------------------------
[ ] Review AUS Findings (DU/LP)
[ ] Check for Income/Asset validations, Appraisal waiver
[ ] Verify borrower names match across documents
[ ] Verify addresses match (LOE if different)
[ ] Review Overview Screen (Program, LTV, Lock status)
[ ] Note red flags: LTV >90%, DTI >40%, Condo, Manufactured

PHASE 3: INCOME & EMPLOYMENT
----------------------------
[ ] Order VOE (if not already ordered)
[ ] Verify 2-year employment history
[ ] Check Day 1 Certainty (DU) or AIM (LP) eligibility
[ ] Review Pay Stubs, W-2s, Tax Returns per AUS
[ ] Validate LO income calculation
[ ] Leave notes for UW in Coversheet

PHASE 4: ASSETS & LIABILITIES
-----------------------------
[ ] Verify bank info matches statements
[ ] Check for large non-payroll deposits (>50% qualifying income)
[ ] Match Credit Report to AUS run
[ ] Verify all debts on application
[ ] Check student loan payment handling
[ ] Review derogatory items and waiting periods
[ ] Link mortgages to REO properties

PHASE 5: ORDER OUTS
-------------------
[ ] Run Initial LoanSafe Report
[ ] Re-run AUS after 1003 updates
[ ] Mark all Stored Docs as "Reviewed"
[ ] Order Title
[ ] Order Appraisal (if applicable)
[ ] Order Homeowners Insurance
[ ] Order Flood Cert (alert if Flood Zone)

PHASE 6: TITLE & INSURANCE
--------------------------
[ ] Verify 12-month chain of title
[ ] Update Doc Prep Screen with Title info
[ ] Complete wire info in Title & Escrow Screen
[ ] Verify E&O not expired
[ ] Confirm insurance coverage >= loan amount
[ ] Update Retail CD Request Screen

PHASE 7: SUBMISSION & APPROVAL
------------------------------
[ ] Finalize UW notes in Cover Letter Screen
[ ] Change status to UW Received
[ ] Review Approval Letter conditions
[ ] Activate UDM (auto by ISGN/Sourcepoint)
[ ] Order MI once DTI/assets finalized
[ ] Order Payoff (closer to closing)
[ ] Request CD (4-10 business days before closing)

PHASE 8: CLEAR TO CLOSE
-----------------------
[ ] Verify no expirations (Credit, Income, Assets, Appraisal)
[ ] Order VVOE within 10 days of closing
[ ] Update UDM - check for new inquiries
[ ] Retrieve Final LoanSafe Report
[ ] Enter CTC Requested Date
[ ] Change status to Conditions for Review
[ ] Confirm lock good through funding
[ ] At CTC: Change status to Docs Ordered

LOAN STATUS PROGRESSION
=======================
Assigned -> UW Received -> Approved -> Conditions for Review -> Docs Ordered
                </pre>
            </div>
        </div>

        <!-- ==================== AI AGENTS TAB ==================== -->
        <div id="agents-panel" class="tab-panel">
            <!-- Agent Header -->
            <div class="agent-header">
                <h1>AI Agent Opportunities</h1>
                <p class="subtitle">Automation opportunities identified for the Conventional Refinance Processing workflow</p>
            </div>

            <!-- Summary Stats -->
            <div class="agent-summary" id="agent-summary">
                <div class="agent-summary-card">
                    <div class="agent-summary-value">5</div>
                    <div class="agent-summary-label">Agent Opportunities</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">68%</div>
                    <div class="agent-summary-label">Automation Potential</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">45 min</div>
                    <div class="agent-summary-label">Est. Time Saved</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">High</div>
                    <div class="agent-summary-label">Compliance Impact</div>
                </div>
            </div>

            <!-- Heat Map Legend -->
            <div class="heat-legend">
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #ef4444, #f97316);"></div>
                    <span>Critical Priority (9-10)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #f97316, #eab308);"></div>
                    <span>High Priority (7-8)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #eab308, #22c55e);"></div>
                    <span>Medium Priority (5-6)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #22c55e, #14b8a6);"></div>
                    <span>Low Priority (1-4)</span>
                </div>
            </div>

            <!-- Heat Map Grid -->
            <div class="heat-map-container" id="agent-heatmap">
                <div class="heat-map-title">Priority Heat Map</div>
                <div class="heat-map-grid">
                    <div class="heat-item critical" onclick="scrollToAgent('agent-docvalidator')">
                        <div class="heat-score">9.4</div>
                        <div class="heat-name">Document Validator Agent</div>
                        <div class="heat-desc">Auto-validate URLA against borrower docs</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>15 min</span></div>
                            <div class="heat-metric">Complexity: <span>High</span></div>
                        </div>
                    </div>
                    <div class="heat-item critical" onclick="scrollToAgent('agent-auschecker')">
                        <div class="heat-score">9.1</div>
                        <div class="heat-name">AUS Findings Analyzer</div>
                        <div class="heat-desc">Parse AUS and generate condition checklist</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>10 min</span></div>
                            <div class="heat-metric">Complexity: <span>Medium</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-incomecalc')">
                        <div class="heat-score">8.3</div>
                        <div class="heat-name">Income Calculator Agent</div>
                        <div class="heat-desc">Auto-calculate income from paystubs/W2s</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>12 min</span></div>
                            <div class="heat-metric">Complexity: <span>High</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-creditanalyzer')">
                        <div class="heat-score">7.8</div>
                        <div class="heat-name">Credit Report Analyzer</div>
                        <div class="heat-desc">Flag derogatory items and waiting periods</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>5 min</span></div>
                            <div class="heat-metric">Complexity: <span>Medium</span></div>
                        </div>
                    </div>
                    <div class="heat-item medium" onclick="scrollToAgent('agent-expirationtracker')">
                        <div class="heat-score">6.5</div>
                        <div class="heat-name">Expiration Tracker</div>
                        <div class="heat-desc">Monitor document and lock expirations</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>3 min</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agent Details -->
            <div id="agent-details">
                <h2 style="color: var(--text-primary); margin-bottom: 25px; font-size: 1.5rem;">Agent Details</h2>
                <div class="agent-grid">
                    <!-- Document Validator Agent -->
                    <div class="agent-card" id="agent-docvalidator">
                        <div class="agent-card-header">
                            <div class="agent-icon">D</div>
                            <div class="agent-info">
                                <div class="agent-name">Document Validator Agent</div>
                                <div class="agent-type">Data Validation / OCR</div>
                            </div>
                            <span class="agent-priority critical">Critical</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Automatically validates URLA data against borrower documents (W2s, paystubs, bank statements). Uses OCR and AI to extract data points and flag discrepancies for processor review, reducing manual comparison time significantly.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Extract URLA Data</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">OCR Documents</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Compare Fields</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Flag Discrepancies</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">15 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">94%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">High</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('docvalidator')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- AUS Findings Analyzer -->
                    <div class="agent-card" id="agent-auschecker">
                        <div class="agent-card-header">
                            <div class="agent-icon">A</div>
                            <div class="agent-info">
                                <div class="agent-name">AUS Findings Analyzer</div>
                                <div class="agent-type">Document Parsing / Automation</div>
                            </div>
                            <span class="agent-priority critical">Critical</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Parses DU/LP findings and automatically generates a customized condition checklist. Identifies required documents, validates against existing uploads, and highlights items needing processor attention.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Parse AUS PDF</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Extract Conditions</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Match to Stored Docs</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Generate Checklist</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">10 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">97%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Med</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('auschecker')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Income Calculator Agent -->
                    <div class="agent-card" id="agent-incomecalc">
                        <div class="agent-card-header">
                            <div class="agent-icon">I</div>
                            <div class="agent-info">
                                <div class="agent-name">Income Calculator Agent</div>
                                <div class="agent-type">Data Extraction / Calculation</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Extracts income data from paystubs, W2s, and tax returns using OCR. Applies CMG income calculation guidelines to compute qualifying income, handling overtime, bonus, commission, and self-employment scenarios.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">OCR Income Docs</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Apply Guidelines</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Calculate Income</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Generate Report</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">12 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">92%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">High</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('incomecalc')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Credit Report Analyzer -->
                    <div class="agent-card" id="agent-creditanalyzer">
                        <div class="agent-card-header">
                            <div class="agent-icon">C</div>
                            <div class="agent-info">
                                <div class="agent-name">Credit Report Analyzer</div>
                                <div class="agent-type">Data Analysis / Compliance</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Analyzes credit reports to identify derogatory items, calculate waiting periods per the derogatory credit matrix, flag disputed accounts, and identify inquiries that may indicate new debt requiring LOE.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Parse Credit Report</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Flag Derogatory</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Check Waiting Periods</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Generate Alerts</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">5 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">96%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Med</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('creditanalyzer')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Expiration Tracker -->
                    <div class="agent-card" id="agent-expirationtracker">
                        <div class="agent-card-header">
                            <div class="agent-icon">E</div>
                            <div class="agent-info">
                                <div class="agent-name">Expiration Tracker</div>
                                <div class="agent-type">Monitoring / Alerts</div>
                            </div>
                            <span class="agent-priority medium">Medium</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Monitors all document expirations (credit, income, assets, appraisal) and rate lock dates across the loan pipeline. Sends proactive alerts to processors before items expire, preventing closing delays.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Scan Dates</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Calculate Days</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Check Thresholds</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Send Alerts</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">3 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">99%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('expirationtracker')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Documentation Modal -->
    <div class="modal-overlay" id="docModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Processor File Flow Refi Documentation</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyToClipboard()">Copy</button>
                    <button class="modal-btn close" onclick="closeDocModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <pre id="docContent"># Processing Conventional (Refinance) Checklist

## Overview
Complete guide for processing conventional refinance loans from loan receipt through clear to close.

## Phase 1: Loan Receipt & Setup
- Receive loan assignment from manager
- Add Processing Checklist Conventional to Processing Log
- Review LO notes in Conversation Log, Cover Letter, emails
- Verify signed disclosures and Intent to Proceed in Stored Docs

## Phase 2: AUS & URLA Review
- Review DU/LP findings for validations
- Verify borrower names and addresses match documents
- Note red flags: LTV >90%, DTI >40%, Condo, Manufactured

## Phase 3: Income & Employment
- Order VOE if not already ordered
- Verify 2-year employment history
- Review Pay Stubs, W-2s, Tax Returns per AUS
- Validate income calculations

## Phase 4: Assets & Liabilities
- Verify bank statements match URLA
- Check for large deposits (>50% qualifying income)
- Review credit report for derogatory items
- Link mortgages to REO properties

## Phase 5: Order Outs
- Run LoanSafe Report
- Re-run AUS after updates
- Order Title, Appraisal, Insurance, Flood Cert

## Phase 6: Title & Insurance Review
- Verify chain of title
- Confirm insurance coverage
- Update CD fees

## Phase 7: Clear to Close
- Verify no document expirations
- Order VVOE within 10 days
- Final LoanSafe Report
- Change status to Docs Ordered</pre>
            </div>
        </div>
    </div>

    <!-- AI Prompt Modal -->
    <div class="modal-overlay prompt-modal" id="promptModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="promptModalTitle">AI Agent Build Prompt</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyPromptToClipboard()">Copy Prompt</button>
                    <button class="modal-btn close" onclick="closePromptModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="prompt-tags" id="promptTags"></div>
                <div class="prompt-section">
                    <h4>Agent Purpose</h4>
                    <div class="prompt-box" id="promptPurpose"></div>
                </div>
                <div class="prompt-section">
                    <h4>Full Build Prompt</h4>
                    <div class="prompt-box" id="promptContent"></div>
                </div>
                <div class="prompt-section">
                    <h4>Integration Points</h4>
                    <div class="prompt-box" id="promptIntegration"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="copy-success" id="copySuccess">Copied to clipboard!</div>

    <script>
        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));

            if (tab === 'workflow') {
                document.querySelector('.sidebar-tab:not(.agent-tab)').classList.add('active');
                document.getElementById('workflow-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'block';
                document.getElementById('agents-nav').style.display = 'none';
            } else {
                document.querySelector('.sidebar-tab.agent-tab').classList.add('active');
                document.getElementById('agents-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'none';
                document.getElementById('agents-nav').style.display = 'block';
            }

            window.scrollTo(0, 0);
        }

        // Scroll spy with isScrolling flag and 1000ms timeout
        const sections = document.querySelectorAll('.section, .quick-ref');
        const navItems = document.querySelectorAll('#workflow-nav .nav-item');
        let isScrolling = false;
        let scrollTimeout;

        function updateActiveNav() {
            if (isScrolling) return;

            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                if (window.scrollY >= sectionTop) current = section.getAttribute('id');
            });
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + current) item.classList.add('active');
            });
        }

        // Handle nav click to temporarily disable scroll spy
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                isScrolling = true;
                clearTimeout(scrollTimeout);

                // Remove active from all, add to clicked
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');

                // Re-enable scroll spy after 1000ms
                scrollTimeout = setTimeout(() => {
                    isScrolling = false;
                }, 1000);
            });
        });

        window.addEventListener('scroll', updateActiveNav);

        // Modal
        function openDocModal() {
            document.getElementById('docModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeDocModal() {
            document.getElementById('docModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyToClipboard() {
            try {
                await navigator.clipboard.writeText(document.getElementById('docContent').textContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeDocModal(); closePromptModal(); } });
        document.getElementById('docModal').addEventListener('click', (e) => { if (e.target.id === 'docModal') closeDocModal(); });

        document.addEventListener('DOMContentLoaded', () => { updateActiveNav(); });

        // Scroll to agent card and highlight
        function scrollToAgent(agentId) {
            const agentCard = document.getElementById(agentId);
            if (agentCard) {
                document.querySelectorAll('.agent-card.highlight').forEach(card => {
                    card.classList.remove('highlight');
                });

                agentCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

                setTimeout(() => {
                    agentCard.classList.add('highlight');
                }, 300);

                setTimeout(() => {
                    agentCard.classList.remove('highlight');
                }, 2500);
            }
        }

        // Agent Prompt System
        const agentPrompts = {
            docvalidator: {
                name: 'Document Validator Agent',
                tags: ['Data Validation', 'OCR', 'High Complexity', 'Critical Priority'],
                purpose: `This agent automatically validates URLA data against borrower documents (W2s, paystubs, bank statements) using OCR and AI to extract data points. It flags discrepancies for processor review, reducing manual comparison time from 15+ minutes to seconds.`,
                prompt: `You are building a Document Validation Agent for CMG Financial's Byte LOS Refinance Processing.

AGENT NAME: Document Validator Agent
TYPE: Data Validation / OCR Automation

OBJECTIVE:
Automatically validate URLA data against uploaded borrower documents, flagging any discrepancies for processor review.

INPUT DATA:
- URLA Borrower Info screen data
- Uploaded documents: W2s, Paystubs, Bank Statements

VALIDATION RULES:

1. Name Matching:
   - Compare borrower name on URLA to name on each document
   - Flag if names don't match (allow for common variations)
   - Check SSN last 4 digits if available

2. Address Matching:
   - Compare URLA address to addresses on documents
   - Flag mismatches for LOE requirement

3. Employer Matching:
   - Compare URLA employer to W2/Paystub employer
   - Update URLA to match document spelling

4. Income Verification:
   - Extract YTD income from paystubs
   - Extract annual income from W2s
   - Compare to URLA stated income

5. Asset Verification:
   - Extract bank name, account number, balance
   - Compare to URLA asset entries

OUTPUT:
{
  "validation_status": "PASS" | "REVIEW_NEEDED",
  "discrepancies": [
    {
      "field": "borrower_name",
      "urla_value": "John Smith",
      "doc_value": "John A Smith",
      "doc_source": "W2-2025.pdf",
      "severity": "LOW",
      "action": "Verify middle initial"
    }
  ],
  "auto_corrections": [],
  "loe_required": false
}`,
                integration: `INTEGRATION POINTS:
1. Byte LOS API
   - Read URLA Borrower Info fields
   - Read Stored Documents metadata
   - Update URLA fields (with approval)

2. OCR Service
   - Google Document AI or AWS Textract
   - Custom models for mortgage docs
   - Confidence scoring

3. Document Storage
   - Access Stored Docs in Byte
   - Generate validation report
   - Attach to loan file

4. Notification
   - Alert processor of discrepancies
   - Queue items for review
   - Track resolution status`
            },
            auschecker: {
                name: 'AUS Findings Analyzer',
                tags: ['Document Parsing', 'Automation', 'Medium Complexity', 'Critical Priority'],
                purpose: `This agent parses DU/LP findings PDFs and automatically generates a customized condition checklist. It identifies required documents, validates against existing uploads, and highlights items needing processor attention.`,
                prompt: `You are building an AUS Findings Analyzer Agent for CMG Financial's Byte LOS.

AGENT NAME: AUS Findings Analyzer
TYPE: Document Parsing / Checklist Generation

OBJECTIVE:
Parse AUS findings (DU/LP) and generate a customized condition checklist matched against existing loan documents.

INPUT:
- DU Certificate PDF or LP Feedback Certificate
- Current Stored Documents list

PARSING RULES:

1. Document Requirements:
   - Extract all "Documentation Required" items
   - Identify validation waivers (income, asset, employment)
   - Note appraisal type required

2. Condition Mapping:
   - Map AUS conditions to standard doc types
   - Check if documents already uploaded
   - Flag missing items

3. Timeline Analysis:
   - Identify time-sensitive requirements
   - Calculate document age validity
   - Flag expiring items

OUTPUT FORMAT:
{
  "aus_type": "DU" | "LP",
  "decision": "Approve/Eligible",
  "case_file_id": "123456789",
  "conditions": [
    {
      "condition_text": "2 years W2",
      "doc_type": "W2",
      "years_required": 2,
      "status": "COMPLETE" | "MISSING" | "PARTIAL",
      "uploaded_docs": ["W2-2024.pdf", "W2-2023.pdf"],
      "action_required": null
    }
  ],
  "waivers": {
    "income_validation": true,
    "asset_validation": false,
    "appraisal_waiver": false
  },
  "red_flags": []
}`,
                integration: `INTEGRATION POINTS:
1. PDF Parsing
   - Apache PDFBox or pdf.js
   - Pattern matching for condition extraction
   - Handle DU and LP formats

2. Byte Stored Documents
   - Query existing documents
   - Match by document type
   - Verify document dates

3. Processing Log
   - Auto-add checklist items
   - Update item status
   - Track completion

4. Reporting
   - Generate condition summary
   - Create processor task list
   - Update loan timeline`
            },
            incomecalc: {
                name: 'Income Calculator Agent',
                tags: ['Data Extraction', 'Calculation', 'High Complexity', 'High Priority'],
                purpose: `This agent extracts income data from paystubs, W2s, and tax returns using OCR. It applies CMG income calculation guidelines to compute qualifying income, handling complex scenarios like overtime, bonus, commission, and self-employment.`,
                prompt: `You are building an Income Calculator Agent for CMG Financial's processing workflow.

AGENT NAME: Income Calculator Agent
TYPE: Data Extraction / Calculation Engine

OBJECTIVE:
Extract income data from documents and calculate qualifying income per CMG guidelines.

INPUT DOCUMENTS:
- Paystubs (most recent 30 days)
- W2 Forms (1-2 years per AUS)
- Tax Returns (if applicable)
- VOE/VVOE (if available)

CALCULATION RULES:

1. Base Salary:
   - Extract current base from paystub
   - Annualize: (YTD Base / Pay Periods Elapsed) * 26 or 24
   - Compare to W2 prior year

2. Overtime:
   - Requires 2-year history
   - Average: (Current YTD + Prior 2 Years) / Months
   - Trend analysis required

3. Bonus/Commission:
   - Requires 2-year history
   - Average method or declining trend
   - Document receipt pattern

4. Self-Employment:
   - Parse Schedule C, 1120S, K-1
   - Calculate per CMG SE worksheet
   - Apply depreciation add-back

5. Non-Taxable Income:
   - Identify gross-up eligible income
   - Apply federal/state tax factor
   - Document tax bracket used

OUTPUT:
{
  "borrower": "John Smith",
  "calculation_date": "2026-01-27",
  "income_breakdown": {
    "base_salary": 75000,
    "overtime": 8500,
    "bonus": 5000,
    "commission": 0,
    "other": 0
  },
  "total_qualifying_income": 88500,
  "monthly_income": 7375,
  "calculation_method": "2-year average",
  "notes": ["Overtime trending up 5%"],
  "worksheet_path": "/docs/income_calc_001.pdf"
}`,
                integration: `INTEGRATION POINTS:
1. OCR Services
   - Google Document AI for paystubs
   - Custom W2 extraction model
   - Tax return parsing (LoanBeam integration)

2. Byte LOS
   - Update income fields
   - Generate notes for UW
   - Attach calculation worksheet

3. Guidelines Database
   - CMG income calculation rules
   - Investor overlay requirements
   - Update for guideline changes

4. Quality Control
   - Compare to LO stated income
   - Flag significant variances
   - Require processor approval`
            },
            creditanalyzer: {
                name: 'Credit Report Analyzer',
                tags: ['Data Analysis', 'Compliance', 'Medium Complexity', 'High Priority'],
                purpose: `This agent analyzes credit reports to identify derogatory items, calculate waiting periods per the derogatory credit matrix, flag disputed accounts per AUS requirements, and identify inquiries that may indicate new debt requiring LOE.`,
                prompt: `You are building a Credit Report Analyzer Agent for CMG Financial.

AGENT NAME: Credit Report Analyzer
TYPE: Data Analysis / Compliance Checker

OBJECTIVE:
Analyze credit reports to identify compliance issues, derogatory items, and items requiring action.

INPUT:
- Tri-merge credit report from Credit Plus
- AUS findings (dispute requirements)
- Loan type (Conv, FHA, VA, etc.)

ANALYSIS RULES:

1. Derogatory Items:
   - Late payments (30/60/90/120+)
   - Collections
   - Charge-offs
   - Foreclosures
   - Short sales
   - Bankruptcies (Ch 7, Ch 13)
   - Judgments

2. Waiting Period Check:
   - Apply derogatory credit matrix
   - Calculate elapsed time from event
   - Determine eligibility by loan type

3. Dispute Detection:
   - Identify disputed accounts
   - Check AUS instructions
   - Flag if removal required

4. Inquiry Analysis:
   - List all inquiries last 120 days
   - Identify mortgage-related
   - Flag potential new debt

5. Student Loan Handling:
   - Identify deferred loans
   - Check for IBR documentation
   - Calculate 1% if no payment shown

OUTPUT:
{
  "credit_score": {"experian": 720, "equifax": 715, "transunion": 718},
  "derogatory_items": [
    {
      "type": "foreclosure",
      "date": "2022-03-15",
      "elapsed_months": 46,
      "waiting_period_conv": 84,
      "waiting_period_fha": 36,
      "status": "ELIGIBLE_FHA_ONLY"
    }
  ],
  "disputed_accounts": [],
  "inquiries_needing_loe": ["ABC Bank - 2026-01-15"],
  "student_loans": [
    {"creditor": "Navient", "balance": 45000, "payment": 0, "calculated_payment": 450}
  ],
  "alerts": ["Foreclosure within 7 years - Conv not eligible"]
}`,
                integration: `INTEGRATION POINTS:
1. Credit Plus API
   - Pull credit report data
   - Access tradeline details
   - Retrieve public records

2. Byte LOS
   - Update liability entries
   - Add calculated payments
   - Flag derogatory in notes

3. Compliance Database
   - Derogatory credit matrix
   - Waiting periods by product
   - Investor overlays

4. Workflow
   - Generate LOE requests
   - Create condition checklist items
   - Alert processor of issues`
            },
            expirationtracker: {
                name: 'Expiration Tracker',
                tags: ['Monitoring', 'Alerts', 'Low Complexity', 'Medium Priority'],
                purpose: `This agent monitors all document expirations (credit, income, assets, appraisal) and rate lock dates across the loan pipeline. It sends proactive alerts to processors before items expire, preventing closing delays.`,
                prompt: `You are building an Expiration Tracker Agent for CMG Financial's loan pipeline.

AGENT NAME: Expiration Tracker
TYPE: Monitoring / Alert System

OBJECTIVE:
Monitor document and rate lock expirations across all active loans, alerting processors before items expire.

MONITORED ITEMS:

1. Document Expirations:
   - Credit Report (120 days typically)
   - Paystubs (30-60 days)
   - Bank Statements (60-90 days)
   - Appraisal (120-180 days)
   - VOE/VVOE (10 days to closing)

2. Rate Lock:
   - Lock expiration date
   - Extension deadlines
   - Relock requirements

3. Compliance Dates:
   - LE acknowledgment
   - CD delivery timing
   - Closing date targets

ALERT THRESHOLDS:
- 14 days: INFO notification
- 7 days: WARNING notification
- 3 days: URGENT notification
- 0 days: CRITICAL - expired

ALERT CHANNELS:
- Email digest (daily)
- Byte dashboard notification
- Teams webhook (urgent only)

BATCH SCHEDULE:
- Daily scan at 6:00 AM
- Real-time for rate locks
- Weekly summary report

OUTPUT:
{
  "loan_number": "2026-001234",
  "processor": "Jane Doe",
  "alerts": [
    {
      "item": "Credit Report",
      "expiration_date": "2026-02-10",
      "days_remaining": 14,
      "alert_level": "INFO",
      "action": "Re-pull credit before closing"
    },
    {
      "item": "Rate Lock",
      "expiration_date": "2026-02-03",
      "days_remaining": 7,
      "alert_level": "WARNING",
      "action": "Confirm closing scheduled or request extension"
    }
  ]
}`,
                integration: `INTEGRATION POINTS:
1. Byte LOS Database
   - Query Important Dates screen
   - Pull document upload dates
   - Check loan status

2. Notification Services
   - SendGrid for email
   - MS Teams webhooks
   - Byte in-app notifications

3. Dashboard
   - Pipeline view with expiration indicators
   - Color-coded urgency
   - One-click action buttons

4. Reporting
   - Daily processor digest
   - Weekly management summary
   - Expiration trend analysis`
            }
        };

        // Show agent prompt modal
        let currentPromptContent = '';

        function showAgentPrompt(agentKey) {
            const agent = agentPrompts[agentKey];
            if (!agent) return;

            document.getElementById('promptModalTitle').textContent = agent.name + ' - Build Prompt';

            const tagsHtml = agent.tags.map(tag => '<span class="prompt-tag">' + tag + '</span>').join('');
            document.getElementById('promptTags').innerHTML = tagsHtml;

            document.getElementById('promptPurpose').textContent = agent.purpose;
            document.getElementById('promptContent').textContent = agent.prompt;
            document.getElementById('promptIntegration').textContent = agent.integration;

            currentPromptContent = '# ' + agent.name + '\n\n## Purpose\n' + agent.purpose + '\n\n## Build Prompt\n' + agent.prompt + '\n\n## Integration Points\n' + agent.integration;

            document.getElementById('promptModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closePromptModal() {
            document.getElementById('promptModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyPromptToClipboard() {
            try {
                await navigator.clipboard.writeText(currentPromptContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) {
                alert('Failed to copy prompt.');
            }
        }

        document.getElementById('promptModal').addEventListener('click', (e) => {
            if (e.target.id === 'promptModal') closePromptModal();
        });
    </script>
</body>
</html>
