<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Processor File Flow Purchase - Process Workflow</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: #111827;
            --bg-card: #1a2234;
            --accent-blue: #3b82f6;
            --accent-teal: #14b8a6;
            --accent-amber: #f59e0b;
            --accent-rose: #f43f5e;
            --accent-green: #22c55e;
            --accent-purple: #8b5cf6;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-subtle: rgba(255,255,255,0.08);
            --sidebar-width: 280px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .breadcrumb {
            background: linear-gradient(90deg, #0d1525 0%, #1a2234 100%);
            padding: 14px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
            border-bottom: 1px solid var(--border-subtle);
        }

        .breadcrumb a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            transition: all 0.2s;
            border: 1px solid var(--border-subtle);
        }

        .breadcrumb a:hover {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .breadcrumb .separator { color: var(--text-muted); font-size: 1.2rem; }
        .breadcrumb .current { color: var(--accent-amber); font-weight: 600; padding: 8px 16px; }

        .sidebar {
            position: fixed;
            top: 54px;
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - 54px);
            background: var(--bg-secondary);
            overflow-y: auto;
            z-index: 1000;
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 25px 20px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-header h2 { color: var(--text-primary); font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
        .sidebar-header p { color: var(--text-muted); font-size: 0.85rem; }

        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-tab {
            flex: 1;
            padding: 14px 10px;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            background: none;
            border-left: none;
            border-right: none;
            border-top: none;
        }

        .sidebar-tab:hover { background: rgba(255,255,255,0.03); color: var(--text-secondary); }
        .sidebar-tab.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); background: rgba(59, 130, 246, 0.08); }
        .sidebar-tab.agent-tab.active { color: var(--accent-purple); border-bottom-color: var(--accent-purple); background: rgba(139, 92, 246, 0.08); }

        .sidebar-nav { padding: 15px 0; flex: 1; overflow-y: auto; }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .nav-item:hover { background: rgba(255,255,255,0.03); color: var(--text-primary); }
        .nav-item.active { background: rgba(59, 130, 246, 0.1); border-left-color: var(--accent-blue); color: var(--text-primary); }

        .nav-number {
            background: rgba(255,255,255,0.1);
            color: var(--text-secondary);
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .nav-item.active .nav-number { background: var(--accent-blue); color: white; }
        .nav-label { font-size: 0.95rem; font-weight: 500; }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-subtle);
            background: rgba(0,0,0,0.2);
        }

        .doc-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px 20px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .doc-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3); }

        .main-content { margin-left: var(--sidebar-width); padding: 80px 40px 40px 40px; }

        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        .header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(20, 184, 166, 0.08) 0%, transparent 50%);
            pointer-events: none;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        .header .meta { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; position: relative; }

        .header .meta-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-subtle);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); }
        .legend-color { width: 18px; height: 18px; border-radius: 4px; }

        .section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            margin-bottom: 25px;
            overflow: hidden;
            scroll-margin-top: 75px;
        }

        .section-header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(59, 130, 246, 0.1) 100%);
            border-bottom: 1px solid var(--border-subtle);
            padding: 22px 25px;
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .section-number {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .section-title h2 { font-size: 1.35rem; font-weight: 700; margin-bottom: 4px; color: var(--text-primary); }
        .section-title span { font-size: 0.9rem; color: var(--text-muted); }
        .section-content { padding: 28px; }

        .workflow-diagram {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 28px;
            margin-bottom: 22px;
        }

        .flow-row { display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 12px; margin: 15px 0; }

        .flow-node {
            padding: 14px 22px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            min-width: 150px;
            border: 1px solid var(--border-subtle);
        }

        .flow-node.start { background: linear-gradient(135deg, var(--accent-green) 0%, #16a34a 100%); color: white; border-radius: 25px; border: none; }
        .flow-node.action { background: linear-gradient(135deg, var(--accent-blue) 0%, #2563eb 100%); color: white; border: none; }
        .flow-node.decision { background: linear-gradient(135deg, var(--accent-amber) 0%, #d97706 100%); color: var(--bg-primary); border: none; }
        .flow-node.input { background: var(--bg-secondary); border: 2px solid var(--accent-blue); color: var(--text-primary); }
        .flow-node.output { background: linear-gradient(135deg, var(--accent-teal) 0%, #0d9488 100%); color: white; border: none; }
        .flow-node.exception { background: linear-gradient(135deg, var(--accent-rose) 0%, #dc2626 100%); color: white; border: none; }

        .flow-arrow { color: var(--accent-blue); font-size: 1.5rem; }
        .flow-arrow.down { transform: rotate(90deg); }

        .decision-branch { display: flex; gap: 40px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
        .branch { display: flex; flex-direction: column; align-items: center; gap: 10px; }

        .branch-label {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        .field-table { width: 100%; border-collapse: collapse; margin: 18px 0; }

        .field-table th {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            padding: 14px 18px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border-subtle);
        }

        .field-table td { padding: 14px 18px; border-bottom: 1px solid var(--border-subtle); color: var(--text-secondary); }
        .field-table tr:hover { background: rgba(255,255,255,0.02); }

        .badge { display: inline-block; padding: 4px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge.required-badge { background: rgba(244, 63, 94, 0.15); color: var(--accent-rose); }
        .badge.optional-badge { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .badge.calculated-badge { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }

        .exception-box, .tip-box, .info-box {
            padding: 18px 22px;
            margin: 18px 0;
            border-radius: 0 10px 10px 0;
            border-left-width: 4px;
            border-left-style: solid;
        }

        .exception-box { background: rgba(244, 63, 94, 0.08); border-color: var(--accent-rose); border: 1px solid rgba(244, 63, 94, 0.2); border-left: 4px solid var(--accent-rose); }
        .exception-box h4 { color: var(--accent-rose); margin-bottom: 10px; font-size: 1rem; }
        .exception-box p, .exception-box li { color: var(--text-secondary); }

        .tip-box { background: rgba(34, 197, 94, 0.08); border-color: var(--accent-green); border: 1px solid rgba(34, 197, 94, 0.2); border-left: 4px solid var(--accent-green); }
        .tip-box h4 { color: var(--accent-green); margin-bottom: 10px; font-size: 1rem; }
        .tip-box p, .tip-box li { color: var(--text-secondary); }

        .info-box { background: rgba(59, 130, 246, 0.08); border-color: var(--accent-blue); border: 1px solid rgba(59, 130, 246, 0.2); border-left: 4px solid var(--accent-blue); }
        .info-box h4 { color: var(--accent-blue); margin-bottom: 10px; font-size: 1rem; }
        .info-box p, .info-box li { color: var(--text-secondary); }

        .step-list { list-style: none; padding: 0; margin: 18px 0; }
        .step-list li {
            padding: 14px 18px;
            border-left: 3px solid var(--accent-blue);
            background: rgba(0,0,0,0.2);
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
        }
        .step-list li strong { color: var(--text-primary); }

        .quick-ref {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
            border: 1px solid var(--border-subtle);
            padding: 28px;
            border-radius: 16px;
            margin-top: 30px;
            font-family: 'JetBrains Mono', monospace;
            scroll-margin-top: 75px;
        }

        .quick-ref h3 { color: var(--accent-amber); margin-bottom: 18px; font-family: 'Plus Jakarta Sans', sans-serif; }
        .quick-ref pre { background: rgba(0,0,0,0.4); border: 1px solid var(--border-subtle); padding: 20px; border-radius: 10px; overflow-x: auto; font-size: 0.85rem; line-height: 1.7; color: var(--text-secondary); }

        .agent-header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .agent-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(139, 92, 246, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .agent-header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        .heat-map-container { margin-bottom: 35px; }
        .heat-map-title { font-size: 1.3rem; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }

        .heat-map-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .heat-item {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .heat-item:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .heat-item:active { transform: scale(0.98); }

        .heat-item::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 4px;
        }

        .heat-item.critical::before { background: linear-gradient(90deg, #ef4444, #f97316); }
        .heat-item.high::before { background: linear-gradient(90deg, #f97316, #eab308); }
        .heat-item.medium::before { background: linear-gradient(90deg, #eab308, #22c55e); }
        .heat-item.low::before { background: linear-gradient(90deg, #22c55e, #14b8a6); }

        .heat-score {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.8rem;
            font-weight: 800;
        }

        .heat-item.critical .heat-score { color: #ef4444; }
        .heat-item.high .heat-score { color: #f97316; }
        .heat-item.medium .heat-score { color: #eab308; }
        .heat-item.low .heat-score { color: #22c55e; }

        .heat-name { font-size: 1rem; font-weight: 700; color: var(--text-primary); margin-bottom: 6px; padding-right: 50px; }
        .heat-desc { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; }

        .heat-metrics { display: flex; gap: 15px; margin-top: 12px; }
        .heat-metric { font-size: 0.75rem; color: var(--text-muted); }
        .heat-metric span { color: var(--text-secondary); font-weight: 600; }

        .agent-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 25px; margin-bottom: 35px; }

        .agent-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .agent-card:hover { transform: translateY(-5px); box-shadow: 0 15px 50px rgba(0,0,0,0.3); }

        .agent-card.highlight {
            animation: highlightPulse 2s ease;
            box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.4);
        }

        @keyframes highlightPulse {
            0% { box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.6); }
            50% { box-shadow: 0 0 0 6px rgba(139, 92, 246, 0.5), 0 15px 50px rgba(139, 92, 246, 0.3); }
            100% { box-shadow: 0 0 0 0px transparent, 0 15px 50px rgba(0,0,0,0.3); }
        }

        .agent-card-header {
            padding: 22px;
            display: flex;
            align-items: flex-start;
            gap: 18px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .agent-icon {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            flex-shrink: 0;
        }

        .agent-info { flex: 1; }
        .agent-name { font-size: 1.15rem; font-weight: 700; color: var(--text-primary); margin-bottom: 5px; }
        .agent-type { font-size: 0.8rem; color: var(--accent-purple); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-priority {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .agent-priority.critical { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .agent-priority.high { background: rgba(249, 115, 22, 0.15); color: #f97316; }
        .agent-priority.medium { background: rgba(234, 179, 8, 0.15); color: #eab308; }
        .agent-priority.low { background: rgba(34, 197, 94, 0.15); color: #22c55e; }

        .agent-card-body { padding: 22px; }
        .agent-description { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; }

        .agent-flow {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 20px;
        }

        .agent-flow-title { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-flow-diagram { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; justify-content: center; }

        .agent-step {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .agent-arrow { color: var(--accent-purple); font-size: 1.2rem; }

        .agent-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }

        .agent-stat {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .agent-stat-value {
            font-size: 1.3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-top: 4px; }

        .agent-prompt-btn {
            width: 100%;
            margin-top: 18px;
            padding: 14px 20px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 10px;
            color: var(--accent-purple);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .agent-prompt-btn:hover {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(59, 130, 246, 0.3) 100%);
            border-color: var(--accent-purple);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.25);
        }

        .agent-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .agent-summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            padding: 25px;
            text-align: center;
        }

        .agent-summary-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-summary-label { font-size: 0.9rem; color: var(--text-muted); margin-top: 8px; }

        .heat-legend {
            display: flex;
            gap: 25px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .heat-legend-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; color: var(--text-secondary); }
        .heat-legend-color { width: 24px; height: 24px; border-radius: 6px; }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(10, 15, 26, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.show { display: flex; }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            width: 100%;
            max-width: 950px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 80px rgba(0,0,0,0.5);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            padding: 22px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 16px 16px 0 0;
        }

        .modal-header h3 { font-size: 1.25rem; font-weight: 700; }
        .modal-actions { display: flex; gap: 12px; }

        .modal-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: transform 0.2s;
            font-size: 0.9rem;
        }

        .modal-btn:hover { transform: scale(1.05); }
        .modal-btn.copy { background: white; color: var(--accent-blue); }
        .modal-btn.close { background: rgba(255,255,255,0.2); color: white; }

        .modal-body { padding: 28px; overflow-y: auto; flex: 1; }

        .modal-body pre {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            padding: 22px;
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.7;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--text-secondary);
        }

        .copy-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--accent-green);
            color: white;
            padding: 18px 35px;
            border-radius: 10px;
            font-weight: 700;
            z-index: 3000;
            display: none;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut { 0%, 100% { opacity: 0; } 10%, 90% { opacity: 1; } }

        .prompt-modal .modal { max-width: 800px; }
        .prompt-modal .modal-header { background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%); }

        .prompt-section { margin-bottom: 25px; }
        .prompt-section h4 { color: var(--accent-purple); font-size: 1rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }

        .prompt-box {
            background: rgba(0,0,0,0.4);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.7;
            color: var(--text-secondary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .prompt-tags { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .prompt-tag { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }

        .copy-prompt-btn {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 15px;
        }

        .copy-prompt-btn:hover { transform: scale(1.05); box-shadow: 0 5px 20px rgba(139, 92, 246, 0.3); }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 75px 20px 30px 20px; }
            .agent-grid { grid-template-columns: 1fr; }
        }
            .breadcrumb-logo-link { display: flex; align-items: center; padding: 4px 8px; background: rgba(255,255,255,0.08); border-radius: 8px; border: 1px solid rgba(255,255,255,0.12); transition: all 0.2s; }
        .breadcrumb-logo-link:hover { background: rgba(255,255,255,0.15); }
        .breadcrumb-logo { height: 28px; width: auto; }
    </style>
</head>
<body>
    <nav class="breadcrumb">
        <a href="../../index.html" class="breadcrumb-logo-link"><img src="../../images/clear-ai-logo.png" alt="Clear AI" class="breadcrumb-logo"></a>
        <a href="../../index.html">Home</a>
        <span class="separator">></span>
        <a href="./index.html">Mortgage Fundamentals</a>
        <span class="separator">></span>
        <span class="current">Processor File Flow Purchase</span>
    </nav>

    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>Processor File Flow</h2>
            <p>Conventional Purchase Checklist</p>
        </div>

        <div class="sidebar-tabs">
            <button class="sidebar-tab active" onclick="switchTab('workflow')">Workflow</button>
            <button class="sidebar-tab agent-tab" onclick="switchTab('agents')">AI Agents</button>
        </div>

        <nav class="sidebar-nav" id="workflow-nav">
            <a href="#section-1" class="nav-item active">
                <span class="nav-number">1</span>
                <span class="nav-label">Review Submission Notes</span>
            </a>
            <a href="#section-2" class="nav-item">
                <span class="nav-number">2</span>
                <span class="nav-label">Check Disclosures</span>
            </a>
            <a href="#section-3" class="nav-item">
                <span class="nav-number">3</span>
                <span class="nav-label">Review AUS Findings</span>
            </a>
            <a href="#section-4" class="nav-item">
                <span class="nav-number">4</span>
                <span class="nav-label">URLA Review</span>
            </a>
            <a href="#section-5" class="nav-item">
                <span class="nav-number">5</span>
                <span class="nav-label">Order Outs</span>
            </a>
            <a href="#section-6" class="nav-item">
                <span class="nav-number">6</span>
                <span class="nav-label">Title Review</span>
            </a>
            <a href="#section-7" class="nav-item">
                <span class="nav-number">7</span>
                <span class="nav-label">HOI & Appraisal</span>
            </a>
            <a href="#section-8" class="nav-item">
                <span class="nav-number">8</span>
                <span class="nav-label">Approved Status</span>
            </a>
            <a href="#section-9" class="nav-item">
                <span class="nav-number">9</span>
                <span class="nav-label">Request CD</span>
            </a>
            <a href="#section-10" class="nav-item">
                <span class="nav-number">10</span>
                <span class="nav-label">Clear to Close</span>
            </a>
            <a href="#quick-ref" class="nav-item">
                <span class="nav-number">*</span>
                <span class="nav-label">Quick Reference</span>
            </a>
        </nav>

        <nav class="sidebar-nav" id="agents-nav" style="display: none;">
            <a href="#agent-summary" class="nav-item active">
                <span class="nav-number">S</span>
                <span class="nav-label">Summary</span>
            </a>
            <a href="#agent-heatmap" class="nav-item">
                <span class="nav-number">H</span>
                <span class="nav-label">Heat Map</span>
            </a>
            <a href="#agent-details" class="nav-item">
                <span class="nav-number">A</span>
                <span class="nav-label">Agent Details</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="doc-btn" onclick="openDocModal()">View Workflow Markdown</button>
        </div>
    </aside>

    <main class="main-content">
        <div id="workflow-panel" class="tab-panel active">
            <div class="header">
                <h1>Processing Conventional Purchase</h1>
                <p class="subtitle">Complete checklist guide for processing conventional purchase loans in Byte LOS</p>
                <div class="meta">
                    <span class="meta-item">System: Byte LOS</span>
                    <span class="meta-item">Role: Processor</span>
                    <span class="meta-item">Loan Type: Conventional</span>
                    <span class="meta-item">Transaction: Purchase</span>
                </div>
            </div>

            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #22c55e, #16a34a);"></div><span>Start/End</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></div><span>Action Step</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></div><span>Decision Point</span></div>
                <div class="legend-item"><div class="legend-color" style="background: #111827; border: 2px solid #3b82f6;"></div><span>User Input</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f43f5e, #dc2626);"></div><span>Exception</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #14b8a6, #0d9488);"></div><span>Output</span></div>
            </div>

            <!-- Section 1: Review Submission Notes -->
            <section id="section-1" class="section">
                <div class="section-header">
                    <div class="section-number">1</div>
                    <div class="section-title"><h2>Review Submission Notes from Loan Officer</h2><span>Receive loan and review initial documentation from LO</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Loan Assigned</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Add Processing Checklist</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Review LO Materials</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Document Findings</div>
                        </div>
                    </div>
                    <ul class="step-list">
                        <li><strong>Receive Loan:</strong> Manager will notify processor the loan is now assigned</li>
                        <li><strong>Add Checklist:</strong> Add Item: Processing Checklist Conventional to Processing Log (Byte > Processing Log > Add Predefined Items > Other Items)</li>
                        <li><strong>Review LO Materials:</strong> Check Conversation Log, Cover Letter screen, search for emails regarding the loan</li>
                    </ul>
                    <div class="info-box">
                        <h4>Checklist Location</h4>
                        <p>Navigate to: Byte > Processing Log > Add Predefined Items > Other Items > Processing Checklist Conventional</p>
                    </div>
                </div>
            </section>

            <!-- Section 2: Check Disclosures -->
            <section id="section-2" class="section">
                <div class="section-header">
                    <div class="section-number">2</div>
                    <div class="section-title"><h2>Check for Signed Disclosures and Intent to Proceed</h2><span>Verify all required disclosures are executed</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Check Stored Docs</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">All Signed?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">YES</span>
                                <div class="flow-node output">Proceed to Order Outs</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">NO</span>
                                <div class="flow-node exception">Pull from IDS</div>
                            </div>
                        </div>
                    </div>
                    <ul class="step-list">
                        <li><strong>Located in Stored Documents:</strong> Check for signed disclosures</li>
                        <li><strong>IDS Pull:</strong> May need to be manually pulled from IDS (refer to IDS Job Aids)</li>
                        <li><strong>Validate:</strong> All returned and fully executed</li>
                    </ul>
                    <div class="exception-box">
                        <h4>Required Documents for Order Outs</h4>
                        <p>You will need the following to order services:</p>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>Intent to Proceed</li>
                            <li>Signed 4506T</li>
                            <li>Borrower's Authorization to proceed with Order Out Process</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 3: Review AUS -->
            <section id="section-3" class="section">
                <div class="section-header">
                    <div class="section-number">3</div>
                    <div class="section-title"><h2>Review AUS for Needed Items</h2><span>Check DU (Fannie Mae) or LP (Freddie Mac) findings</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Review AUS Findings</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Validations Available?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">YES</span>
                                <div class="flow-node output">Use Day 1 Certainty/AIM</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">NO</span>
                                <div class="flow-node action">Collect Documentation</div>
                            </div>
                        </div>
                    </div>
                    <ul class="step-list">
                        <li><strong>Check AUS:</strong> Look for income and asset validations, appraisal waiver or appraisal type</li>
                        <li><strong>Day 1 Certainty (DU):</strong> Check if available by updating The Work Number document</li>
                        <li><strong>AIM (LP):</strong> Check if available for Freddie Mac loans</li>
                    </ul>
                    <table class="field-table">
                        <thead>
                            <tr><th>Document</th><th>When Needed</th><th>Notes</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><strong>W2</strong></td><td>If income validation not available</td><td>AUS determines 1 or 2 years</td></tr>
                            <tr><td><strong>Paystub</strong></td><td>If income validation not available</td><td>Most recent, showing YTD</td></tr>
                            <tr><td><strong>Bank Statements</strong></td><td>If asset validation not available</td><td>Per AUS findings</td></tr>
                            <tr><td><strong>Tax Returns</strong></td><td>Self-Employed (excluding Sch C)</td><td>Run LoanBeam for analysis</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Section 4: URLA Review -->
            <section id="section-4" class="section">
                <div class="section-header">
                    <div class="section-number">4</div>
                    <div class="section-title"><h2>Review/Update URLA Against Borrower Docs</h2><span>Ensure all sections are completed and match documentation</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Verify Borrower Info</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Review Contract</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Verify Employment</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Check Assets/Liabilities</div>
                        </div>
                    </div>

                    <div class="tip-box">
                        <h4>Red Flags to Note</h4>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>LTV over 90%</li>
                            <li>DTI over 40%</li>
                            <li>Property type Condo (request Condo Department on Processing Log - Additional)</li>
                            <li>Property Type Manufactured</li>
                        </ul>
                    </div>

                    <h3 style="color: var(--accent-blue); margin: 25px 0 15px 0;">Purchase Contract Review</h3>
                    <ul class="step-list">
                        <li><strong>Pages:</strong> All pages present and fully executed</li>
                        <li><strong>Addendums:</strong> All addendums listed are included</li>
                        <li><strong>Closing Date:</strong> Confirm matches Byte</li>
                        <li><strong>Seller Credits:</strong> Confirm any seller credits listed on contract are in Byte</li>
                        <li><strong>Address:</strong> Borrower address on contract matches current address on application</li>
                        <li><strong>Parties Screen:</strong> Update Builder/Seller, Selling Agent, Listing Agent with license information</li>
                        <li><strong>Earnest Money:</strong> Verify on bank statements</li>
                    </ul>

                    <h3 style="color: var(--accent-blue); margin: 25px 0 15px 0;">Employment & Income</h3>
                    <ul class="step-list">
                        <li><strong>Order VOE:</strong> If not already ordered</li>
                        <li><strong>Employer Match:</strong> Confirm names match from VOE/Paystubs and URLA</li>
                        <li><strong>2-Year History:</strong> Ensure on application with backup documents per AUS findings</li>
                        <li><strong>Validate Calculation:</strong> Use CMG Income Calculation Job Aid or Income Calc worksheets</li>
                    </ul>

                    <h3 style="color: var(--accent-blue); margin: 25px 0 15px 0;">Assets Review</h3>
                    <table class="field-table">
                        <thead>
                            <tr><th>Validation Item</th><th>Requirement</th><th>Action</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><strong>Bank Info</strong></td><td>Name, Account Number, Balance match</td><td>Update Byte fields</td></tr>
                            <tr><td><strong>Large Deposits</strong></td><td>Over 50% of qualifying income</td><td>Document source</td></tr>
                            <tr><td><strong>Retirement</strong></td><td>Terms of withdrawal if using for funds</td><td>Get withdrawal docs</td></tr>
                            <tr><td><strong>Document Validity</strong></td><td>All pages including blank, URL if web</td><td>Verify completeness</td></tr>
                        </tbody>
                    </table>

                    <h3 style="color: var(--accent-blue); margin: 25px 0 15px 0;">Liabilities & Credit</h3>
                    <ul class="step-list">
                        <li><strong>Credit Report:</strong> Double check it matches AUS submission</li>
                        <li><strong>Debts Listed:</strong> All debts on Credit Report listed on application with accurate payments/balances</li>
                        <li><strong>Student Loans:</strong> If no payment: Conv - use IBR docs for $0 or 1% if deferred/forbearance</li>
                        <li><strong>Derogatory Items:</strong> Check waiting periods on derogatory credit matrix</li>
                        <li><strong>Inquiries:</strong> Get LOE from borrower for any new inquiries</li>
                    </ul>
                </div>
            </section>

            <!-- Section 5: Order Outs -->
            <section id="section-5" class="section">
                <div class="section-header">
                    <div class="section-number">5</div>
                    <div class="section-title"><h2>Order Outs</h2><span>Order title, appraisal, insurance, and run reports</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Run LoanSafe</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Re-Run AUS</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Order Title</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Order Appraisal</div>
                        </div>
                        <div class="flow-row">
                            <div class="flow-node action">Order HOI</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Order Flood Cert</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Run FEMA</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Update Parties</div>
                        </div>
                    </div>

                    <div class="info-box">
                        <h4>Automated Items (ISGN/SourcePoint)</h4>
                        <p>These items will be completed automatically: LoanSafe Report, Flood Cert, FEMA. See Processing Manual - Order Outs for instructions.</p>
                    </div>

                    <ul class="step-list">
                        <li><strong>Review Processing Log:</strong> Ensure no one has completed before loan received - always track ordered/received items</li>
                        <li><strong>Run Initial LoanSafe Report:</strong> Clear watchlist hits, check for undisclosed properties/foreclosures/bankruptcies, enter AKAs on URLA Borrower Info</li>
                        <li><strong>Re-Run AUS:</strong> After 1003 updated to match docs - must be Approve/Accept/Eligible (no caution or ineligible)</li>
                        <li><strong>Mark Documents:</strong> Make sure all docs in Stored Docs are marked "Reviewed"</li>
                        <li><strong>Order Title:</strong> Submit title order</li>
                        <li><strong>Order Appraisal:</strong> If applicable per AUS findings</li>
                        <li><strong>Order HOI:</strong> Homeowners insurance</li>
                        <li><strong>Order Flood Cert:</strong> If in Flood Zone, alert LO and send Borrower Flood Zone Notice</li>
                        <li><strong>Run FEMA:</strong> Verify flood zone status</li>
                    </ul>
                </div>
            </section>

            <!-- Section 6: Title Review -->
            <section id="section-6" class="section">
                <div class="section-header">
                    <div class="section-number">6</div>
                    <div class="section-title"><h2>Title Review</h2><span>Review title commitment and update Byte</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Review Title</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Update Taxes</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Complete Wire Info</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Update Fees</div>
                        </div>
                    </div>

                    <ul class="step-list">
                        <li><strong>Update Taxes:</strong> In Byte per Tax Certificate</li>
                        <li><strong>CPL Date:</strong> Must be dated within 30 days of closing</li>
                        <li><strong>Wire Info:</strong> Complete in Title & Escrow Screen - use Parties when available to validate company info first</li>
                        <li><strong>E&O:</strong> Has deductible and not expired</li>
                        <li><strong>CD Request Screen:</strong> Update to confirm all title items are complete</li>
                        <li><strong>Fees on CD Page 2:</strong> If title company different from initial LE - indicate fees are shopped; if same - confirm fees match (alert Processing Manager if higher)</li>
                        <li><strong>12-Month Chain of Title:</strong> Verify</li>
                        <li><strong>No Deed Restrictions:</strong> Confirm</li>
                    </ul>

                    <table class="field-table">
                        <thead>
                            <tr><th>Doc Prep Screen Field</th><th>Information</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><strong>Escrow Number</strong></td><td>Title Commitment number</td></tr>
                            <tr><td><strong>Title Commitment Date</strong></td><td>Date from title</td></tr>
                            <tr><td><strong>Attorney/Title Officer</strong></td><td>Name and company</td></tr>
                            <tr><td><strong>Escrow Officer</strong></td><td>Name and company</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Section 7: HOI & Appraisal -->
            <section id="section-7" class="section">
                <div class="section-header">
                    <div class="section-number">7</div>
                    <div class="section-title"><h2>Homeowners Insurance & Appraisal Review</h2><span>Verify insurance coverage and appraisal details</span></div>
                </div>
                <div class="section-content">
                    <h3 style="color: var(--accent-blue); margin: 0 0 15px 0;">Homeowners Insurance Review</h3>
                    <ul class="step-list">
                        <li><strong>Borrower Names:</strong> All borrower's names are on policy</li>
                        <li><strong>Subject Property:</strong> Same as financed property</li>
                        <li><strong>Dwelling Coverage:</strong> Equal/above loan amount or replacement cost estimator</li>
                        <li><strong>Effective Dates:</strong> Update Byte to reflect correct premium amount</li>
                        <li><strong>Present Housing:</strong> Update premium converted to monthly amount in URLA Borrower Info</li>
                        <li><strong>Doc Prep Screen:</strong> Enter insurance agent and policy information</li>
                    </ul>

                    <h3 style="color: var(--accent-blue); margin: 25px 0 15px 0;">Appraisal Review</h3>
                    <table class="field-table">
                        <thead>
                            <tr><th>Verification Item</th><th>Must Match</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><strong>Property Address</strong></td><td>Prelim, Byte, USPS, HOI</td></tr>
                            <tr><td><strong>Borrower/Owner</strong></td><td>Public Record matches Prelim, Byte</td></tr>
                            <tr><td><strong>Legal Description</strong></td><td>Parcel Number matches Prelim, Tax Records</td></tr>
                            <tr><td><strong>Occupancy Status</strong></td><td>Byte, Prelim</td></tr>
                            <tr><td><strong>Assignment Type</strong></td><td>Purchase or Refinance - must match Byte</td></tr>
                            <tr><td><strong>Lender/Client</strong></td><td>Must be CMG Financial</td></tr>
                        </tbody>
                    </table>

                    <ul class="step-list">
                        <li><strong>HOA Fees:</strong> Check if property has any fees to enter into Byte</li>
                        <li><strong>Appraisal Value:</strong> Update in Appraisal Info Screen to match report</li>
                        <li><strong>Appraiser & AMC:</strong> Enter in Parties Screen or Appraisal Info Screen</li>
                        <li><strong>Property Details:</strong> Complete structure details from Improvements section</li>
                        <li><strong>Valuation Method:</strong> Complete under Appraisal Details on Appraisal Info Screen</li>
                    </ul>
                </div>
            </section>

            <!-- Section 8: Approved Status -->
            <section id="section-8" class="section">
                <div class="section-header">
                    <div class="section-number">8</div>
                    <div class="section-title"><h2>Approved Status</h2><span>Post-approval tasks and condition collection</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Finalize Notes to UW</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Change Status to UW Received</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Review Approval Letter</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Collect Conditions</div>
                        </div>
                    </div>

                    <ul class="step-list">
                        <li><strong>Finalize Notes:</strong> Complete all notes to UW in Cover Letter Screen in Byte</li>
                        <li><strong>Change Status:</strong> Update loan status to UW Received</li>
                        <li><strong>Review Approval Letter:</strong> Prepare to collect all conditions</li>
                        <li><strong>Discuss with LO:</strong> Determine which conditions the LO/PA will gather required documents to clear</li>
                        <li><strong>Activate UDM:</strong> Completed by ISGN/SourcePoint automatically</li>
                        <li><strong>Order MI:</strong> If applicable, once DTI and assets are finalized</li>
                        <li><strong>Order Payoff:</strong> May be done closer to closing date to avoid Borrower poaching from current lender - update Byte with Payoff information</li>
                    </ul>
                </div>
            </section>

            <!-- Section 9: Request CD -->
            <section id="section-9" class="section">
                <div class="section-header">
                    <div class="section-number">9</div>
                    <div class="section-title"><h2>Request CD</h2><span>Request Closing Disclosure when ready</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node decision">CD Checklist Complete?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">YES</span>
                                <div class="flow-node action">Request CD</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">NO</span>
                                <div class="flow-node exception">Complete Missing Items</div>
                            </div>
                        </div>
                    </div>

                    <div class="exception-box">
                        <h4>CD Timing Requirement</h4>
                        <p>Request CD no later than 4 business days from signing/close date. Preferably 10 days from signing/close date and when Retail CD Checklist is complete.</p>
                    </div>

                    <h3 style="color: var(--accent-blue); margin: 25px 0 15px 0;">CD Request Prerequisites</h3>
                    <ul class="step-list">
                        <li><strong>Loan must be approved</strong></li>
                        <li><strong>Locked good through funding date</strong></li>
                        <li><strong>Title and appraisal in the loan</strong></li>
                        <li><strong>Last LE Acknowledged at least 1 day prior to CD delivery</strong></li>
                        <li><strong>Validate and check the CD Checklist boxes</strong></li>
                    </ul>
                </div>
            </section>

            <!-- Section 10: Clear to Close -->
            <section id="section-10" class="section">
                <div class="section-header">
                    <div class="section-number">10</div>
                    <div class="section-title"><h2>Submit Conditions for Clear to Close</h2><span>Final verification and CTC submission</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Verify Documents</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Order VVOE</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Update UDM/LoanSafe</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Submit for CTC</div>
                        </div>
                    </div>

                    <ul class="step-list">
                        <li><strong>Verify Expiration:</strong> Credit, income, assets are not going to expire</li>
                        <li><strong>Verify Rate Lock:</strong> Loan terms match rate lock, if not update profile in Optimal Blue</li>
                        <li><strong>Order VVOE:</strong> Within 10 days of closing</li>
                        <li><strong>Update UDM Report:</strong> Validate no new inquiries - if there are, request LOE from Borrower to confirm no new debt</li>
                        <li><strong>Retrieve LoanSafe Report:</strong> Confirm low alerts are cleared</li>
                    </ul>

                    <h3 style="color: var(--accent-blue); margin: 25px 0 15px 0;">Enter Clear to Close Requested Date</h3>
                    <ul class="step-list">
                        <li><strong>Change loan status to Conditions for Review</strong></li>
                        <li><strong>Validate no other changes need to be made to the loan</strong></li>
                        <li><strong>Confirm scheduled signing/closing date</strong></li>
                        <li><strong>Confirm lock is still good through funding date</strong></li>
                    </ul>

                    <div class="tip-box">
                        <h4>At Clear to Close</h4>
                        <p>Change loan status to DOCS ORDERED</p>
                    </div>
                </div>
            </section>

            <!-- Quick Reference -->
            <div id="quick-ref" class="quick-ref">
                <h3>Processing Conventional Purchase - Quick Reference</h3>
                <pre>
PROCESSING CONVENTIONAL PURCHASE CHECKLIST SUMMARY
===================================================

PHASE 1: LOAN INTAKE
- Receive loan from LO (Manager notification)
- Add Processing Checklist Conventional to Processing Log
- Review Conversation Log, Cover Letter, emails

PHASE 2: DISCLOSURES & AUS
- Check Stored Docs for signed disclosures
- Pull from IDS if needed
- Verify: Intent to Proceed, 4506T, Authorization
- Review AUS (DU/LP) for validations and waivers

PHASE 3: URLA REVIEW
[ ] Borrower names match documents
[ ] Addresses match or LOE documented
[ ] Purchase contract complete and executed
[ ] Parties screen updated (agents, seller)
[ ] Employment verified (VOE ordered)
[ ] Income calculation validated
[ ] Assets match bank statements
[ ] Liabilities match credit report
[ ] REO linked and validated

PHASE 4: ORDER OUTS
[ ] Run LoanSafe - clear watchlist hits
[ ] Re-run AUS - Approve/Accept/Eligible
[ ] Mark all docs "Reviewed"
[ ] Order Title
[ ] Order Appraisal (if applicable)
[ ] Order HOI
[ ] Order Flood Cert
[ ] Run FEMA

PHASE 5: REVIEWS
Title Review:
- Update taxes per Tax Certificate
- CPL within 30 days of closing
- Wire info in Title & Escrow Screen
- E&O verified
- Fees match LE or marked as shopped

HOI Review:
- All borrowers on policy
- Dwelling coverage >= loan amount
- Premium updated in Byte

Appraisal Review:
- Property address matches all docs
- Value updated in Byte
- Appraiser/AMC in Parties Screen

PHASE 6: APPROVAL & CD
- Finalize notes in Cover Letter Screen
- Change status to UW Received
- Review Approval Letter
- Activate UDM (auto)
- Order MI if applicable
- Order Payoff
- Request CD (4-10 days before close)

PHASE 7: CLEAR TO CLOSE
[ ] Verify no document expirations
[ ] Verify rate lock terms
[ ] Order VVOE (within 10 days)
[ ] Update UDM - no new inquiries
[ ] Retrieve LoanSafe - alerts cleared
[ ] Enter CTC requested date
[ ] Change status: Conditions for Review
[ ] At CTC: Change status to Docs Ordered

RED FLAGS TO WATCH:
- LTV over 90%
- DTI over 40%
- Condo properties
- Manufactured homes
- Large deposits (>50% qualifying income)
- Recent credit inquiries
                </pre>
            </div>
        </div>

        <!-- AI AGENTS TAB -->
        <div id="agents-panel" class="tab-panel">
            <div class="agent-header">
                <h1>AI Agent Opportunities</h1>
                <p class="subtitle">Automation opportunities identified for the Conventional Purchase Processing workflow</p>
            </div>

            <div class="agent-summary" id="agent-summary">
                <div class="agent-summary-card">
                    <div class="agent-summary-value">5</div>
                    <div class="agent-summary-label">Agent Opportunities</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">68%</div>
                    <div class="agent-summary-label">Automation Potential</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">45 min</div>
                    <div class="agent-summary-label">Est. Time Saved</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">High</div>
                    <div class="agent-summary-label">Compliance Impact</div>
                </div>
            </div>

            <div class="heat-legend">
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #ef4444, #f97316);"></div>
                    <span>Critical Priority (9-10)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #f97316, #eab308);"></div>
                    <span>High Priority (7-8)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #eab308, #22c55e);"></div>
                    <span>Medium Priority (5-6)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #22c55e, #14b8a6);"></div>
                    <span>Low Priority (1-4)</span>
                </div>
            </div>

            <div class="heat-map-container" id="agent-heatmap">
                <div class="heat-map-title">Priority Heat Map</div>
                <div class="heat-map-grid">
                    <div class="heat-item critical" onclick="scrollToAgent('agent-docvalidator')">
                        <div class="heat-score">9.4</div>
                        <div class="heat-name">Document Validator Agent</div>
                        <div class="heat-desc">Auto-validate URLA fields against borrower documents</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>15 min</span></div>
                            <div class="heat-metric">Complexity: <span>High</span></div>
                        </div>
                    </div>
                    <div class="heat-item critical" onclick="scrollToAgent('agent-ausanalyzer')">
                        <div class="heat-score">9.1</div>
                        <div class="heat-name">AUS Analyzer Agent</div>
                        <div class="heat-desc">Parse AUS findings and generate collection checklist</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>10 min</span></div>
                            <div class="heat-metric">Complexity: <span>Medium</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-contractreview')">
                        <div class="heat-score">8.3</div>
                        <div class="heat-name">Contract Review Agent</div>
                        <div class="heat-desc">Extract and validate purchase contract data</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>8 min</span></div>
                            <div class="heat-metric">Complexity: <span>Medium</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-conditiontracker')">
                        <div class="heat-score">7.8</div>
                        <div class="heat-name">Condition Tracker Agent</div>
                        <div class="heat-desc">Monitor and alert on condition clearance status</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>N/A</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                    <div class="heat-item medium" onclick="scrollToAgent('agent-incomevalidator')">
                        <div class="heat-score">6.5</div>
                        <div class="heat-name">Income Calculator Agent</div>
                        <div class="heat-desc">Auto-calculate and validate income from documents</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>12 min</span></div>
                            <div class="heat-metric">Complexity: <span>High</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="agent-details">
                <h2 style="color: var(--text-primary); margin-bottom: 25px; font-size: 1.5rem;">Agent Details</h2>
                <div class="agent-grid">
                    <!-- Document Validator Agent -->
                    <div class="agent-card" id="agent-docvalidator">
                        <div class="agent-card-header">
                            <div class="agent-icon">D</div>
                            <div class="agent-info">
                                <div class="agent-name">Document Validator Agent</div>
                                <div class="agent-type">Document Processing / OCR</div>
                            </div>
                            <span class="agent-priority critical">Critical</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Automatically extracts data from borrower documents (W2s, paystubs, bank statements) using OCR and validates against URLA fields in Byte. Flags discrepancies for processor review.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Extract Doc Data</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Compare to URLA</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Flag Discrepancies</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Generate Report</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">15 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">92%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">High</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('docvalidator')">View Build Prompt</button>
                        </div>
                    </div>

                    <!-- AUS Analyzer Agent -->
                    <div class="agent-card" id="agent-ausanalyzer">
                        <div class="agent-card-header">
                            <div class="agent-icon">A</div>
                            <div class="agent-info">
                                <div class="agent-name">AUS Analyzer Agent</div>
                                <div class="agent-type">Data Parsing / Checklist Generation</div>
                            </div>
                            <span class="agent-priority critical">Critical</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Parses DU/LP findings to extract required documentation, identify available validations (Day 1 Certainty, AIM), and generate a prioritized collection checklist for the processor.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Parse AUS PDF</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Extract Requirements</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Check Validations</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Generate Checklist</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">10 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">98%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Med</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('ausanalyzer')">View Build Prompt</button>
                        </div>
                    </div>

                    <!-- Contract Review Agent -->
                    <div class="agent-card" id="agent-contractreview">
                        <div class="agent-card-header">
                            <div class="agent-icon">C</div>
                            <div class="agent-info">
                                <div class="agent-name">Contract Review Agent</div>
                                <div class="agent-type">Document Analysis / Data Extraction</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Extracts key data from purchase contracts (closing date, seller credits, earnest money, parties) and validates against Byte entries. Identifies missing addendums and signature issues.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Parse Contract</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Extract Data</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Compare to Byte</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Flag Issues</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">8 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">94%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Med</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('contractreview')">View Build Prompt</button>
                        </div>
                    </div>

                    <!-- Condition Tracker Agent -->
                    <div class="agent-card" id="agent-conditiontracker">
                        <div class="agent-card-header">
                            <div class="agent-icon">T</div>
                            <div class="agent-info">
                                <div class="agent-name">Condition Tracker Agent</div>
                                <div class="agent-type">Monitoring / Alerts</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Monitors all outstanding conditions from approval letter, tracks document submissions, and sends proactive alerts when conditions are approaching deadline or blocking CTC.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Parse Conditions</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Monitor Docs</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Track Status</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Send Alerts</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">N/A</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">99%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('conditiontracker')">View Build Prompt</button>
                        </div>
                    </div>

                    <!-- Income Calculator Agent -->
                    <div class="agent-card" id="agent-incomevalidator">
                        <div class="agent-card-header">
                            <div class="agent-icon">I</div>
                            <div class="agent-info">
                                <div class="agent-name">Income Calculator Agent</div>
                                <div class="agent-type">Calculation / Validation</div>
                            </div>
                            <span class="agent-priority medium">Medium</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Extracts income data from paystubs, W2s, and tax returns to calculate qualifying income using CMG guidelines. Validates LO calculations and flags discrepancies.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Extract Income</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Apply Rules</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Calculate Total</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Compare to LO</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">12 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">90%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">High</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('incomevalidator')">View Build Prompt</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Document Modal -->
    <div id="docModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3>Processor File Flow Purchase - Workflow Documentation</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyToClipboard()">Copy</button>
                    <button class="modal-btn close" onclick="closeDocModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <pre id="docContent"># Processing Conventional Purchase - Workflow Documentation

## Overview
Complete checklist guide for processing conventional purchase loans in Byte LOS.

## Phase 1: Loan Intake
- Receive loan from Loan Officer (Manager notification)
- Add Processing Checklist Conventional to Processing Log
- Review Conversation Log, Cover Letter screen, search for emails

## Phase 2: Disclosures & AUS Review
- Check Stored Documents for signed disclosures
- Pull from IDS if needed
- Required: Intent to Proceed, Signed 4506T, Borrower's Authorization
- Review AUS (DU/LP) for income/asset validations and appraisal waivers

## Phase 3: URLA Review Against Borrower Documents
- Verify borrower names match documents (W2s, Paystubs, Bank Statements)
- Verify addresses match or document in LOE
- Review and validate Purchase Contract
- Update Parties Screen with agent/seller information
- Verify employment and order VOE if needed
- Validate income calculation using CMG Job Aid
- Review assets and verify large deposits
- Review liabilities and credit report

## Phase 4: Order Outs
- Run Initial LoanSafe Report
- Re-Run AUS after 1003 updated
- Mark all docs as Reviewed
- Order Title, Appraisal, HOI, Flood Cert
- Run FEMA

## Phase 5: Reviews
### Title Review
- Update taxes per Tax Certificate
- Verify CPL within 30 days of closing
- Complete wire info in Title & Escrow Screen
- Update fees on CD Page 2

### Homeowners Insurance Review
- All borrowers on policy
- Dwelling coverage >= loan amount
- Update premium in Byte

### Appraisal Review
- Verify property address matches all documents
- Update appraisal value in Byte
- Enter appraiser and AMC information

## Phase 6: Approved Status
- Finalize notes in Cover Letter Screen
- Change status to UW Received
- Review Approval Letter and collect conditions
- Order MI if applicable
- Order Payoff

## Phase 7: Request CD
- Request no later than 4 business days from close
- Verify: Loan approved, locked, title/appraisal in file
- Validate CD Checklist boxes

## Phase 8: Clear to Close
- Verify documents not expiring
- Order VVOE within 10 days of closing
- Update UDM - no new inquiries
- Retrieve LoanSafe - alerts cleared
- Change status to Conditions for Review
- At CTC: Change status to Docs Ordered
                </pre>
            </div>
        </div>
    </div>

    <!-- Prompt Modal -->
    <div id="promptModal" class="modal-overlay prompt-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="promptModalTitle">Agent Build Prompt</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyPromptToClipboard()">Copy All</button>
                    <button class="modal-btn close" onclick="closePromptModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="prompt-tags" id="promptTags"></div>
                <div class="prompt-section">
                    <h4>Purpose</h4>
                    <div class="prompt-box" id="promptPurpose"></div>
                </div>
                <div class="prompt-section">
                    <h4>Build Prompt</h4>
                    <div class="prompt-box" id="promptContent"></div>
                </div>
                <div class="prompt-section">
                    <h4>Integration Points</h4>
                    <div class="prompt-box" id="promptIntegration"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="copySuccess" class="copy-success">Copied to clipboard!</div>

    <script>
        function switchTab(tab) {
            document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));

            if (tab === 'workflow') {
                document.querySelector('.sidebar-tab:not(.agent-tab)').classList.add('active');
                document.getElementById('workflow-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'block';
                document.getElementById('agents-nav').style.display = 'none';
            } else {
                document.querySelector('.sidebar-tab.agent-tab').classList.add('active');
                document.getElementById('agents-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'none';
                document.getElementById('agents-nav').style.display = 'block';
            }
        }

        const sections = document.querySelectorAll('.section, .quick-ref');
        const navItems = document.querySelectorAll('#workflow-nav .nav-item');
        let isScrolling = false;
        let scrollTimeout;

        function updateActiveNav() {
            if (isScrolling) return;
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (window.scrollY >= sectionTop - 100) {
                    current = section.getAttribute('id');
                }
            });
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + current) {
                    item.classList.add('active');
                }
            });
        }

        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                isScrolling = true;
                clearTimeout(scrollTimeout);
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');
                scrollTimeout = setTimeout(() => { isScrolling = false; }, 1000);
            });
        });

        window.addEventListener('scroll', updateActiveNav);

        function openDocModal() {
            document.getElementById('docModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeDocModal() {
            document.getElementById('docModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyToClipboard() {
            try {
                await navigator.clipboard.writeText(document.getElementById('docContent').textContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeDocModal(); closePromptModal(); } });
        document.getElementById('docModal').addEventListener('click', (e) => { if (e.target.id === 'docModal') closeDocModal(); });
        document.addEventListener('DOMContentLoaded', () => { updateActiveNav(); });

        function scrollToAgent(agentId) {
            const agentCard = document.getElementById(agentId);
            if (agentCard) {
                document.querySelectorAll('.agent-card.highlight').forEach(card => { card.classList.remove('highlight'); });
                agentCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                setTimeout(() => { agentCard.classList.add('highlight'); }, 300);
                setTimeout(() => { agentCard.classList.remove('highlight'); }, 2500);
            }
        }

        const agentPrompts = {
            docvalidator: {
                name: 'Document Validator Agent',
                tags: ['Document Processing', 'OCR', 'High Complexity', 'Critical Priority'],
                purpose: 'Automatically extracts data from borrower documents (W2s, paystubs, bank statements) using OCR and validates against URLA fields in Byte. Flags discrepancies for processor review, reducing manual comparison time by 15+ minutes per loan.',
                prompt: `You are building a Document Processing Agent for CMG Financial's Byte LOS.

AGENT NAME: Document Validator Agent
TYPE: Document Processing / OCR Validation

OBJECTIVE:
Extract data from uploaded borrower documents and validate against URLA fields in Byte, flagging any discrepancies for processor review.

DOCUMENT TYPES TO PROCESS:
1. W2 Forms - Extract: Employer name, EIN, wages, federal tax withheld
2. Paystubs - Extract: Employer name, YTD income, pay period, deductions
3. Bank Statements - Extract: Account number, balance, institution name
4. Tax Returns - Extract: Filing status, AGI, schedules

VALIDATION RULES:
- Borrower name exact match (allow common variations)
- Employer name fuzzy match (80% similarity threshold)
- Address match with standardization
- Income within 5% tolerance
- Account numbers exact match

OUTPUT FORMAT:
{
  "document_type": "W2",
  "extracted_data": {...},
  "urla_data": {...},
  "discrepancies": [
    {"field": "employer_name", "extracted": "ABC Corp", "urla": "ABC Corporation", "severity": "low"}
  ],
  "confidence_score": 0.95
}`,
                integration: `INTEGRATION POINTS:
1. OCR Engine: Azure Form Recognizer or AWS Textract
2. Byte LOS API: Read URLA fields
3. Stored Documents: Access uploaded docs
4. Processing Log: Write validation results
5. Alert System: Notify processor of discrepancies`
            },
            ausanalyzer: {
                name: 'AUS Analyzer Agent',
                tags: ['Data Parsing', 'Checklist Generation', 'Medium Complexity', 'Critical Priority'],
                purpose: 'Parses DU/LP findings to extract required documentation, identify available validations (Day 1 Certainty, AIM), and generate a prioritized collection checklist for the processor.',
                prompt: `You are building an AUS Analysis Agent for CMG Financial's processing workflow.

AGENT NAME: AUS Analyzer Agent
TYPE: Data Parsing / Checklist Generation

OBJECTIVE:
Parse DU (Desktop Underwriter) and LP (Loan Product Advisor) findings PDFs to extract documentation requirements and generate actionable checklists.

PARSING TARGETS:
1. Required Documentation section
2. Income validation status (Day 1 Certainty eligible)
3. Asset validation status (AIM eligible)
4. Appraisal requirements (waiver, PIW, traditional)
5. Credit documentation requirements
6. Conditions and messages

CHECKLIST GENERATION:
- Prioritize by: Critical > High > Standard
- Group by: Income, Assets, Employment, Credit, Property
- Include: Document name, source, deadline

OUTPUT:
{
  "aus_type": "DU",
  "recommendation": "Approve/Eligible",
  "validations": {
    "income": "Day 1 Certainty Available",
    "assets": "Verification Required"
  },
  "checklist": [
    {"item": "2 Years W2", "priority": "high", "category": "income", "source": "borrower"}
  ]
}`,
                integration: `INTEGRATION POINTS:
1. PDF Parser: Extract text from AUS findings
2. Byte LOS: Write checklist to Processing Log
3. Document Tracking: Link requirements to collection status
4. LoanBeam: Trigger for self-employed analysis`
            },
            contractreview: {
                name: 'Contract Review Agent',
                tags: ['Document Analysis', 'Data Extraction', 'Medium Complexity', 'High Priority'],
                purpose: 'Extracts key data from purchase contracts (closing date, seller credits, earnest money, parties) and validates against Byte entries. Identifies missing addendums and signature issues.',
                prompt: `You are building a Contract Review Agent for CMG Financial.

AGENT NAME: Contract Review Agent
TYPE: Document Analysis / Data Extraction

OBJECTIVE:
Extract and validate key data points from purchase contracts, ensuring all information matches Byte and all required documents are present.

DATA EXTRACTION TARGETS:
- Purchase price
- Closing date
- Seller credits/concessions
- Earnest money deposit amount
- Buyer names and addresses
- Seller names
- Property address
- Agent information (selling and listing)
- Addendum list

VALIDATION CHECKS:
1. All listed addendums are attached
2. All signature pages executed
3. Closing date matches Byte
4. Seller credits in Byte match contract
5. Property address standardization match
6. Earnest money verification needed flag

OUTPUT:
{
  "contract_data": {...},
  "byte_comparison": {...},
  "missing_addendums": [],
  "signature_issues": [],
  "recommendations": []
}`,
                integration: `INTEGRATION POINTS:
1. OCR: Extract contract data
2. Byte LOS: Compare to entered data
3. Stored Documents: Check for addendums
4. Parties Screen: Pre-fill agent info`
            },
            conditiontracker: {
                name: 'Condition Tracker Agent',
                tags: ['Monitoring', 'Alerts', 'Low Complexity', 'High Priority'],
                purpose: 'Monitors all outstanding conditions from approval letter, tracks document submissions, and sends proactive alerts when conditions are approaching deadline or blocking CTC.',
                prompt: `You are building a Condition Tracking Agent for CMG Financial.

AGENT NAME: Condition Tracker Agent
TYPE: Monitoring / Push Notifications

OBJECTIVE:
Track all conditions from loan approval, monitor for document submissions, and alert processors to conditions at risk of delaying CTC.

CONDITION SOURCES:
- Approval letter conditions
- Suspense items
- Prior-to-doc conditions
- Prior-to-fund conditions

TRACKING LOGIC:
1. Parse conditions from approval letter
2. Monitor Stored Docs for matching submissions
3. Track condition status in Byte
4. Calculate days until closing
5. Alert based on risk level

ALERT THRESHOLDS:
- 7 days to close + outstanding PTC: WARNING
- 3 days to close + outstanding PTC: URGENT
- Blocking CTC: CRITICAL

OUTPUT:
{
  "loan_number": "xxx",
  "conditions": [
    {"id": 1, "description": "VOE", "status": "pending", "days_outstanding": 5, "risk": "medium"}
  ],
  "ctc_blockers": [],
  "alerts_sent": []
}`,
                integration: `INTEGRATION POINTS:
1. Byte Conditions Screen: Read/update status
2. Stored Documents: Match docs to conditions
3. Email/Teams: Send alerts
4. Dashboard: Visual condition status`
            },
            incomevalidator: {
                name: 'Income Calculator Agent',
                tags: ['Calculation', 'Validation', 'High Complexity', 'Medium Priority'],
                purpose: 'Extracts income data from paystubs, W2s, and tax returns to calculate qualifying income using CMG guidelines. Validates LO calculations and flags discrepancies.',
                prompt: `You are building an Income Calculation Agent for CMG Financial.

AGENT NAME: Income Calculator Agent
TYPE: Calculation / Validation

OBJECTIVE:
Extract income data from documents and calculate qualifying income per CMG/Agency guidelines, validating against LO submitted figures.

INCOME TYPES:
1. Base salary (YTD / months = monthly)
2. Overtime (2-year average if stable/increasing)
3. Bonus (2-year average)
4. Commission (2-year average)
5. Self-employment (tax return analysis)
6. Rental income (Schedule E)
7. Alimony/Child Support (if qualifying)

CALCULATION RULES:
- Salaried: Current rate or YTD average (lower)
- Hourly: YTD hours / YTD weeks * 40 * hourly rate
- Variable: 2-year average, declining = most recent
- Self-employed: Net profit + depreciation - business mileage

VALIDATION:
- Compare to LO calculation
- Flag variance > 5%
- Note any gross-up applied

OUTPUT:
{
  "borrower": "John Smith",
  "income_breakdown": {...},
  "total_qualifying": 8500.00,
  "lo_submitted": 8750.00,
  "variance": -2.9%,
  "flags": []
}`,
                integration: `INTEGRATION POINTS:
1. OCR: Extract from paystubs/W2s
2. LoanBeam: Tax return analysis
3. Byte Income Screen: Compare/update
4. CMG Guidelines: Rule engine`
            }
        };

        let currentPromptContent = '';

        function showAgentPrompt(agentKey) {
            const agent = agentPrompts[agentKey];
            if (!agent) return;
            document.getElementById('promptModalTitle').textContent = agent.name + ' - Build Prompt';
            document.getElementById('promptTags').innerHTML = agent.tags.map(tag => '<span class="prompt-tag">' + tag + '</span>').join('');
            document.getElementById('promptPurpose').textContent = agent.purpose;
            document.getElementById('promptContent').textContent = agent.prompt;
            document.getElementById('promptIntegration').textContent = agent.integration;
            currentPromptContent = '# ' + agent.name + '\n\n## Purpose\n' + agent.purpose + '\n\n## Build Prompt\n' + agent.prompt + '\n\n## Integration Points\n' + agent.integration;
            document.getElementById('promptModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closePromptModal() {
            document.getElementById('promptModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyPromptToClipboard() {
            try {
                await navigator.clipboard.writeText(currentPromptContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy prompt.'); }
        }

        document.getElementById('promptModal').addEventListener('click', (e) => { if (e.target.id === 'promptModal') closePromptModal(); });
    </script>
</body>
</html>
