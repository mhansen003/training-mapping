<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CMG Hybrid eClosing - Process Workflow</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: #111827;
            --bg-card: #1a2234;
            --accent-blue: #3b82f6;
            --accent-teal: #14b8a6;
            --accent-amber: #f59e0b;
            --accent-rose: #f43f5e;
            --accent-green: #22c55e;
            --accent-purple: #8b5cf6;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-subtle: rgba(255,255,255,0.08);
            --sidebar-width: 280px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Breadcrumb */
        .breadcrumb {
            background: linear-gradient(90deg, #0d1525 0%, #1a2234 100%);
            padding: 14px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
            border-bottom: 1px solid var(--border-subtle);
        }

        .breadcrumb a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            transition: all 0.2s;
            border: 1px solid var(--border-subtle);
        }

        .breadcrumb a:hover {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .breadcrumb .separator { color: var(--text-muted); font-size: 1.2rem; }
        .breadcrumb .current { color: var(--accent-amber); font-weight: 600; padding: 8px 16px; }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 54px;
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - 54px);
            background: var(--bg-secondary);
            overflow-y: auto;
            z-index: 1000;
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 25px 20px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-header h2 { color: var(--text-primary); font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
        .sidebar-header p { color: var(--text-muted); font-size: 0.85rem; }

        /* Tab Switch */
        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-tab {
            flex: 1;
            padding: 14px 10px;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            background: none;
            border-left: none;
            border-right: none;
            border-top: none;
        }

        .sidebar-tab:hover { background: rgba(255,255,255,0.03); color: var(--text-secondary); }
        .sidebar-tab.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); background: rgba(59, 130, 246, 0.08); }
        .sidebar-tab.agent-tab.active { color: var(--accent-purple); border-bottom-color: var(--accent-purple); background: rgba(139, 92, 246, 0.08); }

        .sidebar-nav { padding: 15px 0; flex: 1; overflow-y: auto; }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .nav-item:hover { background: rgba(255,255,255,0.03); color: var(--text-primary); }
        .nav-item.active { background: rgba(59, 130, 246, 0.1); border-left-color: var(--accent-blue); color: var(--text-primary); }

        .nav-number {
            background: rgba(255,255,255,0.1);
            color: var(--text-secondary);
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .nav-item.active .nav-number { background: var(--accent-blue); color: white; }
        .nav-label { font-size: 0.95rem; font-weight: 500; }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-subtle);
            background: rgba(0,0,0,0.2);
        }

        .doc-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px 20px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .doc-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3); }

        /* Main Content */
        .main-content { margin-left: var(--sidebar-width); padding: 80px 40px 40px 40px; }

        /* Tab Panels */
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        .header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(20, 184, 166, 0.08) 0%, transparent 50%);
            pointer-events: none;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        .header .meta { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; position: relative; }

        .header .meta-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-subtle);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); }
        .legend-color { width: 18px; height: 18px; border-radius: 4px; }

        /* Sections */
        .section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            margin-bottom: 25px;
            overflow: hidden;
            scroll-margin-top: 75px;
        }

        .section-header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(59, 130, 246, 0.1) 100%);
            border-bottom: 1px solid var(--border-subtle);
            padding: 22px 25px;
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .section-number {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .section-title h2 { font-size: 1.35rem; font-weight: 700; margin-bottom: 4px; color: var(--text-primary); }
        .section-title span { font-size: 0.9rem; color: var(--text-muted); }
        .section-content { padding: 28px; }

        /* Workflow Diagrams */
        .workflow-diagram {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 28px;
            margin-bottom: 22px;
        }

        .flow-row { display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 12px; margin: 15px 0; }

        .flow-node {
            padding: 14px 22px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            min-width: 150px;
            border: 1px solid var(--border-subtle);
        }

        .flow-node.start { background: linear-gradient(135deg, var(--accent-green) 0%, #16a34a 100%); color: white; border-radius: 25px; border: none; }
        .flow-node.action { background: linear-gradient(135deg, var(--accent-blue) 0%, #2563eb 100%); color: white; border: none; }
        .flow-node.decision { background: linear-gradient(135deg, var(--accent-amber) 0%, #d97706 100%); color: var(--bg-primary); border: none; }
        .flow-node.input { background: var(--bg-secondary); border: 2px solid var(--accent-blue); color: var(--text-primary); }
        .flow-node.output { background: linear-gradient(135deg, var(--accent-teal) 0%, #0d9488 100%); color: white; border: none; }
        .flow-node.exception { background: linear-gradient(135deg, var(--accent-rose) 0%, #dc2626 100%); color: white; border: none; }

        .flow-arrow { color: var(--accent-blue); font-size: 1.5rem; }
        .flow-arrow.down { transform: rotate(90deg); }

        .decision-branch { display: flex; gap: 40px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
        .branch { display: flex; flex-direction: column; align-items: center; gap: 10px; }

        .branch-label {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        /* Tables */
        .field-table { width: 100%; border-collapse: collapse; margin: 18px 0; }

        .field-table th {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            padding: 14px 18px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border-subtle);
        }

        .field-table td { padding: 14px 18px; border-bottom: 1px solid var(--border-subtle); color: var(--text-secondary); }
        .field-table tr:hover { background: rgba(255,255,255,0.02); }

        .badge { display: inline-block; padding: 4px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge.required-badge { background: rgba(244, 63, 94, 0.15); color: var(--accent-rose); }
        .badge.optional-badge { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .badge.calculated-badge { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }

        /* Info Boxes */
        .exception-box, .tip-box, .info-box {
            padding: 18px 22px;
            margin: 18px 0;
            border-radius: 0 10px 10px 0;
            border-left-width: 4px;
            border-left-style: solid;
        }

        .exception-box { background: rgba(244, 63, 94, 0.08); border-color: var(--accent-rose); border: 1px solid rgba(244, 63, 94, 0.2); border-left: 4px solid var(--accent-rose); }
        .exception-box h4 { color: var(--accent-rose); margin-bottom: 10px; font-size: 1rem; }
        .exception-box p, .exception-box li { color: var(--text-secondary); }

        .tip-box { background: rgba(34, 197, 94, 0.08); border-color: var(--accent-green); border: 1px solid rgba(34, 197, 94, 0.2); border-left: 4px solid var(--accent-green); }
        .tip-box h4 { color: var(--accent-green); margin-bottom: 10px; font-size: 1rem; }
        .tip-box p, .tip-box li { color: var(--text-secondary); }

        .info-box { background: rgba(59, 130, 246, 0.08); border-color: var(--accent-blue); border: 1px solid rgba(59, 130, 246, 0.2); border-left: 4px solid var(--accent-blue); }
        .info-box h4 { color: var(--accent-blue); margin-bottom: 10px; font-size: 1rem; }
        .info-box p, .info-box li { color: var(--text-secondary); }

        /* Decision Tree */
        .decision-tree {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 22px;
            margin: 22px 0;
        }

        .decision-tree h3 { color: var(--accent-blue); margin-bottom: 18px; padding-bottom: 12px; border-bottom: 1px solid var(--border-subtle); font-size: 1.1rem; }

        .tree-node { margin-left: 20px; padding: 12px; border-left: 2px solid var(--accent-teal); position: relative; color: var(--text-secondary); }
        .tree-node::before { content: ''; position: absolute; left: -2px; top: 22px; width: 15px; height: 2px; background: var(--accent-teal); }
        .tree-node.level-1 { margin-left: 0; border-left: none; }
        .tree-node.level-1::before { display: none; }

        .tree-label { background: var(--accent-amber); color: var(--bg-primary); padding: 6px 14px; border-radius: 6px; font-weight: 700; display: inline-block; margin-bottom: 6px; font-size: 0.9rem; }

        /* Summary Grid */
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 18px; margin: 22px 0; }

        .summary-card { background: rgba(0,0,0,0.3); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 22px; text-align: center; }
        .summary-card h4 { color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9rem; }
        .summary-card .value {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .summary-card .label { font-size: 0.85rem; color: var(--text-muted); margin-top: 8px; }

        /* Role Cards */
        .role-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 22px 0; }

        .role-card { background: rgba(0,0,0,0.2); border: 1px solid var(--border-subtle); border-radius: 12px; overflow: hidden; }
        .role-card-header { background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%); color: white; padding: 18px; text-align: center; }
        .role-card-header h4 { font-size: 1.05rem; }
        .role-card-body { padding: 22px; }
        .role-card ul { list-style: none; padding: 0; }
        .role-card li { padding: 10px 0; border-bottom: 1px solid var(--border-subtle); display: flex; align-items: center; gap: 12px; color: var(--text-secondary); font-size: 0.95rem; }
        .role-card li:last-child { border-bottom: none; }
        .check-icon { color: var(--accent-green); font-weight: bold; }

        /* Quick Reference */
        .quick-ref {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
            border: 1px solid var(--border-subtle);
            padding: 28px;
            border-radius: 16px;
            margin-top: 30px;
            font-family: 'JetBrains Mono', monospace;
            scroll-margin-top: 75px;
        }

        .quick-ref h3 { color: var(--accent-amber); margin-bottom: 18px; font-family: 'Plus Jakarta Sans', sans-serif; }
        .quick-ref pre { background: rgba(0,0,0,0.4); border: 1px solid var(--border-subtle); padding: 20px; border-radius: 10px; overflow-x: auto; font-size: 0.85rem; line-height: 1.7; color: var(--text-secondary); }

        /* ====== AGENT OPPORTUNITIES STYLES ====== */
        .agent-header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .agent-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(139, 92, 246, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .agent-header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        /* Heat Map */
        .heat-map-container { margin-bottom: 35px; }
        .heat-map-title { font-size: 1.3rem; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }

        .heat-map-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .heat-item {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .heat-item:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .heat-item:active { transform: scale(0.98); }

        .heat-item::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 4px;
        }

        .heat-item.critical::before { background: linear-gradient(90deg, #ef4444, #f97316); }
        .heat-item.high::before { background: linear-gradient(90deg, #f97316, #eab308); }
        .heat-item.medium::before { background: linear-gradient(90deg, #eab308, #22c55e); }
        .heat-item.low::before { background: linear-gradient(90deg, #22c55e, #14b8a6); }

        .heat-score {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.8rem;
            font-weight: 800;
        }

        .heat-item.critical .heat-score { color: #ef4444; }
        .heat-item.high .heat-score { color: #f97316; }
        .heat-item.medium .heat-score { color: #eab308; }
        .heat-item.low .heat-score { color: #22c55e; }

        .heat-name { font-size: 1rem; font-weight: 700; color: var(--text-primary); margin-bottom: 6px; padding-right: 50px; }
        .heat-desc { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; }

        .heat-metrics { display: flex; gap: 15px; margin-top: 12px; }
        .heat-metric { font-size: 0.75rem; color: var(--text-muted); }
        .heat-metric span { color: var(--text-secondary); font-weight: 600; }

        /* Agent Cards */
        .agent-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 25px; margin-bottom: 35px; }

        .agent-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .agent-card:hover { transform: translateY(-5px); box-shadow: 0 15px 50px rgba(0,0,0,0.3); }

        .agent-card.highlight {
            animation: highlightPulse 2s ease;
            box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.4);
        }

        @keyframes highlightPulse {
            0% { box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.6); }
            50% { box-shadow: 0 0 0 6px rgba(139, 92, 246, 0.5), 0 15px 50px rgba(139, 92, 246, 0.3); }
            100% { box-shadow: 0 0 0 0px transparent, 0 15px 50px rgba(0,0,0,0.3); }
        }

        .agent-card-header {
            padding: 22px;
            display: flex;
            align-items: flex-start;
            gap: 18px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .agent-icon {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            flex-shrink: 0;
        }

        .agent-info { flex: 1; }
        .agent-name { font-size: 1.15rem; font-weight: 700; color: var(--text-primary); margin-bottom: 5px; }
        .agent-type { font-size: 0.8rem; color: var(--accent-purple); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-priority {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .agent-priority.critical { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .agent-priority.high { background: rgba(249, 115, 22, 0.15); color: #f97316; }
        .agent-priority.medium { background: rgba(234, 179, 8, 0.15); color: #eab308; }
        .agent-priority.low { background: rgba(34, 197, 94, 0.15); color: #22c55e; }

        .agent-card-body { padding: 22px; }
        .agent-description { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; }

        .agent-flow {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 20px;
        }

        .agent-flow-title { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-flow-diagram { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; justify-content: center; }

        .agent-step {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .agent-arrow { color: var(--accent-purple); font-size: 1.2rem; }

        .agent-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }

        .agent-stat {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .agent-stat-value {
            font-size: 1.3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-top: 4px; }

        /* View Prompt Button */
        .agent-prompt-btn {
            width: 100%;
            margin-top: 18px;
            padding: 14px 20px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 10px;
            color: var(--accent-purple);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .agent-prompt-btn:hover {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(59, 130, 246, 0.3) 100%);
            border-color: var(--accent-purple);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.25);
        }

        /* Summary Stats */
        .agent-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .agent-summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            padding: 25px;
            text-align: center;
        }

        .agent-summary-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-summary-label { font-size: 0.9rem; color: var(--text-muted); margin-top: 8px; }

        /* Heat Map Legend */
        .heat-legend {
            display: flex;
            gap: 25px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .heat-legend-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; color: var(--text-secondary); }
        .heat-legend-color { width: 24px; height: 24px; border-radius: 6px; }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(10, 15, 26, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.show { display: flex; }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            width: 100%;
            max-width: 950px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 80px rgba(0,0,0,0.5);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            padding: 22px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 16px 16px 0 0;
        }

        .modal-header h3 { font-size: 1.25rem; font-weight: 700; }
        .modal-actions { display: flex; gap: 12px; }

        .modal-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: transform 0.2s;
            font-size: 0.9rem;
        }

        .modal-btn:hover { transform: scale(1.05); }
        .modal-btn.copy { background: white; color: var(--accent-blue); }
        .modal-btn.close { background: rgba(255,255,255,0.2); color: white; }

        .modal-body { padding: 28px; overflow-y: auto; flex: 1; }

        .modal-body pre {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            padding: 22px;
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.7;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--text-secondary);
        }

        .copy-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--accent-green);
            color: white;
            padding: 18px 35px;
            border-radius: 10px;
            font-weight: 700;
            z-index: 3000;
            display: none;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut { 0%, 100% { opacity: 0; } 10%, 90% { opacity: 1; } }

        /* Prompt Modal */
        .prompt-modal .modal { max-width: 800px; }
        .prompt-modal .modal-header { background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%); }

        .prompt-section { margin-bottom: 25px; }
        .prompt-section h4 { color: var(--accent-purple); font-size: 1rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }

        .prompt-box {
            background: rgba(0,0,0,0.4);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.7;
            color: var(--text-secondary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .prompt-tags { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .prompt-tag { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }

        /* Step List */
        .step-list { list-style: none; padding: 0; margin: 18px 0; }
        .step-list li {
            padding: 14px 18px;
            border-left: 3px solid var(--accent-blue);
            background: rgba(0,0,0,0.2);
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
        }
        .step-list li strong { color: var(--text-primary); }

        /* Script Box */
        .script-box {
            background: rgba(139, 92, 246, 0.08);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-left: 4px solid var(--accent-purple);
            border-radius: 0 10px 10px 0;
            padding: 22px;
            margin: 20px 0;
            font-style: italic;
            color: var(--text-secondary);
            line-height: 1.8;
        }

        .script-box h4 {
            color: var(--accent-purple);
            font-style: normal;
            margin-bottom: 12px;
        }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 75px 20px 30px 20px; }
            .agent-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <a href="../../index.html">Portal Home</a>
        <span class="separator">></span>
        <a href="./index.html">Mortgage Fundamentals</a>
        <span class="separator">></span>
        <span class="current">CMG Hybrid eClosing</span>
    </nav>

    <!-- Fixed Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>eClosing Process</h2>
            <p>Interactive Workflow Guide</p>
        </div>

        <!-- Tab Switcher -->
        <div class="sidebar-tabs">
            <button class="sidebar-tab active" onclick="switchTab('workflow')">Workflow</button>
            <button class="sidebar-tab agent-tab" onclick="switchTab('agents')">AI Agents</button>
        </div>

        <!-- Workflow Navigation -->
        <nav class="sidebar-nav" id="workflow-nav">
            <a href="#section-1" class="nav-item active">
                <span class="nav-number">1</span>
                <span class="nav-label">Overview</span>
            </a>
            <a href="#section-2" class="nav-item">
                <span class="nav-number">2</span>
                <span class="nav-label">LO & Processor Steps</span>
            </a>
            <a href="#section-3" class="nav-item">
                <span class="nav-number">3</span>
                <span class="nav-label">Closer Steps (Part 1)</span>
            </a>
            <a href="#section-4" class="nav-item">
                <span class="nav-number">4</span>
                <span class="nav-label">Closer Steps (Part 2)</span>
            </a>
            <a href="#section-5" class="nav-item">
                <span class="nav-number">5</span>
                <span class="nav-label">eClosing Package</span>
            </a>
            <a href="#section-6" class="nav-item">
                <span class="nav-number">6</span>
                <span class="nav-label">Post eSigning Steps</span>
            </a>
            <a href="#section-7" class="nav-item">
                <span class="nav-number">7</span>
                <span class="nav-label">Funding Package</span>
            </a>
            <a href="#quick-ref" class="nav-item">
                <span class="nav-number">*</span>
                <span class="nav-label">Quick Reference</span>
            </a>
        </nav>

        <!-- Agent Navigation -->
        <nav class="sidebar-nav" id="agents-nav" style="display: none;">
            <a href="#agent-summary" class="nav-item active">
                <span class="nav-number">S</span>
                <span class="nav-label">Summary</span>
            </a>
            <a href="#agent-heatmap" class="nav-item">
                <span class="nav-number">H</span>
                <span class="nav-label">Heat Map</span>
            </a>
            <a href="#agent-details" class="nav-item">
                <span class="nav-number">A</span>
                <span class="nav-label">Agent Details</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="doc-btn" onclick="openDocModal()">
                View Workflow Markdown
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

        <!-- ==================== WORKFLOW TAB ==================== -->
        <div id="workflow-panel" class="tab-panel active">
            <!-- Header -->
            <div class="header">
                <h1>CMG Hybrid eClosing</h1>
                <p class="subtitle">Complete guide for executing mortgage loan closings electronically through a hybrid wet/eSigned document process</p>
                <div class="meta">
                    <span class="meta-item">System: Byte LOS / IDS</span>
                    <span class="meta-item">Roles: LO, Processor, Closer, Closing Agent, Funder</span>
                    <span class="meta-item">Doc: RET226/042220</span>
                    <span class="meta-item">Type: Hybrid eClosing</span>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #22c55e, #16a34a);"></div><span>Start/End</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></div><span>Action Step</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></div><span>Decision Point</span></div>
                <div class="legend-item"><div class="legend-color" style="background: #111827; border: 2px solid #3b82f6;"></div><span>User Input</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f43f5e, #dc2626);"></div><span>Exception</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #14b8a6, #0d9488);"></div><span>Output</span></div>
            </div>

            <!-- Section 1: Overview -->
            <section id="section-1" class="section">
                <div class="section-header">
                    <div class="section-number">1</div>
                    <div class="section-title"><h2>eClosing Overview</h2><span>Understanding the CMG Hybrid eClosing process and key participants</span></div>
                </div>
                <div class="section-content">
                    <div class="info-box">
                        <h4>What is an eClosing?</h4>
                        <p>An eClosing is the act of closing a mortgage loan electronically. This occurs through a secure digital environment where some or all of the closing documents are executed and accessed electronically. eClosing can streamline the closing process for Borrowers and Closing Agents.</p>
                    </div>

                    <div class="exception-box">
                        <h4>CMG Hybrid eClosing Only</h4>
                        <p><strong>Currently CMG allows Hybrid eClosing only.</strong> This is a combination of wet and eSigned documentation by the Borrower. Communication is a key part of making the process a success.</p>
                    </div>

                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Sales</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Processing</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Closing</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Closing Agent</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Funding</div>
                        </div>
                    </div>

                    <div class="summary-grid">
                        <div class="summary-card">
                            <h4>View Only Link</h4>
                            <div class="value">Pre</div>
                            <div class="label">Before Closing Date</div>
                        </div>
                        <div class="summary-card">
                            <h4>eSign Link Active</h4>
                            <div class="value">12AM</div>
                            <div class="label">Hawaii Time on Closing Day</div>
                        </div>
                        <div class="summary-card">
                            <h4>Signing Window</h4>
                            <div class="value">1 Day</div>
                            <div class="label">Closing Date Only</div>
                        </div>
                        <div class="summary-card">
                            <h4>Document Access</h4>
                            <div class="value">View</div>
                            <div class="label">Anytime Before/After</div>
                        </div>
                    </div>

                    <div class="tip-box">
                        <h4>Key Timing Rules</h4>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>Borrower reviews full closing package <strong>prior to closing date</strong></li>
                            <li>Closing package link becomes active for signing at <strong>midnight Hawaii time</strong> on the day of closing</li>
                            <li>Link is active for signing <strong>only on the closing date</strong></li>
                            <li>The Borrower can view their closing documents anytime before or after the closing date</li>
                        </ul>
                    </div>

                    <!-- Role Responsibilities -->
                    <h3 style="color: var(--text-primary); margin: 25px 0 15px;">Role Responsibilities</h3>
                    <div class="role-cards">
                        <div class="role-card">
                            <div class="role-card-header"><h4>Sales (LO)</h4></div>
                            <div class="role-card-body">
                                <ul>
                                    <li><span class="check-icon">+</span> Speaks with Borrower, sets expectations</li>
                                    <li><span class="check-icon">+</span> Provides IDS sign up instructions at CTC</li>
                                </ul>
                            </div>
                        </div>
                        <div class="role-card">
                            <div class="role-card-header"><h4>Processing</h4></div>
                            <div class="role-card-body">
                                <ul>
                                    <li><span class="check-icon">+</span> Speaks with Borrower, sets expectations</li>
                                    <li><span class="check-icon">+</span> Orders title, sets expectations with Closing Agent</li>
                                    <li><span class="check-icon">+</span> Checks eClosing box in Byte</li>
                                </ul>
                            </div>
                        </div>
                        <div class="role-card">
                            <div class="role-card-header"><h4>Closing</h4></div>
                            <div class="role-card-body">
                                <ul>
                                    <li><span class="check-icon">+</span> Speaks with Closing Agent, sets expectations</li>
                                    <li><span class="check-icon">+</span> Sends eClosing package to Borrower for review</li>
                                    <li><span class="check-icon">+</span> Sends full package to Closing Agent</li>
                                </ul>
                            </div>
                        </div>
                        <div class="role-card">
                            <div class="role-card-header"><h4>Closing Agent</h4></div>
                            <div class="role-card-body">
                                <ul>
                                    <li><span class="check-icon">+</span> Speaks with Borrower, schedules notary</li>
                                    <li><span class="check-icon">+</span> Receives full package, prints wet/notarized docs</li>
                                    <li><span class="check-icon">+</span> Completes wet signing, scans to CMG</li>
                                </ul>
                            </div>
                        </div>
                        <div class="role-card">
                            <div class="role-card-header"><h4>Funding</h4></div>
                            <div class="role-card-body">
                                <ul>
                                    <li><span class="check-icon">+</span> Downloads package from IDS Fulfillment</li>
                                    <li><span class="check-icon">+</span> Reviews for completeness</li>
                                    <li><span class="check-icon">+</span> Contacts Closing Agent for corrections</li>
                                    <li><span class="check-icon">+</span> Ships file as normal</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 2: Loan Officer & Processor Steps -->
            <section id="section-2" class="section">
                <div class="section-header">
                    <div class="section-number">2</div>
                    <div class="section-title"><h2>Loan Officer & Processor Steps</h2><span>Initial setup and communication for eClosing</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Borrower Requests eClosing</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Open Loan in Byte</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Open Retail CD Request Screen</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Check eClosing Box</div>
                        </div>
                    </div>

                    <div class="decision-tree">
                        <h3>Step 1: Update Loan File in Byte</h3>
                        <ul class="step-list">
                            <li><strong>Step 1a:</strong> Once notified the Borrower wants an eClosing, open the loan file in <strong>Byte</strong></li>
                            <li><strong>Step 1b:</strong> Open the <strong>Retail CD Request Screen</strong></li>
                            <li><strong>Step 1c:</strong> Click the <strong>eClosing checkbox</strong></li>
                            <li><strong>Step 1d:</strong> Add any relevant notes to the Closer regarding the Borrower or Closing Agent</li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Step 2: Communicate eClosing Expectations</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 15px;">Loan Officer or Processor must communicate eClosing expectations with the Borrower. It is important to set the expectation with the Borrower and Closing Agent they <strong>cannot sign closing documents until the day of closing</strong>.</p>
                        <ul class="step-list">
                            <li><strong>Borrower:</strong> Receives a view only link with documents prior to closing</li>
                            <li><strong>Closing Agent:</strong> Receives a separate link with the full closing package to print wet sign documents</li>
                            <li><strong>Closing Agent:</strong> Prepares wet sign documents for the Borrower notary appointment</li>
                        </ul>
                    </div>

                    <div class="info-box">
                        <h4>IDS Account Note</h4>
                        <p>This process is slightly different than the LE/CD process as a <strong>new IDS Borrower account</strong> is created at the start of the process. The Borrower eSign process is located on SharePoint.</p>
                    </div>

                    <div class="script-box">
                        <h4>Borrower Communication Script</h4>
                        "In an effort to assist with social distancing and reduce the spread of COVID-19 but also close your loan on time, you are eligible to participate in our <strong>Hybrid eClosing Process</strong>. To participate in this process, you will be delivered your closing package through our electronic signing process. The process is similar as signing all of the disclosures that you have already esigned through your mortgage transaction.<br><br>
                        You'll receive a link from <strong>notifications@idsdocs.com</strong> that is view only to review all of your closing documents. It becomes an esign link at midnight Hawaii time on the day of your closing to allow you to esign documents that allow for electronic signature.<br><br>
                        <strong>The esigned documents must be signed on the same day that you will be live signing the note and mortgage with the Settlement Agent/Title Company. Please esign these documents as early as possible on the morning of your closing.</strong><br><br>
                        Some documents are just for review and must be wet signed. Once your esigned documents are processed, the remaining documents to complete your closing will be delivered to the Settlement Agent/Title Company for you to meet and sign in person. The live signing process should only take a few moments due to the limited documents that need to be signed in front of a notary. This will help to limit exposure to others. Your health and safety is our priority."
                    </div>
                </div>
            </section>

            <!-- Section 3: Closer Steps Part 1 -->
            <section id="section-3" class="section">
                <div class="section-header">
                    <div class="section-number">3</div>
                    <div class="section-title"><h2>Closer Steps (Part 1)</h2><span>Pipeline review and closing agent communication</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Review Pipeline for eClosing</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Prepare Loan File</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Instruct Closing Agent</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Open Doc Prep Screen</div>
                        </div>
                    </div>

                    <div class="decision-tree">
                        <h3>Step 1: Prepare and Communicate</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 15px;">Closers review pipelines for eClosing and prepare the loan file for closing documents as normal in Byte.</p>
                        <ul class="step-list">
                            <li><strong>When completing the wire confirmation call</strong> - Instruct closing agent this is an eClosing</li>
                            <li><strong>When email balancing the CD</strong> - Instruct closing agent this is an eClosing</li>
                            <li><strong>Emailing through Outlook when the closing package is released</strong> - Instruct closing agent this is an eClosing</li>
                        </ul>
                    </div>

                    <div class="script-box">
                        <h4>Closing Agent Communication Script</h4>
                        "In an effort to assist with social distancing and reduce the spread of COVID-19 but also close on time, the <strong>[Borrower Name]</strong> is eligible to participate in our Hybrid EClosing Process.<br><br>
                        The <strong>[Borrower Name]</strong> will receive a link of all documents that are eligible to be esigned on the day of closing, with view only access to documents requiring notarization and/or wet signature. You (title company) will receive a link of the complete closing package for review.<br><br>
                        The live signing process should only take a few moments due to the limited documents that need to be signed in front of a notary. This will help to limit exposure to others. Your health and safety is our priority."
                    </div>

                    <div class="decision-tree">
                        <h3>Step 2: Submit Closing Documents</h3>
                        <ul class="step-list">
                            <li><strong>Step 2a:</strong> Open the <strong>Document Preparation Screen</strong> in Byte</li>
                            <li><strong>Step 2b:</strong> Choose <strong>Closing</strong> from the Package Type drop-down</li>
                            <li><strong>Step 2c:</strong> Click <strong>Just Submit; I am Not Disclosing</strong> as normal</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 4: Closer Steps Part 2 -->
            <section id="section-4" class="section">
                <div class="section-header">
                    <div class="section-number">4</div>
                    <div class="section-title"><h2>Closer Steps (Part 2)</h2><span>Sending full package to Closing Agent</span></div>
                </div>
                <div class="section-content">
                    <div class="exception-box">
                        <h4>Important: Send Full Package First</h4>
                        <p>The Closing Agent must be sent the <strong>full package prior to the eClosing package</strong> to include any wet sign documents for printing. This is sent prior to the closing date for preparation of documents for the Closing Agent.</p>
                    </div>

                    <div class="decision-tree">
                        <h3>Step 3: Order Documents for Closing Agent</h3>
                        <ul class="step-list">
                            <li><strong>Package Type:</strong> Closing</li>
                            <li><strong>Notary Signing Method:</strong> Ink Sign</li>
                            <li><strong>Note Type:</strong> Ink Sign Note</li>
                            <li><strong>Send To Fulfillment:</strong> Do NOT check</li>
                            <li><strong>Fulfillment Delivery:</strong> Do NOT choose</li>
                            <li><strong>Click:</strong> Order Docs</li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Step 4: Review Closing Package PDF</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 15px;">Click the PDF closing package link to review for any notarized documents and alert the Closing Agent of documents requiring notarization and/or wet signature.</p>
                    </div>

                    <h3 style="color: var(--text-primary); margin: 25px 0 15px;">Documents to Include for Closing Agent</h3>
                    <div class="info-box">
                        <h4>Document List (Varies by State/Program)</h4>
                        <p>Review the closing package to confirm any documents to be included in the list to the Closing Agent:</p>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Document</th>
                                <th>Type</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Cover Funding Sheet/Post Closing Instructions</strong></td>
                                <td><span class="badge required-badge">Required</span></td>
                                <td>Standard inclusion</td>
                            </tr>
                            <tr>
                                <td><strong>PTF Documents</strong></td>
                                <td><span class="badge optional-badge">If Applicable</span></td>
                                <td>Including Tax Returns and Letter of Explanations</td>
                            </tr>
                            <tr>
                                <td><strong>Insurance</strong></td>
                                <td><span class="badge required-badge">Required</span></td>
                                <td>Standard inclusion</td>
                            </tr>
                            <tr>
                                <td><strong>VA or FHA Documents</strong></td>
                                <td><span class="badge optional-badge">If Applicable</span></td>
                                <td>For seller signature if applicable</td>
                            </tr>
                            <tr>
                                <td><strong>Closing Instructions</strong></td>
                                <td><span class="badge required-badge">Required</span></td>
                                <td>Standard inclusion</td>
                            </tr>
                            <tr>
                                <td><strong>Closing Disclosure</strong></td>
                                <td><span class="badge required-badge">Required</span></td>
                                <td>Standard inclusion</td>
                            </tr>
                            <tr>
                                <td><strong>Mailing Address Certification</strong></td>
                                <td><span class="badge required-badge">Required</span></td>
                                <td>Standard inclusion</td>
                            </tr>
                            <tr>
                                <td><strong>Patriot Act</strong></td>
                                <td><span class="badge required-badge">Required</span></td>
                                <td>Completed by Closing Agent</td>
                            </tr>
                            <tr>
                                <td><strong>Settlement Agent's Tax Information Sheet</strong></td>
                                <td><span class="badge required-badge">Required</span></td>
                                <td>Completed by Closing Agent</td>
                            </tr>
                            <tr>
                                <td><strong>Security Instrument and Riders</strong></td>
                                <td><span class="badge required-badge">Notarized</span></td>
                                <td>Requires notarization</td>
                            </tr>
                            <tr>
                                <td><strong>Compliance Agreement/Errors and Omissions</strong></td>
                                <td><span class="badge required-badge">Notarized</span></td>
                                <td>Requires notarization</td>
                            </tr>
                            <tr>
                                <td><strong>Occupancy Statement</strong></td>
                                <td><span class="badge required-badge">Notarized</span></td>
                                <td>Requires notarization</td>
                            </tr>
                            <tr>
                                <td><strong>Signature Affidavit and AKA Statement</strong></td>
                                <td><span class="badge required-badge">Notarized</span></td>
                                <td>Requires notarization</td>
                            </tr>
                            <tr>
                                <td><strong>Lien Letter</strong></td>
                                <td><span class="badge optional-badge">If Applicable</span></td>
                                <td>Completed by Closing Agent if applicable</td>
                            </tr>
                            <tr>
                                <td><strong>SSA 89</strong></td>
                                <td><span class="badge required-badge">Wet Sign</span></td>
                                <td>NOT able to sign in eClosing</td>
                            </tr>
                            <tr>
                                <td><strong>Note and Addendums</strong></td>
                                <td><span class="badge required-badge">Wet Sign</span></td>
                                <td>Requires wet signature</td>
                            </tr>
                            <tr>
                                <td><strong>Right to Cancel</strong></td>
                                <td><span class="badge optional-badge">If Applicable</span></td>
                                <td>If applicable to loan type</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="decision-tree">
                        <h3>Step 5: Add PTF Docs to Package</h3>
                        <ul class="step-list">
                            <li>Add any additional PTF Docs to the Closing Package link using <strong>Options -> Modify</strong> as normal</li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Step 6: Send Full Package Email</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 15px;">Send full package email to Closing Agent, Loan Officer, Processor and Production Assistant as normal. Include email instructions detailing eClosing steps for the Closing Agent.</p>
                    </div>

                    <div class="script-box">
                        <h4>Full Package Email to Closing Agent</h4>
                        "Below is the link for the <strong>[Borrower]</strong> closing. This is a Hybrid eClosing and you are receiving the full document package for review and printing of any wet signed documents requiring notarization and/or wet signature as well as Closing Agent documents for your review and signature.<br><br>
                        The Borrower will receive their package on the day of closing. <strong>They cannot sign prior or after the closing date.</strong><br><br>
                        Please review the package and coordinate signing with the Borrower for the wet and/or notarized documents.<br><br>
                        <strong>The wet signed package can be returned:</strong><br>
                        CMG Mortgage, Inc. Retail Closing Department<br>
                        3160 Crow Canyon Road, Suite 400<br>
                        San Ramon, CA 94583<br><br>
                        <strong>The scanned package can be returned:</strong><br>
                        [Closing email package return address]"
                    </div>
                </div>
            </section>

            <!-- Section 5: eClosing Package -->
            <section id="section-5" class="section">
                <div class="section-header">
                    <div class="section-number">5</div>
                    <div class="section-title"><h2>eClosing Package to Borrower</h2><span>Sending the eClosing package via IDS</span></div>
                </div>
                <div class="section-content">
                    <div class="exception-box">
                        <h4>Borrower Cannot Pre-Sign</h4>
                        <p>The Borrower cannot pre-sign documents. IDS sends the Borrower a read only link that converts to an esign link on <strong>midnight of the day of closing</strong>.</p>
                    </div>

                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Return to Doc Prep Screen</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Choose Closing</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Submit and Flag as Disclosed</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Order Docs</div>
                        </div>
                    </div>

                    <div class="decision-tree">
                        <h3>Step 7: Configure IDS Browser Settings</h3>
                        <ul class="step-list">
                            <li><strong>Package Type:</strong> Closing</li>
                            <li><strong>Notary Signing Method:</strong> Ink Sign</li>
                            <li><strong>Note Type:</strong> Ink Sign Note</li>
                            <li><strong>Send to Fulfillment When Docs Ordered:</strong> Checkbox (checked)</li>
                            <li><strong>Fulfillment Delivery:</strong> eDisclosure</li>
                            <li><strong>EDisclosure Method:</strong> eSign</li>
                        </ul>
                    </div>

                    <div class="info-box">
                        <h4>IDS Document Restrictions</h4>
                        <p>The Borrower will receive the full closing package for review of documentation. <strong>IDS does not allow signature of notarized documents or the Note.</strong></p>
                    </div>

                    <div class="decision-tree">
                        <h3>Step 8: Order Documents</h3>
                        <ul class="step-list">
                            <li>Click <strong>Order Docs</strong></li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Step 9: Confirm Package Sent</h3>
                        <ul class="step-list">
                            <li>The <strong>eDisclosure symbol</strong> appears once the package is sent to all parties</li>
                            <li>This can take up to <strong>20 seconds</strong></li>
                        </ul>
                    </div>

                    <div class="tip-box">
                        <h4>Email Notifications</h4>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>The <strong>Loan Officer, Processor, and Closer</strong> receive an email from IDS with a link to the eSign room (similar to eSign room for LE/CD)</li>
                            <li>The <strong>Borrower</strong> receives a separate email which begins the eSign review process</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 6: Post eSigning Steps -->
            <section id="section-6" class="section">
                <div class="section-header">
                    <div class="section-number">6</div>
                    <div class="section-title"><h2>Post eSigning Steps</h2><span>Processing wet signed documents and IDS download</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Closing Agent Emails Wet Docs</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Upload to Stored Docs</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Funder Logs into IDS</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Download Package</div>
                        </div>
                    </div>

                    <div class="decision-tree">
                        <h3>Step 1: Receive Wet Signed Documents</h3>
                        <ul class="step-list">
                            <li>Closing Agent emails wet signed documents to the Closer or regional email address</li>
                            <li>Closers upload any documents to Stored Documents as <strong>Unsigned Docs</strong> or email to the assigned Funder</li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Step 2: Funder/Funding Assistant Downloads Package</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 15px;">Funders/Funding Assistants monitor the Retail Funder pipeline daily for eClosings. When eClosing is noted on the pipeline:</p>
                        <ul class="step-list">
                            <li>Log into IDS @ <strong>https://fulfillment.idsdoc.com/</strong></li>
                            <li><strong>Search</strong> by Loan Number</li>
                            <li><strong>Locate</strong> the Closing package and click the <strong>plus sign</strong> to expand</li>
                            <li>Click the <strong>plus sign</strong> to open the Closing package</li>
                            <li>Click <strong>Download Package</strong></li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Step 3: Extract ZIP File</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 15px;">The document package downloads as a ZIP file which cannot be added to Stored Documents directly.</p>
                        <ul class="step-list">
                            <li><strong>Open</strong> the ZIP file on the bottom of your browser window</li>
                            <li>Click <strong>Extract All</strong></li>
                            <li>Click <strong>Browse</strong> and choose your desktop shipping folder</li>
                            <li><strong>Add</strong> a new Borrower folder if needed at this time</li>
                            <li>Click <strong>Extract</strong></li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 7: Funding Package -->
            <section id="section-7" class="section">
                <div class="section-header">
                    <div class="section-number">7</div>
                    <div class="section-title"><h2>Create Funding Package</h2><span>Combining documents for the Pre-Funding Package</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Open First Document</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Create -> Combine Files</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Add All Files</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Save as Prefunding Package</div>
                        </div>
                    </div>

                    <div class="decision-tree">
                        <h3>Step 4: Open and Prepare to Combine</h3>
                        <ul class="step-list">
                            <li><strong>Open</strong> the first document in the Borrower shipping folder</li>
                            <li>Click <strong>Create</strong> then <strong>Combine Files into a Single PDF...</strong></li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Step 5: Add and Combine Files</h3>
                        <ul class="step-list">
                            <li>Click <strong>Add Files...</strong> then <strong>Add Files</strong> again</li>
                            <li>Use the <strong>mouse and shift key</strong> to highlight all the documents in the Borrower shipping folder</li>
                            <li>Click <strong>Open</strong></li>
                            <li>Click <strong>Combine Files</strong></li>
                            <li>Click <strong>Save</strong> and name the file <strong>Prefunding Funding Package</strong></li>
                            <li><strong>Close</strong> out of all open PDFs</li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Step 6: Add Title Documents and Store</h3>
                        <ul class="step-list">
                            <li>Once received, <strong>add title wet signed documents</strong> to the Pre Funding Package</li>
                            <li><strong>Store</strong> in Byte as <strong>Approved Funding Package</strong></li>
                        </ul>
                    </div>

                    <div class="tip-box">
                        <h4>Process Complete</h4>
                        <p>The eClosing process is now complete. The loan can proceed through normal funding and shipping procedures.</p>
                    </div>
                </div>
            </section>

            <!-- Quick Reference -->
            <div id="quick-ref" class="quick-ref">
                <h3>eClosing Quick Reference</h3>
                <pre>
CMG HYBRID eCLOSING SUMMARY
===========================

WHAT IS HYBRID eCLOSING?
- Combination of wet and eSigned documentation
- Borrower reviews docs electronically, signs some online
- Note and notarized docs still require wet signature

KEY TIMING
==========
- View-only link: Available BEFORE closing date
- eSign link active: Midnight Hawaii time on closing day
- Signing window: Closing date ONLY
- Document access: Anytime before/after closing

ROLE CHECKLIST
==============

LOAN OFFICER / PROCESSOR:
[ ] Speak with Borrower, set expectations
[ ] Provide IDS sign-up instructions at CTC
[ ] Open loan in Byte
[ ] Open Retail CD Request Screen
[ ] Check eClosing checkbox
[ ] Add notes to Closer

CLOSER:
[ ] Review pipeline for eClosing
[ ] Instruct Closing Agent (wire call, CD email, package release)
[ ] Order Closing docs (Ink Sign, Ink Sign Note)
[ ] Send full package to Closing Agent
[ ] Add PTF docs via Options -> Modify
[ ] Send email with eClosing instructions
[ ] Order eClosing package (eDisclosure/eSign)
[ ] Verify eDisclosure symbol appears

CLOSING AGENT:
[ ] Receive full package
[ ] Print wet/notarized documents
[ ] Schedule notary with Borrower
[ ] Complete wet signing
[ ] Scan package to CMG

FUNDER:
[ ] Monitor pipeline for eClosing
[ ] Log into IDS Fulfillment
[ ] Search by Loan Number
[ ] Download package
[ ] Extract ZIP to shipping folder
[ ] Combine files into Prefunding Package
[ ] Add title wet signed docs
[ ] Store as Approved Funding Package

IDS SETTINGS FOR eCLOSING PACKAGE
=================================
Package Type: Closing
Notary Signing Method: Ink Sign
Note Type: Ink Sign Note
Send to Fulfillment: CHECKED
Fulfillment Delivery: eDisclosure
EDisclosure Method: eSign

DOCUMENTS REQUIRING WET/NOTARIZED SIGNATURE
==========================================
- Security Instrument and Riders (notarized)
- Compliance Agreement/Errors and Omissions (notarized)
- Occupancy Statement (notarized)
- Signature Affidavit and AKA Statement (notarized)
- SSA 89 (wet sign only - NOT in eClosing)
- Note and Addendums (wet sign)

RETURN ADDRESSES
================
Physical: CMG Mortgage, Inc.
          Retail Closing Department
          3160 Crow Canyon Road, Suite 400
          San Ramon, CA 94583

Scanned: Regional closing email address

IDS FULFILLMENT URL
===================
https://fulfillment.idsdoc.com/
                </pre>
            </div>
        </div>

        <!-- ==================== AI AGENTS TAB ==================== -->
        <div id="agents-panel" class="tab-panel">
            <!-- Agent Header -->
            <div class="agent-header">
                <h1>AI Agent Opportunities</h1>
                <p class="subtitle">Automation opportunities identified for the CMG Hybrid eClosing process</p>
            </div>

            <!-- Summary Stats -->
            <div class="agent-summary" id="agent-summary">
                <div class="agent-summary-card">
                    <div class="agent-summary-value">5</div>
                    <div class="agent-summary-label">Agent Opportunities</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">65%</div>
                    <div class="agent-summary-label">Automation Potential</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">25 min</div>
                    <div class="agent-summary-label">Est. Time Saved</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">High</div>
                    <div class="agent-summary-label">Process Impact</div>
                </div>
            </div>

            <!-- Heat Map Legend -->
            <div class="heat-legend">
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #ef4444, #f97316);"></div>
                    <span>Critical Priority (9-10)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #f97316, #eab308);"></div>
                    <span>High Priority (7-8)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #eab308, #22c55e);"></div>
                    <span>Medium Priority (5-6)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #22c55e, #14b8a6);"></div>
                    <span>Low Priority (1-4)</span>
                </div>
            </div>

            <!-- Heat Map Grid -->
            <div class="heat-map-container" id="agent-heatmap">
                <div class="heat-map-title">Priority Heat Map</div>
                <div class="heat-map-grid">
                    <div class="heat-item critical" onclick="scrollToAgent('agent-docrouter')">
                        <div class="heat-score">9.1</div>
                        <div class="heat-name">Document Router Agent</div>
                        <div class="heat-desc">Auto-route wet vs eSign docs based on state/program</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>10 min</span></div>
                            <div class="heat-metric">Complexity: <span>Medium</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-emailgen')">
                        <div class="heat-score">8.3</div>
                        <div class="heat-name">Email Generator Agent</div>
                        <div class="heat-desc">Auto-generate borrower and closing agent scripts</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>5 min</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-pdfcombine')">
                        <div class="heat-score">7.8</div>
                        <div class="heat-name">PDF Combine Agent</div>
                        <div class="heat-desc">Auto-combine downloaded IDS files into funding package</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>5 min</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                    <div class="heat-item medium" onclick="scrollToAgent('agent-statusmonitor')">
                        <div class="heat-score">6.5</div>
                        <div class="heat-name">Status Monitor Agent</div>
                        <div class="heat-desc">Track eSign status and alert on pending signatures</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>N/A</span></div>
                            <div class="heat-metric">Complexity: <span>Medium</span></div>
                        </div>
                    </div>
                    <div class="heat-item medium" onclick="scrollToAgent('agent-checklistvalidator')">
                        <div class="heat-score">5.9</div>
                        <div class="heat-name">Checklist Validator</div>
                        <div class="heat-desc">Verify all eClosing requirements are met before sending</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>5 min</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agent Details -->
            <div id="agent-details">
                <h2 style="color: var(--text-primary); margin-bottom: 25px; font-size: 1.5rem;">Agent Details</h2>
                <div class="agent-grid">
                    <!-- Document Router Agent -->
                    <div class="agent-card" id="agent-docrouter">
                        <div class="agent-card-header">
                            <div class="agent-icon">R</div>
                            <div class="agent-info">
                                <div class="agent-name">Document Router Agent</div>
                                <div class="agent-type">Document Classification / Rules Engine</div>
                            </div>
                            <span class="agent-priority critical">Critical</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Automatically analyzes the closing package and routes documents to the appropriate signing method (eSign vs wet/notarized) based on state regulations, loan program, and document type. Generates the document list for the Closing Agent automatically.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Analyze Package</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Check State Rules</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Classify Docs</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Generate List</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">10 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">98%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Med</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('docrouter')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Email Generator Agent -->
                    <div class="agent-card" id="agent-emailgen">
                        <div class="agent-card-header">
                            <div class="agent-icon">E</div>
                            <div class="agent-info">
                                <div class="agent-name">Email Generator Agent</div>
                                <div class="agent-type">Content Generation / Template Engine</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Automatically generates personalized communication scripts for borrowers and closing agents. Populates borrower names, closing dates, and return addresses. Ensures consistent messaging across all eClosing communications.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Read Loan Data</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Select Template</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Merge Fields</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Generate Email</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">5 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">99%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('emailgen')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- PDF Combine Agent -->
                    <div class="agent-card" id="agent-pdfcombine">
                        <div class="agent-card-header">
                            <div class="agent-icon">P</div>
                            <div class="agent-info">
                                <div class="agent-name">PDF Combine Agent</div>
                                <div class="agent-type">Document Processing / Automation</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Automatically monitors the download folder for IDS ZIP files, extracts contents, combines all PDFs in the correct order, and creates the Prefunding Funding Package. Eliminates manual Adobe Acrobat steps.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Detect ZIP</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Extract Files</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Order & Combine</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Save Package</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">5 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">100%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('pdfcombine')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Status Monitor Agent -->
                    <div class="agent-card" id="agent-statusmonitor">
                        <div class="agent-card-header">
                            <div class="agent-icon">S</div>
                            <div class="agent-info">
                                <div class="agent-name">Status Monitor Agent</div>
                                <div class="agent-type">Monitoring / Notifications</div>
                            </div>
                            <span class="agent-priority medium">Medium</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Monitors IDS eSign room for document signing status. Alerts processors when borrowers have not signed by a specified time on closing day. Tracks Closing Agent package receipt and wet document return.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Poll IDS API</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Check Status</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Evaluate Rules</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Send Alerts</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">N/A</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">95%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Med</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('statusmonitor')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Checklist Validator Agent -->
                    <div class="agent-card" id="agent-checklistvalidator">
                        <div class="agent-card-header">
                            <div class="agent-icon">C</div>
                            <div class="agent-info">
                                <div class="agent-name">Checklist Validator</div>
                                <div class="agent-type">Quality Assurance / Validation</div>
                            </div>
                            <span class="agent-priority medium">Medium</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Validates all eClosing prerequisites before package submission. Checks that eClosing box is checked, IDS settings are correct, all required documents are included, and communication scripts have been sent.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Read Loan</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Check Settings</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Validate Docs</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Report Status</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">5 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">99%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('checklistvalidator')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Documentation Modal -->
    <div class="modal-overlay" id="docModal">
        <div class="modal">
            <div class="modal-header">
                <h3>eClosing Workflow Documentation</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyToClipboard()">Copy</button>
                    <button class="modal-btn close" onclick="closeDocModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <pre id="docContent"># CMG Hybrid eClosing - Process Workflow

## Overview
An eClosing is the act of closing a mortgage loan electronically through a secure digital environment. CMG currently allows Hybrid eClosing only - a combination of wet and eSigned documentation.

## Key Timing Rules
- View-only link available BEFORE closing date
- eSign link activates at midnight Hawaii time on closing day
- Signing window is closing date ONLY
- Document access available anytime before/after

## Loan Officer & Processor Steps
1. Open loan file in Byte
2. Open Retail CD Request Screen
3. Check eClosing checkbox
4. Add notes for Closer
5. Communicate expectations with Borrower

## Closer Steps
1. Review pipeline for eClosing loans
2. Instruct Closing Agent (wire call, CD email, package release)
3. Order Closing docs (Ink Sign, Ink Sign Note)
4. Send full package to Closing Agent
5. Add PTF docs via Options -> Modify
6. Send email with eClosing instructions
7. Order eClosing package (eDisclosure/eSign)
8. Verify eDisclosure symbol appears

## IDS Settings for eClosing Package
- Package Type: Closing
- Notary Signing Method: Ink Sign
- Note Type: Ink Sign Note
- Send to Fulfillment: CHECKED
- Fulfillment Delivery: eDisclosure
- EDisclosure Method: eSign

## Post eSigning Steps
1. Closing Agent emails wet signed docs
2. Upload to Stored Documents as Unsigned Docs
3. Funder logs into IDS Fulfillment
4. Download and extract ZIP package
5. Combine files into Prefunding Package
6. Add title wet signed docs
7. Store as Approved Funding Package

## Documents Requiring Wet/Notarized Signature
- Security Instrument and Riders (notarized)
- Compliance Agreement/Errors and Omissions (notarized)
- Occupancy Statement (notarized)
- Signature Affidavit and AKA Statement (notarized)
- SSA 89 (wet sign only)
- Note and Addendums (wet sign)</pre>
            </div>
        </div>
    </div>

    <!-- AI Prompt Modal -->
    <div class="modal-overlay prompt-modal" id="promptModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="promptModalTitle">AI Agent Build Prompt</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyPromptToClipboard()">Copy Prompt</button>
                    <button class="modal-btn close" onclick="closePromptModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="prompt-tags" id="promptTags"></div>
                <div class="prompt-section">
                    <h4>Agent Purpose</h4>
                    <div class="prompt-box" id="promptPurpose"></div>
                </div>
                <div class="prompt-section">
                    <h4>Full Build Prompt</h4>
                    <div class="prompt-box" id="promptContent"></div>
                </div>
                <div class="prompt-section">
                    <h4>Integration Points</h4>
                    <div class="prompt-box" id="promptIntegration"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="copy-success" id="copySuccess">Copied to clipboard!</div>

    <script>
        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));

            if (tab === 'workflow') {
                document.querySelector('.sidebar-tab:not(.agent-tab)').classList.add('active');
                document.getElementById('workflow-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'block';
                document.getElementById('agents-nav').style.display = 'none';
            } else {
                document.querySelector('.sidebar-tab.agent-tab').classList.add('active');
                document.getElementById('agents-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'none';
                document.getElementById('agents-nav').style.display = 'block';
            }

            window.scrollTo(0, 0);
        }

        // Scroll spy with isScrolling flag and 1000ms timeout
        const sections = document.querySelectorAll('.section, .quick-ref');
        const navItems = document.querySelectorAll('#workflow-nav .nav-item');
        let isScrolling = false;
        let scrollTimeout;

        function updateActiveNav() {
            if (isScrolling) return;

            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                if (window.scrollY >= sectionTop) current = section.getAttribute('id');
            });
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + current) item.classList.add('active');
            });
        }

        // Handle nav click to temporarily disable scroll spy
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                isScrolling = true;
                clearTimeout(scrollTimeout);

                // Remove active from all, add to clicked
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');

                // Re-enable scroll spy after 1000ms
                scrollTimeout = setTimeout(() => {
                    isScrolling = false;
                }, 1000);
            });
        });

        window.addEventListener('scroll', updateActiveNav);

        // Modal
        function openDocModal() {
            document.getElementById('docModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeDocModal() {
            document.getElementById('docModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyToClipboard() {
            try {
                await navigator.clipboard.writeText(document.getElementById('docContent').textContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeDocModal(); closePromptModal(); } });
        document.getElementById('docModal').addEventListener('click', (e) => { if (e.target.id === 'docModal') closeDocModal(); });

        document.addEventListener('DOMContentLoaded', () => { updateActiveNav(); });

        // Scroll to agent card and highlight
        function scrollToAgent(agentId) {
            const agentCard = document.getElementById(agentId);
            if (agentCard) {
                document.querySelectorAll('.agent-card.highlight').forEach(card => {
                    card.classList.remove('highlight');
                });

                agentCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

                setTimeout(() => {
                    agentCard.classList.add('highlight');
                }, 300);

                setTimeout(() => {
                    agentCard.classList.remove('highlight');
                }, 2500);
            }
        }

        // Agent Prompt System
        const agentPrompts = {
            docrouter: {
                name: 'Document Router Agent',
                tags: ['Document Classification', 'Rules Engine', 'Medium Complexity', 'Critical Priority'],
                purpose: `This agent automatically analyzes the closing package and routes documents to the appropriate signing method (eSign vs wet/notarized) based on state regulations, loan program, and document type. It generates the document list for the Closing Agent automatically, reducing manual review time and ensuring compliance.`,
                prompt: `You are building a Document Classification Agent for CMG Financial's eClosing process.

AGENT NAME: Document Router Agent
TYPE: Document Classification / Rules Engine

OBJECTIVE:
Create an agent that analyzes closing packages and automatically classifies each document as either eSign-eligible or requiring wet/notarized signature based on state laws, loan program requirements, and document type.

INPUT DATA:
- Closing package PDF (from IDS)
- State code (property state)
- Loan program (Conv, FHA, VA, USDA)
- Loan type (Purchase, Refinance)

CLASSIFICATION RULES:
{
  "always_notarized": [
    "Security Instrument",
    "Mortgage Deed",
    "Deed of Trust",
    "Compliance Agreement",
    "Errors and Omissions",
    "Occupancy Statement",
    "Signature Affidavit",
    "AKA Statement"
  ],
  "always_wet_sign": [
    "Promissory Note",
    "Note Addendums",
    "SSA 89"
  ],
  "esign_eligible": [
    "Closing Disclosure",
    "Mailing Address Certification",
    "Most compliance documents"
  ],
  "state_specific_rules": {
    // Load from state rules database
  }
}

OUTPUT:
{
  "esign_documents": ["doc1", "doc2", ...],
  "wet_sign_documents": ["doc3", "doc4", ...],
  "notarized_documents": ["doc5", "doc6", ...],
  "closing_agent_list_html": "<formatted list>"
}`,
                integration: `INTEGRATION POINTS:
1. IDS Document System
   - Read closing package contents
   - Parse document names and types

2. State Rules Database
   - Maintain state-specific notarization requirements
   - Update when regulations change

3. Email System
   - Auto-generate document list for Closing Agent
   - Include in package release email

DEPLOYMENT:
- Triggered when closing package is generated
- Runs before package is sent to Closing Agent
- Results stored in loan file for reference`
            },
            emailgen: {
                name: 'Email Generator Agent',
                tags: ['Content Generation', 'Template Engine', 'Low Complexity', 'High Priority'],
                purpose: `This agent automatically generates personalized communication scripts for borrowers and closing agents. It populates borrower names, closing dates, return addresses, and other loan-specific details, ensuring consistent messaging across all eClosing communications.`,
                prompt: `You are building a Content Generation Agent for CMG Financial's eClosing communications.

AGENT NAME: Email Generator Agent
TYPE: Content Generation / Template Engine

OBJECTIVE:
Generate personalized, compliant communication emails for eClosing participants by merging loan data with approved templates.

INPUT DATA:
- Borrower name(s)
- Loan number
- Closing date
- Closing Agent name and email
- Regional return address
- Loan Officer name

TEMPLATES:
1. Borrower eClosing Introduction
2. Closing Agent Package Notification
3. Closing Agent eClosing Instructions
4. Wire Confirmation Script Addendum

MERGE FIELDS:
{
  "[Borrower Name]": "data.borrower.full_name",
  "[Closing Date]": "data.loan.closing_date",
  "[Closing Agent]": "data.closing_agent.name",
  "[Return Address]": "data.regional.return_address",
  "[Loan Number]": "data.loan.number"
}

OUTPUT:
{
  "borrower_email": {
    "to": "borrower@email.com",
    "subject": "CMG Financial - Your Hybrid eClosing Instructions",
    "body": "<merged template>"
  },
  "closing_agent_email": {
    "to": "agent@titleco.com",
    "cc": ["lo@cmgfi.com", "processor@cmgfi.com"],
    "subject": "CMG Mortgage, Inc.: [Borrower Name]",
    "body": "<merged template>"
  }
}`,
                integration: `INTEGRATION POINTS:
1. Byte LOS
   - Read borrower and loan data
   - Get closing date and parties

2. Outlook Integration
   - Pre-populate email drafts
   - One-click send capability

3. Template Management
   - Store approved templates
   - Version control for compliance

DEPLOYMENT:
- Triggered from Closer workflow
- Manual review before send (optional)
- Log all communications to loan file`
            },
            pdfcombine: {
                name: 'PDF Combine Agent',
                tags: ['Document Processing', 'Automation', 'Low Complexity', 'High Priority'],
                purpose: `This agent automatically monitors the download folder for IDS ZIP files, extracts contents, combines all PDFs in the correct order, and creates the Prefunding Funding Package. It eliminates the manual Adobe Acrobat steps described in the workflow.`,
                prompt: `You are building a Document Processing Agent for CMG Financial's funding workflow.

AGENT NAME: PDF Combine Agent
TYPE: Document Processing / File Automation

OBJECTIVE:
Automatically process downloaded IDS eClosing packages by extracting, ordering, and combining PDFs into the Prefunding Funding Package.

INPUT:
- ZIP file from IDS Fulfillment download
- Loan number for naming
- Borrower name for folder creation

PROCESSING STEPS:
1. Monitor downloads folder for ZIP files matching pattern
2. Extract ZIP to borrower-specific folder
3. Identify and order documents by type:
   - Application documents first
   - Note and security docs
   - Compliance documents
   - Miscellaneous last
4. Combine all PDFs in order
5. Apply consistent naming convention
6. Clean up source files (optional)

OUTPUT:
{
  "package_path": "shipping/[Borrower]/Prefunding Funding Package.pdf",
  "page_count": 87,
  "documents_combined": 23,
  "processing_time": "4.2 seconds"
}

NAMING CONVENTION:
"Prefunding Funding Package - [Loan Number] - [Borrower Last Name].pdf"`,
                integration: `INTEGRATION POINTS:
1. File System Monitoring
   - Watch downloads folder
   - Detect IDS ZIP files

2. PDF Processing Library
   - PyPDF2 or similar
   - Maintain document order
   - Handle encryption if present

3. Byte Stored Documents
   - Auto-upload combined package
   - Set document type and status

DEPLOYMENT:
- Background service on Funder workstation
- Notification on completion
- Error handling for corrupt files`
            },
            statusmonitor: {
                name: 'Status Monitor Agent',
                tags: ['Monitoring', 'Notifications', 'Medium Complexity', 'Medium Priority'],
                purpose: `This agent monitors the IDS eSign room for document signing status. It alerts processors when borrowers have not signed by a specified time on closing day, and tracks Closing Agent package receipt and wet document return status.`,
                prompt: `You are building a Monitoring Agent for CMG Financial's eClosing process.

AGENT NAME: Status Monitor Agent
TYPE: Monitoring / Notifications

OBJECTIVE:
Track eClosing signing status across all active loans and proactively alert stakeholders when action is needed.

MONITORING TARGETS:
1. Borrower eSign status in IDS
2. Closing Agent package view status
3. Wet document return tracking
4. Funding package completeness

ALERT RULES:
{
  "closing_day_alerts": [
    {
      "condition": "borrower_not_signed AND time > 10:00 AM local",
      "action": "alert_processor",
      "message": "Borrower has not eSigned - closing today"
    },
    {
      "condition": "closing_agent_not_viewed AND time > 8:00 AM local",
      "action": "alert_closer",
      "message": "Closing Agent has not viewed package"
    }
  ],
  "post_closing_alerts": [
    {
      "condition": "wet_docs_not_received AND days_since_closing > 2",
      "action": "alert_funder",
      "message": "Wet signed documents not received"
    }
  ]
}

OUTPUT:
- Real-time dashboard of eClosing status
- Email/Teams alerts per rules
- Daily summary report`,
                integration: `INTEGRATION POINTS:
1. IDS API
   - Poll eSign room status
   - Get viewing/signing timestamps

2. Notification System
   - Email alerts
   - Microsoft Teams integration
   - SMS for urgent items

3. Reporting Dashboard
   - Real-time status view
   - Historical tracking

DEPLOYMENT:
- Scheduled polling every 15 minutes
- Escalation rules for missed deadlines
- Integration with closer/funder dashboards`
            },
            checklistvalidator: {
                name: 'Checklist Validator Agent',
                tags: ['Quality Assurance', 'Validation', 'Low Complexity', 'Medium Priority'],
                purpose: `This agent validates all eClosing prerequisites before package submission. It checks that the eClosing box is checked in Byte, IDS settings are correct, all required documents are included, and communication scripts have been sent to appropriate parties.`,
                prompt: `You are building a Quality Assurance Agent for CMG Financial's eClosing process.

AGENT NAME: Checklist Validator Agent
TYPE: Quality Assurance / Validation

OBJECTIVE:
Validate all eClosing requirements are met before allowing package submission, preventing errors and rework.

VALIDATION CHECKLIST:
{
  "byte_settings": [
    "eClosing checkbox checked",
    "Closer notes present",
    "Closing date populated"
  ],
  "ids_settings": [
    "Package Type = Closing",
    "Notary Signing Method = Ink Sign",
    "Note Type = Ink Sign Note",
    "Send to Fulfillment = Checked",
    "Fulfillment Delivery = eDisclosure",
    "EDisclosure Method = eSign"
  ],
  "documents": [
    "Full package sent to Closing Agent",
    "Required notarized docs identified",
    "PTF docs added if applicable"
  ],
  "communications": [
    "Borrower script sent",
    "Closing Agent instructed",
    "Wire call completed with eClosing mention"
  ]
}

OUTPUT:
{
  "validation_status": "PASS" | "FAIL",
  "passed_checks": ["check1", "check2", ...],
  "failed_checks": ["check3", ...],
  "warnings": ["warning1", ...],
  "ready_to_submit": true | false
}`,
                integration: `INTEGRATION POINTS:
1. Byte LOS API
   - Read loan settings
   - Check field values

2. IDS Configuration
   - Validate package settings
   - Verify delivery method

3. User Interface
   - Display validation results
   - Block submission if failed
   - Provide remediation guidance

DEPLOYMENT:
- Triggered before Order Docs click
- Results displayed in modal
- Can be bypassed with supervisor override`
            }
        };

        function showAgentPrompt(agentId) {
            const agent = agentPrompts[agentId];
            if (!agent) return;

            document.getElementById('promptModalTitle').textContent = agent.name + ' - Build Prompt';
            document.getElementById('promptTags').innerHTML = agent.tags.map(tag => `<span class="prompt-tag">${tag}</span>`).join('');
            document.getElementById('promptPurpose').textContent = agent.purpose;
            document.getElementById('promptContent').textContent = agent.prompt;
            document.getElementById('promptIntegration').textContent = agent.integration;

            document.getElementById('promptModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closePromptModal() {
            document.getElementById('promptModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyPromptToClipboard() {
            const content = document.getElementById('promptContent').textContent;
            try {
                await navigator.clipboard.writeText(content);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.getElementById('promptModal').addEventListener('click', (e) => {
            if (e.target.id === 'promptModal') closePromptModal();
        });
    </script>
</body>
</html>
