<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Income Verification Workflow - Process Guide</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: #111827;
            --bg-card: #1a2234;
            --accent-blue: #3b82f6;
            --accent-teal: #14b8a6;
            --accent-amber: #f59e0b;
            --accent-rose: #f43f5e;
            --accent-green: #22c55e;
            --accent-purple: #8b5cf6;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-subtle: rgba(255,255,255,0.08);
            --sidebar-width: 280px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Breadcrumb */
        .breadcrumb {
            background: linear-gradient(90deg, #0d1525 0%, #1a2234 100%);
            padding: 14px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
            border-bottom: 1px solid var(--border-subtle);
        }

        .breadcrumb a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            transition: all 0.2s;
            border: 1px solid var(--border-subtle);
        }

        .breadcrumb a:hover {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .breadcrumb .separator { color: var(--text-muted); font-size: 1.2rem; }
        .breadcrumb .current { color: var(--accent-amber); font-weight: 600; padding: 8px 16px; }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 54px;
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - 54px);
            background: var(--bg-secondary);
            overflow-y: auto;
            z-index: 1000;
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 25px 20px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-header h2 { color: var(--text-primary); font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
        .sidebar-header p { color: var(--text-muted); font-size: 0.85rem; }

        /* Tab Switch */
        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-tab {
            flex: 1;
            padding: 14px 10px;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            background: none;
            border-left: none;
            border-right: none;
            border-top: none;
        }

        .sidebar-tab:hover { background: rgba(255,255,255,0.03); color: var(--text-secondary); }
        .sidebar-tab.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); background: rgba(59, 130, 246, 0.08); }
        .sidebar-tab.agent-tab.active { color: var(--accent-purple); border-bottom-color: var(--accent-purple); background: rgba(139, 92, 246, 0.08); }

        .sidebar-nav { padding: 15px 0; flex: 1; overflow-y: auto; }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .nav-item:hover { background: rgba(255,255,255,0.03); color: var(--text-primary); }
        .nav-item.active { background: rgba(59, 130, 246, 0.1); border-left-color: var(--accent-blue); color: var(--text-primary); }

        .nav-number {
            background: rgba(255,255,255,0.1);
            color: var(--text-secondary);
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .nav-item.active .nav-number { background: var(--accent-blue); color: white; }
        .nav-label { font-size: 0.95rem; font-weight: 500; }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-subtle);
            background: rgba(0,0,0,0.2);
        }

        .doc-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px 20px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .doc-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3); }

        /* Main Content */
        .main-content { margin-left: var(--sidebar-width); padding: 80px 40px 40px 40px; }

        /* Tab Panels */
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        .header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(20, 184, 166, 0.08) 0%, transparent 50%);
            pointer-events: none;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        .header .meta { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; position: relative; }

        .header .meta-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-subtle);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); }
        .legend-color { width: 18px; height: 18px; border-radius: 4px; }

        /* Sections */
        .section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            margin-bottom: 25px;
            overflow: hidden;
            scroll-margin-top: 75px;
        }

        .section-header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(59, 130, 246, 0.1) 100%);
            border-bottom: 1px solid var(--border-subtle);
            padding: 22px 25px;
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .section-number {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .section-title h2 { font-size: 1.35rem; font-weight: 700; margin-bottom: 4px; color: var(--text-primary); }
        .section-title span { font-size: 0.9rem; color: var(--text-muted); }
        .section-content { padding: 28px; }

        /* Workflow Diagrams */
        .workflow-diagram {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 28px;
            margin-bottom: 22px;
        }

        .flow-row { display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 12px; margin: 15px 0; }

        .flow-node {
            padding: 14px 22px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            min-width: 150px;
            border: 1px solid var(--border-subtle);
        }

        .flow-node.start { background: linear-gradient(135deg, var(--accent-green) 0%, #16a34a 100%); color: white; border-radius: 25px; border: none; }
        .flow-node.action { background: linear-gradient(135deg, var(--accent-blue) 0%, #2563eb 100%); color: white; border: none; }
        .flow-node.decision { background: linear-gradient(135deg, var(--accent-amber) 0%, #d97706 100%); color: var(--bg-primary); border: none; }
        .flow-node.input { background: var(--bg-secondary); border: 2px solid var(--accent-blue); color: var(--text-primary); }
        .flow-node.output { background: linear-gradient(135deg, var(--accent-teal) 0%, #0d9488 100%); color: white; border: none; }
        .flow-node.exception { background: linear-gradient(135deg, var(--accent-rose) 0%, #dc2626 100%); color: white; border: none; }

        .flow-arrow { color: var(--accent-blue); font-size: 1.5rem; }
        .flow-arrow.down { transform: rotate(90deg); }

        .decision-branch { display: flex; gap: 40px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
        .branch { display: flex; flex-direction: column; align-items: center; gap: 10px; }

        .branch-label {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        /* Tables */
        .field-table { width: 100%; border-collapse: collapse; margin: 18px 0; }

        .field-table th {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            padding: 14px 18px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border-subtle);
        }

        .field-table td { padding: 14px 18px; border-bottom: 1px solid var(--border-subtle); color: var(--text-secondary); }
        .field-table tr:hover { background: rgba(255,255,255,0.02); }

        .badge { display: inline-block; padding: 4px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge.required-badge { background: rgba(244, 63, 94, 0.15); color: var(--accent-rose); }
        .badge.optional-badge { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .badge.calculated-badge { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }

        /* Info Boxes */
        .exception-box, .tip-box, .info-box {
            padding: 18px 22px;
            margin: 18px 0;
            border-radius: 0 10px 10px 0;
            border-left-width: 4px;
            border-left-style: solid;
        }

        .exception-box { background: rgba(244, 63, 94, 0.08); border-color: var(--accent-rose); border: 1px solid rgba(244, 63, 94, 0.2); border-left: 4px solid var(--accent-rose); }
        .exception-box h4 { color: var(--accent-rose); margin-bottom: 10px; font-size: 1rem; }
        .exception-box p, .exception-box li { color: var(--text-secondary); }

        .tip-box { background: rgba(34, 197, 94, 0.08); border-color: var(--accent-green); border: 1px solid rgba(34, 197, 94, 0.2); border-left: 4px solid var(--accent-green); }
        .tip-box h4 { color: var(--accent-green); margin-bottom: 10px; font-size: 1rem; }
        .tip-box p, .tip-box li { color: var(--text-secondary); }

        .info-box { background: rgba(59, 130, 246, 0.08); border-color: var(--accent-blue); border: 1px solid rgba(59, 130, 246, 0.2); border-left: 4px solid var(--accent-blue); }
        .info-box h4 { color: var(--accent-blue); margin-bottom: 10px; font-size: 1rem; }
        .info-box p, .info-box li { color: var(--text-secondary); }

        /* Note Box (Yellow) */
        .note-box {
            background: rgba(245, 158, 11, 0.08);
            border: 1px solid rgba(245, 158, 11, 0.2);
            border-left: 4px solid var(--accent-amber);
            padding: 18px 22px;
            margin: 18px 0;
            border-radius: 0 10px 10px 0;
        }
        .note-box h4 { color: var(--accent-amber); margin-bottom: 10px; font-size: 1rem; }
        .note-box p, .note-box li { color: var(--text-secondary); }

        /* Decision Tree */
        .decision-tree {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 22px;
            margin: 22px 0;
        }

        .decision-tree h3 { color: var(--accent-blue); margin-bottom: 18px; padding-bottom: 12px; border-bottom: 1px solid var(--border-subtle); font-size: 1.1rem; }

        .tree-node { margin-left: 20px; padding: 12px; border-left: 2px solid var(--accent-teal); position: relative; color: var(--text-secondary); }
        .tree-node::before { content: ''; position: absolute; left: -2px; top: 22px; width: 15px; height: 2px; background: var(--accent-teal); }
        .tree-node.level-1 { margin-left: 0; border-left: none; }
        .tree-node.level-1::before { display: none; }

        .tree-label { background: var(--accent-amber); color: var(--bg-primary); padding: 6px 14px; border-radius: 6px; font-weight: 700; display: inline-block; margin-bottom: 6px; font-size: 0.9rem; }

        /* Summary Grid */
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 18px; margin: 22px 0; }

        .summary-card { background: rgba(0,0,0,0.3); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 22px; text-align: center; }
        .summary-card h4 { color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9rem; }
        .summary-card .value {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .summary-card .label { font-size: 0.85rem; color: var(--text-muted); margin-top: 8px; }

        /* Step List */
        .step-list { list-style: none; padding: 0; margin: 18px 0; }
        .step-list li {
            padding: 14px 18px;
            border-left: 3px solid var(--accent-blue);
            background: rgba(0,0,0,0.2);
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
        }
        .step-list li strong { color: var(--text-primary); }

        /* Quick Reference */
        .quick-ref {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
            border: 1px solid var(--border-subtle);
            padding: 28px;
            border-radius: 16px;
            margin-top: 30px;
            font-family: 'JetBrains Mono', monospace;
            scroll-margin-top: 75px;
        }

        .quick-ref h3 { color: var(--accent-amber); margin-bottom: 18px; font-family: 'Plus Jakarta Sans', sans-serif; }
        .quick-ref pre { background: rgba(0,0,0,0.4); border: 1px solid var(--border-subtle); padding: 20px; border-radius: 10px; overflow-x: auto; font-size: 0.85rem; line-height: 1.7; color: var(--text-secondary); }

        /* ====== AGENT OPPORTUNITIES STYLES ====== */
        .agent-header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .agent-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(139, 92, 246, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .agent-header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        /* Heat Map */
        .heat-map-container { margin-bottom: 35px; }
        .heat-map-title { font-size: 1.3rem; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }

        .heat-map-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .heat-item {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .heat-item:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .heat-item:active { transform: scale(0.98); }

        .heat-item::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 4px;
        }

        .heat-item.critical::before { background: linear-gradient(90deg, #ef4444, #f97316); }
        .heat-item.high::before { background: linear-gradient(90deg, #f97316, #eab308); }
        .heat-item.medium::before { background: linear-gradient(90deg, #eab308, #22c55e); }
        .heat-item.low::before { background: linear-gradient(90deg, #22c55e, #14b8a6); }

        .heat-score {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.8rem;
            font-weight: 800;
        }

        .heat-item.critical .heat-score { color: #ef4444; }
        .heat-item.high .heat-score { color: #f97316; }
        .heat-item.medium .heat-score { color: #eab308; }
        .heat-item.low .heat-score { color: #22c55e; }

        .heat-name { font-size: 1rem; font-weight: 700; color: var(--text-primary); margin-bottom: 6px; padding-right: 50px; }
        .heat-desc { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; }

        .heat-metrics { display: flex; gap: 15px; margin-top: 12px; }
        .heat-metric { font-size: 0.75rem; color: var(--text-muted); }
        .heat-metric span { color: var(--text-secondary); font-weight: 600; }

        /* Agent Cards */
        .agent-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 25px; margin-bottom: 35px; }

        .agent-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .agent-card:hover { transform: translateY(-5px); box-shadow: 0 15px 50px rgba(0,0,0,0.3); }

        .agent-card.highlight {
            animation: highlightPulse 2s ease;
            box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.4);
        }

        @keyframes highlightPulse {
            0% { box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.6); }
            50% { box-shadow: 0 0 0 6px rgba(139, 92, 246, 0.5), 0 15px 50px rgba(139, 92, 246, 0.3); }
            100% { box-shadow: 0 0 0 0px transparent, 0 15px 50px rgba(0,0,0,0.3); }
        }

        .agent-card-header {
            padding: 22px;
            display: flex;
            align-items: flex-start;
            gap: 18px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .agent-icon {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            flex-shrink: 0;
        }

        .agent-info { flex: 1; }
        .agent-name { font-size: 1.15rem; font-weight: 700; color: var(--text-primary); margin-bottom: 5px; }
        .agent-type { font-size: 0.8rem; color: var(--accent-purple); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-priority {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .agent-priority.critical { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .agent-priority.high { background: rgba(249, 115, 22, 0.15); color: #f97316; }
        .agent-priority.medium { background: rgba(234, 179, 8, 0.15); color: #eab308; }
        .agent-priority.low { background: rgba(34, 197, 94, 0.15); color: #22c55e; }

        .agent-card-body { padding: 22px; }
        .agent-description { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; }

        .agent-flow {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 20px;
        }

        .agent-flow-title { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-flow-diagram { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; justify-content: center; }

        .agent-step {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .agent-arrow { color: var(--accent-purple); font-size: 1.2rem; }

        .agent-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }

        .agent-stat {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .agent-stat-value {
            font-size: 1.3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-top: 4px; }

        /* View Prompt Button */
        .agent-prompt-btn {
            width: 100%;
            margin-top: 18px;
            padding: 14px 20px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 10px;
            color: var(--accent-purple);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .agent-prompt-btn:hover {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(59, 130, 246, 0.3) 100%);
            border-color: var(--accent-purple);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.25);
        }

        /* Summary Stats */
        .agent-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .agent-summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            padding: 25px;
            text-align: center;
        }

        .agent-summary-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-summary-label { font-size: 0.9rem; color: var(--text-muted); margin-top: 8px; }

        /* Heat Map Legend */
        .heat-legend {
            display: flex;
            gap: 25px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .heat-legend-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; color: var(--text-secondary); }
        .heat-legend-color { width: 24px; height: 24px; border-radius: 6px; }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(10, 15, 26, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.show { display: flex; }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            width: 100%;
            max-width: 950px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 80px rgba(0,0,0,0.5);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            padding: 22px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 16px 16px 0 0;
        }

        .modal-header h3 { font-size: 1.25rem; font-weight: 700; }
        .modal-actions { display: flex; gap: 12px; }

        .modal-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: transform 0.2s;
            font-size: 0.9rem;
        }

        .modal-btn:hover { transform: scale(1.05); }
        .modal-btn.copy { background: white; color: var(--accent-blue); }
        .modal-btn.close { background: rgba(255,255,255,0.2); color: white; }

        .modal-body { padding: 28px; overflow-y: auto; flex: 1; }

        .modal-body pre {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            padding: 22px;
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.7;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--text-secondary);
        }

        .copy-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--accent-green);
            color: white;
            padding: 18px 35px;
            border-radius: 10px;
            font-weight: 700;
            z-index: 3000;
            display: none;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut { 0%, 100% { opacity: 0; } 10%, 90% { opacity: 1; } }

        /* Prompt Modal */
        .prompt-modal .modal { max-width: 800px; }
        .prompt-modal .modal-header { background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%); }

        .prompt-section { margin-bottom: 25px; }
        .prompt-section h4 { color: var(--accent-purple); font-size: 1rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }

        .prompt-box {
            background: rgba(0,0,0,0.4);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.7;
            color: var(--text-secondary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .prompt-tags { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .prompt-tag { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 75px 20px 30px 20px; }
            .agent-grid { grid-template-columns: 1fr; }
        }
            .breadcrumb-logo-link { display: flex; align-items: center; padding: 4px 8px; background: rgba(255,255,255,0.08); border-radius: 8px; border: 1px solid rgba(255,255,255,0.12); transition: all 0.2s; }
        .breadcrumb-logo-link:hover { background: rgba(255,255,255,0.15); }
        .breadcrumb-logo { height: 28px; width: auto; }
    </style>
</head>
<body>
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <a href="../../index.html" class="breadcrumb-logo-link"><img src="../../images/clear-ai-logo.png" alt="Clear AI" class="breadcrumb-logo"></a>
        <a href="../../index.html">Portal Home</a>
        <span class="separator">></span>
        <a href="./index.html">Mortgage Fundamentals</a>
        <span class="separator">></span>
        <span class="current">Income Verification Workflow</span>
    </nav>

    <!-- Fixed Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>Income Verification</h2>
            <p>Interactive Workflow Guide</p>
        </div>

        <!-- Tab Switcher -->
        <div class="sidebar-tabs">
            <button class="sidebar-tab active" onclick="switchTab('workflow')">Workflow</button>
            <button class="sidebar-tab agent-tab" onclick="switchTab('agents')">AI Agents</button>
        </div>

        <!-- Workflow Navigation -->
        <nav class="sidebar-nav" id="workflow-nav">
            <a href="#section-1" class="nav-item active">
                <span class="nav-number">1</span>
                <span class="nav-label">Initiate Truv Order</span>
            </a>
            <a href="#section-2" class="nav-item">
                <span class="nav-number">2</span>
                <span class="nav-label">Truv Connection</span>
            </a>
            <a href="#section-3" class="nav-item">
                <span class="nav-number">3</span>
                <span class="nav-label">Fallback Documentation</span>
            </a>
            <a href="#section-4" class="nav-item">
                <span class="nav-number">4</span>
                <span class="nav-label">Variable Income</span>
            </a>
            <a href="#section-5" class="nav-item">
                <span class="nav-number">5</span>
                <span class="nav-label">Income Verified</span>
            </a>
            <a href="#section-6" class="nav-item">
                <span class="nav-number">6</span>
                <span class="nav-label">Submit to Underwriting</span>
            </a>
            <a href="#section-7" class="nav-item">
                <span class="nav-number">7</span>
                <span class="nav-label">TWN Special Cases</span>
            </a>
            <a href="#quick-ref" class="nav-item">
                <span class="nav-number">*</span>
                <span class="nav-label">Quick Reference</span>
            </a>
        </nav>

        <!-- Agent Navigation -->
        <nav class="sidebar-nav" id="agents-nav" style="display: none;">
            <a href="#agent-summary" class="nav-item active">
                <span class="nav-number">S</span>
                <span class="nav-label">Summary</span>
            </a>
            <a href="#agent-heatmap" class="nav-item">
                <span class="nav-number">H</span>
                <span class="nav-label">Heat Map</span>
            </a>
            <a href="#agent-details" class="nav-item">
                <span class="nav-number">A</span>
                <span class="nav-label">Agent Details</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="doc-btn" onclick="openDocModal()">
                View Workflow Markdown
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

        <!-- ==================== WORKFLOW TAB ==================== -->
        <div id="workflow-panel" class="tab-panel active">
            <!-- Header -->
            <div class="header">
                <h1>New Income Verification Workflow</h1>
                <p class="subtitle">Complete guide for verifying borrower income prior to initial underwriting submission</p>
                <div class="meta">
                    <span class="meta-item">Primary Tool: Truv</span>
                    <span class="meta-item">Role: Sales Team / Processor</span>
                    <span class="meta-item">Updated: May 8, 2025</span>
                    <span class="meta-item">Pre-Underwriting Process</span>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #22c55e, #16a34a);"></div><span>Start/End</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></div><span>Action Step</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></div><span>Decision Point</span></div>
                <div class="legend-item"><div class="legend-color" style="background: #111827; border: 2px solid #3b82f6;"></div><span>User Input</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f43f5e, #dc2626);"></div><span>Exception</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #14b8a6, #0d9488);"></div><span>Output</span></div>
            </div>

            <!-- Section 1: Initiate Truv Order -->
            <section id="section-1" class="section">
                <div class="section-header">
                    <div class="section-number">1</div>
                    <div class="section-title"><h2>Initiate Truv Order Request</h2><span>Sales Team or Processor creates the initial income verification request</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Start</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Sales Team or Processor</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Creates Truv Order Request</div>
                        </div>
                    </div>
                    <div class="info-box">
                        <h4>Process Overview</h4>
                        <p>Prior to submitting the file for initial underwriting, follow this workflow for the path to income verification. The primary method is through Truv, an electronic income verification service.</p>
                    </div>
                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Role</th>
                                <th>Responsibility</th>
                                <th>Timing</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Sales Team</strong></td>
                                <td>Can initiate Truv order request during loan application</td>
                                <td><span class="badge optional-badge">Early Stage</span></td>
                            </tr>
                            <tr>
                                <td><strong>Processor</strong></td>
                                <td>Initiates Truv order if not already done by Sales</td>
                                <td><span class="badge required-badge">Pre-UW</span></td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="tip-box">
                        <h4>Best Practice</h4>
                        <p>Initiate the Truv order as early as possible in the loan process to allow time for borrower connection and any fallback verification methods if needed.</p>
                    </div>
                </div>
            </section>

            <!-- Section 2: Truv Connection -->
            <section id="section-2" class="section">
                <div class="section-header">
                    <div class="section-number">2</div>
                    <div class="section-title"><h2>Truv Borrower Connection</h2><span>Determine if borrower successfully connects to Truv verification</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Truv Order Created</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Successful Borrower Connection to Truv?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">YES</span>
                                <div class="flow-node output">Proceed to Variable Income Check</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">NO</span>
                                <div class="flow-node exception">Obtain Fallback Documentation</div>
                            </div>
                        </div>
                    </div>
                    <div class="info-box">
                        <h4>Truv Connection Process</h4>
                        <p>The borrower receives a link to connect their payroll/employer account through Truv. If successful, income data is automatically retrieved. If unsuccessful, proceed to manual documentation collection.</p>
                    </div>
                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Connection Status</th>
                                <th>Description</th>
                                <th>Next Step</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Successful</strong></td>
                                <td>Borrower connected their employer/payroll account</td>
                                <td>Check for Variable Income</td>
                            </tr>
                            <tr>
                                <td><strong>Unsuccessful</strong></td>
                                <td>Borrower unable to connect or employer not supported</td>
                                <td>Obtain paystubs & W2s manually</td>
                            </tr>
                            <tr>
                                <td><strong>Pending</strong></td>
                                <td>Borrower has not yet attempted connection</td>
                                <td>Follow up with borrower</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Section 3: Fallback Documentation -->
            <section id="section-3" class="section">
                <div class="section-header">
                    <div class="section-number">3</div>
                    <div class="section-title"><h2>Fallback Documentation</h2><span>Manual income documentation when Truv connection fails</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node exception">Truv Connection Failed</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Obtain Paystubs & W2s</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Per AUS Findings / Guidelines</div>
                        </div>
                    </div>
                    <div class="exception-box">
                        <h4>Documentation Requirements</h4>
                        <p>Obtain paystubs and W2s as required in the findings. For non-agency loans, refer to specific investor/product guidelines for documentation requirements.</p>
                    </div>
                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Document</th>
                                <th>Typical Requirement</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Paystubs</strong></td>
                                <td>Most recent 30 days covering pay period</td>
                                <td><span class="badge required-badge">Required</span></td>
                            </tr>
                            <tr>
                                <td><strong>W2s</strong></td>
                                <td>Most recent 1-2 years</td>
                                <td>Per AUS findings</td>
                            </tr>
                            <tr>
                                <td><strong>Tax Returns</strong></td>
                                <td>If required by AUS or guidelines</td>
                                <td>Non-agency may vary</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="info-box">
                        <h4>Non-Agency Loans</h4>
                        <p>For non-agency loan products, always refer to the specific product guidelines for income documentation requirements as they may differ from standard agency requirements.</p>
                    </div>
                </div>
            </section>

            <!-- Section 4: Variable Income -->
            <section id="section-4" class="section">
                <div class="section-header">
                    <div class="section-number">4</div>
                    <div class="section-title"><h2>Variable Income Assessment</h2><span>Evaluate and document fluctuating income components</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Review Income Data</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Variable Income Present?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">YES</span>
                                <div class="flow-node exception">Request Additional Documentation</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">NO</span>
                                <div class="flow-node output">Proceed to Income Verified</div>
                            </div>
                        </div>
                    </div>

                    <div class="decision-tree">
                        <h3>Variable Income Definition</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 15px;">Variable income includes any fluctuating income components that are needed to qualify the borrower:</p>
                        <ul class="step-list">
                            <li><strong>Fluctuating Hourly Income:</strong> Hours vary week to week or month to month</li>
                            <li><strong>Bonus Income:</strong> Annual or periodic bonus payments being used for qualifying</li>
                            <li><strong>Overtime (OT):</strong> Overtime hours and pay that vary and are needed to qualify</li>
                        </ul>
                    </div>

                    <div class="exception-box">
                        <h4>Variable Income Documentation Options</h4>
                        <p>When variable income is present and needed to qualify, choose one of these documentation paths:</p>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li><strong>Option 1:</strong> Request year-end paystub for income breakdown</li>
                            <li><strong>Option 2:</strong> Attempt manual written verification of employment</li>
                            <li><strong>Option 3:</strong> If employer validates through The Work Number (TWN) only - see special procedures below</li>
                        </ul>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Variable Income Type</th>
                                <th>Documentation Needed</th>
                                <th>Purpose</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Fluctuating Hours</strong></td>
                                <td>Year-end paystub or VOE with hours breakdown</td>
                                <td>Calculate average hourly income</td>
                            </tr>
                            <tr>
                                <td><strong>Bonus Income</strong></td>
                                <td>Year-end paystub showing YTD bonus totals</td>
                                <td>Establish 2-year bonus history/average</td>
                            </tr>
                            <tr>
                                <td><strong>Overtime</strong></td>
                                <td>Year-end paystub with OT breakdown</td>
                                <td>Calculate consistent OT average</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Section 5: Income Verified -->
            <section id="section-5" class="section">
                <div class="section-header">
                    <div class="section-number">5</div>
                    <div class="section-title"><h2>Income Verified</h2><span>Confirm sufficient documentation and complete income calculator</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Review All Documentation</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Sufficient for Credit Decision?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">YES</span>
                                <div class="flow-node output">Income Verified - Complete Calculator</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">NO</span>
                                <div class="flow-node exception">Request Additional Documentation</div>
                            </div>
                        </div>
                    </div>

                    <div class="tip-box">
                        <h4>Income Verification Checklist</h4>
                        <p>Before marking income as verified, ensure all of the following are complete:</p>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>All required income documentation obtained</li>
                            <li>Income calculator completed and in file</li>
                            <li>Documentation supports AUS findings or guideline requirements</li>
                            <li>Variable income (if any) properly documented and calculated</li>
                        </ul>
                    </div>

                    <div class="summary-grid">
                        <div class="summary-card">
                            <h4>VOI Report</h4>
                            <div class="value">Truv</div>
                            <div class="label">Primary Verification</div>
                        </div>
                        <div class="summary-card">
                            <h4>Paystubs</h4>
                            <div class="value">30</div>
                            <div class="label">Days Coverage</div>
                        </div>
                        <div class="summary-card">
                            <h4>W2s</h4>
                            <div class="value">1-2</div>
                            <div class="label">Years Required</div>
                        </div>
                        <div class="summary-card">
                            <h4>Calculator</h4>
                            <div class="value">REQ</div>
                            <div class="label">Must Complete</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 6: Submit to Underwriting -->
            <section id="section-6" class="section">
                <div class="section-header">
                    <div class="section-number">6</div>
                    <div class="section-title"><h2>Submit to Underwriting</h2><span>Ensure all documents are added and file is ready for submission</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Income Verified</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Add Documents to Loan File</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Submit to Underwriting</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node start">End</div>
                        </div>
                    </div>

                    <ul class="step-list">
                        <li><strong>Step 1:</strong> Ensure VOI (Verification of Income) report is added to loan documents</li>
                        <li><strong>Step 2:</strong> Add paystubs to loan documents (if needed/obtained)</li>
                        <li><strong>Step 3:</strong> Add W2s to loan documents (if needed/obtained)</li>
                        <li><strong>Step 4:</strong> Verify income calculator is complete and in file</li>
                        <li><strong>Step 5:</strong> Submit file to underwriting for initial review</li>
                    </ul>

                    <div class="info-box">
                        <h4>Document Checklist for Submission</h4>
                        <p>Ensure the following are properly categorized and attached in the loan file:</p>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li><strong>Truv Report / VOI:</strong> Electronic verification results</li>
                            <li><strong>Paystubs:</strong> If required by findings or Truv unavailable</li>
                            <li><strong>W2s:</strong> If required by findings or Truv unavailable</li>
                            <li><strong>Year-End Paystub:</strong> If variable income present</li>
                            <li><strong>Income Calculator:</strong> Completed calculation worksheet</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 7: TWN Special Cases -->
            <section id="section-7" class="section">
                <div class="section-header">
                    <div class="section-number">7</div>
                    <div class="section-title"><h2>The Work Number (TWN) Special Cases</h2><span>Procedures when employer only validates through TWN</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node decision">Employer Uses TWN Only?</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Discuss with Processing Manager</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Pull TWN Report</div>
                        </div>
                    </div>

                    <div class="note-box">
                        <h4>IMPORTANT: TWN Access Restrictions</h4>
                        <p>Only P3 and Ops Managers have system access to The Work Number (TWN). These pulls will be monitored through reporting.</p>
                        <p style="margin-top: 10px;"><strong>Ensure there is a documented need and approval from leadership BEFORE pulling a TWN report.</strong></p>
                    </div>

                    <div class="decision-tree">
                        <h3>TWN Pull Procedure</h3>
                        <ul class="step-list">
                            <li><strong>Step 1:</strong> Identify that employer validates only through The Work Number</li>
                            <li><strong>Step 2:</strong> Discuss situation with Processing Manager</li>
                            <li><strong>Step 3:</strong> Document the need for TWN report in loan notes</li>
                            <li><strong>Step 4:</strong> Obtain approval from leadership before pulling report</li>
                            <li><strong>Step 5:</strong> P3 or Ops Manager pulls TWN report</li>
                            <li><strong>Step 6:</strong> Add TWN report to loan documents</li>
                        </ul>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Role</th>
                                <th>TWN Access</th>
                                <th>Responsibility</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Processor</strong></td>
                                <td><span class="badge required-badge">No Access</span></td>
                                <td>Identify need, escalate to manager</td>
                            </tr>
                            <tr>
                                <td><strong>P3</strong></td>
                                <td><span class="badge optional-badge">Has Access</span></td>
                                <td>Can pull TWN reports with approval</td>
                            </tr>
                            <tr>
                                <td><strong>Ops Manager</strong></td>
                                <td><span class="badge optional-badge">Has Access</span></td>
                                <td>Can pull TWN reports, provides approval</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="exception-box">
                        <h4>TWN Monitoring</h4>
                        <p>All TWN pulls are monitored through reporting. Unauthorized or undocumented pulls may result in compliance review. Always ensure proper documentation and approval before requesting a TWN report.</p>
                    </div>
                </div>
            </section>

            <!-- Quick Reference -->
            <div id="quick-ref" class="quick-ref">
                <h3>Income Verification Quick Reference</h3>
                <pre>
INCOME VERIFICATION WORKFLOW SUMMARY
====================================
Updated: 5/8/2025

PRIMARY VERIFICATION PATH
=========================
1. Sales Team / Processor creates Truv order request
2. Borrower connects to Truv
3. If successful -> Check for variable income
4. If variable income -> Request year-end paystub or VOE
5. Income verified -> Complete calculator
6. Submit to underwriting with all documents

TRUV CONNECTION OUTCOMES
========================
SUCCESS     | Proceed to variable income check
FAILURE     | Obtain paystubs & W2s per findings
PENDING     | Follow up with borrower

VARIABLE INCOME TYPES
=====================
Type                | Documentation Needed
--------------------|------------------------
Fluctuating Hours   | Year-end paystub or VOE
Bonus Income        | Year-end paystub (YTD bonus)
Overtime (OT)       | Year-end paystub (OT breakdown)

DOCUMENTATION OPTIONS FOR VARIABLE INCOME
=========================================
[ ] Request year-end paystub for income breakdown
[ ] Attempt manual written verification of employment
[ ] TWN Report (if employer uses TWN only - see below)

THE WORK NUMBER (TWN) SPECIAL PROCEDURES
========================================
* ONLY P3 and Ops Managers have TWN access
* Pulls are monitored through reporting
* MUST have documented need
* MUST have leadership approval BEFORE pulling

TWN Pull Steps:
1. Identify employer uses TWN only
2. Discuss with Processing Manager
3. Document need in loan notes
4. Get leadership approval
5. P3/Ops Manager pulls report
6. Add to loan documents

DOCUMENT SUBMISSION CHECKLIST
=============================
[ ] VOI Report (Truv) - if obtained
[ ] Paystubs (if needed) - 30 days coverage
[ ] W2s (if needed) - per AUS findings
[ ] Year-End Paystub (if variable income)
[ ] Income Calculator - REQUIRED (complete)

NON-AGENCY LOANS
================
* Refer to specific product guidelines
* Documentation requirements may vary
* Follow investor-specific income requirements

ROLES & RESPONSIBILITIES
========================
Sales Team    : Can initiate Truv order early
Processor     : Primary workflow driver
P3            : TWN access (with approval)
Ops Manager   : TWN access, approval authority
                </pre>
            </div>
        </div>

        <!-- ==================== AI AGENTS TAB ==================== -->
        <div id="agents-panel" class="tab-panel">
            <!-- Agent Header -->
            <div class="agent-header">
                <h1>AI Agent Opportunities</h1>
                <p class="subtitle">Automation opportunities identified for the Income Verification process</p>
            </div>

            <!-- Summary Stats -->
            <div class="agent-summary" id="agent-summary">
                <div class="agent-summary-card">
                    <div class="agent-summary-value">4</div>
                    <div class="agent-summary-label">Agent Opportunities</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">78%</div>
                    <div class="agent-summary-label">Automation Potential</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">12 min</div>
                    <div class="agent-summary-label">Est. Time Saved</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">High</div>
                    <div class="agent-summary-label">Accuracy Impact</div>
                </div>
            </div>

            <!-- Heat Map Legend -->
            <div class="heat-legend">
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #ef4444, #f97316);"></div>
                    <span>Critical Priority (9-10)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #f97316, #eab308);"></div>
                    <span>High Priority (7-8)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #eab308, #22c55e);"></div>
                    <span>Medium Priority (5-6)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #22c55e, #14b8a6);"></div>
                    <span>Low Priority (1-4)</span>
                </div>
            </div>

            <!-- Heat Map Grid -->
            <div class="heat-map-container" id="agent-heatmap">
                <div class="heat-map-title">Priority Heat Map</div>
                <div class="heat-map-grid">
                    <div class="heat-item critical" onclick="scrollToAgent('agent-truv')">
                        <div class="heat-score">9.4</div>
                        <div class="heat-name">Truv Connection Monitor</div>
                        <div class="heat-desc">Auto-track Truv connection status and trigger fallback</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>5 min</span></div>
                            <div class="heat-metric">Complexity: <span>Medium</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-variable')">
                        <div class="heat-score">8.2</div>
                        <div class="heat-name">Variable Income Detector</div>
                        <div class="heat-desc">Auto-analyze income for OT, bonus, and fluctuations</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>4 min</span></div>
                            <div class="heat-metric">Complexity: <span>Medium</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-calculator')">
                        <div class="heat-score">7.8</div>
                        <div class="heat-name">Income Calculator Agent</div>
                        <div class="heat-desc">Auto-populate income calculator from verified data</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>3 min</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                    <div class="heat-item medium" onclick="scrollToAgent('agent-twn')">
                        <div class="heat-score">6.1</div>
                        <div class="heat-name">TWN Request Router</div>
                        <div class="heat-desc">Auto-route TWN requests with approval workflow</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>N/A</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agent Details -->
            <div id="agent-details">
                <h2 style="color: var(--text-primary); margin-bottom: 25px; font-size: 1.5rem;">Agent Details</h2>
                <div class="agent-grid">
                    <!-- Truv Connection Monitor Agent -->
                    <div class="agent-card" id="agent-truv">
                        <div class="agent-card-header">
                            <div class="agent-icon">T</div>
                            <div class="agent-info">
                                <div class="agent-name">Truv Connection Monitor</div>
                                <div class="agent-type">Integration / Monitoring</div>
                            </div>
                            <span class="agent-priority critical">Critical</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Monitors Truv order status in real-time, tracks borrower connection attempts, and automatically triggers fallback documentation requests when connection fails or times out. Sends proactive notifications to processors about connection status.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Order Created</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Monitor Status</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Detect Outcome</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Trigger Action</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">5 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">99%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Med</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('truv')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Variable Income Detector Agent -->
                    <div class="agent-card" id="agent-variable">
                        <div class="agent-card-header">
                            <div class="agent-icon">V</div>
                            <div class="agent-info">
                                <div class="agent-name">Variable Income Detector</div>
                                <div class="agent-type">Data Analysis / AI</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Automatically analyzes Truv data and paystubs to detect variable income components (OT, bonus, fluctuating hours). Flags qualifying income that requires additional documentation and pre-generates documentation request letters.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Parse Income Data</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Detect Patterns</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Flag Variable</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Request Docs</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">4 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">95%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Med</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('variable')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Income Calculator Agent -->
                    <div class="agent-card" id="agent-calculator">
                        <div class="agent-card-header">
                            <div class="agent-icon">C</div>
                            <div class="agent-info">
                                <div class="agent-name">Income Calculator Agent</div>
                                <div class="agent-type">Automation / Calculation</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Automatically extracts income data from Truv reports and paystubs, calculates qualifying income per agency guidelines, and populates the income calculator worksheet. Handles base, OT, bonus, and other income averaging.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Extract Data</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Apply Rules</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Calculate</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Populate Form</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">3 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">98%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('calculator')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- TWN Request Router Agent -->
                    <div class="agent-card" id="agent-twn">
                        <div class="agent-card-header">
                            <div class="agent-icon">W</div>
                            <div class="agent-info">
                                <div class="agent-name">TWN Request Router</div>
                                <div class="agent-type">Workflow / Routing</div>
                            </div>
                            <span class="agent-priority medium">Medium</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Automates the TWN request approval workflow by routing requests to appropriate managers (P3/Ops), tracking approval status, logging audit trail, and ensuring compliance with access restrictions and monitoring requirements.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Request Created</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Route to Manager</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Track Approval</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Log Audit</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">N/A</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">100%</div>
                                    <div class="agent-stat-label">Compliance</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('twn')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Documentation Modal -->
    <div class="modal-overlay" id="docModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Income Verification Workflow Documentation</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyToClipboard()">Copy</button>
                    <button class="modal-btn close" onclick="closeDocModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <pre id="docContent"># New Income Verification Workflow

## Overview
Prior to submitting the file for initial underwriting, follow this workflow for the path to income verification.

**Updated:** May 8, 2025

## Primary Workflow Steps

### 1. Initiate Truv Order
- Sales Team or Processor creates Truv order request
- Do this as early as possible in the loan process

### 2. Truv Connection Check
- **Successful:** Proceed to variable income assessment
- **Unsuccessful:** Obtain paystubs & W2s per AUS findings

### 3. Variable Income Assessment
Check for fluctuating income needed to qualify:
- Fluctuating hourly income
- Bonus income
- Overtime (OT)

### 4. Variable Income Documentation
If variable income present, choose one option:
- Request year-end paystub for income breakdown
- Attempt manual written VOE
- TWN Report (special procedures apply)

### 5. Income Verified
Ensure:
- Sufficient documentation for credit decision
- Income calculator complete and in file

### 6. Submit to Underwriting
Ensure VOI, paystubs & W2 (if needed) are added to loan documents.

## TWN Special Procedures

**Access Restrictions:**
- Only P3 and Ops Managers have TWN access
- Pulls are monitored through reporting
- Must have documented need
- Must have leadership approval BEFORE pulling

## Document Requirements

| Document | Requirement |
|----------|-------------|
| VOI (Truv) | Primary verification |
| Paystubs | 30 days if Truv unavailable |
| W2s | Per AUS findings |
| Year-End Paystub | If variable income |
| Income Calculator | Required - must complete |

## Non-Agency Loans
Refer to specific product guidelines for documentation requirements.</pre>
            </div>
        </div>
    </div>

    <!-- AI Prompt Modal -->
    <div class="modal-overlay prompt-modal" id="promptModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="promptModalTitle">AI Agent Build Prompt</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyPromptToClipboard()">Copy Prompt</button>
                    <button class="modal-btn close" onclick="closePromptModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="prompt-tags" id="promptTags"></div>
                <div class="prompt-section">
                    <h4>Agent Purpose</h4>
                    <div class="prompt-box" id="promptPurpose"></div>
                </div>
                <div class="prompt-section">
                    <h4>Full Build Prompt</h4>
                    <div class="prompt-box" id="promptContent"></div>
                </div>
                <div class="prompt-section">
                    <h4>Integration Points</h4>
                    <div class="prompt-box" id="promptIntegration"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="copy-success" id="copySuccess">Copied to clipboard!</div>

    <script>
        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));

            if (tab === 'workflow') {
                document.querySelector('.sidebar-tab:not(.agent-tab)').classList.add('active');
                document.getElementById('workflow-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'block';
                document.getElementById('agents-nav').style.display = 'none';
            } else {
                document.querySelector('.sidebar-tab.agent-tab').classList.add('active');
                document.getElementById('agents-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'none';
                document.getElementById('agents-nav').style.display = 'block';
            }

            window.scrollTo(0, 0);
        }

        // Scroll spy with isScrolling flag and 1000ms timeout
        const sections = document.querySelectorAll('.section, .quick-ref');
        const navItems = document.querySelectorAll('#workflow-nav .nav-item');
        let isScrolling = false;
        let scrollTimeout;

        function updateActiveNav() {
            if (isScrolling) return;

            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                if (window.scrollY >= sectionTop) current = section.getAttribute('id');
            });
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + current) item.classList.add('active');
            });
        }

        // Handle nav click to temporarily disable scroll spy
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                isScrolling = true;
                clearTimeout(scrollTimeout);

                // Remove active from all, add to clicked
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');

                // Re-enable scroll spy after 1000ms
                scrollTimeout = setTimeout(() => {
                    isScrolling = false;
                }, 1000);
            });
        });

        window.addEventListener('scroll', updateActiveNav);

        // Modal
        function openDocModal() {
            document.getElementById('docModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeDocModal() {
            document.getElementById('docModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyToClipboard() {
            try {
                await navigator.clipboard.writeText(document.getElementById('docContent').textContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeDocModal(); closePromptModal(); } });
        document.getElementById('docModal').addEventListener('click', (e) => { if (e.target.id === 'docModal') closeDocModal(); });

        document.addEventListener('DOMContentLoaded', () => { updateActiveNav(); });

        // Scroll to agent card and highlight
        function scrollToAgent(agentId) {
            const agentCard = document.getElementById(agentId);
            if (agentCard) {
                document.querySelectorAll('.agent-card.highlight').forEach(card => {
                    card.classList.remove('highlight');
                });

                agentCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

                setTimeout(() => {
                    agentCard.classList.add('highlight');
                }, 300);

                setTimeout(() => {
                    agentCard.classList.remove('highlight');
                }, 2500);
            }
        }

        // Agent Prompt System
        const agentPrompts = {
            truv: {
                name: 'Truv Connection Monitor',
                tags: ['Integration', 'Monitoring', 'Medium Complexity', 'Critical Priority'],
                purpose: `This agent monitors Truv order status in real-time, tracks borrower connection attempts, and automatically triggers fallback documentation requests when connection fails or times out. It sends proactive notifications to processors about connection status changes.`,
                prompt: `You are building an Integration/Monitoring Agent for CMG Financial's Income Verification process.

AGENT NAME: Truv Connection Monitor
TYPE: Integration / Real-time Monitoring

OBJECTIVE:
Monitor Truv income verification orders in real-time, track borrower connection status, and automatically trigger appropriate next steps based on connection outcomes.

INPUT DATA:
- Truv Order ID
- Borrower Email/Phone
- Loan Number
- Processor Assignment

MONITORING EVENTS:
1. Order Created -> Start monitoring
2. Borrower Invited -> Track open/click
3. Connection Attempted -> Log attempt
4. Connection Successful -> Trigger income analysis
5. Connection Failed -> Trigger fallback workflow
6. Timeout (48hr) -> Alert processor

API INTEGRATION:
{
  "truv_webhook": "/api/truv/webhook",
  "events": [
    "order.created",
    "borrower.invited",
    "connection.started",
    "connection.completed",
    "connection.failed",
    "data.available"
  ]
}

ACTIONS BY STATUS:
{
  "successful": {
    "action": "proceed_to_variable_income_check",
    "notify": "processor",
    "message": "Truv connection successful - income data available"
  },
  "failed": {
    "action": "trigger_fallback_docs",
    "notify": "processor",
    "message": "Truv connection failed - request paystubs & W2s",
    "auto_generate": "doc_request_email"
  },
  "timeout": {
    "action": "escalate",
    "notify": ["processor", "supervisor"],
    "message": "Truv connection timed out after 48 hours"
  }
}`,
                integration: `INTEGRATION POINTS:
1. Truv API
   - Webhook receiver for status events
   - Order status polling (backup)
   - Data retrieval on success

2. LOS Integration
   - Update loan status notes
   - Flag for processor attention
   - Store connection outcome

3. Notification System
   - Email to processor
   - Dashboard alerts
   - SMS for urgent timeouts

4. Fallback Automation
   - Generate doc request letter
   - Update task list
   - Schedule follow-up

DEPLOYMENT:
- Event-driven architecture
- 99.9% uptime requirement
- Sub-second response to webhooks`
            },
            variable: {
                name: 'Variable Income Detector',
                tags: ['Data Analysis', 'AI/ML', 'Medium Complexity', 'High Priority'],
                purpose: `This agent automatically analyzes Truv data and paystubs to detect variable income components (OT, bonus, fluctuating hours). It flags qualifying income that requires additional documentation and pre-generates documentation request letters.`,
                prompt: `You are building a Data Analysis Agent for CMG Financial's Income Verification process.

AGENT NAME: Variable Income Detector
TYPE: Data Analysis / Pattern Recognition

OBJECTIVE:
Analyze income data from Truv reports and paystubs to automatically detect variable income components that require additional documentation per agency guidelines.

INPUT DATA:
- Truv employment/income report
- Paystub images/data (OCR extracted)
- Historical pay periods (if available)
- AUS findings

DETECTION PATTERNS:

1. FLUCTUATING HOURLY INCOME:
{
  "detection": "hours_variance > 10%",
  "lookback": "13_pay_periods",
  "metrics": {
    "avg_hours": "calculated",
    "std_deviation": "calculated",
    "trend": "increasing|decreasing|stable"
  }
}

2. OVERTIME INCOME:
{
  "detection": "ot_present_and_needed",
  "criteria": {
    "ot_line_item_exists": true,
    "ot_needed_for_qualify": "check_DTI_impact",
    "consistency_check": "2_year_history"
  }
}

3. BONUS INCOME:
{
  "detection": "bonus_payments_found",
  "criteria": {
    "bonus_line_exists": true,
    "frequency": "annual|quarterly|periodic",
    "2_year_average": "calculate"
  }
}

OUTPUT:
{
  "variable_income_detected": true,
  "components": [
    {
      "type": "overtime",
      "amount_ytd": 5420.00,
      "requires_doc": "year_end_paystub",
      "reason": "OT needed to qualify, requires 2-year history"
    }
  ],
  "auto_actions": [
    "generate_yearend_paystub_request",
    "flag_processor_attention"
  ]
}`,
                integration: `INTEGRATION POINTS:
1. Truv Data
   - Income breakdown parsing
   - Historical pay data
   - Employer details

2. OCR Service
   - Paystub text extraction
   - Field identification
   - Data validation

3. AUS Integration
   - DTI calculation check
   - Income qualification rules
   - Finding requirements

4. Document Generation
   - Year-end paystub request letter
   - VOE request form
   - Borrower communication

DEPLOYMENT:
- Triggered on income data receipt
- Real-time analysis (<30 seconds)
- Confidence scoring for manual review`
            },
            calculator: {
                name: 'Income Calculator Agent',
                tags: ['Automation', 'Calculation', 'Low Complexity', 'High Priority'],
                purpose: `This agent automatically extracts income data from Truv reports and paystubs, calculates qualifying income per agency guidelines, and populates the income calculator worksheet. It handles base, OT, bonus, and other income averaging.`,
                prompt: `You are building a Calculation/Automation Agent for CMG Financial's Income Verification process.

AGENT NAME: Income Calculator Agent
TYPE: Automation / Calculation Engine

OBJECTIVE:
Automatically extract verified income data, apply agency calculation rules, and populate the income calculator worksheet with accurate qualifying income figures.

INPUT DATA:
- Truv VOI Report (primary)
- Paystubs (if available)
- W2s (historical)
- Year-end paystubs (for variable income)
- Loan type/investor

CALCULATION RULES:

1. BASE INCOME (Salaried):
{
  "method": "annual_salary / 12",
  "verification": "truv_or_paystub",
  "output": "monthly_base"
}

2. BASE INCOME (Hourly):
{
  "method": "hourly_rate * avg_hours * 52 / 12",
  "avg_hours_source": "most_recent_paystubs_or_truv",
  "output": "monthly_base"
}

3. OVERTIME INCOME:
{
  "method": "2_year_average",
  "calculation": "(year1_ot + year2_ot) / 24",
  "trending_check": "if declining > 20%, use lower year",
  "output": "monthly_ot"
}

4. BONUS INCOME:
{
  "method": "2_year_average",
  "calculation": "(year1_bonus + year2_bonus) / 24",
  "minimum_history": "1_year_for_conventional",
  "output": "monthly_bonus"
}

FIELD MAPPING:
{
  "employer_name": "form.employer",
  "position": "form.job_title",
  "start_date": "form.employment_date",
  "base_monthly": "form.base_income",
  "ot_monthly": "form.overtime_income",
  "bonus_monthly": "form.bonus_income",
  "total_monthly": "form.total_qualifying"
}`,
                integration: `INTEGRATION POINTS:
1. Data Extraction
   - Truv API data parsing
   - Paystub OCR fields
   - W2 data mapping

2. Calculation Engine
   - Agency-specific rules
   - Investor overlays
   - Trending analysis

3. Form Population
   - Income calculator template
   - LOS field mapping
   - Validation checks

4. Audit Trail
   - Source documentation
   - Calculation methodology
   - Override tracking

DEPLOYMENT:
- Triggered on income verification complete
- Pre-fills calculator with "Draft" status
- Processor review required before finalization`
            },
            twn: {
                name: 'TWN Request Router',
                tags: ['Workflow', 'Routing', 'Low Complexity', 'Medium Priority'],
                purpose: `This agent automates the TWN request approval workflow by routing requests to appropriate managers (P3/Ops), tracking approval status, logging audit trail, and ensuring compliance with access restrictions and monitoring requirements.`,
                prompt: `You are building a Workflow/Routing Agent for CMG Financial's Income Verification process.

AGENT NAME: TWN Request Router
TYPE: Workflow Automation / Compliance

OBJECTIVE:
Automate the The Work Number (TWN) request and approval workflow, ensuring compliance with access restrictions while maintaining audit trail for monitoring requirements.

ACCESS RULES:
{
  "authorized_pullers": ["P3", "Ops_Manager"],
  "requires_approval": true,
  "approval_authority": ["Processing_Manager", "Ops_Manager"],
  "monitoring": "all_pulls_logged"
}

WORKFLOW STEPS:

1. REQUEST INITIATION:
{
  "requester": "processor",
  "required_fields": [
    "loan_number",
    "borrower_name",
    "employer_name",
    "reason_for_twn",
    "truv_failure_evidence"
  ]
}

2. APPROVAL ROUTING:
{
  "route_to": "processing_manager",
  "escalation": {
    "if_no_response_24hr": "ops_manager",
    "urgent_flag": "route_both_simultaneously"
  }
}

3. APPROVAL DECISION:
{
  "approve": {
    "action": "route_to_p3_or_ops",
    "notification": "requester_notified",
    "deadline": "24_hours"
  },
  "deny": {
    "action": "return_to_requester",
    "require": "reason_for_denial"
  }
}

4. PULL EXECUTION:
{
  "executor": "p3_or_ops_manager",
  "logging": {
    "timestamp": "auto",
    "loan_number": "auto",
    "executor_id": "auto",
    "approval_reference": "linked"
  }
}

5. AUDIT TRAIL:
{
  "report_generation": "monthly",
  "fields": [
    "request_date",
    "requester",
    "approver",
    "executor",
    "loan_details",
    "reason"
  ]
}`,
                integration: `INTEGRATION POINTS:
1. Request Portal
   - Web form for processors
   - Required field validation
   - Supporting doc upload

2. Approval System
   - Manager notification (email/Teams)
   - Mobile-friendly approval
   - Deadline tracking

3. TWN System
   - Credentialed access for authorized users
   - Report retrieval
   - Auto-attach to loan file

4. Compliance Reporting
   - Monthly pull reports
   - Unauthorized attempt alerts
   - Audit export for compliance

DEPLOYMENT:
- Embedded in processor workflow
- Real-time routing
- Full audit logging
- Compliance dashboard`
            }
        };

        function showAgentPrompt(agentId) {
            const agent = agentPrompts[agentId];
            if (!agent) return;

            document.getElementById('promptModalTitle').textContent = agent.name + ' - Build Prompt';
            document.getElementById('promptTags').innerHTML = agent.tags.map(tag =>
                `<span class="prompt-tag">${tag}</span>`
            ).join('');
            document.getElementById('promptPurpose').textContent = agent.purpose;
            document.getElementById('promptContent').textContent = agent.prompt;
            document.getElementById('promptIntegration').textContent = agent.integration;

            document.getElementById('promptModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closePromptModal() {
            document.getElementById('promptModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyPromptToClipboard() {
            const content = document.getElementById('promptContent').textContent;
            try {
                await navigator.clipboard.writeText(content);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.getElementById('promptModal').addEventListener('click', (e) => {
            if (e.target.id === 'promptModal') closePromptModal();
        });
    </script>
</body>
</html>
