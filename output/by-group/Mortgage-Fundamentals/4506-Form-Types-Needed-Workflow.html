<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4506-C Form Types Needed - Process Workflow</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: #111827;
            --bg-card: #1a2234;
            --accent-blue: #3b82f6;
            --accent-teal: #14b8a6;
            --accent-amber: #f59e0b;
            --accent-rose: #f43f5e;
            --accent-green: #22c55e;
            --accent-purple: #8b5cf6;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-subtle: rgba(255,255,255,0.08);
            --sidebar-width: 280px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Breadcrumb */
        .breadcrumb {
            background: linear-gradient(90deg, #0d1525 0%, #1a2234 100%);
            padding: 14px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
            border-bottom: 1px solid var(--border-subtle);
        }

        .breadcrumb a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            transition: all 0.2s;
            border: 1px solid var(--border-subtle);
        }

        .breadcrumb a:hover {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .breadcrumb .separator { color: var(--text-muted); font-size: 1.2rem; }
        .breadcrumb .current { color: var(--accent-amber); font-weight: 600; padding: 8px 16px; }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 54px;
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - 54px);
            background: var(--bg-secondary);
            overflow-y: auto;
            z-index: 1000;
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 25px 20px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-header h2 { color: var(--text-primary); font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
        .sidebar-header p { color: var(--text-muted); font-size: 0.85rem; }

        /* Tab Switch */
        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-tab {
            flex: 1;
            padding: 14px 10px;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            background: none;
            border-left: none;
            border-right: none;
            border-top: none;
        }

        .sidebar-tab:hover { background: rgba(255,255,255,0.03); color: var(--text-secondary); }
        .sidebar-tab.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); background: rgba(59, 130, 246, 0.08); }
        .sidebar-tab.agent-tab.active { color: var(--accent-purple); border-bottom-color: var(--accent-purple); background: rgba(139, 92, 246, 0.08); }

        .sidebar-nav { padding: 15px 0; flex: 1; overflow-y: auto; }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .nav-item:hover { background: rgba(255,255,255,0.03); color: var(--text-primary); }
        .nav-item.active { background: rgba(59, 130, 246, 0.1); border-left-color: var(--accent-blue); color: var(--text-primary); }

        .nav-number {
            background: rgba(255,255,255,0.1);
            color: var(--text-secondary);
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .nav-item.active .nav-number { background: var(--accent-blue); color: white; }
        .nav-label { font-size: 0.95rem; font-weight: 500; }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-subtle);
            background: rgba(0,0,0,0.2);
        }

        .doc-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px 20px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .doc-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3); }

        /* Main Content */
        .main-content { margin-left: var(--sidebar-width); padding: 80px 40px 40px 40px; }

        /* Tab Panels */
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        .header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(20, 184, 166, 0.08) 0%, transparent 50%);
            pointer-events: none;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        .header .meta { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; position: relative; }

        .header .meta-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-subtle);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); }
        .legend-color { width: 18px; height: 18px; border-radius: 4px; }

        /* Sections */
        .section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            margin-bottom: 25px;
            overflow: hidden;
            scroll-margin-top: 75px;
        }

        .section-header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(59, 130, 246, 0.1) 100%);
            border-bottom: 1px solid var(--border-subtle);
            padding: 22px 25px;
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .section-number {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .section-title h2 { font-size: 1.35rem; font-weight: 700; margin-bottom: 4px; color: var(--text-primary); }
        .section-title span { font-size: 0.9rem; color: var(--text-muted); }
        .section-content { padding: 28px; }

        /* Workflow Diagrams */
        .workflow-diagram {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 28px;
            margin-bottom: 22px;
        }

        .flow-row { display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 12px; margin: 15px 0; }

        .flow-node {
            padding: 14px 22px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            min-width: 150px;
            border: 1px solid var(--border-subtle);
        }

        .flow-node.start { background: linear-gradient(135deg, var(--accent-green) 0%, #16a34a 100%); color: white; border-radius: 25px; border: none; }
        .flow-node.action { background: linear-gradient(135deg, var(--accent-blue) 0%, #2563eb 100%); color: white; border: none; }
        .flow-node.decision { background: linear-gradient(135deg, var(--accent-amber) 0%, #d97706 100%); color: var(--bg-primary); border: none; }
        .flow-node.input { background: var(--bg-secondary); border: 2px solid var(--accent-blue); color: var(--text-primary); }
        .flow-node.output { background: linear-gradient(135deg, var(--accent-teal) 0%, #0d9488 100%); color: white; border: none; }
        .flow-node.exception { background: linear-gradient(135deg, var(--accent-rose) 0%, #dc2626 100%); color: white; border: none; }

        .flow-arrow { color: var(--accent-blue); font-size: 1.5rem; }
        .flow-arrow.down { transform: rotate(90deg); }

        .decision-branch { display: flex; gap: 40px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
        .branch { display: flex; flex-direction: column; align-items: center; gap: 10px; }

        .branch-label {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        /* Tables */
        .field-table { width: 100%; border-collapse: collapse; margin: 18px 0; }

        .field-table th {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            padding: 14px 18px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border-subtle);
        }

        .field-table td { padding: 14px 18px; border-bottom: 1px solid var(--border-subtle); color: var(--text-secondary); }
        .field-table tr:hover { background: rgba(255,255,255,0.02); }

        .badge { display: inline-block; padding: 4px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge.required-badge { background: rgba(244, 63, 94, 0.15); color: var(--accent-rose); }
        .badge.optional-badge { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .badge.calculated-badge { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }

        /* Info Boxes */
        .exception-box, .tip-box, .info-box {
            padding: 18px 22px;
            margin: 18px 0;
            border-radius: 0 10px 10px 0;
            border-left-width: 4px;
            border-left-style: solid;
        }

        .exception-box { background: rgba(244, 63, 94, 0.08); border-color: var(--accent-rose); border: 1px solid rgba(244, 63, 94, 0.2); border-left: 4px solid var(--accent-rose); }
        .exception-box h4 { color: var(--accent-rose); margin-bottom: 10px; font-size: 1rem; }
        .exception-box p, .exception-box li { color: var(--text-secondary); }

        .tip-box { background: rgba(34, 197, 94, 0.08); border-color: var(--accent-green); border: 1px solid rgba(34, 197, 94, 0.2); border-left: 4px solid var(--accent-green); }
        .tip-box h4 { color: var(--accent-green); margin-bottom: 10px; font-size: 1rem; }
        .tip-box p, .tip-box li { color: var(--text-secondary); }

        .info-box { background: rgba(59, 130, 246, 0.08); border-color: var(--accent-blue); border: 1px solid rgba(59, 130, 246, 0.2); border-left: 4px solid var(--accent-blue); }
        .info-box h4 { color: var(--accent-blue); margin-bottom: 10px; font-size: 1rem; }
        .info-box p, .info-box li { color: var(--text-secondary); }

        /* Decision Tree */
        .decision-tree {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 22px;
            margin: 22px 0;
        }

        .decision-tree h3 { color: var(--accent-blue); margin-bottom: 18px; padding-bottom: 12px; border-bottom: 1px solid var(--border-subtle); font-size: 1.1rem; }

        .tree-node { margin-left: 20px; padding: 12px; border-left: 2px solid var(--accent-teal); position: relative; color: var(--text-secondary); }
        .tree-node::before { content: ''; position: absolute; left: -2px; top: 22px; width: 15px; height: 2px; background: var(--accent-teal); }
        .tree-node.level-1 { margin-left: 0; border-left: none; }
        .tree-node.level-1::before { display: none; }

        .tree-label { background: var(--accent-amber); color: var(--bg-primary); padding: 6px 14px; border-radius: 6px; font-weight: 700; display: inline-block; margin-bottom: 6px; font-size: 0.9rem; }

        /* Summary Grid */
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 18px; margin: 22px 0; }

        .summary-card { background: rgba(0,0,0,0.3); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 22px; text-align: center; }
        .summary-card h4 { color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9rem; }
        .summary-card .value {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .summary-card .label { font-size: 0.85rem; color: var(--text-muted); margin-top: 8px; }

        /* Scenario Cards */
        .scenario-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin: 22px 0; }

        .scenario-card { background: rgba(0,0,0,0.2); border: 1px solid var(--border-subtle); border-radius: 12px; overflow: hidden; }
        .scenario-card-header { background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%); color: white; padding: 18px; }
        .scenario-card-header h4 { font-size: 1.05rem; margin-bottom: 5px; }
        .scenario-card-header span { font-size: 0.85rem; opacity: 0.9; }
        .scenario-card-body { padding: 22px; }
        .scenario-card ul { list-style: none; padding: 0; }
        .scenario-card li { padding: 10px 0; border-bottom: 1px solid var(--border-subtle); display: flex; align-items: center; gap: 12px; color: var(--text-secondary); font-size: 0.95rem; }
        .scenario-card li:last-child { border-bottom: none; }
        .check-icon { color: var(--accent-green); font-weight: bold; }
        .x-icon { color: var(--accent-rose); font-weight: bold; }

        /* Quick Reference */
        .quick-ref {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
            border: 1px solid var(--border-subtle);
            padding: 28px;
            border-radius: 16px;
            margin-top: 30px;
            font-family: 'JetBrains Mono', monospace;
            scroll-margin-top: 75px;
        }

        .quick-ref h3 { color: var(--accent-amber); margin-bottom: 18px; font-family: 'Plus Jakarta Sans', sans-serif; }
        .quick-ref pre { background: rgba(0,0,0,0.4); border: 1px solid var(--border-subtle); padding: 20px; border-radius: 10px; overflow-x: auto; font-size: 0.85rem; line-height: 1.7; color: var(--text-secondary); }

        /* ====== AGENT OPPORTUNITIES STYLES ====== */
        .agent-header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .agent-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(139, 92, 246, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .agent-header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        /* Heat Map */
        .heat-map-container { margin-bottom: 35px; }
        .heat-map-title { font-size: 1.3rem; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }

        .heat-map-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .heat-item {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .heat-item:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .heat-item:active { transform: scale(0.98); }

        .heat-item::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 4px;
        }

        .heat-item.critical::before { background: linear-gradient(90deg, #ef4444, #f97316); }
        .heat-item.high::before { background: linear-gradient(90deg, #f97316, #eab308); }
        .heat-item.medium::before { background: linear-gradient(90deg, #eab308, #22c55e); }
        .heat-item.low::before { background: linear-gradient(90deg, #22c55e, #14b8a6); }

        .heat-score {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.8rem;
            font-weight: 800;
        }

        .heat-item.critical .heat-score { color: #ef4444; }
        .heat-item.high .heat-score { color: #f97316; }
        .heat-item.medium .heat-score { color: #eab308; }
        .heat-item.low .heat-score { color: #22c55e; }

        .heat-name { font-size: 1rem; font-weight: 700; color: var(--text-primary); margin-bottom: 6px; padding-right: 50px; }
        .heat-desc { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; }

        .heat-metrics { display: flex; gap: 15px; margin-top: 12px; }
        .heat-metric { font-size: 0.75rem; color: var(--text-muted); }
        .heat-metric span { color: var(--text-secondary); font-weight: 600; }

        /* Agent Cards */
        .agent-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 25px; margin-bottom: 35px; }

        .agent-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .agent-card:hover { transform: translateY(-5px); box-shadow: 0 15px 50px rgba(0,0,0,0.3); }

        .agent-card.highlight {
            animation: highlightPulse 2s ease;
            box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.4);
        }

        @keyframes highlightPulse {
            0% { box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.6); }
            50% { box-shadow: 0 0 0 6px rgba(139, 92, 246, 0.5), 0 15px 50px rgba(139, 92, 246, 0.3); }
            100% { box-shadow: 0 0 0 0px transparent, 0 15px 50px rgba(0,0,0,0.3); }
        }

        .agent-card-header {
            padding: 22px;
            display: flex;
            align-items: flex-start;
            gap: 18px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .agent-icon {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            flex-shrink: 0;
        }

        .agent-info { flex: 1; }
        .agent-name { font-size: 1.15rem; font-weight: 700; color: var(--text-primary); margin-bottom: 5px; }
        .agent-type { font-size: 0.8rem; color: var(--accent-purple); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-priority {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .agent-priority.critical { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .agent-priority.high { background: rgba(249, 115, 22, 0.15); color: #f97316; }
        .agent-priority.medium { background: rgba(234, 179, 8, 0.15); color: #eab308; }
        .agent-priority.low { background: rgba(34, 197, 94, 0.15); color: #22c55e; }

        .agent-card-body { padding: 22px; }
        .agent-description { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; }

        .agent-flow {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 20px;
        }

        .agent-flow-title { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-flow-diagram { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; justify-content: center; }

        .agent-step {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .agent-arrow { color: var(--accent-purple); font-size: 1.2rem; }

        .agent-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }

        .agent-stat {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .agent-stat-value {
            font-size: 1.3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-top: 4px; }

        /* View Prompt Button */
        .agent-prompt-btn {
            width: 100%;
            margin-top: 18px;
            padding: 14px 20px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 10px;
            color: var(--accent-purple);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .agent-prompt-btn:hover {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(59, 130, 246, 0.3) 100%);
            border-color: var(--accent-purple);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.25);
        }

        /* Summary Stats */
        .agent-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .agent-summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            padding: 25px;
            text-align: center;
        }

        .agent-summary-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-summary-label { font-size: 0.9rem; color: var(--text-muted); margin-top: 8px; }

        /* Heat Map Legend */
        .heat-legend {
            display: flex;
            gap: 25px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .heat-legend-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; color: var(--text-secondary); }
        .heat-legend-color { width: 24px; height: 24px; border-radius: 6px; }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(10, 15, 26, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.show { display: flex; }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            width: 100%;
            max-width: 950px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 80px rgba(0,0,0,0.5);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            padding: 22px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 16px 16px 0 0;
        }

        .modal-header h3 { font-size: 1.25rem; font-weight: 700; }
        .modal-actions { display: flex; gap: 12px; }

        .modal-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: transform 0.2s;
            font-size: 0.9rem;
        }

        .modal-btn:hover { transform: scale(1.05); }
        .modal-btn.copy { background: white; color: var(--accent-blue); }
        .modal-btn.close { background: rgba(255,255,255,0.2); color: white; }

        .modal-body { padding: 28px; overflow-y: auto; flex: 1; }

        .modal-body pre {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            padding: 22px;
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.7;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--text-secondary);
        }

        .copy-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--accent-green);
            color: white;
            padding: 18px 35px;
            border-radius: 10px;
            font-weight: 700;
            z-index: 3000;
            display: none;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut { 0%, 100% { opacity: 0; } 10%, 90% { opacity: 1; } }

        /* Prompt Modal */
        .prompt-modal .modal { max-width: 800px; }
        .prompt-modal .modal-header { background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%); }

        .prompt-section { margin-bottom: 25px; }
        .prompt-section h4 { color: var(--accent-purple); font-size: 1rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }

        .prompt-box {
            background: rgba(0,0,0,0.4);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.7;
            color: var(--text-secondary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .prompt-tags { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .prompt-tag { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }

        /* Step List */
        .step-list { list-style: none; padding: 0; margin: 18px 0; }
        .step-list li {
            padding: 14px 18px;
            border-left: 3px solid var(--accent-blue);
            background: rgba(0,0,0,0.2);
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
        }
        .step-list li strong { color: var(--text-primary); }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 75px 20px 30px 20px; }
            .agent-grid { grid-template-columns: 1fr; }
            .scenario-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <a href="../../index.html">Portal Home</a>
        <span class="separator">></span>
        <a href="./index.html">Mortgage Fundamentals</a>
        <span class="separator">></span>
        <span class="current">4506-C Form Types Needed</span>
    </nav>

    <!-- Fixed Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>4506-C Forms Guide</h2>
            <p>Interactive Workflow Guide</p>
        </div>

        <!-- Tab Switcher -->
        <div class="sidebar-tabs">
            <button class="sidebar-tab active" onclick="switchTab('workflow')">Workflow</button>
            <button class="sidebar-tab agent-tab" onclick="switchTab('agents')">AI Agents</button>
        </div>

        <!-- Workflow Navigation -->
        <nav class="sidebar-nav" id="workflow-nav">
            <a href="#section-1" class="nav-item active">
                <span class="nav-number">1</span>
                <span class="nav-label">Understanding 4506-C</span>
            </a>
            <a href="#section-2" class="nav-item">
                <span class="nav-number">2</span>
                <span class="nav-label">Single Borrower W-2</span>
            </a>
            <a href="#section-3" class="nav-item">
                <span class="nav-number">3</span>
                <span class="nav-label">Single Self-Employed</span>
            </a>
            <a href="#section-4" class="nav-item">
                <span class="nav-number">4</span>
                <span class="nav-label">Married Borrowers</span>
            </a>
            <a href="#section-5" class="nav-item">
                <span class="nav-number">5</span>
                <span class="nav-label">Joint Unmarried</span>
            </a>
            <a href="#section-6" class="nav-item">
                <span class="nav-number">6</span>
                <span class="nav-label">CTC Requirements</span>
            </a>
            <a href="#section-7" class="nav-item">
                <span class="nav-number">7</span>
                <span class="nav-label">Form Types Reference</span>
            </a>
            <a href="#quick-ref" class="nav-item">
                <span class="nav-number">*</span>
                <span class="nav-label">Quick Reference</span>
            </a>
        </nav>

        <!-- Agent Navigation -->
        <nav class="sidebar-nav" id="agents-nav" style="display: none;">
            <a href="#agent-summary" class="nav-item active">
                <span class="nav-number">S</span>
                <span class="nav-label">Summary</span>
            </a>
            <a href="#agent-heatmap" class="nav-item">
                <span class="nav-number">H</span>
                <span class="nav-label">Heat Map</span>
            </a>
            <a href="#agent-details" class="nav-item">
                <span class="nav-number">A</span>
                <span class="nav-label">Agent Details</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="doc-btn" onclick="openDocModal()">
                View Workflow Markdown
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

        <!-- ==================== WORKFLOW TAB ==================== -->
        <div id="workflow-panel" class="tab-panel active">
            <!-- Header -->
            <div class="header">
                <h1>4506-C Form Types Needed</h1>
                <p class="subtitle">Complete guide for determining how many 4506-C forms are required based on borrower scenarios and income types</p>
                <div class="meta">
                    <span class="meta-item">Category: Tax Transcripts</span>
                    <span class="meta-item">Role: Processor / Underwriter</span>
                    <span class="meta-item">Updated: July 23, 2024</span>
                    <span class="meta-item">Duration: 2-5 min per loan</span>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #22c55e, #16a34a);"></div><span>Start/End</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></div><span>Action Step</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></div><span>Decision Point</span></div>
                <div class="legend-item"><div class="legend-color" style="background: #111827; border: 2px solid #3b82f6;"></div><span>User Input</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f43f5e, #dc2626);"></div><span>Exception</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #14b8a6, #0d9488);"></div><span>Output</span></div>
            </div>

            <!-- Section 1: Understanding 4506-C -->
            <section id="section-1" class="section">
                <div class="section-header">
                    <div class="section-number">1</div>
                    <div class="section-title"><h2>Understanding 4506-C Forms</h2><span>Overview of IRS Form 4506-C and transcript requirements</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Start</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Identify Borrower Type</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Determine Income Type</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Calculate Forms Needed</div>
                        </div>
                    </div>
                    <div class="info-box">
                        <h4>What is Form 4506-C?</h4>
                        <p>IRS Form 4506-C (IVES Request for Transcript of Tax Return) is used to request tax transcripts directly from the IRS. The number of forms needed depends on the borrower's marital status, number of borrowers on the loan, and income types.</p>
                    </div>

                    <div class="summary-grid">
                        <div class="summary-card">
                            <h4>Form Types</h4>
                            <div class="value">3</div>
                            <div class="label">Wage/Income, 1040, Business</div>
                        </div>
                        <div class="summary-card">
                            <h4>Max Forms</h4>
                            <div class="value">3+</div>
                            <div class="label">Complex Scenarios</div>
                        </div>
                        <div class="summary-card">
                            <h4>CTC Required</h4>
                            <div class="value">Yes</div>
                            <div class="label">Self-Employed Only</div>
                        </div>
                        <div class="summary-card">
                            <h4>Scenarios</h4>
                            <div class="value">11</div>
                            <div class="label">Covered in Guide</div>
                        </div>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Transcript Type</th>
                                <th>Description</th>
                                <th>When Required</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Wage/Income Transcript</strong></td>
                                <td>Shows W-2, 1099, and other wage information reported to IRS</td>
                                <td><span class="badge calculated-badge">W-2 Income</span></td>
                            </tr>
                            <tr>
                                <td><strong>1040 Transcript</strong></td>
                                <td>Shows line items from filed tax return (Form 1040)</td>
                                <td><span class="badge required-badge">Self-Employed</span></td>
                            </tr>
                            <tr>
                                <td><strong>Business Return Transcript</strong></td>
                                <td>For 1065, 1120, or 1120S business returns</td>
                                <td><span class="badge required-badge">Business Entities</span></td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="tip-box">
                        <h4>Key Rule: CTC (Clear to Close) Requirements</h4>
                        <p>1040 Transcripts are <strong>only required for Clear to Close (CTC)</strong> when the borrower is self-employed. W-2 wage earners do not require 1040 transcripts for CTC.</p>
                    </div>
                </div>
            </section>

            <!-- Section 2: Single Borrower W-2 -->
            <section id="section-2" class="section">
                <div class="section-header">
                    <div class="section-number">2</div>
                    <div class="section-title"><h2>Single Borrower - W-2 Income</h2><span>Simplest scenario requiring minimum documentation</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node input">Single Borrower</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">W-2 Only?</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">1 Wage/Income Form</div>
                        </div>
                    </div>

                    <div class="scenario-grid">
                        <div class="scenario-card">
                            <div class="scenario-card-header">
                                <h4>Single Borrower - W-2 Income</h4>
                                <span>Total Forms: 1 | CTC Transcripts: No</span>
                            </div>
                            <div class="scenario-card-body">
                                <ul>
                                    <li><span class="check-icon">1</span> Wage/Income (borrower)</li>
                                </ul>
                            </div>
                        </div>
                        <div class="scenario-card">
                            <div class="scenario-card-header">
                                <h4>Single Borrower - Multiple Income (W-2 & 1099)</h4>
                                <span>Total Forms: 1 | CTC Transcripts: No</span>
                            </div>
                            <div class="scenario-card-body">
                                <ul>
                                    <li><span class="check-icon">1</span> Wage/Income (borrower)</li>
                                </ul>
                                <div class="info-box" style="margin-top: 15px;">
                                    <h4>Note</h4>
                                    <p>W-2 and 1099 income are both captured on the same Wage/Income transcript</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tip-box">
                        <h4>W-2 Income Simplicity</h4>
                        <p>W-2 wage earners require only the Wage/Income transcript, which captures all W-2 and 1099 income reported to the IRS. No 1040 transcripts are needed for CTC.</p>
                    </div>
                </div>
            </section>

            <!-- Section 3: Single Borrower Self-Employed -->
            <section id="section-3" class="section">
                <div class="section-header">
                    <div class="section-number">3</div>
                    <div class="section-title"><h2>Single Borrower - Self-Employed</h2><span>Schedule C and business entity requirements</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node input">Single Borrower</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Self-Employed Type?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">Schedule C</span>
                                <div class="flow-node output">1 Form - 1040</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">1065/1120/1120S</span>
                                <div class="flow-node output">2+ Forms</div>
                            </div>
                        </div>
                    </div>

                    <div class="scenario-grid">
                        <div class="scenario-card">
                            <div class="scenario-card-header">
                                <h4>Schedule C (Sole Proprietor)</h4>
                                <span>Total Forms: 1 | CTC Transcripts: Yes</span>
                            </div>
                            <div class="scenario-card-body">
                                <ul>
                                    <li><span class="check-icon">1</span> 1040 (borrower)</li>
                                </ul>
                                <div class="tip-box" style="margin-top: 15px;">
                                    <h4>Schedule C Note</h4>
                                    <p>Schedule C income is reported on the personal 1040, so only one 1040 form is needed.</p>
                                </div>
                            </div>
                        </div>
                        <div class="scenario-card">
                            <div class="scenario-card-header">
                                <h4>Business Entity (1065, 1120, 1120S)</h4>
                                <span>Total Forms: 2+ | CTC Transcripts: Yes</span>
                            </div>
                            <div class="scenario-card-body">
                                <ul>
                                    <li><span class="check-icon">1</span> 1040 (borrower)</li>
                                    <li><span class="check-icon">1</span> Business Form (per business)</li>
                                </ul>
                                <div class="exception-box" style="margin-top: 15px;">
                                    <h4>Multiple Businesses</h4>
                                    <p>If borrower owns multiple businesses, one Business Form is required for EACH business entity.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Business Type</th>
                                <th>IRS Form</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Schedule C</strong></td>
                                <td>Part of 1040</td>
                                <td>Sole proprietorship - reported on personal return</td>
                            </tr>
                            <tr>
                                <td><strong>Partnership</strong></td>
                                <td>Form 1065</td>
                                <td>Partnership return - separate 4506-C required</td>
                            </tr>
                            <tr>
                                <td><strong>C Corporation</strong></td>
                                <td>Form 1120</td>
                                <td>Corporate return - separate 4506-C required</td>
                            </tr>
                            <tr>
                                <td><strong>S Corporation</strong></td>
                                <td>Form 1120S</td>
                                <td>S Corp return - separate 4506-C required</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Section 4: Married Borrowers -->
            <section id="section-4" class="section">
                <div class="section-header">
                    <div class="section-number">4</div>
                    <div class="section-title"><h2>Married Borrowers</h2><span>Requirements for married couples on the loan</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node input">Married Borrowers</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Who's on Loan?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">One Spouse</span>
                                <div class="flow-node action">1 Form</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">Both Spouses</span>
                                <div class="flow-node action">2+ Forms</div>
                            </div>
                        </div>
                    </div>

                    <div class="scenario-grid">
                        <div class="scenario-card">
                            <div class="scenario-card-header">
                                <h4>Only One Spouse on Loan - W-2</h4>
                                <span>Total Forms: 1 | CTC Transcripts: No</span>
                            </div>
                            <div class="scenario-card-body">
                                <ul>
                                    <li><span class="check-icon">1</span> Wage/Income (borrower)</li>
                                </ul>
                            </div>
                        </div>
                        <div class="scenario-card">
                            <div class="scenario-card-header">
                                <h4>Both Spouses - Both W-2</h4>
                                <span>Total Forms: 2 | CTC Transcripts: No</span>
                            </div>
                            <div class="scenario-card-body">
                                <ul>
                                    <li><span class="check-icon">1</span> Wage/Income (borrower)</li>
                                    <li><span class="check-icon">1</span> Wage/Income (co-borrower)</li>
                                </ul>
                            </div>
                        </div>
                        <div class="scenario-card">
                            <div class="scenario-card-header">
                                <h4>Both Spouses - One W-2, One Self-Employed</h4>
                                <span>Total Forms: 3+ | CTC Transcripts: Yes</span>
                            </div>
                            <div class="scenario-card-body">
                                <ul>
                                    <li><span class="check-icon">1</span> Wage/Income (W-2 borrower)</li>
                                    <li><span class="check-icon">1</span> 1040 (Self-Employed borrower)</li>
                                    <li><span class="check-icon">1</span> Business Form (per business)</li>
                                </ul>
                            </div>
                        </div>
                        <div class="scenario-card">
                            <div class="scenario-card-header">
                                <h4>Both Spouses - Both Self-Employed</h4>
                                <span>Total Forms: 2+ | CTC Transcripts: Yes</span>
                            </div>
                            <div class="scenario-card-body">
                                <ul>
                                    <li><span class="check-icon">1</span> 1040 (borrower & co-borrower)*</li>
                                    <li><span class="check-icon">1</span> Business Form (per business)</li>
                                </ul>
                                <div class="info-box" style="margin-top: 15px;">
                                    <h4>Joint vs. Separate Filing</h4>
                                    <p>*If filed jointly, only 1 Form 1040 needed. If filed separately, one 1040 per borrower is required.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 5: Joint Unmarried Borrowers -->
            <section id="section-5" class="section">
                <div class="section-header">
                    <div class="section-number">5</div>
                    <div class="section-title"><h2>Joint Borrower (Unmarried)</h2><span>Requirements for unmarried co-borrowers</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node input">Unmarried Co-Borrowers</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Income Types?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">Both W-2</span>
                                <div class="flow-node output">2 Forms</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">Mixed</span>
                                <div class="flow-node output">3+ Forms</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">Both SE</span>
                                <div class="flow-node output">3+ Forms</div>
                            </div>
                        </div>
                    </div>

                    <div class="scenario-grid">
                        <div class="scenario-card">
                            <div class="scenario-card-header">
                                <h4>Both W-2 Income</h4>
                                <span>Total Forms: 2 | CTC Transcripts: No</span>
                            </div>
                            <div class="scenario-card-body">
                                <ul>
                                    <li><span class="check-icon">1</span> Wage/Income (borrower)</li>
                                    <li><span class="check-icon">1</span> Wage/Income (co-borrower)</li>
                                </ul>
                            </div>
                        </div>
                        <div class="scenario-card">
                            <div class="scenario-card-header">
                                <h4>One W-2, One Self-Employed</h4>
                                <span>Total Forms: 3+ | CTC Transcripts: Yes</span>
                            </div>
                            <div class="scenario-card-body">
                                <ul>
                                    <li><span class="check-icon">1</span> Wage/Income (W-2 borrower)</li>
                                    <li><span class="check-icon">1</span> 1040 (Self-Employed borrower)</li>
                                    <li><span class="check-icon">1</span> Business Form (per business)</li>
                                </ul>
                            </div>
                        </div>
                        <div class="scenario-card">
                            <div class="scenario-card-header">
                                <h4>Both Self-Employed</h4>
                                <span>Total Forms: 3+ | CTC Transcripts: Yes</span>
                            </div>
                            <div class="scenario-card-body">
                                <ul>
                                    <li><span class="check-icon">1</span> 1040 (borrower)</li>
                                    <li><span class="check-icon">1</span> 1040 (co-borrower)</li>
                                    <li><span class="check-icon">1</span> Business Form (per business / per borrower)</li>
                                </ul>
                                <div class="exception-box" style="margin-top: 15px;">
                                    <h4>Key Difference from Married</h4>
                                    <p>Unmarried borrowers ALWAYS file separate 1040s, so each self-employed borrower requires their own 1040 form.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 6: CTC Requirements -->
            <section id="section-6" class="section">
                <div class="section-header">
                    <div class="section-number">6</div>
                    <div class="section-title"><h2>CTC Transcript Requirements</h2><span>When 1040 transcripts are required for Clear to Close</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node decision">Self-Employed?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">YES</span>
                                <div class="flow-node exception">1040 Transcripts Required for CTC</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">NO</span>
                                <div class="flow-node output">No 1040 Transcripts for CTC</div>
                            </div>
                        </div>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Scenario</th>
                                <th>1040 Transcripts for CTC</th>
                                <th>Reason</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>W-2 Income Only</strong></td>
                                <td><span class="badge optional-badge">No</span></td>
                                <td>Wage/Income transcript sufficient for verification</td>
                            </tr>
                            <tr>
                                <td><strong>W-2 + 1099 Mixed</strong></td>
                                <td><span class="badge optional-badge">No</span></td>
                                <td>Both captured on Wage/Income transcript</td>
                            </tr>
                            <tr>
                                <td><strong>Self-Employed (Schedule C)</strong></td>
                                <td><span class="badge required-badge">Yes</span></td>
                                <td>Must verify self-employment income on 1040</td>
                            </tr>
                            <tr>
                                <td><strong>Self-Employed (Business Entity)</strong></td>
                                <td><span class="badge required-badge">Yes</span></td>
                                <td>Need 1040 + Business transcripts</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="exception-box">
                        <h4>Critical CTC Rule</h4>
                        <p>1040 Transcripts are <strong>ONLY</strong> required for Clear to Close when the borrower has self-employment income. If all borrowers are W-2 wage earners, 1040 transcripts are NOT required at CTC.</p>
                    </div>
                </div>
            </section>

            <!-- Section 7: Form Types Reference -->
            <section id="section-7" class="section">
                <div class="section-header">
                    <div class="section-number">7</div>
                    <div class="section-title"><h2>Complete Reference Table</h2><span>All scenarios at a glance</span></div>
                </div>
                <div class="section-content">
                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Number of Borrowers</th>
                                <th>Income Type</th>
                                <th>Type of Form for CTC</th>
                                <th>Total</th>
                                <th>1040 for CTC</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Single Borrower</strong></td>
                                <td>W-2 Income</td>
                                <td>1 Wage/Income (borrower)</td>
                                <td><span class="badge calculated-badge">1</span></td>
                                <td><span class="badge optional-badge">No</span></td>
                            </tr>
                            <tr>
                                <td><strong>Single Borrower</strong></td>
                                <td>Self-Employed (Schedule C)</td>
                                <td>1 1040 (borrower)</td>
                                <td><span class="badge calculated-badge">1</span></td>
                                <td><span class="badge required-badge">Yes</span></td>
                            </tr>
                            <tr>
                                <td><strong>Single Borrower</strong></td>
                                <td>Self-Employed (1065; 1120; 1120S)</td>
                                <td>1 1040 (borrower) + 1 Business Form (per business)</td>
                                <td><span class="badge calculated-badge">2+</span></td>
                                <td><span class="badge required-badge">Yes</span></td>
                            </tr>
                            <tr>
                                <td><strong>Single Borrower</strong></td>
                                <td>Multiple Income (W-2 & 1099)</td>
                                <td>1 Wage/Income (borrower)</td>
                                <td><span class="badge calculated-badge">1</span></td>
                                <td><span class="badge optional-badge">No</span></td>
                            </tr>
                            <tr>
                                <td><strong>Married (one on loan)</strong></td>
                                <td>W-2 Income</td>
                                <td>1 Wage/Income (borrower)</td>
                                <td><span class="badge calculated-badge">1</span></td>
                                <td><span class="badge optional-badge">No</span></td>
                            </tr>
                            <tr>
                                <td><strong>Married Borrowers</strong></td>
                                <td>Both W-2 Income</td>
                                <td>1 Wage/Income (borrower) + 1 Wage/Income (co-borrower)</td>
                                <td><span class="badge calculated-badge">2</span></td>
                                <td><span class="badge optional-badge">No</span></td>
                            </tr>
                            <tr>
                                <td><strong>Married Borrowers</strong></td>
                                <td>One W-2; One Self-Employed</td>
                                <td>1 Wage/Income + 1 1040 + 1 Business Form</td>
                                <td><span class="badge calculated-badge">3+</span></td>
                                <td><span class="badge required-badge">Yes</span></td>
                            </tr>
                            <tr>
                                <td><strong>Married Borrowers</strong></td>
                                <td>Both Self-Employed</td>
                                <td>1 1040 (joint or separate) + Business Forms</td>
                                <td><span class="badge calculated-badge">2+</span></td>
                                <td><span class="badge required-badge">Yes</span></td>
                            </tr>
                            <tr>
                                <td><strong>Joint (Unmarried)</strong></td>
                                <td>Both W-2 Income</td>
                                <td>1 Wage/Income (borrower) + 1 Wage/Income (co-borrower)</td>
                                <td><span class="badge calculated-badge">2</span></td>
                                <td><span class="badge optional-badge">No</span></td>
                            </tr>
                            <tr>
                                <td><strong>Joint (Unmarried)</strong></td>
                                <td>One W-2, One Self-Employed</td>
                                <td>1 Wage/Income + 1 1040 + Business Forms</td>
                                <td><span class="badge calculated-badge">3+</span></td>
                                <td><span class="badge required-badge">Yes</span></td>
                            </tr>
                            <tr>
                                <td><strong>Joint (Unmarried)</strong></td>
                                <td>Both Self-Employed</td>
                                <td>1 1040 (each) + Business Forms (per business/per borrower)</td>
                                <td><span class="badge calculated-badge">3+</span></td>
                                <td><span class="badge required-badge">Yes</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Quick Reference -->
            <div id="quick-ref" class="quick-ref">
                <h3>4506-C Quick Reference</h3>
                <pre>
4506-C FORM COUNT QUICK GUIDE
=============================

TRANSCRIPT TYPES
----------------
- Wage/Income:  W-2, 1099 wage income
- 1040:         Personal tax return (self-employed)
- Business:     1065/1120/1120S returns

SINGLE BORROWER
---------------
W-2 Only:           1 Wage/Income form     | CTC: No
Schedule C:         1 1040 form            | CTC: Yes
Business Entity:    1 1040 + Business(es)  | CTC: Yes
W-2 + 1099:         1 Wage/Income form     | CTC: No

MARRIED BORROWERS (BOTH ON LOAN)
--------------------------------
Both W-2:           2 Wage/Income forms    | CTC: No
W-2 + Self-Emp:     3+ forms total         | CTC: Yes
Both Self-Emp:      2+ forms (joint 1040)  | CTC: Yes

UNMARRIED CO-BORROWERS
----------------------
Both W-2:           2 Wage/Income forms    | CTC: No
W-2 + Self-Emp:     3+ forms total         | CTC: Yes
Both Self-Emp:      3+ forms (separate)    | CTC: Yes

KEY RULES
---------
1. W-2 & 1099 = Same Wage/Income transcript
2. Married joint filers = 1 shared 1040
3. Unmarried = Separate 1040s always
4. Each business = Separate Business form
5. 1040 for CTC = Self-employed ONLY

BUSINESS FORM TYPES
-------------------
- Form 1065:  Partnership
- Form 1120:  C Corporation
- Form 1120S: S Corporation
- Schedule C: Part of 1040 (no separate form)

Updated: 7/23/2024
                </pre>
            </div>
        </div>

        <!-- ==================== AI AGENTS TAB ==================== -->
        <div id="agents-panel" class="tab-panel">
            <!-- Agent Header -->
            <div class="agent-header">
                <h1>AI Agent Opportunities</h1>
                <p class="subtitle">Automation opportunities identified for the 4506-C form determination process</p>
            </div>

            <!-- Summary Stats -->
            <div class="agent-summary" id="agent-summary">
                <div class="agent-summary-card">
                    <div class="agent-summary-value">3</div>
                    <div class="agent-summary-label">Agent Opportunities</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">85%</div>
                    <div class="agent-summary-label">Automation Potential</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">4 min</div>
                    <div class="agent-summary-label">Est. Time Saved</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">High</div>
                    <div class="agent-summary-label">Accuracy Impact</div>
                </div>
            </div>

            <!-- Heat Map Legend -->
            <div class="heat-legend">
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #ef4444, #f97316);"></div>
                    <span>Critical Priority (9-10)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #f97316, #eab308);"></div>
                    <span>High Priority (7-8)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #eab308, #22c55e);"></div>
                    <span>Medium Priority (5-6)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #22c55e, #14b8a6);"></div>
                    <span>Low Priority (1-4)</span>
                </div>
            </div>

            <!-- Heat Map Grid -->
            <div class="heat-map-container" id="agent-heatmap">
                <div class="heat-map-title">Priority Heat Map</div>
                <div class="heat-map-grid">
                    <div class="heat-item critical" onclick="scrollToAgent('agent-formcalc')">
                        <div class="heat-score">9.5</div>
                        <div class="heat-name">Form Calculator Agent</div>
                        <div class="heat-desc">Auto-calculate required 4506-C forms based on loan data</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>3 min</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-docgen')">
                        <div class="heat-score">8.2</div>
                        <div class="heat-name">Form Generator Agent</div>
                        <div class="heat-desc">Auto-generate pre-filled 4506-C forms</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>2 min</span></div>
                            <div class="heat-metric">Complexity: <span>Medium</span></div>
                        </div>
                    </div>
                    <div class="heat-item medium" onclick="scrollToAgent('agent-validator')">
                        <div class="heat-score">6.8</div>
                        <div class="heat-name">Completeness Validator</div>
                        <div class="heat-desc">Verify all required forms are present before CTC</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>1 min</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agent Details -->
            <div id="agent-details">
                <h2 style="color: var(--text-primary); margin-bottom: 25px; font-size: 1.5rem;">Agent Details</h2>
                <div class="agent-grid">
                    <!-- Form Calculator Agent -->
                    <div class="agent-card" id="agent-formcalc">
                        <div class="agent-card-header">
                            <div class="agent-icon">C</div>
                            <div class="agent-info">
                                <div class="agent-name">Form Calculator Agent</div>
                                <div class="agent-type">Decision Logic / Rules Engine</div>
                            </div>
                            <span class="agent-priority critical">Critical</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Automatically analyzes loan file data to determine the exact number and type of 4506-C forms required. Considers borrower count, marital status, income types, and business entities to calculate the complete form list.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Read Loan Data</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Apply Rules</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Calculate Forms</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Output List</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">3 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">99%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('formcalc')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Form Generator Agent -->
                    <div class="agent-card" id="agent-docgen">
                        <div class="agent-card-header">
                            <div class="agent-icon">G</div>
                            <div class="agent-info">
                                <div class="agent-name">Form Generator Agent</div>
                                <div class="agent-type">Document Automation</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Automatically generates pre-filled 4506-C forms with borrower information, SSN, addresses, and appropriate checkboxes for the required transcript types. Reduces manual data entry and transcription errors.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Get Form List</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Pull Borrower Data</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Fill PDF Fields</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Store to Docs</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">2 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">98%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Med</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('docgen')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Completeness Validator Agent -->
                    <div class="agent-card" id="agent-validator">
                        <div class="agent-card-header">
                            <div class="agent-icon">V</div>
                            <div class="agent-info">
                                <div class="agent-name">Completeness Validator</div>
                                <div class="agent-type">Quality Assurance</div>
                            </div>
                            <span class="agent-priority medium">Medium</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Validates that all required 4506-C forms and transcripts are present in the loan file before Clear to Close. Flags missing documents and generates a checklist for the processor.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Scan Stored Docs</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Compare to Required</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Flag Missing</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Generate Report</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">1 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">100%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('validator')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Documentation Modal -->
    <div class="modal-overlay" id="docModal">
        <div class="modal">
            <div class="modal-header">
                <h3>4506-C Forms Workflow Documentation</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyToClipboard()">Copy</button>
                    <button class="modal-btn close" onclick="closeDocModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <pre id="docContent"># 4506-C Form Types Needed Guide

## Overview
This guide determines how many IRS Form 4506-C (IVES Request for Transcript of Tax Return) forms are needed based on borrower scenarios and income types.

## Transcript Types

### Wage/Income Transcript
- Captures W-2 and 1099 income
- Required for W-2 wage earners

### 1040 Transcript
- Personal tax return data
- Required for self-employed borrowers

### Business Return Transcript
- For 1065 (Partnership), 1120 (C Corp), 1120S (S Corp)
- One form per business entity

## Quick Reference by Scenario

### Single Borrower
- W-2 Only: 1 Wage/Income | No CTC transcripts
- Schedule C: 1 1040 | CTC required
- Business Entity: 1 1040 + Business forms | CTC required
- W-2 + 1099: 1 Wage/Income | No CTC transcripts

### Married Borrowers (Both on Loan)
- Both W-2: 2 Wage/Income | No CTC
- One W-2 + One SE: 3+ forms | CTC required
- Both SE: 2+ forms | CTC required

### Joint Unmarried
- Both W-2: 2 Wage/Income | No CTC
- One W-2 + One SE: 3+ forms | CTC required
- Both SE: 3+ forms | CTC required

## Key Rules
1. W-2 and 1099 = Same Wage/Income transcript
2. Married joint filers = 1 shared 1040
3. Unmarried = Separate 1040s always
4. Each business = Separate Business form
5. 1040 for CTC = Self-employed ONLY

Updated: July 23, 2024</pre>
            </div>
        </div>
    </div>

    <!-- AI Prompt Modal -->
    <div class="modal-overlay prompt-modal" id="promptModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="promptModalTitle">AI Agent Build Prompt</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyPromptToClipboard()">Copy Prompt</button>
                    <button class="modal-btn close" onclick="closePromptModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="prompt-tags" id="promptTags"></div>
                <div class="prompt-section">
                    <h4>Agent Purpose</h4>
                    <div class="prompt-box" id="promptPurpose"></div>
                </div>
                <div class="prompt-section">
                    <h4>Full Build Prompt</h4>
                    <div class="prompt-box" id="promptContent"></div>
                </div>
                <div class="prompt-section">
                    <h4>Integration Points</h4>
                    <div class="prompt-box" id="promptIntegration"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="copy-success" id="copySuccess">Copied to clipboard!</div>

    <script>
        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));

            if (tab === 'workflow') {
                document.querySelector('.sidebar-tab:not(.agent-tab)').classList.add('active');
                document.getElementById('workflow-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'block';
                document.getElementById('agents-nav').style.display = 'none';
            } else {
                document.querySelector('.sidebar-tab.agent-tab').classList.add('active');
                document.getElementById('agents-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'none';
                document.getElementById('agents-nav').style.display = 'block';
            }

            window.scrollTo(0, 0);
        }

        // Scroll spy with isScrolling flag and 1000ms timeout
        const sections = document.querySelectorAll('.section, .quick-ref');
        const navItems = document.querySelectorAll('#workflow-nav .nav-item');
        let isScrolling = false;
        let scrollTimeout;

        function updateActiveNav() {
            if (isScrolling) return;

            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                if (window.scrollY >= sectionTop) current = section.getAttribute('id');
            });
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + current) item.classList.add('active');
            });
        }

        // Handle nav click to temporarily disable scroll spy
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                isScrolling = true;
                clearTimeout(scrollTimeout);

                // Remove active from all, add to clicked
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');

                // Re-enable scroll spy after 1000ms
                scrollTimeout = setTimeout(() => {
                    isScrolling = false;
                }, 1000);
            });
        });

        window.addEventListener('scroll', updateActiveNav);

        // Modal
        function openDocModal() {
            document.getElementById('docModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeDocModal() {
            document.getElementById('docModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyToClipboard() {
            try {
                await navigator.clipboard.writeText(document.getElementById('docContent').textContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeDocModal(); closePromptModal(); } });
        document.getElementById('docModal').addEventListener('click', (e) => { if (e.target.id === 'docModal') closeDocModal(); });

        document.addEventListener('DOMContentLoaded', () => { updateActiveNav(); });

        // Scroll to agent card and highlight
        function scrollToAgent(agentId) {
            const agentCard = document.getElementById(agentId);
            if (agentCard) {
                document.querySelectorAll('.agent-card.highlight').forEach(card => {
                    card.classList.remove('highlight');
                });

                agentCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

                setTimeout(() => {
                    agentCard.classList.add('highlight');
                }, 300);

                setTimeout(() => {
                    agentCard.classList.remove('highlight');
                }, 2500);
            }
        }

        // Agent Prompt System
        const agentPrompts = {
            formcalc: {
                name: 'Form Calculator Agent',
                tags: ['Decision Logic', 'Rules Engine', 'Low Complexity', 'Critical Priority'],
                purpose: `This agent automatically analyzes loan file data to determine the exact number and type of 4506-C forms required. It considers borrower count, marital status, income types, and business entities to calculate the complete form list, eliminating manual lookup and reducing errors.`,
                prompt: `You are building a Decision Logic Agent for CMG Financial's 4506-C form determination process.

AGENT NAME: Form Calculator Agent
TYPE: Decision Logic / Rules Engine

OBJECTIVE:
Create an agent that automatically calculates the required 4506-C forms based on loan file data, applying the documented business rules.

INPUT DATA FROM LOAN FILE:
- Number of borrowers
- Marital status (married/unmarried)
- Borrower names
- Income types for each borrower:
  - W-2 wage income
  - 1099 contractor income
  - Self-employed Schedule C
  - Business entity (1065/1120/1120S)
- Business entities owned (name, EIN, type)

DECISION RULES:

Rule 1: W-2 Income
- Each W-2 borrower needs 1 Wage/Income form
- W-2 + 1099 = Still just 1 Wage/Income form

Rule 2: Self-Employed Schedule C
- Each SE borrower needs 1 1040 form
- CTC transcripts: YES

Rule 3: Business Entities
- Each business (1065/1120/1120S) needs separate Business form
- Plus 1040 for the borrower

Rule 4: Married Joint Filers
- If both self-employed AND filing jointly: 1 shared 1040
- If filing separately: 1 1040 each

Rule 5: Unmarried Co-Borrowers
- Always separate 1040s for self-employed borrowers

OUTPUT FORMAT:
{
  "total_forms": 3,
  "ctc_transcripts_required": true,
  "forms": [
    {"type": "Wage/Income", "borrower": "John Smith", "ssn_last4": "1234"},
    {"type": "1040", "borrower": "Jane Smith", "ssn_last4": "5678"},
    {"type": "Business-1120S", "entity": "ABC Corp", "ein": "12-3456789"}
  ],
  "explanation": "Jane is self-employed with S-Corp, requiring 1040 and business transcript"
}`,
                integration: `INTEGRATION POINTS:
1. Loan Origination System (Byte)
   - Read borrower information
   - Read income employment records
   - Read business entity data

2. Output Destinations
   - Display form requirements in UI
   - Feed into Form Generator Agent
   - Update loan checklist/conditions

3. Validation Triggers
   - On loan creation
   - On borrower/income changes
   - Pre-submission check

DEPLOYMENT:
- Real-time calculation on data change
- Batch processing for pipeline reports
- API endpoint for external systems`
            },
            docgen: {
                name: 'Form Generator Agent',
                tags: ['Document Automation', 'PDF Generation', 'Medium Complexity', 'High Priority'],
                purpose: `This agent automatically generates pre-filled IRS Form 4506-C documents with borrower information, SSN, addresses, and appropriate checkboxes for the required transcript types. Reduces manual data entry time and eliminates transcription errors.`,
                prompt: `You are building a Document Generation Agent for CMG Financial's 4506-C form process.

AGENT NAME: Form Generator Agent
TYPE: Document Automation / PDF Generation

OBJECTIVE:
Generate pre-filled IRS Form 4506-C PDFs based on the form list from the Calculator Agent and borrower data from the loan file.

INPUT DATA:
- Form list from Calculator Agent
- For each form:
  - Borrower name
  - SSN (full)
  - Current address
  - Prior addresses (if different from tax return)
  - Tax years needed
  - Transcript type (Wage/Income, 1040, Business)
- Business entity info (if applicable):
  - Business name
  - EIN
  - Business address

FORM FIELD MAPPING:
Line 1a: Taxpayer name (borrower name or business name)
Line 1b: SSN or EIN
Line 2a: Spouse name (if joint)
Line 2b: Spouse SSN (if joint)
Line 3: Current address
Line 4: Prior address (if different from Line 3)
Line 5a-5c: Requestor info (CMG Financial)
Line 6: Transcript type checkboxes
  - Box 6a: Return Transcript
  - Box 6b: Account Transcript
  - Box 6c: Record of Account
  - Box 6d: Verification of Nonfiling
  - Box 6e: Form W-2 Transcript
Line 7: Tax form number (1040, 1065, 1120, 1120S)
Line 9: Tax years

PDF GENERATION:
- Use pdf-lib or similar for field filling
- Flatten form after filling (prevent editing)
- Generate filename: 4506C_[BorrowerLast]_[Type]_[Date].pdf

OUTPUT:
{
  "status": "success",
  "files_generated": 3,
  "documents": [
    {"filename": "4506C_Smith_WageIncome_20260127.pdf", "path": "/stored_docs/..."},
    {"filename": "4506C_Smith_1040_20260127.pdf", "path": "/stored_docs/..."},
    {"filename": "4506C_ABCCorp_1120S_20260127.pdf", "path": "/stored_docs/..."}
  ]
}`,
                integration: `INTEGRATION POINTS:
1. PDF Library
   - pdf-lib for Node.js
   - PyPDF2 for Python
   - Adobe PDF Services API

2. Document Storage
   - Save to Byte Stored Documents
   - Set document type: "4506-C"
   - Auto-categorize by transcript type

3. Signature Integration
   - Route to DocuSign/eSign
   - Pre-position signature fields
   - Track signing status

4. Audit Trail
   - Log generation timestamp
   - Record data sources used
   - Version control for form updates`
            },
            validator: {
                name: 'Completeness Validator Agent',
                tags: ['Quality Assurance', 'Document Verification', 'Low Complexity', 'Medium Priority'],
                purpose: `This agent validates that all required 4506-C forms have been signed and all corresponding IRS transcripts have been received before Clear to Close. Flags missing documents and generates a compliance checklist for the processor.`,
                prompt: `You are building a Quality Assurance Agent for CMG Financial's 4506-C compliance process.

AGENT NAME: Completeness Validator Agent
TYPE: Quality Assurance / Document Verification

OBJECTIVE:
Verify all required 4506-C forms are signed and corresponding transcripts are received before allowing Clear to Close.

INPUT DATA:
- Required forms list (from Calculator Agent)
- Stored Documents inventory
- Document metadata (type, status, date received)

VALIDATION CHECKS:

Check 1: Forms Signed
- For each required form, verify 4506-C exists in Stored Docs
- Check document status = "Signed" or "Executed"
- Verify signature date is present

Check 2: Transcripts Received (CTC Check)
- If CTC transcripts required (self-employed):
  - Verify 1040 transcript received
  - Verify business transcripts received (if applicable)
- Match transcript years to required years

Check 3: Data Consistency
- Borrower names match between form and loan
- SSN matches
- Tax years covered are correct

VALIDATION OUTPUT:
{
  "status": "INCOMPLETE",
  "ctc_ready": false,
  "checklist": [
    {"item": "4506-C Wage/Income - John Smith", "status": "COMPLETE", "signed": "2026-01-15"},
    {"item": "4506-C 1040 - Jane Smith", "status": "COMPLETE", "signed": "2026-01-15"},
    {"item": "1040 Transcript - Jane Smith", "status": "MISSING", "required_for": "CTC"},
    {"item": "1120S Transcript - ABC Corp", "status": "PENDING", "ordered": "2026-01-20"}
  ],
  "blocking_items": ["1040 Transcript - Jane Smith"],
  "recommendation": "Order 1040 transcript for Jane Smith before CTC"
}

ERROR HANDLING:
- Flag expired transcripts (older than 120 days)
- Alert on mismatched data
- Escalate repeated failures`,
                integration: `INTEGRATION POINTS:
1. Document Management
   - Scan Stored Documents for 4506-C forms
   - Check IRS transcript folder
   - Parse document metadata

2. Milestone Tracking
   - Block CTC milestone if incomplete
   - Update loan conditions
   - Notify processor of gaps

3. Reporting
   - Generate compliance report
   - Dashboard widget for pipeline view
   - Exception queue for missing items

4. IRS Integration (Future)
   - Track IVES submission status
   - Auto-retrieve transcripts when available
   - Handle IRS delays/errors`
            }
        };

        function showAgentPrompt(agentKey) {
            const agent = agentPrompts[agentKey];
            if (!agent) return;

            document.getElementById('promptModalTitle').textContent = agent.name + ' - Build Prompt';
            document.getElementById('promptTags').innerHTML = agent.tags.map(tag => `<span class="prompt-tag">${tag}</span>`).join('');
            document.getElementById('promptPurpose').textContent = agent.purpose;
            document.getElementById('promptContent').textContent = agent.prompt;
            document.getElementById('promptIntegration').textContent = agent.integration;

            document.getElementById('promptModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closePromptModal() {
            document.getElementById('promptModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyPromptToClipboard() {
            const content = document.getElementById('promptContent').textContent;
            try {
                await navigator.clipboard.writeText(content);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.getElementById('promptModal').addEventListener('click', (e) => { if (e.target.id === 'promptModal') closePromptModal(); });
    </script>
</body>
</html>
