<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payoff Request Form - Process Workflow</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: #111827;
            --bg-card: #1a2234;
            --accent-blue: #3b82f6;
            --accent-teal: #14b8a6;
            --accent-amber: #f59e0b;
            --accent-rose: #f43f5e;
            --accent-green: #22c55e;
            --accent-purple: #8b5cf6;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-subtle: rgba(255,255,255,0.08);
            --sidebar-width: 280px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Breadcrumb */
        .breadcrumb {
            background: linear-gradient(90deg, #0d1525 0%, #1a2234 100%);
            padding: 14px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
            border-bottom: 1px solid var(--border-subtle);
        }

        .breadcrumb a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            transition: all 0.2s;
            border: 1px solid var(--border-subtle);
        }

        .breadcrumb a:hover {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .breadcrumb .separator { color: var(--text-muted); font-size: 1.2rem; }
        .breadcrumb .current { color: var(--accent-amber); font-weight: 600; padding: 8px 16px; }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 54px;
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - 54px);
            background: var(--bg-secondary);
            overflow-y: auto;
            z-index: 1000;
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 25px 20px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-header h2 { color: var(--text-primary); font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
        .sidebar-header p { color: var(--text-muted); font-size: 0.85rem; }

        /* Tab Switch */
        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-tab {
            flex: 1;
            padding: 14px 10px;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            background: none;
            border-left: none;
            border-right: none;
            border-top: none;
        }

        .sidebar-tab:hover { background: rgba(255,255,255,0.03); color: var(--text-secondary); }
        .sidebar-tab.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); background: rgba(59, 130, 246, 0.08); }
        .sidebar-tab.agent-tab.active { color: var(--accent-purple); border-bottom-color: var(--accent-purple); background: rgba(139, 92, 246, 0.08); }

        .sidebar-nav { padding: 15px 0; flex: 1; overflow-y: auto; }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .nav-item:hover { background: rgba(255,255,255,0.03); color: var(--text-primary); }
        .nav-item.active { background: rgba(59, 130, 246, 0.1); border-left-color: var(--accent-blue); color: var(--text-primary); }

        .nav-number {
            background: rgba(255,255,255,0.1);
            color: var(--text-secondary);
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .nav-item.active .nav-number { background: var(--accent-blue); color: white; }
        .nav-label { font-size: 0.95rem; font-weight: 500; }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-subtle);
            background: rgba(0,0,0,0.2);
        }

        .doc-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px 20px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .doc-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3); }

        /* Main Content */
        .main-content { margin-left: var(--sidebar-width); padding: 80px 40px 40px 40px; }

        /* Tab Panels */
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        .header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(20, 184, 166, 0.08) 0%, transparent 50%);
            pointer-events: none;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        .header .meta { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; position: relative; }

        .header .meta-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-subtle);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); }
        .legend-color { width: 18px; height: 18px; border-radius: 4px; }

        /* Sections */
        .section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            margin-bottom: 25px;
            overflow: hidden;
            scroll-margin-top: 75px;
        }

        .section-header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(59, 130, 246, 0.1) 100%);
            border-bottom: 1px solid var(--border-subtle);
            padding: 22px 25px;
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .section-number {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .section-title h2 { font-size: 1.35rem; font-weight: 700; margin-bottom: 4px; color: var(--text-primary); }
        .section-title span { font-size: 0.9rem; color: var(--text-muted); }
        .section-content { padding: 28px; }

        /* Workflow Diagrams */
        .workflow-diagram {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 28px;
            margin-bottom: 22px;
        }

        .flow-row { display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 12px; margin: 15px 0; }

        .flow-node {
            padding: 14px 22px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            min-width: 150px;
            border: 1px solid var(--border-subtle);
        }

        .flow-node.start { background: linear-gradient(135deg, var(--accent-green) 0%, #16a34a 100%); color: white; border-radius: 25px; border: none; }
        .flow-node.action { background: linear-gradient(135deg, var(--accent-blue) 0%, #2563eb 100%); color: white; border: none; }
        .flow-node.decision { background: linear-gradient(135deg, var(--accent-amber) 0%, #d97706 100%); color: var(--bg-primary); border: none; }
        .flow-node.input { background: var(--bg-secondary); border: 2px solid var(--accent-blue); color: var(--text-primary); }
        .flow-node.output { background: linear-gradient(135deg, var(--accent-teal) 0%, #0d9488 100%); color: white; border: none; }
        .flow-node.exception { background: linear-gradient(135deg, var(--accent-rose) 0%, #dc2626 100%); color: white; border: none; }

        .flow-arrow { color: var(--accent-blue); font-size: 1.5rem; }
        .flow-arrow.down { transform: rotate(90deg); }

        .decision-branch { display: flex; gap: 40px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
        .branch { display: flex; flex-direction: column; align-items: center; gap: 10px; }

        .branch-label {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        /* Tables */
        .field-table { width: 100%; border-collapse: collapse; margin: 18px 0; }

        .field-table th {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            padding: 14px 18px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border-subtle);
        }

        .field-table td { padding: 14px 18px; border-bottom: 1px solid var(--border-subtle); color: var(--text-secondary); }
        .field-table tr:hover { background: rgba(255,255,255,0.02); }

        .badge { display: inline-block; padding: 4px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge.required-badge { background: rgba(244, 63, 94, 0.15); color: var(--accent-rose); }
        .badge.optional-badge { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .badge.calculated-badge { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }

        /* Info Boxes */
        .exception-box, .tip-box, .info-box {
            padding: 18px 22px;
            margin: 18px 0;
            border-radius: 0 10px 10px 0;
            border-left-width: 4px;
            border-left-style: solid;
        }

        .exception-box { background: rgba(244, 63, 94, 0.08); border-color: var(--accent-rose); border: 1px solid rgba(244, 63, 94, 0.2); border-left: 4px solid var(--accent-rose); }
        .exception-box h4 { color: var(--accent-rose); margin-bottom: 10px; font-size: 1rem; }
        .exception-box p, .exception-box li { color: var(--text-secondary); }

        .tip-box { background: rgba(34, 197, 94, 0.08); border-color: var(--accent-green); border: 1px solid rgba(34, 197, 94, 0.2); border-left: 4px solid var(--accent-green); }
        .tip-box h4 { color: var(--accent-green); margin-bottom: 10px; font-size: 1rem; }
        .tip-box p, .tip-box li { color: var(--text-secondary); }

        .info-box { background: rgba(59, 130, 246, 0.08); border-color: var(--accent-blue); border: 1px solid rgba(59, 130, 246, 0.2); border-left: 4px solid var(--accent-blue); }
        .info-box h4 { color: var(--accent-blue); margin-bottom: 10px; font-size: 1rem; }
        .info-box p, .info-box li { color: var(--text-secondary); }

        /* Decision Tree */
        .decision-tree {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 22px;
            margin: 22px 0;
        }

        .decision-tree h3 { color: var(--accent-blue); margin-bottom: 18px; padding-bottom: 12px; border-bottom: 1px solid var(--border-subtle); font-size: 1.1rem; }

        .tree-node { margin-left: 20px; padding: 12px; border-left: 2px solid var(--accent-teal); position: relative; color: var(--text-secondary); }
        .tree-node::before { content: ''; position: absolute; left: -2px; top: 22px; width: 15px; height: 2px; background: var(--accent-teal); }
        .tree-node.level-1 { margin-left: 0; border-left: none; }
        .tree-node.level-1::before { display: none; }

        .tree-label { background: var(--accent-amber); color: var(--bg-primary); padding: 6px 14px; border-radius: 6px; font-weight: 700; display: inline-block; margin-bottom: 6px; font-size: 0.9rem; }

        /* Summary Grid */
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 18px; margin: 22px 0; }

        .summary-card { background: rgba(0,0,0,0.3); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 22px; text-align: center; }
        .summary-card h4 { color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9rem; }
        .summary-card .value {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .summary-card .label { font-size: 0.85rem; color: var(--text-muted); margin-top: 8px; }

        /* Quick Reference */
        .quick-ref {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
            border: 1px solid var(--border-subtle);
            padding: 28px;
            border-radius: 16px;
            margin-top: 30px;
            font-family: 'JetBrains Mono', monospace;
            scroll-margin-top: 75px;
        }

        .quick-ref h3 { color: var(--accent-amber); margin-bottom: 18px; font-family: 'Plus Jakarta Sans', sans-serif; }
        .quick-ref pre { background: rgba(0,0,0,0.4); border: 1px solid var(--border-subtle); padding: 20px; border-radius: 10px; overflow-x: auto; font-size: 0.85rem; line-height: 1.7; color: var(--text-secondary); }

        /* Step List */
        .step-list { list-style: none; padding: 0; margin: 18px 0; }
        .step-list li {
            padding: 14px 18px;
            border-left: 3px solid var(--accent-blue);
            background: rgba(0,0,0,0.2);
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
        }
        .step-list li strong { color: var(--text-primary); }

        /* ====== AGENT OPPORTUNITIES STYLES ====== */
        .agent-header {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .agent-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(139, 92, 246, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .agent-header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-header .subtitle { color: var(--text-secondary); font-size: 1.1rem; position: relative; }

        /* Heat Map */
        .heat-map-container { margin-bottom: 35px; }
        .heat-map-title { font-size: 1.3rem; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }

        .heat-map-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .heat-item {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .heat-item:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .heat-item:active { transform: scale(0.98); }

        .heat-item::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 4px;
        }

        .heat-item.critical::before { background: linear-gradient(90deg, #ef4444, #f97316); }
        .heat-item.high::before { background: linear-gradient(90deg, #f97316, #eab308); }
        .heat-item.medium::before { background: linear-gradient(90deg, #eab308, #22c55e); }
        .heat-item.low::before { background: linear-gradient(90deg, #22c55e, #14b8a6); }

        .heat-score {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.8rem;
            font-weight: 800;
        }

        .heat-item.critical .heat-score { color: #ef4444; }
        .heat-item.high .heat-score { color: #f97316; }
        .heat-item.medium .heat-score { color: #eab308; }
        .heat-item.low .heat-score { color: #22c55e; }

        .heat-name { font-size: 1rem; font-weight: 700; color: var(--text-primary); margin-bottom: 6px; padding-right: 50px; }
        .heat-desc { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; }

        .heat-metrics { display: flex; gap: 15px; margin-top: 12px; }
        .heat-metric { font-size: 0.75rem; color: var(--text-muted); }
        .heat-metric span { color: var(--text-secondary); font-weight: 600; }

        /* Agent Cards */
        .agent-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 25px; margin-bottom: 35px; }

        .agent-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .agent-card:hover { transform: translateY(-5px); box-shadow: 0 15px 50px rgba(0,0,0,0.3); }

        .agent-card.highlight {
            animation: highlightPulse 2s ease;
            box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.4);
        }

        @keyframes highlightPulse {
            0% { box-shadow: 0 0 0 3px var(--accent-purple), 0 15px 50px rgba(139, 92, 246, 0.6); }
            50% { box-shadow: 0 0 0 6px rgba(139, 92, 246, 0.5), 0 15px 50px rgba(139, 92, 246, 0.3); }
            100% { box-shadow: 0 0 0 0px transparent, 0 15px 50px rgba(0,0,0,0.3); }
        }

        .agent-card-header {
            padding: 22px;
            display: flex;
            align-items: flex-start;
            gap: 18px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .agent-icon {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            flex-shrink: 0;
        }

        .agent-info { flex: 1; }
        .agent-name { font-size: 1.15rem; font-weight: 700; color: var(--text-primary); margin-bottom: 5px; }
        .agent-type { font-size: 0.8rem; color: var(--accent-purple); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-priority {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .agent-priority.critical { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .agent-priority.high { background: rgba(249, 115, 22, 0.15); color: #f97316; }
        .agent-priority.medium { background: rgba(234, 179, 8, 0.15); color: #eab308; }
        .agent-priority.low { background: rgba(34, 197, 94, 0.15); color: #22c55e; }

        .agent-card-body { padding: 22px; }
        .agent-description { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; }

        .agent-flow {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 20px;
        }

        .agent-flow-title { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

        .agent-flow-diagram { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; justify-content: center; }

        .agent-step {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .agent-arrow { color: var(--accent-purple); font-size: 1.2rem; }

        .agent-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }

        .agent-stat {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .agent-stat-value {
            font-size: 1.3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-top: 4px; }

        /* View Prompt Button */
        .agent-prompt-btn {
            width: 100%;
            margin-top: 18px;
            padding: 14px 20px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 10px;
            color: var(--accent-purple);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .agent-prompt-btn:hover {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(59, 130, 246, 0.3) 100%);
            border-color: var(--accent-purple);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.25);
        }

        /* Summary Stats */
        .agent-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .agent-summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            padding: 25px;
            text-align: center;
        }

        .agent-summary-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .agent-summary-label { font-size: 0.9rem; color: var(--text-muted); margin-top: 8px; }

        /* Heat Map Legend */
        .heat-legend {
            display: flex;
            gap: 25px;
            padding: 18px 22px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .heat-legend-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; color: var(--text-secondary); }
        .heat-legend-color { width: 24px; height: 24px; border-radius: 6px; }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(10, 15, 26, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.show { display: flex; }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            width: 100%;
            max-width: 950px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 80px rgba(0,0,0,0.5);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: white;
            padding: 22px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 16px 16px 0 0;
        }

        .modal-header h3 { font-size: 1.25rem; font-weight: 700; }
        .modal-actions { display: flex; gap: 12px; }

        .modal-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: transform 0.2s;
            font-size: 0.9rem;
        }

        .modal-btn:hover { transform: scale(1.05); }
        .modal-btn.copy { background: white; color: var(--accent-blue); }
        .modal-btn.close { background: rgba(255,255,255,0.2); color: white; }

        .modal-body { padding: 28px; overflow-y: auto; flex: 1; }

        .modal-body pre {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-subtle);
            padding: 22px;
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.7;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--text-secondary);
        }

        .copy-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--accent-green);
            color: white;
            padding: 18px 35px;
            border-radius: 10px;
            font-weight: 700;
            z-index: 3000;
            display: none;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut { 0%, 100% { opacity: 0; } 10%, 90% { opacity: 1; } }

        /* Prompt Modal */
        .prompt-modal .modal { max-width: 800px; }
        .prompt-modal .modal-header { background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%); }

        .prompt-section { margin-bottom: 25px; }
        .prompt-section h4 { color: var(--accent-purple); font-size: 1rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }

        .prompt-box {
            background: rgba(0,0,0,0.4);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.7;
            color: var(--text-secondary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .prompt-tags { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .prompt-tag { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }

        .copy-prompt-btn {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 15px;
        }

        .copy-prompt-btn:hover { transform: scale(1.05); box-shadow: 0 5px 20px rgba(139, 92, 246, 0.3); }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 75px 20px 30px 20px; }
            .agent-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <a href="../../index.html">Portal Home</a>
        <span class="separator">></span>
        <a href="./index.html">Mortgage Fundamentals</a>
        <span class="separator">></span>
        <span class="current">Payoff Request Form</span>
    </nav>

    <!-- Fixed Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>Payoff Request</h2>
            <p>Interactive Workflow Guide</p>
        </div>

        <!-- Tab Switcher -->
        <div class="sidebar-tabs">
            <button class="sidebar-tab active" onclick="switchTab('workflow')">Workflow</button>
            <button class="sidebar-tab agent-tab" onclick="switchTab('agents')">AI Agents</button>
        </div>

        <!-- Workflow Navigation -->
        <nav class="sidebar-nav" id="workflow-nav">
            <a href="#section-1" class="nav-item active">
                <span class="nav-number">1</span>
                <span class="nav-label">Form Overview</span>
            </a>
            <a href="#section-2" class="nav-item">
                <span class="nav-number">2</span>
                <span class="nav-label">When to Use</span>
            </a>
            <a href="#section-3" class="nav-item">
                <span class="nav-number">3</span>
                <span class="nav-label">Required Fields</span>
            </a>
            <a href="#section-4" class="nav-item">
                <span class="nav-number">4</span>
                <span class="nav-label">Completing the Form</span>
            </a>
            <a href="#section-5" class="nav-item">
                <span class="nav-number">5</span>
                <span class="nav-label">Submission Process</span>
            </a>
            <a href="#section-6" class="nav-item">
                <span class="nav-number">6</span>
                <span class="nav-label">Follow-Up & Tracking</span>
            </a>
            <a href="#section-7" class="nav-item">
                <span class="nav-number">7</span>
                <span class="nav-label">Common Issues</span>
            </a>
            <a href="#quick-ref" class="nav-item">
                <span class="nav-number">*</span>
                <span class="nav-label">Quick Reference</span>
            </a>
        </nav>

        <!-- Agent Navigation -->
        <nav class="sidebar-nav" id="agents-nav" style="display: none;">
            <a href="#agent-summary" class="nav-item active">
                <span class="nav-number">S</span>
                <span class="nav-label">Summary</span>
            </a>
            <a href="#agent-heatmap" class="nav-item">
                <span class="nav-number">H</span>
                <span class="nav-label">Heat Map</span>
            </a>
            <a href="#agent-details" class="nav-item">
                <span class="nav-number">A</span>
                <span class="nav-label">Agent Details</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="doc-btn" onclick="openDocModal()">
                View Workflow Markdown
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

        <!-- ==================== WORKFLOW TAB ==================== -->
        <div id="workflow-panel" class="tab-panel active">
            <!-- Header -->
            <div class="header">
                <h1>Payoff Request Form</h1>
                <p class="subtitle">Complete guide for requesting payoff statements from lenders and creditors to satisfy existing liens during refinance or purchase transactions</p>
                <div class="meta">
                    <span class="meta-item">Document: CMG Financial Form</span>
                    <span class="meta-item">Role: Loan Processor</span>
                    <span class="meta-item">Version: 03/01/2021</span>
                    <span class="meta-item">Duration: 2-5 min to complete</span>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #22c55e, #16a34a);"></div><span>Start/End</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></div><span>Action Step</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></div><span>Decision Point</span></div>
                <div class="legend-item"><div class="legend-color" style="background: #111827; border: 2px solid #3b82f6;"></div><span>User Input</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f43f5e, #dc2626);"></div><span>Exception</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #14b8a6, #0d9488);"></div><span>Output</span></div>
            </div>

            <!-- Section 1: Form Overview -->
            <section id="section-1" class="section">
                <div class="section-header">
                    <div class="section-number">1</div>
                    <div class="section-title"><h2>Form Overview</h2><span>Understanding the purpose and structure of the Payoff Request Form</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Identify Payoff Need</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Obtain Form</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Complete Fields</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Submit to Lender/Creditor</div>
                        </div>
                    </div>
                    <div class="info-box">
                        <h4>What is a Payoff Request Form?</h4>
                        <p>The Payoff Request Form is an official CMG Financial document used to request a payoff statement from an existing lender or creditor. A payoff statement provides the exact amount needed to satisfy and close an existing loan or debt as of a specific date. This is essential for refinance transactions and purchase transactions where the borrower has existing liens that must be satisfied at closing.</p>
                    </div>
                    <div class="tip-box">
                        <h4>CMG Financial Branding</h4>
                        <p>This form features CMG Financial Services, Inc. branding and includes the company's licensing information. The form is dated 03/01/2021 and directs any questions to the Loan Processor handling the file.</p>
                    </div>

                    <div class="summary-grid">
                        <div class="summary-card">
                            <h4>Form Fields</h4>
                            <div class="value">6</div>
                            <div class="label">Required Data Points</div>
                        </div>
                        <div class="summary-card">
                            <h4>Typical Response</h4>
                            <div class="value">3-7</div>
                            <div class="label">Business Days</div>
                        </div>
                        <div class="summary-card">
                            <h4>Validity Period</h4>
                            <div class="value">10-30</div>
                            <div class="label">Days (Varies)</div>
                        </div>
                        <div class="summary-card">
                            <h4>Format</h4>
                            <div class="value">PDF</div>
                            <div class="label">Fillable Form</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 2: When to Use -->
            <section id="section-2" class="section">
                <div class="section-header">
                    <div class="section-number">2</div>
                    <div class="section-title"><h2>When to Use This Form</h2><span>Identifying scenarios that require a payoff request</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node decision">Transaction Type?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">Refinance</span>
                                <div class="flow-node action">Payoff Existing Mortgage</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">Purchase</span>
                                <div class="flow-node action">Payoff Seller's Mortgage</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">Debt Consolidation</span>
                                <div class="flow-node action">Payoff Credit Accounts</div>
                            </div>
                        </div>
                    </div>

                    <div class="decision-tree">
                        <h3>Common Use Cases</h3>
                        <ul class="step-list">
                            <li><strong>Rate and Term Refinance:</strong> Request payoff from the borrower's current mortgage lender to determine exact payoff amount for the existing first mortgage</li>
                            <li><strong>Cash-Out Refinance:</strong> Request payoffs for first mortgage and any subordinate liens (HELOCs, second mortgages) that will be paid off</li>
                            <li><strong>Purchase Transaction:</strong> Request payoff for seller's existing mortgage when handling payoff at closing (less common)</li>
                            <li><strong>Debt Consolidation:</strong> Request payoffs from credit card companies, auto lenders, or other creditors when consolidating debt into new mortgage</li>
                            <li><strong>Lien Subordination Alternative:</strong> When subordination is not possible and the lien must be paid off instead</li>
                        </ul>
                    </div>

                    <div class="exception-box">
                        <h4>Important: Good Through Date Selection</h4>
                        <p>The "Good Through Date" should be set to cover the expected closing date plus a buffer period. Payoff statements are only valid until this date. If closing is delayed beyond the good through date, a new payoff request may be required. Consider adding 7-10 days beyond the expected closing date as a buffer.</p>
                    </div>
                </div>
            </section>

            <!-- Section 3: Required Fields -->
            <section id="section-3" class="section">
                <div class="section-header">
                    <div class="section-number">3</div>
                    <div class="section-title"><h2>Required Fields</h2><span>Understanding each field on the Payoff Request Form</span></div>
                </div>
                <div class="section-content">
                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Field Name</th>
                                <th>Description</th>
                                <th>Data Source</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Date</strong></td>
                                <td>The date the payoff request is being submitted</td>
                                <td>Current date when completing form</td>
                                <td><span class="badge required-badge">Required</span></td>
                            </tr>
                            <tr>
                                <td><strong>Credit/Lender Name</strong></td>
                                <td>Name of the institution holding the loan or credit account to be paid off</td>
                                <td>Credit report, loan statements, or borrower-provided documents</td>
                                <td><span class="badge required-badge">Required</span></td>
                            </tr>
                            <tr>
                                <td><strong>Account/Loan Number</strong></td>
                                <td>The unique identifier for the account or loan being paid off</td>
                                <td>Credit report, loan statements, or borrower-provided documents</td>
                                <td><span class="badge required-badge">Required</span></td>
                            </tr>
                            <tr>
                                <td><strong>Good Through Date</strong></td>
                                <td>The date through which the payoff amount should remain valid</td>
                                <td>Calculated based on expected closing date + buffer</td>
                                <td><span class="badge required-badge">Required</span></td>
                            </tr>
                            <tr>
                                <td><strong>Borrower(s)</strong></td>
                                <td>Full legal name(s) of the borrower(s) on the account (two lines provided for multiple borrowers)</td>
                                <td>Loan application, credit report</td>
                                <td><span class="badge required-badge">Required</span></td>
                            </tr>
                            <tr>
                                <td><strong>Address</strong></td>
                                <td>Property address or borrower's mailing address associated with the account (Street, City, State, ZIP)</td>
                                <td>Loan application, credit report, property records</td>
                                <td><span class="badge required-badge">Required</span></td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="info-box">
                        <h4>Address Format</h4>
                        <p>The form provides two address lines: the first for the street address, and the second line is formatted for City, State, and ZIP code separated by blanks. Ensure the property address matches exactly as it appears on the existing loan documents.</p>
                    </div>

                    <div class="tip-box">
                        <h4>Contact Information</h4>
                        <p>The form includes a note that "Any questions can be directed to the Loan Processor at" - this allows the processor to add their contact information so the lender/creditor can reach out with questions about the request.</p>
                    </div>
                </div>
            </section>

            <!-- Section 4: Completing the Form -->
            <section id="section-4" class="section">
                <div class="section-header">
                    <div class="section-number">4</div>
                    <div class="section-title"><h2>Completing the Form</h2><span>Step-by-step instructions for filling out the Payoff Request</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node start">Gather Information</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Fill Form Fields</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Verify Accuracy</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node output">Save/Print Form</div>
                        </div>
                    </div>

                    <ul class="step-list">
                        <li><strong>Step 1 - Gather Required Information:</strong> Before completing the form, gather the borrower's credit report, existing loan statements, and verify the account/loan number. Confirm the correct lender name (some loans are serviced by different companies than the original lender).</li>
                        <li><strong>Step 2 - Enter the Date:</strong> Enter the current date in the "Date" field. Use MM/DD/YYYY format (e.g., 03/01/2021).</li>
                        <li><strong>Step 3 - Enter Credit/Lender Name:</strong> Enter the full legal name of the lender or creditor. For mortgages, use the servicer name if different from the original lender. Example: "Wells Fargo Home Mortgage" or "Bank of America, N.A."</li>
                        <li><strong>Step 4 - Enter Account/Loan Number:</strong> Enter the complete account or loan number as it appears on the credit report or loan statement. Double-check for accuracy as errors can delay the payoff response.</li>
                        <li><strong>Step 5 - Calculate Good Through Date:</strong> Determine the expected closing date and add 7-10 business days as a buffer. Enter this date in the "Good Through Date" field. Example: If closing is expected 01/15, use 01/25 as good through date.</li>
                        <li><strong>Step 6 - Enter Borrower Name(s):</strong> Enter the full legal name of the primary borrower on the first line. If there are co-borrowers on the account, enter the co-borrower's name on the second line. Names should match exactly as they appear on the existing loan.</li>
                        <li><strong>Step 7 - Enter Property/Mailing Address:</strong> Enter the street address on the first address line. On the second line, enter the City, State (abbreviation), and ZIP code. For mortgage payoffs, use the property address. For credit accounts, use the borrower's mailing address.</li>
                        <li><strong>Step 8 - Add Processor Contact (Optional):</strong> Add your name, phone number, and/or email after "the Loan Processor at" so the lender can contact you with questions.</li>
                        <li><strong>Step 9 - Review and Save:</strong> Review all entries for accuracy, then save and/or print the completed form for submission.</li>
                    </ul>

                    <div class="exception-box">
                        <h4>Critical Accuracy Check</h4>
                        <p>Before submitting, verify:</p>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>Account/Loan number matches credit report and statements exactly</li>
                            <li>Borrower names match existing loan documents</li>
                            <li>Lender/Servicer name is current (may have changed due to loan sale/transfer)</li>
                            <li>Good through date provides adequate buffer beyond expected closing</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 5: Submission Process -->
            <section id="section-5" class="section">
                <div class="section-header">
                    <div class="section-number">5</div>
                    <div class="section-title"><h2>Submission Process</h2><span>How to submit the payoff request to lenders and creditors</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Identify Submission Method</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Submission Type?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">Fax</span>
                                <div class="flow-node action">Fax to Payoff Dept</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">Email</span>
                                <div class="flow-node action">Email to Payoff Dept</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">Online Portal</span>
                                <div class="flow-node action">Submit via Portal</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">Phone</span>
                                <div class="flow-node action">Call Payoff Line</div>
                            </div>
                        </div>
                    </div>

                    <div class="decision-tree">
                        <h3>Submission Methods by Lender Type</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 15px;">Different lenders accept payoff requests through various channels. Contact the lender's payoff department to confirm their preferred method.</p>
                        <ul class="step-list">
                            <li><strong>Major Mortgage Servicers:</strong> Most have dedicated payoff request portals or automated phone systems. Many offer same-day or next-day digital payoff statements.</li>
                            <li><strong>Credit Unions/Small Banks:</strong> Often prefer fax or email to their payoff department. Response times may be 3-5 business days.</li>
                            <li><strong>Credit Card Companies:</strong> Typically provide payoff information via phone or online account access. May require written request for official payoff letter.</li>
                            <li><strong>Auto Lenders:</strong> Usually have dedicated payoff phone lines with automated systems. Can often provide verbal payoff amounts immediately with written confirmation to follow.</li>
                            <li><strong>HELOC/Second Mortgage Servicers:</strong> Process varies widely - contact the servicer directly to determine their preferred submission method.</li>
                        </ul>
                    </div>

                    <table class="field-table">
                        <thead>
                            <tr>
                                <th>Submission Method</th>
                                <th>Best For</th>
                                <th>Typical Response Time</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Online Portal</strong></td>
                                <td>Major servicers with digital systems</td>
                                <td>Same day to 24 hours</td>
                            </tr>
                            <tr>
                                <td><strong>Automated Phone</strong></td>
                                <td>Quick verbal payoff amounts</td>
                                <td>Immediate (verbal) / 3-5 days (written)</td>
                            </tr>
                            <tr>
                                <td><strong>Fax</strong></td>
                                <td>Formal written requests, traditional lenders</td>
                                <td>3-7 business days</td>
                            </tr>
                            <tr>
                                <td><strong>Email</strong></td>
                                <td>Lenders accepting electronic submissions</td>
                                <td>2-5 business days</td>
                            </tr>
                            <tr>
                                <td><strong>Mail</strong></td>
                                <td>Last resort only</td>
                                <td>7-14 business days</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="tip-box">
                        <h4>Authorization Requirements</h4>
                        <p>Many lenders require borrower authorization before releasing payoff information to third parties. Ensure you have a signed authorization letter or use CMG's standard authorization form if required by the lender.</p>
                    </div>
                </div>
            </section>

            <!-- Section 6: Follow-Up & Tracking -->
            <section id="section-6" class="section">
                <div class="section-header">
                    <div class="section-number">6</div>
                    <div class="section-title"><h2>Follow-Up & Tracking</h2><span>Managing payoff requests through to receipt</span></div>
                </div>
                <div class="section-content">
                    <div class="workflow-diagram">
                        <div class="flow-row">
                            <div class="flow-node action">Submit Request</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node action">Log Submission</div>
                            <span class="flow-arrow">-></span>
                            <div class="flow-node decision">Received?</div>
                        </div>
                        <div class="decision-branch">
                            <div class="branch">
                                <span class="branch-label">YES</span>
                                <div class="flow-node output">Verify & Store</div>
                            </div>
                            <div class="branch">
                                <span class="branch-label">NO</span>
                                <div class="flow-node action">Follow Up</div>
                            </div>
                        </div>
                    </div>

                    <ul class="step-list">
                        <li><strong>Step 1 - Log the Request:</strong> Document when and how the payoff request was submitted. Note the submission date, method (fax/email/portal), confirmation number (if any), and expected response timeframe.</li>
                        <li><strong>Step 2 - Set Follow-Up Reminder:</strong> Set a calendar reminder to follow up if payoff is not received within the expected timeframe. For most lenders, follow up after 5 business days if no response.</li>
                        <li><strong>Step 3 - Verify Receipt:</strong> When payoff statement is received, verify it includes: payoff amount, per diem interest, good through date, wiring instructions, and any prepayment penalties or fees.</li>
                        <li><strong>Step 4 - Store in Loan File:</strong> Save the payoff statement to the loan file in the appropriate document category. Index as "Payoff Statement" or per your company's naming convention.</li>
                        <li><strong>Step 5 - Notify Title/Closing:</strong> Forward the payoff statement to the title company or closing department so they can prepare the HUD/Closing Disclosure with accurate payoff figures.</li>
                        <li><strong>Step 6 - Monitor Expiration:</strong> Track the good through date. If closing is delayed beyond this date, request an updated payoff statement before closing.</li>
                    </ul>

                    <div class="info-box">
                        <h4>Payoff Statement Components to Verify</h4>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li><strong>Principal Balance:</strong> Current outstanding principal</li>
                            <li><strong>Accrued Interest:</strong> Interest due through the good through date</li>
                            <li><strong>Per Diem:</strong> Daily interest amount for days beyond good through date</li>
                            <li><strong>Fees:</strong> Recording fees, release fees, prepayment penalties</li>
                            <li><strong>Total Payoff Amount:</strong> Sum of all components</li>
                            <li><strong>Wire Instructions:</strong> Where to send payoff funds</li>
                            <li><strong>Good Through Date:</strong> When the payoff amount expires</li>
                        </ul>
                    </div>

                    <div class="exception-box">
                        <h4>Escalation Process</h4>
                        <p>If payoff is not received after 7-10 business days and multiple follow-up attempts:</p>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>Escalate to lender's supervisor or management</li>
                            <li>Request expedited processing due to closing timeline</li>
                            <li>Document all escalation attempts in the loan file</li>
                            <li>Consider alternative methods (borrower contacting lender directly)</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 7: Common Issues -->
            <section id="section-7" class="section">
                <div class="section-header">
                    <div class="section-number">7</div>
                    <div class="section-title"><h2>Common Issues & Troubleshooting</h2><span>Resolving typical problems with payoff requests</span></div>
                </div>
                <div class="section-content">
                    <div class="decision-tree">
                        <h3>Issue: Account Number Not Found</h3>
                        <ul class="step-list">
                            <li><strong>Cause:</strong> Account number may have changed due to loan sale/transfer, or typo in the request</li>
                            <li><strong>Solution:</strong> Verify account number against most recent statement. Contact borrower to confirm current account number. Check if loan was sold/transferred to new servicer.</li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Issue: Authorization Required</h3>
                        <ul class="step-list">
                            <li><strong>Cause:</strong> Lender requires written authorization from borrower to release payoff information</li>
                            <li><strong>Solution:</strong> Obtain signed authorization letter from borrower. Include with payoff request on re-submission. Some lenders accept verbal authorization with borrower on the line.</li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Issue: Good Through Date Expired</h3>
                        <ul class="step-list">
                            <li><strong>Cause:</strong> Closing was delayed beyond the payoff statement's valid date</li>
                            <li><strong>Solution:</strong> Request updated payoff statement with new good through date. Some lenders allow per diem calculation to extend the payoff. Verify new total before closing.</li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Issue: Payoff Amount Disputed</h3>
                        <ul class="step-list">
                            <li><strong>Cause:</strong> Borrower believes payoff amount is incorrect (fees, prepayment penalty, etc.)</li>
                            <li><strong>Solution:</strong> Request itemized payoff breakdown from lender. Have borrower review their loan documents for prepayment penalty terms. Escalate disputes through lender's customer service.</li>
                        </ul>
                    </div>

                    <div class="decision-tree">
                        <h3>Issue: Missing Wire Instructions</h3>
                        <ul class="step-list">
                            <li><strong>Cause:</strong> Payoff statement received without wiring instructions for fund transfer</li>
                            <li><strong>Solution:</strong> Contact lender's payoff department directly to obtain wire instructions. Some lenders have separate wire instruction requests. Verify wire details match company name.</li>
                        </ul>
                    </div>

                    <div class="tip-box">
                        <h4>Pro Tips for Faster Payoffs</h4>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>Request payoffs early in the loan process - don't wait until close to closing</li>
                            <li>Use online portals when available for fastest response times</li>
                            <li>Include borrower's written authorization with initial request to avoid delays</li>
                            <li>Request the good through date extend 10+ days beyond expected closing</li>
                            <li>For multiple payoffs, submit all requests simultaneously</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Quick Reference -->
            <div id="quick-ref" class="quick-ref">
                <h3>Payoff Request Quick Reference</h3>
                <pre>
PAYOFF REQUEST FORM - CMG FINANCIAL
====================================

FORM FIELDS CHECKLIST
---------------------
[ ] Date: Current date (MM/DD/YYYY)
[ ] Credit/Lender Name: Full legal name of servicer
[ ] Account/Loan Number: Exact number from credit report/statement
[ ] Good Through Date: Expected closing + 7-10 days buffer
[ ] Borrower(s): Full legal name(s) as on existing loan
[ ] Address: Property or mailing address (Street / City, State, ZIP)

GOOD THROUGH DATE CALCULATION
-----------------------------
Expected Closing Date: ____________
+ Buffer Days:         + 7-10 days
----------------------------------
Good Through Date:     ____________

Example: Closing 02/15 -> Good Through 02/25

SUBMISSION METHODS (by speed)
-----------------------------
1. Online Portal    -> Same day to 24 hours
2. Phone (verbal)   -> Immediate / Written: 3-5 days
3. Email            -> 2-5 business days
4. Fax              -> 3-7 business days
5. Mail             -> 7-14 business days (avoid if possible)

PAYOFF STATEMENT - VERIFY THESE ITEMS
-------------------------------------
[ ] Principal balance
[ ] Accrued interest through good through date
[ ] Per diem interest rate
[ ] Fees (recording, release, prepayment penalty)
[ ] Total payoff amount
[ ] Wire instructions (bank, routing, account)
[ ] Good through date
[ ] Contact for questions

COMMON ISSUES & SOLUTIONS
-------------------------
Account Not Found     -> Verify account # / Check for loan transfer
Authorization Needed  -> Obtain signed borrower authorization
Expired Good Through  -> Request updated payoff statement
Amount Disputed       -> Request itemized breakdown
Missing Wire Info     -> Contact payoff department directly

FOLLOW-UP TIMELINE
------------------
Day 0:    Submit request, log details
Day 3:    Check for response
Day 5:    First follow-up if no response
Day 7:    Second follow-up, request escalation
Day 10:   Escalate to management, explore alternatives

CMG FINANCIAL LICENSING
-----------------------
CMG Mortgage, Inc., NMLS# 1820
California Residential Mortgage Lending Act No. 4150025
www.cmgfi.com | www.nmlsconsumeraccess.org
                </pre>
            </div>
        </div>

        <!-- ==================== AI AGENTS TAB ==================== -->
        <div id="agents-panel" class="tab-panel">
            <!-- Agent Header -->
            <div class="agent-header">
                <h1>AI Agent Opportunities</h1>
                <p class="subtitle">Automation opportunities identified for the Payoff Request process</p>
            </div>

            <!-- Summary Stats -->
            <div class="agent-summary" id="agent-summary">
                <div class="agent-summary-card">
                    <div class="agent-summary-value">4</div>
                    <div class="agent-summary-label">Agent Opportunities</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">85%</div>
                    <div class="agent-summary-label">Automation Potential</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">15 min</div>
                    <div class="agent-summary-label">Est. Time Saved</div>
                </div>
                <div class="agent-summary-card">
                    <div class="agent-summary-value">High</div>
                    <div class="agent-summary-label">Accuracy Impact</div>
                </div>
            </div>

            <!-- Heat Map Legend -->
            <div class="heat-legend">
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #ef4444, #f97316);"></div>
                    <span>Critical Priority (9-10)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #f97316, #eab308);"></div>
                    <span>High Priority (7-8)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #eab308, #22c55e);"></div>
                    <span>Medium Priority (5-6)</span>
                </div>
                <div class="heat-legend-item">
                    <div class="heat-legend-color" style="background: linear-gradient(90deg, #22c55e, #14b8a6);"></div>
                    <span>Low Priority (1-4)</span>
                </div>
            </div>

            <!-- Heat Map Grid -->
            <div class="heat-map-container" id="agent-heatmap">
                <div class="heat-map-title">Priority Heat Map</div>
                <div class="heat-map-grid">
                    <div class="heat-item critical" onclick="scrollToAgent('agent-autofill')">
                        <div class="heat-score">9.4</div>
                        <div class="heat-name">Auto-Fill Agent</div>
                        <div class="heat-desc">Auto-populate form fields from credit report and LOS data</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>5 min</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-submission')">
                        <div class="heat-score">8.2</div>
                        <div class="heat-name">Smart Submission Agent</div>
                        <div class="heat-desc">Auto-route and submit payoff requests to lenders</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>8 min</span></div>
                            <div class="heat-metric">Complexity: <span>Medium</span></div>
                        </div>
                    </div>
                    <div class="heat-item high" onclick="scrollToAgent('agent-tracker')">
                        <div class="heat-score">7.8</div>
                        <div class="heat-name">Payoff Tracker Agent</div>
                        <div class="heat-desc">Monitor and track payoff request status and expiration</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>N/A</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                    <div class="heat-item medium" onclick="scrollToAgent('agent-validator')">
                        <div class="heat-score">6.5</div>
                        <div class="heat-name">Payoff Validator Agent</div>
                        <div class="heat-desc">Validate received payoff statements for completeness</div>
                        <div class="heat-metrics">
                            <div class="heat-metric">Time: <span>2 min</span></div>
                            <div class="heat-metric">Complexity: <span>Low</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agent Details -->
            <div id="agent-details">
                <h2 style="color: var(--text-primary); margin-bottom: 25px; font-size: 1.5rem;">Agent Details</h2>
                <div class="agent-grid">
                    <!-- Auto-Fill Agent -->
                    <div class="agent-card" id="agent-autofill">
                        <div class="agent-card-header">
                            <div class="agent-icon">A</div>
                            <div class="agent-info">
                                <div class="agent-name">Auto-Fill Agent</div>
                                <div class="agent-type">Data Extraction / Form Population</div>
                            </div>
                            <span class="agent-priority critical">Critical</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Automatically extracts lender/creditor information from credit reports and LOS data to pre-populate payoff request forms. Identifies all accounts requiring payoffs, extracts account numbers, lender names, and borrower information, then generates completed forms ready for submission.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Parse Credit Report</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Extract Accounts</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Calc Good Through</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Generate Forms</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">5 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">98%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('autofill')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Smart Submission Agent -->
                    <div class="agent-card" id="agent-submission">
                        <div class="agent-card-header">
                            <div class="agent-icon">S</div>
                            <div class="agent-info">
                                <div class="agent-name">Smart Submission Agent</div>
                                <div class="agent-type">Integration / Routing</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Maintains a database of lender payoff submission methods and automatically routes completed payoff requests via the appropriate channel (portal, fax, email). Handles lender-specific requirements and authorization needs.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Identify Lender</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Lookup Method</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Attach Auth</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Submit Request</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">8 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">95%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Med</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('submission')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Payoff Tracker Agent -->
                    <div class="agent-card" id="agent-tracker">
                        <div class="agent-card-header">
                            <div class="agent-icon">T</div>
                            <div class="agent-info">
                                <div class="agent-name">Payoff Tracker Agent</div>
                                <div class="agent-type">Monitoring / Alerts</div>
                            </div>
                            <span class="agent-priority high">High</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Tracks all outstanding payoff requests, monitors response times, and alerts processors when follow-up is needed. Also monitors received payoff statements for upcoming good-through date expirations and triggers re-requests when needed.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Track Requests</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Monitor Status</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Check Expiration</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Send Alerts</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">N/A</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">99%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('tracker')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>

                    <!-- Payoff Validator Agent -->
                    <div class="agent-card" id="agent-validator">
                        <div class="agent-card-header">
                            <div class="agent-icon">V</div>
                            <div class="agent-info">
                                <div class="agent-name">Payoff Validator Agent</div>
                                <div class="agent-type">Document Analysis / QC</div>
                            </div>
                            <span class="agent-priority medium">Medium</span>
                        </div>
                        <div class="agent-card-body">
                            <p class="agent-description">Analyzes received payoff statements to verify completeness, extract key data points (payoff amount, per diem, wire instructions), and flag any missing information before the document is used for closing.</p>
                            <div class="agent-flow">
                                <div class="agent-flow-title">Agent Flow</div>
                                <div class="agent-flow-diagram">
                                    <span class="agent-step">Receive Payoff</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Parse Document</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Validate Fields</span>
                                    <span class="agent-arrow">-></span>
                                    <span class="agent-step">Flag Issues</span>
                                </div>
                            </div>
                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">2 min</div>
                                    <div class="agent-stat-label">Time Saved</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">97%</div>
                                    <div class="agent-stat-label">Accuracy</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">Low</div>
                                    <div class="agent-stat-label">Complexity</div>
                                </div>
                            </div>
                            <button class="agent-prompt-btn" onclick="showAgentPrompt('validator')">
                                View Build Prompt
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Documentation Modal -->
    <div class="modal-overlay" id="docModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Payoff Request Form Documentation</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyToClipboard()">Copy</button>
                    <button class="modal-btn close" onclick="closeDocModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <pre id="docContent"># Payoff Request Form - CMG Financial

## Overview
The Payoff Request Form is used to request payoff statements from lenders and creditors. A payoff statement provides the exact amount needed to satisfy and close an existing loan or debt as of a specific date.

## Form Fields

### Required Information
- **Date**: Current date when submitting request
- **Credit/Lender Name**: Full name of lender/servicer
- **Account/Loan Number**: Exact account identifier
- **Good Through Date**: Closing date + 7-10 days buffer
- **Borrower(s)**: Full legal names on the account
- **Address**: Property or mailing address

## When to Use
- Rate and Term Refinance
- Cash-Out Refinance
- Debt Consolidation
- Lien Payoff (when subordination not possible)

## Submission Methods
1. Online Portal (fastest)
2. Automated Phone
3. Email
4. Fax
5. Mail (last resort)

## Follow-Up Timeline
- Day 0: Submit and log
- Day 5: First follow-up
- Day 7: Second follow-up
- Day 10: Escalate

## Payoff Statement Verification
Verify these items when received:
- Principal balance
- Accrued interest
- Per diem rate
- Fees and penalties
- Total payoff amount
- Wire instructions
- Good through date

## Common Issues
- Account not found -> Verify number/check transfers
- Authorization required -> Get borrower signature
- Expired good through -> Request updated payoff
- Amount disputed -> Request itemized breakdown</pre>
            </div>
        </div>
    </div>

    <!-- AI Prompt Modal -->
    <div class="modal-overlay prompt-modal" id="promptModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="promptModalTitle">AI Agent Build Prompt</h3>
                <div class="modal-actions">
                    <button class="modal-btn copy" onclick="copyPromptToClipboard()">Copy Prompt</button>
                    <button class="modal-btn close" onclick="closePromptModal()">Close</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="prompt-tags" id="promptTags"></div>
                <div class="prompt-section">
                    <h4>Agent Purpose</h4>
                    <div class="prompt-box" id="promptPurpose"></div>
                </div>
                <div class="prompt-section">
                    <h4>Full Build Prompt</h4>
                    <div class="prompt-box" id="promptContent"></div>
                </div>
                <div class="prompt-section">
                    <h4>Integration Points</h4>
                    <div class="prompt-box" id="promptIntegration"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="copy-success" id="copySuccess">Copied to clipboard!</div>

    <script>
        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));

            if (tab === 'workflow') {
                document.querySelector('.sidebar-tab:not(.agent-tab)').classList.add('active');
                document.getElementById('workflow-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'block';
                document.getElementById('agents-nav').style.display = 'none';
            } else {
                document.querySelector('.sidebar-tab.agent-tab').classList.add('active');
                document.getElementById('agents-panel').classList.add('active');
                document.getElementById('workflow-nav').style.display = 'none';
                document.getElementById('agents-nav').style.display = 'block';
            }

            window.scrollTo(0, 0);
        }

        // Scroll spy with isScrolling flag and 1000ms timeout
        const sections = document.querySelectorAll('.section, .quick-ref');
        const navItems = document.querySelectorAll('#workflow-nav .nav-item');
        let isScrolling = false;
        let scrollTimeout;

        function updateActiveNav() {
            if (isScrolling) return;

            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                if (window.scrollY >= sectionTop) current = section.getAttribute('id');
            });
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + current) item.classList.add('active');
            });
        }

        // Handle nav click to temporarily disable scroll spy
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                isScrolling = true;
                clearTimeout(scrollTimeout);

                // Remove active from all, add to clicked
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');

                // Re-enable scroll spy after 1000ms
                scrollTimeout = setTimeout(() => {
                    isScrolling = false;
                }, 1000);
            });
        });

        window.addEventListener('scroll', updateActiveNav);

        // Modal
        function openDocModal() {
            document.getElementById('docModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeDocModal() {
            document.getElementById('docModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyToClipboard() {
            try {
                await navigator.clipboard.writeText(document.getElementById('docContent').textContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) { alert('Failed to copy.'); }
        }

        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeDocModal(); closePromptModal(); } });
        document.getElementById('docModal').addEventListener('click', (e) => { if (e.target.id === 'docModal') closeDocModal(); });

        document.addEventListener('DOMContentLoaded', () => { updateActiveNav(); });

        // Scroll to agent card and highlight
        function scrollToAgent(agentId) {
            const agentCard = document.getElementById(agentId);
            if (agentCard) {
                document.querySelectorAll('.agent-card.highlight').forEach(card => {
                    card.classList.remove('highlight');
                });

                agentCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

                setTimeout(() => {
                    agentCard.classList.add('highlight');
                }, 300);

                setTimeout(() => {
                    agentCard.classList.remove('highlight');
                }, 2500);
            }
        }

        // Agent Prompt System
        const agentPrompts = {
            autofill: {
                name: 'Auto-Fill Agent',
                tags: ['Data Extraction', 'Form Population', 'Low Complexity', 'Critical Priority'],
                purpose: `This agent automatically extracts lender/creditor information from credit reports and LOS data to pre-populate payoff request forms. It identifies all accounts requiring payoffs, extracts account numbers, lender names, and borrower information, then generates completed forms ready for submission.`,
                prompt: `You are building a Data Extraction Agent for CMG Financial's Payoff Request process.

AGENT NAME: Payoff Auto-Fill Agent
TYPE: Data Extraction / Form Population

OBJECTIVE:
Create an agent that automatically populates CMG Financial's Payoff Request Form by extracting data from credit reports and the LOS database.

INPUT DATA SOURCES:
1. Credit Report (Tri-Merge)
   - Tradeline account numbers
   - Creditor names
   - Current balances
   - Account types (mortgage, HELOC, auto, credit card)

2. LOS Database
   - Borrower names (legal)
   - Property address
   - Expected closing date
   - Loan purpose (refinance/purchase)

DATA EXTRACTION LOGIC:
1. Parse credit report for accounts to be paid off:
   - Mortgages on subject property
   - HELOCs/2nd mortgages
   - Debts marked for consolidation

2. For each account extract:
   {
     "creditor_name": "string",
     "account_number": "string",
     "current_balance": number,
     "account_type": "MORTGAGE|HELOC|AUTO|CC|OTHER",
     "monthly_payment": number
   }

3. Calculate Good Through Date:
   - Get expected_closing_date from LOS
   - Add 10 business days as buffer
   - Format as MM/DD/YYYY

FORM FIELD MAPPING:
- Date: Current date (auto)
- Credit/Lender Name: creditor_name
- Account/Loan Number: account_number
- Good Through Date: calculated_good_through
- Borrower(s): LOS.borrower_name + LOS.coborrower_name
- Address: LOS.property_address OR LOS.mailing_address

OUTPUT:
- Generate one completed PDF form per payoff account
- Store in loan file under "Payoff Requests" category
- Return list of generated forms for processor review`,
                integration: `INTEGRATION POINTS:

1. Credit Report Parser
   - Accept tri-merge XML/PDF
   - Extract tradeline data
   - Identify accounts by type

2. LOS Database
   - Query borrower info
   - Get closing date from pipeline
   - Retrieve property address

3. PDF Generation
   - Use PDF form filling library
   - Populate CMG Payoff Request template
   - Maintain form field formatting

4. Document Management
   - Auto-save to loan file
   - Set document type: "Payoff Request"
   - Link to originating tradeline

DEPLOYMENT:
- Trigger: Manual initiation by processor
- Also trigger on: Loan purpose = Refinance
- Background processing with status indicator`
            },
            submission: {
                name: 'Smart Submission Agent',
                tags: ['Integration', 'Routing', 'Medium Complexity', 'High Priority'],
                purpose: `This agent maintains a database of lender payoff submission methods and automatically routes completed payoff requests via the appropriate channel (portal, fax, email). It handles lender-specific requirements including authorization needs and special forms.`,
                prompt: `You are building a Routing Agent for CMG Financial's Payoff Request process.

AGENT NAME: Smart Submission Agent
TYPE: Integration / Intelligent Routing

OBJECTIVE:
Automatically submit payoff requests to lenders via their preferred submission method, handling authentication, authorization, and lender-specific requirements.

LENDER DATABASE SCHEMA:
{
  "lender_id": "string",
  "lender_name": "string",
  "submission_methods": [
    {
      "priority": 1,
      "type": "PORTAL|FAX|EMAIL|PHONE",
      "endpoint": "string",
      "credentials": "encrypted_ref",
      "requires_auth_letter": boolean,
      "special_form_required": boolean,
      "special_form_url": "string"
    }
  ],
  "expected_response_days": number,
  "notes": "string"
}

SUBMISSION LOGIC:
1. Receive completed payoff request form
2. Identify lender from form data
3. Lookup lender in database
4. Select highest priority submission method
5. Check if authorization letter required
   - If yes, attach borrower auth letter
6. Check if special form required
   - If yes, download and complete lender's form
7. Submit via appropriate channel:

PORTAL SUBMISSION:
- Use Puppeteer/Playwright automation
- Handle OAuth/login flows
- Upload documents
- Capture confirmation number

FAX SUBMISSION:
- Use cloud fax API (eFax, Twilio)
- Attach cover sheet with CMG branding
- Include callback number
- Log transmission confirmation

EMAIL SUBMISSION:
- Use SendGrid/SES
- Standard subject line format
- Attach PDFs
- Request read receipt

OUTPUT:
{
  "submission_id": "uuid",
  "lender": "lender_name",
  "method_used": "PORTAL|FAX|EMAIL",
  "confirmation": "string",
  "submitted_at": "timestamp",
  "expected_response": "date"
}`,
                integration: `INTEGRATION POINTS:

1. Lender Database
   - Maintain list of 500+ lenders
   - Store submission preferences
   - Track success rates by method

2. Portal Automation
   - Headless browser automation
   - Credential management (vault)
   - Handle 2FA where needed

3. Fax Service
   - Cloud fax API integration
   - Delivery confirmation
   - Retry logic for failures

4. Email Service
   - SMTP integration
   - Template management
   - Attachment handling

5. Authorization System
   - Check for signed auth in file
   - Request if missing
   - Auto-attach when present

LENDER ONBOARDING:
- Admin interface to add new lenders
- Bulk import from industry databases
- Periodic validation of submission methods`
            },
            tracker: {
                name: 'Payoff Tracker Agent',
                tags: ['Monitoring', 'Alerts', 'Low Complexity', 'High Priority'],
                purpose: `This agent tracks all outstanding payoff requests, monitors response times, alerts processors when follow-up is needed, and monitors received payoff statements for upcoming good-through date expirations.`,
                prompt: `You are building a Monitoring Agent for CMG Financial's Payoff Request process.

AGENT NAME: Payoff Tracker Agent
TYPE: Monitoring / Proactive Alerts

OBJECTIVE:
Track all payoff requests from submission through receipt, monitor expiration dates, and proactively alert processors to prevent delays.

TRACKING DATA MODEL:
{
  "payoff_request_id": "uuid",
  "loan_number": "string",
  "lender_name": "string",
  "account_number": "string",
  "submitted_date": "date",
  "submission_method": "string",
  "expected_response_date": "date",
  "status": "SUBMITTED|PENDING|RECEIVED|EXPIRED",
  "received_date": "date|null",
  "good_through_date": "date|null",
  "payoff_amount": number|null,
  "processor": "string",
  "follow_ups": [
    {
      "date": "date",
      "method": "string",
      "notes": "string"
    }
  ]
}

MONITORING RULES:

1. Pending Request Alerts:
   - Day 3: Status check reminder
   - Day 5: First follow-up alert
   - Day 7: Urgent follow-up alert
   - Day 10: Escalation alert to supervisor

2. Good Through Date Monitoring:
   - 7 days before: INFO alert
   - 3 days before: WARNING alert
   - 1 day before: URGENT alert
   - Day 0: EXPIRED alert + auto-request new payoff

3. Closing Date Comparison:
   - Alert if good_through_date < closing_date
   - Recommend requesting updated payoff

ALERT CHANNELS:
- Email to processor
- LOS task creation
- Dashboard notification
- Teams/Slack webhook (optional)

ALERT MESSAGE FORMAT:
{
  "alert_type": "FOLLOW_UP|EXPIRING|EXPIRED",
  "loan_number": "string",
  "lender": "string",
  "days_outstanding": number,
  "action_required": "string",
  "processor": "string"
}

DASHBOARD METRICS:
- Total outstanding requests
- Average response time by lender
- Requests by status
- Expiring within 7 days`,
                integration: `INTEGRATION POINTS:

1. Request Database
   - Store all payoff requests
   - Track status changes
   - Log follow-up activities

2. LOS Integration
   - Get closing dates
   - Create follow-up tasks
   - Update loan status

3. Notification Services
   - Email via SendGrid
   - In-app notifications
   - Webhook to Teams/Slack

4. Reporting
   - Daily digest emails
   - Lender performance metrics
   - Pipeline status dashboard

BATCH PROCESSING:
- Run every 4 hours
- Morning digest at 7 AM
- End-of-day summary at 5 PM

ESCALATION MATRIX:
Day 5: Processor alert
Day 7: + Supervisor CC
Day 10: + Manager + alternative methods`
            },
            validator: {
                name: 'Payoff Validator Agent',
                tags: ['Document Analysis', 'QC', 'Low Complexity', 'Medium Priority'],
                purpose: `This agent analyzes received payoff statements to verify completeness, extract key data points (payoff amount, per diem, wire instructions), and flag any missing information before the document is used for closing.`,
                prompt: `You are building a Document Analysis Agent for CMG Financial's Payoff Request process.

AGENT NAME: Payoff Validator Agent
TYPE: Document Analysis / Quality Control

OBJECTIVE:
Automatically analyze received payoff statements to extract key data, verify completeness, and flag any issues before the document is used for closing preparation.

REQUIRED FIELDS TO EXTRACT:
{
  "lender_name": "string",
  "account_number": "string",
  "borrower_name": "string",
  "property_address": "string",
  "principal_balance": number,
  "interest_accrued": number,
  "per_diem": number,
  "fees": [
    {
      "description": "string",
      "amount": number
    }
  ],
  "total_payoff": number,
  "good_through_date": "date",
  "wire_instructions": {
    "bank_name": "string",
    "routing_number": "string",
    "account_number": "string",
    "reference": "string"
  },
  "special_instructions": "string"
}

VALIDATION RULES:

1. Completeness Checks:
   [ ] Principal balance present
   [ ] Per diem rate stated
   [ ] Good through date specified
   [ ] Wire instructions complete
   [ ] Total matches component sum

2. Accuracy Checks:
   [ ] Account number matches request
   [ ] Borrower name matches loan file
   [ ] Good through date >= closing date
   [ ] Wire routing number valid (9 digits)

3. Red Flag Detection:
   - Prepayment penalty present
   - Unusually high fees
   - Good through date in past
   - Missing wire instructions

OUTPUT:
{
  "validation_status": "PASS|WARN|FAIL",
  "extracted_data": {...},
  "issues": [
    {
      "severity": "ERROR|WARNING|INFO",
      "field": "string",
      "message": "string"
    }
  ],
  "ready_for_closing": boolean
}

OCR PROCESSING:
- Use Tesseract or cloud OCR
- Handle multi-page documents
- Extract tabular data
- Parse various lender formats`,
                integration: `INTEGRATION POINTS:

1. Document Ingestion
   - Watch folder for new payoffs
   - Email attachment parsing
   - Portal download monitoring

2. OCR Engine
   - Tesseract for on-premise
   - AWS Textract for cloud
   - Google Vision API alternative

3. Data Extraction
   - Template matching for common lenders
   - ML model for unknown formats
   - Human review queue for low confidence

4. LOS Update
   - Write extracted data to loan file
   - Update payoff tracking record
   - Trigger CD/HUD recalculation

5. Closing Preparation
   - Auto-populate CD payoff section
   - Generate wire instruction summary
   - Flag for title company

ACCURACY METRICS:
- Track extraction accuracy
- Log human corrections
- Retrain models on corrections`
            }
        };

        // Show agent prompt modal
        let currentPromptContent = '';

        function showAgentPrompt(agentKey) {
            const agent = agentPrompts[agentKey];
            if (!agent) return;

            document.getElementById('promptModalTitle').textContent = agent.name + ' - Build Prompt';

            const tagsHtml = agent.tags.map(tag => '<span class="prompt-tag">' + tag + '</span>').join('');
            document.getElementById('promptTags').innerHTML = tagsHtml;

            document.getElementById('promptPurpose').textContent = agent.purpose;
            document.getElementById('promptContent').textContent = agent.prompt;
            document.getElementById('promptIntegration').textContent = agent.integration;

            currentPromptContent = '# ' + agent.name + '\n\n## Purpose\n' + agent.purpose + '\n\n## Build Prompt\n' + agent.prompt + '\n\n## Integration Points\n' + agent.integration;

            document.getElementById('promptModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closePromptModal() {
            document.getElementById('promptModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyPromptToClipboard() {
            try {
                await navigator.clipboard.writeText(currentPromptContent);
                const success = document.getElementById('copySuccess');
                success.style.display = 'block';
                setTimeout(() => { success.style.display = 'none'; }, 2000);
            } catch (e) {
                alert('Failed to copy prompt.');
            }
        }

        document.getElementById('promptModal').addEventListener('click', (e) => {
            if (e.target.id === 'promptModal') closePromptModal();
        });
    </script>
</body>
</html>
